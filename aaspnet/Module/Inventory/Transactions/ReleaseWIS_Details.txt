=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/Inventory/Transactions/ReleaseWIS_Details.aspx.txt ===

﻿<%@ Page Language="C#" MasterPageFile="~/MasterPage.master" AutoEventWireup="true" CodeFile="ReleaseWIS_Details.aspx.cs" Inherits="Module_Inventory_Transactions_ReleaseWIS_Details" Title="ERP" Theme="Default" %>

<asp:Content ID="Content1" ContentPlaceHolderID="head" Runat="Server">
<link href="../../../Css/yui-datatable.css" rel="stylesheet" type="text/css" />
    <link href="../../../Css/StyleSheet.css" rel="stylesheet" type="text/css" />
     <script src="../../../Javascript/loadingNotifier.js" type="text/javascript"></script>
    
</asp:Content>
<asp:Content ID="Content2" ContentPlaceHolderID="cp3" Runat="Server">
</asp:Content>
<asp:Content ID="Content3" ContentPlaceHolderID="cp1" Runat="Server">
</asp:Content>
<asp:Content ID="Content4" ContentPlaceHolderID="cp2" Runat="Server">
</asp:Content>
<asp:Content ID="Content5" ContentPlaceHolderID="MainContent" Runat="Server">
</asp:Content>
<asp:Content ID="Content6" ContentPlaceHolderID="ContentPlaceHolder2" Runat="Server">
</asp:Content>
<asp:Content ID="Content7" ContentPlaceHolderID="ContentPlaceHolder3" Runat="Server">

<table align="left" cellpadding="0" cellspacing="0" width="100%">
        <tr>
            <td  align="left" valign="middle" style="background:url(../../../images/hdbg.JPG)" height="21" class="fontcsswhite"><b>&nbsp;Release WO for WIS</b></td>
        </tr>
        <tr>
            <td>
                <asp:GridView ID="GridView2" runat="server" CssClass="yui-datatable-theme" 
                    AllowPaging="True" AutoGenerateColumns="False" Width="70%" 
             
                    onpageindexchanging="GridView2_PageIndexChanging" PageSize="20">
                    <PagerSettings PageButtonCount="40" />
                    <Columns>
                        <asp:TemplateField HeaderText="SN">
                        <ItemTemplate>
                        <%# Container.DataItemIndex+1 %>
                        </ItemTemplate>
                            <ItemStyle HorizontalAlign="Right" />
                        </asp:TemplateField>                        
                       
                           
                        <asp:TemplateField HeaderText="Id" Visible="false">
                            <ItemTemplate>
                            <asp:Label ID="lblId" runat="server" Text='<%#Eval("Id") %>' />
                            </ItemTemplate>
                            <ItemStyle HorizontalAlign="Center" />
                        </asp:TemplateField>
                          <asp:TemplateField HeaderText="Fin Year">
                            <ItemTemplate>
                            <asp:Label ID="lblyear" runat="server" Text='<%#Eval("FinYear") %>' />
                            </ItemTemplate>
                            <ItemStyle HorizontalAlign="Center" />
                        </asp:TemplateField>
                        <asp:TemplateField HeaderText="WO No">
                            <ItemTemplate>
                            <asp:Label ID="lblwono" runat="server" Text='<%#Eval("WONo") %>' />
                            </ItemTemplate>
                            <ItemStyle HorizontalAlign="Center" />
                        </asp:TemplateField>
                       
                        <asp:TemplateField HeaderText="Rel Date">
                            <ItemTemplate>
                            <asp:Label ID="lblreldate" runat="server" Text='<%#Eval("ReleaseSysDate") %>' />
                            </ItemTemplate>
                            <ItemStyle HorizontalAlign="Center" />
                        </asp:TemplateField>
                        <asp:TemplateField HeaderText="Rel Time">
                         <ItemTemplate>
                            <asp:Label ID="lblreltime" runat="server" Text='<%#Eval("ReleaseSysTime") %>' />
                            </ItemTemplate>
                            <ItemStyle HorizontalAlign="Center" />
                        </asp:TemplateField>
                        <asp:TemplateField HeaderText="Release By">
                         <ItemTemplate>
                            <asp:Label ID="lblrelby" runat="server" Text='<%#Eval("GenBy") %>' />
                            </ItemTemplate>
                            <ItemStyle HorizontalAlign="Left" Width="50%"/>
                        </asp:TemplateField>
                      
                    </Columns>
                    <EmptyDataTemplate>
                                    <table width="100%" class="fontcss"><tr><td align="center" >
                                    <asp:Label ID="Label1" runat="server"  Text="No  data found to display" Font-Bold="true"
    Font-Names="Calibri" ForeColor="red"></asp:Label></td></tr>
    </table>
                                    </EmptyDataTemplate>
                    
                    
                </asp:GridView>
            </td>
        </tr>
        <tr>
            <td height="25">
                &nbsp;<asp:Button ID="Button1" runat="server" CssClass="redbox" 
                    onclick="Button1_Click" Text="Cancel" />
                &nbsp;</td>
        </tr>
    </table>


</asp:Content>
<asp:Content ID="Content8" ContentPlaceHolderID="ContentPlaceHolder4" Runat="Server">
</asp:Content>



=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/Inventory/Transactions/ReleaseWIS_Details.aspx.cs ===

﻿using System;
using System.Collections;
using System.Configuration;
using System.Data;
using System.Linq;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Xml.Linq;
using System.Data.SqlClient;

public partial class Module_Inventory_Transactions_ReleaseWIS_Details : System.Web.UI.Page
{
    clsFunctions fun = new clsFunctions();
    int CompId = 0;
    int FinYearId = 0;
    string SId = "";
    string wono = "";

    protected void Page_Load(object sender, EventArgs e)
    {
        FinYearId = Convert.ToInt32(Session["finyear"]);
        try
        {
            CompId = Convert.ToInt32(Request.QueryString["cid"]);

            wono = Request.QueryString["wn"].ToString();
            SId = Session["username"].ToString();

            if (!IsPostBack)
            {
                this.loadgrid();
            }

        }
        catch (Exception ex)
        {
        }
    }

   public void loadgrid()
   {
       string   connStr = fun.Connection();
       SqlConnection con = new SqlConnection(connStr);

       try
       {

           SqlCommand Cmdgrid = new SqlCommand(fun.select("Id,CompId ,WONo,FinYearId,WONo,ReleaseSysDate,ReleaseSysTime,ReleaseBy", "tblInv_WORelease_WIS", "CompId='" + CompId + "' And WONO='" + wono + "' Order by Id Desc"), con);
           SqlDataAdapter dagrid = new SqlDataAdapter(Cmdgrid);
           DataSet DS = new DataSet();
           dagrid.Fill(DS);

           DataTable dt = new DataTable();
           dt.Columns.Add(new System.Data.DataColumn("Id", typeof(string)));
           dt.Columns.Add(new System.Data.DataColumn("WONo", typeof(string)));
           dt.Columns.Add(new System.Data.DataColumn("FinYear", typeof(string)));
           dt.Columns.Add(new System.Data.DataColumn("ReleaseSysDate", typeof(string)));
           dt.Columns.Add(new System.Data.DataColumn("ReleaseSysTime", typeof(string)));
           dt.Columns.Add(new System.Data.DataColumn("GenBy", typeof(string)));

           if (DS.Tables[0].Rows.Count > 0)
           {
               DataRow dr;
               for (int i = 0; i < DS.Tables[0].Rows.Count; i++)
               {
                   dr = dt.NewRow();

                   dr[0] = DS.Tables[0].Rows[i]["Id"].ToString();
                   dr[1] = DS.Tables[0].Rows[i]["WONo"].ToString();

                   string sqlFin = fun.select("FinYear", "tblFinancial_master", "FinYearId='" + DS.Tables[0].Rows[i]["FinYearId"].ToString() + "'");
                   SqlCommand cmdFinYr = new SqlCommand(sqlFin, con);
                   SqlDataAdapter daFin = new SqlDataAdapter(cmdFinYr);
                   DataSet DSFin = new DataSet();
                   daFin.Fill(DSFin);

                   if (DSFin.Tables[0].Rows.Count > 0)
                   {
                     dr[2] = DSFin.Tables[0].Rows[0]["FinYear"].ToString();
                   }

                   dr[3] = fun.FromDateDMY(DS.Tables[0].Rows[i]["ReleaseSysDate"].ToString());
                   dr[4] = DS.Tables[0].Rows[0]["ReleaseSysTime"].ToString();

                   if (DS.Tables[0].Rows[i]["ReleaseBy"] != DBNull.Value)
                   {
                       string sqlGenBy = fun.select("tblHR_OfficeStaff.Title+'. '+tblHR_OfficeStaff.EmployeeName AS GenBy", "tblHR_OfficeStaff", "tblHR_OfficeStaff.EmpId='" + DS.Tables[0].Rows[i]["ReleaseBy"].ToString() + "'");
                       SqlCommand cmdGenBy = new SqlCommand(sqlGenBy, con);
                       SqlDataAdapter daGenBy = new SqlDataAdapter(cmdGenBy);
                       DataSet DSGenBy = new DataSet();
                       daGenBy.Fill(DSGenBy);
                       if (DSGenBy.Tables[0].Rows.Count > 0)
                       {
                           dr[5] = DSGenBy.Tables[0].Rows[0]["GenBy"].ToString();
                       }
                   }

                   dt.Rows.Add(dr);
                   dt.AcceptChanges();
               }
           }
           GridView2.DataSource = dt;
           GridView2.DataBind();
       }
       catch (Exception st)
       {

       }
   }

   protected void GridView2_PageIndexChanging(object sender, GridViewPageEventArgs e)
   {
       GridView2.PageIndex = e.NewPageIndex;
       this.loadgrid();
   }
   protected void Button1_Click(object sender, EventArgs e)
   {
       Response.Redirect("ReleaseWIS.aspx?ModId=9");
   }
}
