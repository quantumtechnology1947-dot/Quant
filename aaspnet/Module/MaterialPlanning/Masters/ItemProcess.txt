=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/MaterialPlanning/Masters/ItemProcess.aspx.txt ===

﻿<%@ Page Language="C#" MasterPageFile="~/MasterPage.master" AutoEventWireup="true" CodeFile="ItemProcess.aspx.cs" Inherits="Module_MaterialPlanning_Masters_ItemProcess" Title="ERP" Theme ="Default"  %>
<asp:Content ID="Content1" ContentPlaceHolderID="head" Runat="Server">
    <link href="../../../Css/StyleSheet.css" rel="stylesheet" type="text/css" />
    <link href="../../../Css/yui-datatable.css" rel="stylesheet" type="text/css" />

    <script src="../../../Javascript/PopUpMsg.js" type="text/javascript"></script>

    <script src="../../../Javascript/loadingNotifier.js" type="text/javascript"></script>
</asp:Content>
<asp:Content ID="Content2" ContentPlaceHolderID="cp3" Runat="Server">
</asp:Content>
<asp:Content ID="Content3" ContentPlaceHolderID="cp1" Runat="Server">
</asp:Content>
<asp:Content ID="Content4" ContentPlaceHolderID="cp2" Runat="Server">
</asp:Content>
<asp:Content ID="Content5" ContentPlaceHolderID="MainContent" Runat="Server">
</asp:Content>
<asp:Content ID="Content6" ContentPlaceHolderID="ContentPlaceHolder2" Runat="Server">
</asp:Content>
<asp:Content ID="Content7" ContentPlaceHolderID="ContentPlaceHolder3" Runat="Server">

<table cellpadding="0" cellspacing="0" width="100%">
        <tr>
            <td>
    <table cellpadding="0" cellspacing="0" align="center" style="width: 40%">
        <tr>
            <td align="center" valign="top">&nbsp;</td>
        </tr>
        <tr>
            <td align="left" valign="middle" style="background:url(../../../images/hdbg.JPG)" height="21" class="fontcsswhite"><b>
                            &nbsp;Material Process</b>
                        </td>
        </tr>
        <tr>
            <td align="center" valign="top">
                <asp:GridView ID="GridView1" 
                runat="server" 
                AllowPaging="True" PageSize="15"
                ShowFooter="True"  DataKeyNames="Id"
                AutoGenerateColumns="False" 
                FooterStyle-Wrap="True" 
               OnRowCommand="GridView1_RowCommand" CssClass="yui-datatable-theme" 
                    Width="100%" onpageindexchanging="GridView1_PageIndexChanging" 
                    onrowcancelingedit="GridView1_RowCancelingEdit" 
                    onrowdeleting="GridView1_RowDeleting" onrowediting="GridView1_RowEditing" 
                    onrowupdating="GridView1_RowUpdating" 
                    onrowdatabound="GridView1_RowDataBound1" onrowdeleted="GridView1_RowDeleted" 
                    onrowupdated="GridView1_RowUpdated">
                    
            <FooterStyle Wrap="True"></FooterStyle>
            
            <Columns> 
                     
                    <asp:TemplateField HeaderText="SN">
                    <ItemTemplate>
                    <%# Container.DataItemIndex+1 %>
                    </ItemTemplate>
                     <FooterTemplate>
                    <asp:Button ID="btnInsert" runat="server" CommandName="Add"  CssClass="redbox" 
                     OnClientClick=" return confirmationAdd()" Text="Insert" ValidationGroup="SG" />                      
                    </FooterTemplate>
                    
                    <HeaderStyle Font-Size="10pt" />
                    <ItemStyle HorizontalAlign="Right" VerticalAlign="Top" Width="5%" />
                    </asp:TemplateField>
                    
                     <asp:CommandField ShowEditButton="True"  >
                         <ItemStyle HorizontalAlign="Center" />
                    </asp:CommandField>
                    <asp:TemplateField ShowHeader="False">
                        <ItemTemplate>
                            <asp:LinkButton ID="LinkButton1"  OnClientClick=" return confirmationDelete()" runat="server" CausesValidation="false" 
                                CommandName="Del" Text="Delete"></asp:LinkButton>
                        </ItemTemplate>
                        <ItemStyle HorizontalAlign="Center" />
                    </asp:TemplateField>                    
                    
                    <asp:TemplateField HeaderText="Name of Process">
                    <ItemTemplate>
                    <asp:Label ID="lblProcessName" runat="server" Text='<%# Eval("ProcessName") %>'></asp:Label>                    
                  </ItemTemplate>
                  <EditItemTemplate>
                  <asp:TextBox ID ="txtPName" runat ="server" Width="95%"   CssClass="box3" Text='<%# Eval("ProcessName") %>'
                     ValidationGroup="A" >
                    </asp:TextBox>
                     <asp:RequiredFieldValidator ID="ReqProcessName" runat="server" ValidationGroup="A" ControlToValidate="txtPName" 
                    ErrorMessage="*">
                    </asp:RequiredFieldValidator> 
                  
                  </EditItemTemplate>
                  
                   <FooterTemplate>
                    <asp:TextBox ID="txtProcessName1" Width="95%" CssClass="box3" runat="server" ValidationGroup="SG">
                    </asp:TextBox>
                    <asp:RequiredFieldValidator ID="ReqProcessName1" runat="server" ValidationGroup="SG" ControlToValidate="txtProcessName1" 
                    ErrorMessage="*">
                    </asp:RequiredFieldValidator>                     
                    </FooterTemplate>
                    <ItemStyle VerticalAlign="Top" HorizontalAlign="Left" />
                    </asp:TemplateField>
                     
                    <asp:TemplateField HeaderText="Symbol">
                    <ItemTemplate>
                    <asp:Label ID="lblSymbol" runat="server" Text='<%# Eval("Symbol") %>'></asp:Label>
                    
                     </ItemTemplate>
                     <EditItemTemplate>
                     <asp:TextBox ID ="txtSymbol" CssClass="box3" Width="95%" runat ="server"  Text='<%# Eval("Symbol") %>'
                     ValidationGroup="A">
                    </asp:TextBox>
                     <asp:RequiredFieldValidator ID="ReqSymbol" ValidationGroup="A" runat="server" ControlToValidate="txtSymbol" 
                        ErrorMessage="*">
                        </asp:RequiredFieldValidator>
                     
                     </EditItemTemplate>
                     
                      <FooterTemplate>
                        <asp:TextBox ID="txtSymbol1" Width="95%" CssClass="box3" runat="server" ValidationGroup="SG">
                        </asp:TextBox>
                        <asp:RequiredFieldValidator ID="ReqSymbol" ValidationGroup="SG" runat="server" ControlToValidate="txtSymbol1" 
                        ErrorMessage="*">
                        </asp:RequiredFieldValidator>
                        </FooterTemplate>
                    <ItemStyle VerticalAlign="Top" HorizontalAlign="Center" />
                    </asp:TemplateField>                    
                    
                    <asp:TemplateField HeaderText="Id"   Visible="false">
                    <ItemTemplate>
                    <asp:Label ID="lblId" runat="server" Text='<%# Eval("Id") %>'></asp:Label>
                    </ItemTemplate>  
                    <ItemStyle VerticalAlign="Top" HorizontalAlign="Right" />
                    </asp:TemplateField>
                                        
                     
            
            </Columns>
            
            <EmptyDataTemplate>
            
            <table  width="100%" border="1" style="border-color:Gray">
                    <tr>
                    <td></td>
                    <td align="center">
                        <asp:Label ID="Label1" Font-Bold="true" Font-Size="Medium" Font-Names="Times New Roman" runat="server" Text="Name of Process"></asp:Label></td>
                        
                        <td align="center">
                         <asp:Label ID="Label2" runat="server" Font-Size="Medium" Font-Names="Times New Roman"  Font-Bold="true" Text="Symbol"></asp:Label></td>
                         <td align="center">
                          <asp:Label ID="Label3" runat="server" Font-Size="Medium"  Font-Names="Times New Roman" Font-Bold="true" Text="UOM Basic"></asp:Label>
                        </td>
                    </tr>
                    <tr>
                        <td>
            <asp:Button ID="btnInsert1" runat="server" CommandName="Add1"  CssClass="redbox" 
                     OnClientClick=" return confirmationAdd()" Text="Insert" ValidationGroup="SG1" />  
                     </td>
                     <td>
            <asp:TextBox ID="txtName" Width="95%" runat="server" CssClass="box3"></asp:TextBox>
             <asp:RequiredFieldValidator ID="ReqSymbol" ValidationGroup="SG1" runat="server" ControlToValidate="txtName" 
                        ErrorMessage="*">
                        </asp:RequiredFieldValidator>
            </td>
            <td>
            <asp:TextBox ID="txtSymbol"  Width="95%" runat="server"  CssClass="box3"></asp:TextBox>
            <asp:RequiredFieldValidator ID="RequiredFieldValidator1" ValidationGroup="SG1" runat="server" ControlToValidate="txtSymbol" 
                        ErrorMessage="*">
                        </asp:RequiredFieldValidator></td>
            <td>
            <asp:DropDownList ID="DDLBasic" runat="server" Width="95%" CssClass="box3" 
                    DataSourceID="SqlDataSource2" DataTextField="Symbol" DataValueField="Id">
                    </asp:DropDownList></td>                    
                    </table>
            </EmptyDataTemplate>
            
              </asp:GridView>
              
                <asp:SqlDataSource ID="SqlDataSource2" runat="server" 
                ConnectionString="<%$ ConnectionStrings:LocalSqlServer %>" 
                ProviderName="System.Data.SqlClient" 
                SelectCommand="SELECT * FROM [Unit_Master]">
                </asp:SqlDataSource>

                <asp:Label ID="lblmsg" runat="server"></asp:Label>

            </td>
            </tr>  
       
    </table>
            </td>
        </tr>
    </table>
</asp:Content>
<asp:Content ID="Content8" ContentPlaceHolderID="ContentPlaceHolder4" Runat="Server">
</asp:Content>

=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/MaterialPlanning/Masters/ItemProcess.aspx.cs ===

﻿using System;
using System.Collections;
using System.Configuration;
using System.Data;
using System.Linq;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Xml.Linq;
using System.Data.SqlClient;

public partial class Module_MaterialPlanning_Masters_ItemProcess : System.Web.UI.Page
{
    clsFunctions fun = new clsFunctions();
    string sId = "";
    int CompId = 0;
    protected void Page_Load(object sender, EventArgs e)
    {
        try
        {
            sId = Session["username"].ToString();
            CompId = Convert.ToInt32(Session["compid"]);
            if (!IsPostBack)
            {
                this.LoadData();

                //lblmsg.Text = "";
            }
        }

        catch (Exception ex)
        {
        }
    }

    public void LoadData()
    {

        try
        {
            string str = fun.Connection();
            SqlConnection con = new SqlConnection(str);
            con.Open();
            string sqlqty = fun.select("Id, ProcessName, Symbol", "tblPln_Process_Master","Id!='0'");
            SqlCommand cmdqty = new SqlCommand(sqlqty, con);
            SqlDataAdapter daqty = new SqlDataAdapter(cmdqty);
            DataSet DSqty = new DataSet();
            daqty.Fill(DSqty);

            DataTable dt = new DataTable();
            dt.Columns.Add(new System.Data.DataColumn("Id", typeof(int)));
            dt.Columns.Add(new System.Data.DataColumn("ProcessName", typeof(string)));
            dt.Columns.Add(new System.Data.DataColumn("Symbol", typeof(string)));
            
            DataRow dr;
            for (int i = 0; i < DSqty.Tables[0].Rows.Count; i++)
            {
                dr = dt.NewRow();
                if (DSqty.Tables[0].Rows.Count > 0)
                {

                    dr[0] = DSqty.Tables[0].Rows[i]["Id"].ToString();
                    dr[1] = DSqty.Tables[0].Rows[i]["ProcessName"].ToString();
                    dr[2] = DSqty.Tables[0].Rows[i]["Symbol"].ToString();
                  
                    dt.Rows.Add(dr);
                    dt.AcceptChanges();
                }
            }

            GridView1.DataSource = dt;
            GridView1.DataBind();
        }

        catch(Exception ex)
        {
        }

    }


    protected void GridView1_RowCommand(object sender, GridViewCommandEventArgs e)
    {

        try
        {
            string str = fun.Connection();
            SqlConnection con = new SqlConnection(str);

            if (e.CommandName == "Add")
            {
                string strtxtPName1 = ((TextBox)GridView1.FooterRow.FindControl("txtProcessName1")).Text;
                string strSymbol1 = ((TextBox)GridView1.FooterRow.FindControl("txtSymbol1")).Text;
               
                if (strtxtPName1 != "" && strSymbol1 != "")
                {
                    con.Open();
                    string add = fun.insert("tblPln_Process_Master", "ProcessName,Symbol", "'" + strtxtPName1 + "','" + strSymbol1 + "'");
                    SqlCommand cmdAdd = new SqlCommand(add, con);
                    cmdAdd.ExecuteNonQuery();
                    con.Close();

                    Page.Response.Redirect(Page.Request.Url.ToString(), true);
                }
            }


            if (e.CommandName == "Add1")
            {
                string strtxtPName1 = ((TextBox)GridView1.Controls[0].Controls[0].FindControl("txtName")).Text;
                string strSymbol1 = ((TextBox)GridView1.Controls[0].Controls[0].FindControl("txtSymbol")).Text;
               
                if (strtxtPName1 != "" && strSymbol1 != "")
                {
                    con.Open();
                    string add = fun.insert("tblPln_Process_Master", "ProcessName,Symbol", "'" + strtxtPName1 + "','" + strSymbol1 + "'");
                    SqlCommand cmdAdd = new SqlCommand(add, con);
                    cmdAdd.ExecuteNonQuery();

                    con.Close();
                    Page.Response.Redirect(Page.Request.Url.ToString(), true);
                }

            }
            if (e.CommandName == "Del")
            {

                GridViewRow row = (GridViewRow)(((LinkButton)e.CommandSource).NamingContainer);
                int id = Convert.ToInt32(((Label)row.FindControl("lblId")).Text);
                string upt = fun.delete("tblPln_Process_Master", "Id='" + id + "'");
                SqlCommand cmd = new SqlCommand(upt, con);
                con.Open();
                cmd.ExecuteNonQuery();
                con.Close();

                Page.Response.Redirect(Page.Request.Url.ToString(), true);
            }

        }

        catch(Exception ex)
        {
        }
    } 




    protected void GridView1_PageIndexChanging(object sender, GridViewPageEventArgs e)
    {
        GridView1.PageIndex = e.NewPageIndex;
        this.LoadData();
    }
    protected void GridView1_RowDeleting(object sender, GridViewDeleteEventArgs e)
    {
        
    }
    protected void GridView1_RowCancelingEdit(object sender, GridViewCancelEditEventArgs e)
    {
        try
        {
            GridView1.EditIndex = -1;
            this.LoadData();
        }
        catch (Exception ex) { }
    }
    protected void GridView1_RowEditing(object sender, GridViewEditEventArgs e)
    {
        try
        {
            GridView1.EditIndex = e.NewEditIndex;
            this.LoadData();
            string connStr = fun.Connection();
            SqlConnection con = new SqlConnection(connStr);
            int index = GridView1.EditIndex;
            GridViewRow row = GridView1.Rows[index];
            int id = Convert.ToInt32(((Label)row.FindControl("lblId")).Text);
            string sqlqty = fun.select("UOMBasic", "tblPln_Process_Master", "Id='" + id + "'");
            SqlCommand cmdqty = new SqlCommand(sqlqty, con);
            SqlDataAdapter daqty = new SqlDataAdapter(cmdqty);
            DataSet DSqty = new DataSet();
            daqty.Fill(DSqty);

            if (DSqty.Tables[0].Rows.Count > 0)
            {
                ((DropDownList)row.FindControl("DDLBasic")).SelectedValue = DSqty.Tables[0].Rows[0]["UOMBasic"].ToString();

            }

        }

        catch (Exception ex) { }

    }
    protected void GridView1_RowUpdating(object sender, GridViewUpdateEventArgs e)
    {

        try
        {
            string connStr = fun.Connection();            
            SqlConnection con = new SqlConnection(connStr);
            int index = GridView1.EditIndex;
            GridViewRow row = GridView1.Rows[index];
            int id = Convert.ToInt32(GridView1.DataKeys[e.RowIndex].Value);
            string strProcessName = ((TextBox)row.FindControl("txtPName")).Text;
            string strSymbol = ((TextBox)row.FindControl("txtSymbol")).Text;
          
            if (strProcessName != "" && strSymbol != "")
            {
                con.Open();
                string upt = fun.update("tblPln_Process_Master", "ProcessName='" + strProcessName + "',Symbol='" + strSymbol + "'", "Id='" + id + "'");
                SqlCommand cmd = new SqlCommand(upt, con);
                cmd.ExecuteNonQuery();
                con.Close();
                Page.Response.Redirect(Page.Request.Url.ToString(), true);
            }
        }
        catch (Exception ex)
        {
        }
    }
    

    protected void GridView1_RowDataBound1(object sender, GridViewRowEventArgs e)
    {
        try
        {
            if (e.Row.RowType == DataControlRowType.DataRow)
            {
                LinkButton del = (LinkButton)e.Row.Cells[1].Controls[0];
                del.Attributes.Add("onclick", "return confirmationUpdate();");

            }
            
        }
        catch (Exception ex) { }
    }
    protected void GridView1_RowDeleted(object sender, GridViewDeletedEventArgs e)
    {
        //lblmsg.Text = "Record deleted successfuly";
    }
    protected void GridView1_RowUpdated(object sender, GridViewUpdatedEventArgs e)
    {
        //lblmsg.Text = "Record updated successfuly";
    }
}


