=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/Machinery/Transactions/Schedule_Edit_Details.aspx.txt ===

﻿<%@ Page Language="C#" MasterPageFile="~/MasterPage.master" AutoEventWireup="true" CodeFile="Schedule_Edit_Details.aspx.cs" Inherits="Module_Machinery_Transactions_Schedule_Edit_Details" Title="ERP"  Theme="Default"%>
<%@ Register assembly="AjaxControlToolkit" namespace="AjaxControlToolkit" tagprefix="cc1" %>
<%@ Register assembly="TimePicker" namespace="MKB.TimePicker" tagprefix="MKB" %>
<asp:Content ID="Content1" ContentPlaceHolderID="head" Runat="Server">
<script src="../../../Javascript/loadingNotifier.js" type="text/javascript"></script>
    <link href="../../../Css/yui-datatable.css" rel="stylesheet" type="text/css" />
    <link href="../../../Css/StyleSheet.css" rel="stylesheet" type="text/css" />
    <script src="../../../Javascript/PopUpMsg.js" type="text/javascript"></script>

</asp:Content>
<asp:Content ID="Content2" ContentPlaceHolderID="cp3" Runat="Server">
</asp:Content>
<asp:Content ID="Content3" ContentPlaceHolderID="cp1" Runat="Server">
</asp:Content>
<asp:Content ID="Content4" ContentPlaceHolderID="cp2" Runat="Server">
</asp:Content>
<asp:Content ID="Content5" ContentPlaceHolderID="MainContent" Runat="Server">
</asp:Content>
<asp:Content ID="Content6" ContentPlaceHolderID="ContentPlaceHolder2" Runat="Server">
</asp:Content>
<asp:Content ID="Content7" ContentPlaceHolderID="ContentPlaceHolder3" Runat="Server">
<table align="left" cellpadding="0" cellspacing="0"  style="height:auto" width="100%" >
 <tr><td align="left" valign="middle" colspan="2" 
         style="background:url(../../../images/hdbg.JPG)" height="21" 
         class="fontcsswhite"><b>&nbsp;Job-Sheduling Input-Edit</b></td></tr>
 
 <tr>
 <td height="25" valign="middle" width="50%"> 
     &nbsp; 
     Item Code : <asp:Label ID="lblItemCode" runat="server" style="font-weight: 700"></asp:Label> 
     </td>
 
 <td height="25" valign="middle">
 
     &nbsp;UOM : <asp:Label ID="lblunit" runat="server" style="font-weight: 700"></asp:Label>
 
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BOM Qty : <asp:Label ID="lblBomqty" runat="server" style="font-weight: 700"></asp:Label>
 
     </td>
 
 </tr>
 
 <tr>
 <td height="25" valign="middle" width="50%">
 
     &nbsp; Description :&nbsp;<asp:Label ID="lblDesc" runat="server" style="font-weight: 700"></asp:Label>
 
     </td>
 
 <td height="25" valign="middle">
 
     &nbsp;WoNo : <asp:Label ID="lblWoNo" runat="server" style="font-weight: 700"></asp:Label>
 
     </td>
 
 </tr>
 
 <tr>
         <td align="left" colspan="2">
             <asp:GridView ID="GridView1" runat="server" AutoGenerateColumns="False" 
                    CssClass="yui-datatable-theme"  AllowPaging="True" 
                    Width="100%" PageSize="15"  DataKeyNames="Id"
                 onpageindexchanging="GridView1_PageIndexChanging" 
                 onrowediting="GridView1_RowEditing" 
                 onrowcancelingedit="GridView1_RowCancelingEdit" 
                 onrowupdating="GridView1_RowUpdating" 
                 onrowdatabound="GridView1_RowDataBound" ><FooterStyle Wrap="True"></FooterStyle>
                    <Columns><asp:TemplateField HeaderText="SN"><ItemTemplate><%#Container.DataItemIndex+1  %></ItemTemplate><HeaderStyle Font-Size="10pt" /><ItemStyle HorizontalAlign="Right" VerticalAlign="Top" Width="2%" /></asp:TemplateField>
                         <asp:CommandField ButtonType="Link"  ShowEditButton="True"  ItemStyle-Width="3%" ItemStyle-HorizontalAlign="Center" ValidationGroup="A"/>
              <asp:TemplateField HeaderText="Machine Name">
              
              <ItemTemplate>
                  <asp:Label ID="lblMachine" runat="server" Text='<%#Eval("MachineName")%>'></asp:Label>         
            </ItemTemplate>
            <EditItemTemplate>
            <asp:DropDownList ID="DrpMachine" Width="93%" AutoPostBack="true"  runat="server" 
        onselectedindexchanged="DrpMachine_SelectedIndexChanged">
       
        </asp:DropDownList>
         <asp:RequiredFieldValidator ID="reqMachineName"  ControlToValidate="DrpMachine" runat="server" ErrorMessage="*" ValidationGroup="A"  InitialValue="Select"> </asp:RequiredFieldValidator> 
            
            </EditItemTemplate>
            
            
            <ItemStyle HorizontalAlign="Left" Width="8%" />
            </asp:TemplateField>
            
            
            <asp:TemplateField HeaderText="Process">
            
            <ItemTemplate>
            <asp:Label ID="lblProcess" runat="server" Text='<%#Eval("Process")%>'></asp:Label>     
            </ItemTemplate>
            <ItemStyle Width="6%" HorizontalAlign="Center" />
            <EditItemTemplate>
             <asp:DropDownList ID="DrpProcess" Width="95%" runat="server"></asp:DropDownList>
            </EditItemTemplate>
            
            </asp:TemplateField>
            <asp:TemplateField HeaderText="Type">
            <ItemTemplate>
            <asp:Label ID="lbltype" runat="server" Text='<%#Eval("Type")%>'></asp:Label>     
            </ItemTemplate>
            <ItemStyle Width="5%" HorizontalAlign="Center" />            
            <EditItemTemplate>
            <asp:DropDownList ID="DrpType" Width="90%" runat="server"><asp:ListItem Value="Select"> Select </asp:ListItem><asp:ListItem Value="0"> Fresh </asp:ListItem><asp:ListItem Value="1"> Rework </asp:ListItem></asp:DropDownList>            
            <asp:RequiredFieldValidator ID="reqType" ControlToValidate="DrpType" runat="server" ErrorMessage="*" ValidationGroup="A"  InitialValue="Select"/>
            </EditItemTemplate>
            </asp:TemplateField>
              <asp:TemplateField  HeaderText="Shift">  
                                  <ItemTemplate>
                                      <asp:Label ID="lblShift" runat="server" Text='<%#Eval("Shift")%>'></asp:Label>
                                  </ItemTemplate>  
            <ItemStyle  HorizontalAlign="Center" Width="4%" />               
            <EditItemTemplate>
            <asp:DropDownList ID="DrpShift" Width="85%"  runat="server" >
                     <asp:ListItem Value="Select">Select</asp:ListItem>
                    <asp:ListItem Value="0">Day</asp:ListItem>
                     <asp:ListItem Value="1">Night</asp:ListItem>
                                  
                                  </asp:DropDownList>
                                  <asp:RequiredFieldValidator ID="reqShift" ControlToValidate="DrpShift" runat="server" ErrorMessage="*" ValidationGroup="A"  InitialValue="Select"/>
            
            </EditItemTemplate>                             
                                  </asp:TemplateField>
             
              <asp:TemplateField HeaderText="Batch No">
              <ItemTemplate>
            <asp:Label ID="lblBatchNo" runat="server" Text='<%#Eval("BatchNo")%>'></asp:Label>                  
              </ItemTemplate>
              <ItemStyle HorizontalAlign="Center" Width="4%"  />
              <EditItemTemplate>
              <asp:DropDownList ID="DrpBatchNO" Width="85%"   runat="server">
                  </asp:DropDownList>
                  <asp:RequiredFieldValidator ID="reqBatchNO" ControlToValidate="DrpBatchNO" InitialValue="Select" runat="server" ErrorMessage="*" ValidationGroup="A" > </asp:RequiredFieldValidator>
              </EditItemTemplate>
              
              </asp:TemplateField>
              
              <asp:TemplateField HeaderText="Batch Qty">
              <ItemTemplate> 
               <asp:Label ID="lblBatchQty" runat="server" Text='<%#Eval("Qty")%>'></asp:Label>   
              </ItemTemplate>                            
               <ItemStyle HorizontalAlign="Center"  Width="4%" />
               <EditItemTemplate>
               <asp:TextBox ID="TxtBatchQty" runat="server" Width="80%" ></asp:TextBox>
              <asp:RequiredFieldValidator ID="reqBatchQty" ControlToValidate="TxtBatchQty" runat="server" ErrorMessage="*" ValidationGroup="A" > </asp:RequiredFieldValidator>
               </EditItemTemplate>               
               </asp:TemplateField> 
                <asp:TemplateField HeaderText="From Date">
                
                <ItemTemplate>               
                 <asp:Label ID="lblfromDate" runat="server" Text='<%#Eval("FromDate")%>'></asp:Label>   
                 </ItemTemplate>
                            <ItemStyle HorizontalAlign="Center"  Width="6%"  />
                            
                            <EditItemTemplate>
                             <asp:TextBox ID="TxtFdate" runat="server" Width="80%" ></asp:TextBox><cc1:CalendarExtender ID="TxtFdate_CalendarExtender" runat="server" 
        Enabled="True" Format="dd-MM-yyyy" TargetControlID="TxtFdate" PopupPosition="BottomLeft"></cc1:CalendarExtender><asp:RegularExpressionValidator ID="RegularExpressionValidatorFDate" runat="server" ControlToValidate="TxtFdate" ValidationExpression="^([1-9]|0[1-9]|[12][0-9]|3[01])[- /.]([1-9]|0[1-9]|1[012])[- /.][0-9]{4}$"  ValidationGroup="A"  ErrorMessage="*"></asp:RegularExpressionValidator>
        <asp:RequiredFieldValidator ID="reqFDate" ControlToValidate="TxtFdate" runat="server" ErrorMessage="*" ValidationGroup="A" > </asp:RequiredFieldValidator>
                            </EditItemTemplate>
                            </asp:TemplateField>
                            <asp:TemplateField HeaderText="To Date">
                            <ItemTemplate>
                            <asp:Label ID="lblToDate" runat="server" Text='<%#Eval("ToDate")%>'></asp:Label>
                            </ItemTemplate>
                            <ItemStyle HorizontalAlign="Center"  Width="6%"  />
                            <EditItemTemplate>
                            <asp:TextBox ID="TxtTdate" runat="server" Width="80%" ></asp:TextBox><cc1:CalendarExtender ID="TxtTdate_CalendarExtender" runat="server" Enabled="True" Format="dd-MM-yyyy" TargetControlID="TxtTdate" PopupPosition="BottomRight"></cc1:CalendarExtender><asp:RegularExpressionValidator ID="RegularExpressionValidatorTDate" runat="server" ControlToValidate="TxtTdate" ValidationExpression="^([1-9]|0[1-9]|[12][0-9]|3[01])[- /.]([1-9]|0[1-9]|1[012])[- /.][0-9]{4}$"  ValidationGroup="A"  ErrorMessage="*"></asp:RegularExpressionValidator>
        <asp:RequiredFieldValidator ID="reqTDate" ControlToValidate="TxtTdate" runat="server" ErrorMessage="*" ValidationGroup="A" > </asp:RequiredFieldValidator>
                            </EditItemTemplate>
                            </asp:TemplateField>
                            
                            <asp:TemplateField HeaderText=" From Time">                            
                            <ItemTemplate>
                             <asp:Label ID="lblFromTime" runat="server" Text='<%#Eval("FromTime")%>'></asp:Label>
                            </ItemTemplate>
                            <ItemStyle Width="7%"  HorizontalAlign="Center"/>
                            <EditItemTemplate>
                            <MKB:TimeSelector ID="Fdate" runat="server" AmPm="AM"  MinuteIncrement="1"></MKB:TimeSelector>
                            </EditItemTemplate>
                        </asp:TemplateField>
                        <asp:TemplateField HeaderText=" To Time">
                        <ItemTemplate>
                          <asp:Label ID="lblToTime" runat="server" Text='<%#Eval("ToTime")%>'></asp:Label>
                        </ItemTemplate>
                            <ItemStyle Width="7%" HorizontalAlign="Center" />                            
                            <EditItemTemplate>
                            <MKB:TimeSelector ID="Tdate" runat="server"  AmPm="AM" MinuteIncrement="1"></MKB:TimeSelector>
                            </EditItemTemplate>
                        </asp:TemplateField>
                        <asp:TemplateField HeaderText="Incharge" >
                        <ItemTemplate>
                         <asp:Label ID="lblIncharge" runat="server" Text='<%#Eval("Incharge")%>'></asp:Label>
                        </ItemTemplate>
                            <ItemStyle HorizontalAlign="Left" Width="9%" />
                            <EditItemTemplate>
                            <asp:TextBox ID="TxtIncharge" runat="server" Width="90%" CssClass="box3"  > </asp:TextBox>
                        
                        <cc1:AutoCompleteExtender ID="TxtIncharge_AutoCompleteExtender" runat="server" 
                                DelimiterCharacters="" Enabled="True" ServiceMethod="GetCompletionList" 
                                ServicePath="" TargetControlID="TxtIncharge" UseContextKey="True"
                                 CompletionInterval="100" CompletionSetCount="2" FirstRowSelected="True" MinimumPrefixLength="1" ShowOnlyCurrentWordInCompletionListItem="True" CompletionListItemCssClass="bg" CompletionListHighlightedItemCssClass="bgtext" CompletionListCssClass="almt"></cc1:AutoCompleteExtender>
                                 <asp:RequiredFieldValidator ID="reqIncharge" ControlToValidate="TxtIncharge" runat="server" ErrorMessage="*" ValidationGroup="A" > </asp:RequiredFieldValidator>
                            
                            </EditItemTemplate>
                            
                            </asp:TemplateField>
                            
                            <asp:TemplateField HeaderText="Operator" >
                            <ItemTemplate>
                             <asp:Label ID="lblOperator" runat="server" Text='<%#Eval("Operator")%>'></asp:Label>
                            </ItemTemplate>
                            <ItemStyle HorizontalAlign="Left" Width="9%" />
                            <EditItemTemplate>
                            <asp:TextBox ID="TxtOperator" runat="server"  Width="90%" CssClass="box3" > </asp:TextBox><cc1:AutoCompleteExtender ID="TxtOperator_AutoCompleteExtender" runat="server" 
                                DelimiterCharacters="" Enabled="True" ServiceMethod="GetCompletionList" 
                                ServicePath="" TargetControlID="TxtOperator" UseContextKey="True"
                                 CompletionInterval="100" CompletionSetCount="2" FirstRowSelected="True" MinimumPrefixLength="1" ShowOnlyCurrentWordInCompletionListItem="True" CompletionListItemCssClass="bg" CompletionListHighlightedItemCssClass="bgtext" CompletionListCssClass="almt"></cc1:AutoCompleteExtender>
                                 <asp:RequiredFieldValidator ID="reqoperator" ControlToValidate="TxtOperator" runat="server" ErrorMessage="*" ValidationGroup="A" > </asp:RequiredFieldValidator>
                            </EditItemTemplate>
                            </asp:TemplateField>
                            
                             <asp:TemplateField HeaderText="Id" Visible="false">
              <ItemTemplate> 
               <asp:Label ID="lblId" runat="server" Text='<%#Eval("Id")%>'></asp:Label>   
              </ItemTemplate>                            
               <ItemStyle HorizontalAlign="Center"  Width="4%" />
               <EditItemTemplate>
              <asp:Label ID="lblId" runat="server" Text='<%#Eval("Id")%>'></asp:Label>   
               </EditItemTemplate>               
               </asp:TemplateField> 
                       
                 </Columns>
                 
                 
                 <EmptyDataTemplate><table width="100%" class="fontcss"><tr><td align="center"><asp:Label ID="Label1" runat="server"  Text="No data to display !" Font-Size="Larger" ForeColor="maroon"> </asp:Label></td></tr></table></EmptyDataTemplate></asp:GridView>
                 
                 
                 </td></tr> 
                 <tr>
                 <td colspan="2"> &nbsp;</td>
                 </tr>
                                             
                            <tr>
                            <td height="25" valign="middle" align="center" colspan="2">
                            &nbsp;&nbsp;
                                <asp:Button ID="Btncancel" runat="server" CssClass="redbox" 
                                    onclick="Btncancel_Click" Text="Cancel" />
                            </td>
                            
                            
                            </tr>
                            </table>

</asp:Content>
<asp:Content ID="Content8" ContentPlaceHolderID="ContentPlaceHolder4" Runat="Server">
</asp:Content>



=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/Machinery/Transactions/Schedule_Edit_Details.aspx.cs ===

﻿using System;
using System.Collections;
using System.Configuration;
using System.Data;
using System.Linq;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Xml.Linq;
using System.Data.SqlClient;
using MKB.TimePicker;
using System.Collections.Generic;

public partial class Module_Machinery_Transactions_Schedule_Edit_Details : System.Web.UI.Page
{
    clsFunctions fun = new clsFunctions();
    string connStr = "";
    SqlConnection con;
    int CompId = 0;
    string SId = "";
    int itemId = 0;
    string WoNo = "";
    int FinYearId = 0;
    protected void Page_Load(object sender, EventArgs e)
    {
        try
        {
            CompId = Convert.ToInt32(Session["compid"]);
            FinYearId = Convert.ToInt32(Session["finyear"]);
            SId = Session["username"].ToString();
            connStr = fun.Connection();
            con = new SqlConnection(connStr);
            WoNo = (Request.QueryString["WONo"].ToString());

            if (!string.IsNullOrEmpty(Request.QueryString["id"].ToString()))
            {
                itemId = Convert.ToInt32(Request.QueryString["id"]);
            }
            if (!IsPostBack)
            {
                this.PrintItem();
                FillTempGrid();

            }
        }
        catch (Exception ex)
        {
        }
    }

    public void PrintItem()
    {

        try
        {

            string sql2 = fun.select("ItemId", "tblMS_JobShedule_Master ", " Id='" + itemId + "'And CompId='"+CompId+"' ");
            SqlCommand cmd2 = new SqlCommand(sql2, con);
            DataSet DS32 = new DataSet();
            SqlDataAdapter DA22 = new SqlDataAdapter(cmd2);
            DA22.Fill(DS32);
            if (DS32.Tables[0].Rows.Count > 0)
            {
                string sql = fun.select("tblDG_BOM_Master.PId,tblDG_BOM_Master.CId,tblDG_BOM_Master.ItemId,tblDG_Item_Master.ManfDesc,Unit_Master.Symbol As UOMBasic,tblDG_Item_Master.ItemCode,tblDG_BOM_Master.Qty", " tblDG_BOM_Master,tblDG_Item_Master,Unit_Master", " Unit_Master.Id=tblDG_Item_Master.UOMBasic and tblDG_Item_Master.Id=tblDG_BOM_Master.ItemId and tblDG_BOM_Master.WONo='" + WoNo + "' and  tblDG_BOM_Master.ItemId='" + DS32.Tables[0].Rows[0][0].ToString() + "' And tblDG_BOM_Master.CompId='" + CompId + "'And tblDG_BOM_Master.FinYearId<='" + FinYearId + "'");
            SqlCommand cmd = new SqlCommand(sql, con);
            DataSet DS3 = new DataSet();
            SqlDataAdapter DA2 = new SqlDataAdapter(cmd);
            DA2.Fill(DS3);

           
            if (DS3.Tables[0].Rows.Count > 0)
            {

                lblItemCode.Text = DS3.Tables[0].Rows[0]["ItemCode"].ToString();
                List<double> g = new List<double>();
                g = fun.BOMTreeQty(WoNo, Convert.ToInt32(DS3.Tables[0].Rows[0]["PId"]), Convert.ToInt32(DS3.Tables[0].Rows[0]["CId"]));


                double h = 1;

                for (int j = 0; j < g.Count; j++)
                {
                    h = h * g[j];
                }


                lblBomqty.Text = h.ToString();
                lblDesc.Text = DS3.Tables[0].Rows[0]["ManfDesc"].ToString();
                lblunit.Text = DS3.Tables[0].Rows[0]["UOMBasic"].ToString();
            }
            lblWoNo.Text = WoNo;
            }
        }

        catch (Exception ex)
        {
        }
    }

    public void FillTempGrid()
    {
         try
        {
            string StrSql = fun.select("*", "tblMS_JobSchedule_Details", "MId='" + itemId + "' order By Id Desc");
            SqlCommand cmdsupId = new SqlCommand(StrSql, con);
            SqlDataAdapter dasupId = new SqlDataAdapter(cmdsupId);
            DataSet DSSql = new DataSet();
            DataTable dt = new DataTable();
            dasupId.Fill(DSSql);

            dt.Columns.Add(new System.Data.DataColumn("MachineName", typeof(string)));
            dt.Columns.Add(new System.Data.DataColumn("Process", typeof(string)));
            dt.Columns.Add(new System.Data.DataColumn("Type", typeof(string)));
            dt.Columns.Add(new System.Data.DataColumn("Shift", typeof(string)));
            dt.Columns.Add(new System.Data.DataColumn("Qty", typeof(double)));
            dt.Columns.Add(new System.Data.DataColumn("FromDate", typeof(string)));
            dt.Columns.Add(new System.Data.DataColumn("TODate", typeof(string)));
            dt.Columns.Add(new System.Data.DataColumn("FromTime", typeof(string)));
            dt.Columns.Add(new System.Data.DataColumn("ToTime", typeof(string)));
            dt.Columns.Add(new System.Data.DataColumn("Incharge", typeof(string)));
            dt.Columns.Add(new System.Data.DataColumn("Operator", typeof(string)));
            dt.Columns.Add(new System.Data.DataColumn("Id", typeof(int)));
            dt.Columns.Add(new System.Data.DataColumn("BatchNo", typeof(string)));
            DataRow dr;


            for (int i = 0; i < DSSql.Tables[0].Rows.Count; i++)
            {
                dr = dt.NewRow();
                string sql = fun.select("tblDG_Item_Master.ManfDesc", " tblDG_Item_Master", " tblDG_Item_Master.Id='" + DSSql.Tables[0].Rows[i]["MachineId"].ToString() + "'  And    tblDG_Item_Master.CompId='" + CompId + "'And tblDG_Item_Master.FinYearId<='" + FinYearId + "'");
                SqlCommand cmd = new SqlCommand(sql, con);
                DataSet DS3 = new DataSet();
                SqlDataAdapter DA2 = new SqlDataAdapter(cmd);
                DA2.Fill(DS3);

                if (DS3.Tables[0].Rows.Count > 0)
                {
                    dr[0] = DS3.Tables[0].Rows[0]["ManfDesc"].ToString();
                }
                string sql1 = fun.select("'['+Symbol+'] '+ProcessName As Process,Id", "tblPln_Process_Master", "Symbol!='0' And Id='" + DSSql.Tables[0].Rows[i]["Process"].ToString() + "'");
                SqlCommand cmd1 = new SqlCommand(sql1, con);
                SqlDataAdapter da1 = new SqlDataAdapter(cmd1);
                DataSet DS1 = new DataSet();
                da1.Fill(DS1);
                if (DS1.Tables[0].Rows.Count > 0)
                {
                    dr[1] = DS1.Tables[0].Rows[0]["Process"].ToString();
                }

                int Type = Convert.ToInt32(DSSql.Tables[0].Rows[i]["Type"].ToString());
                if (Type == 0)
                {
                    dr[2] = "Fresh";
                }
                else
                {
                    dr[2] = "Rework";
                }

                int Shift = Convert.ToInt32(DSSql.Tables[0].Rows[i]["Shift"].ToString());
                if (Shift == 0)
                {
                    dr[3] = "Day";
                }
                else
                {
                    dr[3] = "Night";
                }
                dr[4] = DSSql.Tables[0].Rows[i]["Qty"].ToString();
                dr[5] = fun.FromDateDMY(DSSql.Tables[0].Rows[i]["FromDate"].ToString());
                dr[6] = fun.FromDateDMY(DSSql.Tables[0].Rows[i]["ToDate"].ToString());
                dr[7] = (DSSql.Tables[0].Rows[i]["FromTime"].ToString());               
                dr[8] = (DSSql.Tables[0].Rows[i]["ToTime"].ToString());
            

                string sqlin = fun.select("EmployeeName+'['+EmpId+'] ' As Incharge", "tblHR_OfficeStaff", "CompId='" + CompId + "' And EmpId='" + DSSql.Tables[0].Rows[i]["Incharge"].ToString() + "'");
                SqlDataAdapter dain = new SqlDataAdapter(sqlin, con);
                DataSet DSin = new DataSet();
                dain.Fill(DSin, "tblHR_OfficeStaff");

                if (DSin.Tables[0].Rows.Count > 0)
                {
                    dr[9] = DSin.Tables[0].Rows[0]["Incharge"].ToString();
                }

                string sqlop = fun.select("EmployeeName+'['+EmpId+'] ' As Operator", "tblHR_OfficeStaff", "CompId='" + CompId + "' And EmpId='" + DSSql.Tables[0].Rows[i]["Operator"].ToString() + "'");
                SqlDataAdapter daop = new SqlDataAdapter(sqlop, con);
                DataSet DSop = new DataSet();
                daop.Fill(DSop, "tblHR_OfficeStaff");

                if (DSop.Tables[0].Rows.Count > 0)
                {
                    dr[10] = DSop.Tables[0].Rows[0]["Operator"].ToString();
                }
                dr[11] = DSSql.Tables[0].Rows[i]["Id"].ToString();
                dr[12] = DSSql.Tables[0].Rows[i]["BatchNo"].ToString();
                dt.Rows.Add(dr);
                dt.AcceptChanges();
            }

             GridView1.DataSource = dt;
             GridView1.DataBind();

        }

        catch (Exception ex)
        {
        }
    }

    protected void Btncancel_Click(object sender, EventArgs e)
    {
        Response.Redirect("~/Module/machinery/transactions/schedule_Edit.aspx?&ModId=15&SubModId=69");
    }
    protected void GridView1_PageIndexChanging(object sender, GridViewPageEventArgs e)
    {
        GridView1.PageIndex = e.NewPageIndex;
        this.FillTempGrid();
    }

    protected void DrpMachine_SelectedIndexChanged(object sender, EventArgs e)
    {
        
            this.fillDropDown();
        
    }

    public void fillDropDown()
    {
        try
        {

            if (this.GridView1.EditIndex != -1)
            {
                if (((DropDownList)GridView1.Rows[GridView1.EditIndex].FindControl("DrpMachine")).SelectedItem.Text != "Select")
                {
                    int ItemId = Convert.ToInt32(((DropDownList)GridView1.Rows[GridView1.EditIndex].FindControl("DrpMachine")).SelectedValue);
                    string sqlms = fun.select("Id", "tblMS_Master", " ItemId='" + ItemId + "'");
                    SqlCommand cmdms = new SqlCommand(sqlms, con);
                    SqlDataAdapter dams = new SqlDataAdapter(cmdms);
                    DataSet dsms = new DataSet();
                    dams.Fill(dsms);

                    if (dsms.Tables[0].Rows.Count > 0)
                    {
                        string sqlPro = fun.select("tblPln_Process_Master.Id,tblPln_Process_Master.ProcessName", "tblMS_Process,tblPln_Process_Master", "tblMS_Process.MId='" + dsms.Tables[0].Rows[0][0].ToString() + "' AND tblPln_Process_Master.Id=tblMS_Process.PId AND tblPln_Process_Master.Id not in (Select Process from tblMS_JobSchedule_Details_Temp where CompId='" + CompId + "' And ItemId='" + itemId + "')");
                        SqlCommand cmdPro = new SqlCommand(sqlPro, con);
                        SqlDataAdapter daPro = new SqlDataAdapter(cmdPro);
                        DataSet dsPro = new DataSet();
                        daPro.Fill(dsPro);

                        if (dsPro.Tables[0].Rows.Count > 0)
                        {
                            ((DropDownList)GridView1.Rows[GridView1.EditIndex].FindControl("DrpProcess")).DataSource = dsPro.Tables[0];
                            ((DropDownList)GridView1.Rows[GridView1.EditIndex].FindControl("DrpProcess")).DataTextField = "ProcessName";
                            ((DropDownList)GridView1.Rows[GridView1.EditIndex].FindControl("DrpProcess")).DataValueField = "Id";
                            ((DropDownList)GridView1.Rows[GridView1.EditIndex].FindControl("DrpProcess")).DataBind();

                        }
                        else
                        {
                            ((DropDownList)GridView1.Rows[GridView1.EditIndex].FindControl("DrpProcess")).Items.Clear();
                        }
                    }

                    else
                    {
                        ((DropDownList)GridView1.Rows[GridView1.EditIndex].FindControl("DrpProcess")).Items.Clear();
                    }
                }
                else
                {
                    ((DropDownList)GridView1.Rows[GridView1.EditIndex].FindControl("DrpProcess")).Items.Clear();
                }
            }          
        }
        catch (Exception ex)
        {
        }
    }
    protected void GridView1_RowEditing(object sender, GridViewEditEventArgs e)
    {
        try
        {
            GridView1.EditIndex = e.NewEditIndex;
            this.FillTempGrid();
            DataSet DSB = new DataSet();
            DataTable DtB = new DataTable();
            DataRow DrB;
            DtB.Columns.Add(new System.Data.DataColumn("BatchNo", typeof(Double)));
            DtB.Columns.Add(new System.Data.DataColumn("Id", typeof(int)));
            string sqlbatch = fun.select("Batches", "SD_Cust_WorkOrder_Master", " WONo='" + WoNo + "'   and   CompId='" + CompId + "'");
            SqlCommand cmdbatch = new SqlCommand(sqlbatch, con);
            SqlDataAdapter dabatch = new SqlDataAdapter(cmdbatch);
            DataSet dsbatch = new DataSet();
            dabatch.Fill(dsbatch);
            double Batch = 0;
            if (dsbatch.Tables[0].Rows.Count > 0)
            {
                double No = Convert.ToDouble(dsbatch.Tables[0].Rows[0]["Batches"]);
                for (int n = 1; n <= No; n++)
                {
                    Batch = n;
                    DrB = DtB.NewRow();
                    DrB[0] = Batch;
                    DrB[1] = Batch;
                    DtB.Rows.Add(DrB);
                    DtB.AcceptChanges();

                }
            }
            DSB.Tables.Add(DtB);

            string sqlms = fun.select("tblMS_Master.ItemId,tblDG_Item_Master.ManfDesc", "tblMS_Master,tblDG_Item_Master", " tblDG_Item_Master.Id=tblMS_Master.ItemId  And  tblMS_Master.CompId='" + CompId + "'");
            SqlCommand cmdms = new SqlCommand(sqlms, con);
            SqlDataAdapter dams = new SqlDataAdapter(cmdms);
            DataSet dsms = new DataSet();
            dams.Fill(dsms);
            GridViewRow row = GridView1.Rows[e.NewEditIndex];
            {
                ((DropDownList)row.FindControl("DrpBatchNO")).DataSource = DSB.Tables[0];
                ((DropDownList)row.FindControl("DrpBatchNO")).DataTextField = "BatchNo";
                ((DropDownList)row.FindControl("DrpBatchNO")).DataValueField = "Id";
                ((DropDownList)row.FindControl("DrpBatchNO")).DataBind();
                ((DropDownList)row.FindControl("DrpBatchNO")).Items.Insert(0, "Select");
                ((DropDownList)row.FindControl("DrpMachine")).DataSource = dsms.Tables[0];
                ((DropDownList)row.FindControl("DrpMachine")).DataTextField = "ManfDesc";
                ((DropDownList)row.FindControl("DrpMachine")).DataValueField = "ItemId";
                ((DropDownList)row.FindControl("DrpMachine")).DataBind();
                ((DropDownList)row.FindControl("DrpMachine")).Items.Insert(0, "Select");
                int Id = Convert.ToInt32(((Label)row.FindControl("lblId")).Text);
                string sqlms2 = fun.select("*", "tblMS_JobSchedule_Details", "Id='" + Id + "'");
                SqlCommand cmdms2 = new SqlCommand(sqlms2, con);
                SqlDataAdapter dams2 = new SqlDataAdapter(cmdms2);
                DataSet dsms2 = new DataSet();
                dams2.Fill(dsms2);               
                if (dsms2.Tables[0].Rows.Count > 0)
                {
                    ((DropDownList)row.FindControl("DrpMachine")).SelectedValue = dsms2.Tables[0].Rows[0]["MachineId"].ToString();

                    if (((DropDownList)row.FindControl("DrpMachine")).SelectedItem.Text != "Select")
                    {
                        int ItemId = Convert.ToInt32(((DropDownList)row.FindControl("DrpMachine")).SelectedValue);
                        this.fillDropDown();
                        ((DropDownList)row.FindControl("DrpProcess")).SelectedValue = dsms2.Tables[0].Rows[0]["Process"].ToString();
                        ((DropDownList)row.FindControl("DrpBatchNO")).SelectedValue = dsms2.Tables[0].Rows[0]["BatchNO"].ToString();
                        ((DropDownList)row.FindControl("DrpShift")).SelectedValue = dsms2.Tables[0].Rows[0]["Shift"].ToString();
                        ((DropDownList)row.FindControl("DrpType")).SelectedValue = dsms2.Tables[0].Rows[0]["Type"].ToString();
                        ((TextBox)row.FindControl("TxtBatchQty")).Text = dsms2.Tables[0].Rows[0]["Qty"].ToString();
                       ((TextBox)row.FindControl("TxtFdate")).Text = fun.FromDate(dsms2.Tables[0].Rows[0]["FromDate"].ToString());
                        ((TextBox)row.FindControl("TxtTdate")).Text = fun.FromDate(dsms2.Tables[0].Rows[0]["ToDate"].ToString());

                        string sqlin = fun.select("EmployeeName+'['+EmpId+']' As Incharge", "tblHR_OfficeStaff", "CompId='" + CompId + "' And EmpId='" + dsms2.Tables[0].Rows[0]["Incharge"].ToString() + "'");
                        SqlDataAdapter dain = new SqlDataAdapter(sqlin, con);
                        DataSet DSin = new DataSet();
                        dain.Fill(DSin, "tblHR_OfficeStaff");

                        if (DSin.Tables[0].Rows.Count > 0)
                        {
                            ((TextBox)row.FindControl("TxtIncharge")).Text = DSin.Tables[0].Rows[0]["Incharge"].ToString();
                        }

                        string sqlop = fun.select("EmployeeName+'['+EmpId+'] ' As Operator", "tblHR_OfficeStaff", "CompId='" + CompId + "' And EmpId='" + dsms2.Tables[0].Rows[0]["Operator"].ToString() + "'");
                        SqlDataAdapter daop = new SqlDataAdapter(sqlop, con);
                        DataSet DSop = new DataSet();
                        daop.Fill(DSop, "tblHR_OfficeStaff");

                        if (DSop.Tables[0].Rows.Count > 0)
                        {
                            ((TextBox)row.FindControl("TxtOperator")).Text = DSop.Tables[0].Rows[0]["Operator"].ToString();
                        }
                        string sqlNextLastDt = fun.select("FromDate,FromTime", "tblMS_JobSchedule_Details", "MachineId='" + dsms2.Tables[0].Rows[0]["MachineId"].ToString() + "'And Process='" + dsms2.Tables[0].Rows[0]["Process"].ToString() + "'And Released!='1' And FromDate >='" + (dsms2.Tables[0].Rows[0]["ToDate"].ToString()) + "'  Order By FromDate Asc");
                        SqlCommand cmdNextLastDt = new SqlCommand(sqlNextLastDt, con);
                        SqlDataAdapter daNextLastDt = new SqlDataAdapter(cmdNextLastDt);
                        DataSet DSNextLastDt = new DataSet();
                        daNextLastDt.Fill(DSNextLastDt);
                        if (DSNextLastDt.Tables[0].Rows.Count > 0)
                        {
                            if ((Convert.ToDateTime(fun.FromDate(((TextBox)row.FindControl("TxtTdate")).Text))).Date == (Convert.ToDateTime((DSNextLastDt.Tables[0].Rows[0][0].ToString())).Date))
                            {

                                fun.TimeSelectorDatabase2(DSNextLastDt.Tables[0].Rows[0]["FromTime"].ToString(), (TimeSelector)row.FindControl("Tdate"));
                            }
                        }
                    }
                }

            }
        }
        catch (Exception ex) { }
    }
    protected void GridView1_RowCancelingEdit(object sender, GridViewCancelEditEventArgs e)
    {
        try
        {
            GridView1.EditIndex = -1;
            this.FillTempGrid();
        }
        catch (Exception ex) { }
    }
    protected void GridView1_RowUpdating(object sender, GridViewUpdateEventArgs e)
    {
        try
        {
           
            int rowIndex = GridView1.EditIndex;
            GridViewRow row = GridView1.Rows[rowIndex];
            int id = Convert.ToInt32(GridView1.DataKeys[e.RowIndex].Value);
            int MachinId = Convert.ToInt32(((DropDownList)row.FindControl("DrpMachine")).SelectedValue);
            int Process = Convert.ToInt32(((DropDownList)row.FindControl("DrpProcess")).SelectedValue);
            int Type = Convert.ToInt32(((DropDownList)row.FindControl("DrpType")).SelectedValue);
            int Shift = Convert.ToInt32(((DropDownList)row.FindControl("DrpShift")).SelectedValue);
            int BatchNO = Convert.ToInt32(((DropDownList)row.FindControl("DrpBatchNO")).SelectedValue);
            double BatchQty = Convert.ToDouble(((TextBox)row.FindControl("TxtBatchQty")).Text);
            string FDate = fun.FromDate(((TextBox)row.FindControl("TxtFdate")).Text);
            string TDate = fun.FromDate(((TextBox)row.FindControl("TxtTdate")).Text);
            string FromTime = ((TimeSelector)row.FindControl("Fdate")).Hour.ToString("D2") + ":" + ((TimeSelector)row.FindControl("Fdate")).Minute.ToString("D2") + ":" + ((TimeSelector)row.FindControl("Fdate")).Second.ToString("D2") + " " + ((TimeSelector)row.FindControl("Fdate")).AmPm.ToString();
           
            string ToTime = ((TimeSelector)row.FindControl("Tdate")).Hour.ToString("D2") + ":" + ((TimeSelector)row.FindControl("Tdate")).Minute.ToString("D2") + ":" + ((TimeSelector)row.FindControl("Tdate")).Second.ToString("D2") + " " + ((TimeSelector)row.FindControl("Tdate")).AmPm.ToString();
            string Incharge = fun.getCode((((TextBox)row.FindControl("TxtIncharge")).Text));
            string Operator = fun.getCode((((TextBox)row.FindControl("TxtOperator")).Text)); 
            string LastDate = "";
            string LastTime = "";
            
            this.AddToTemp("tblMS_JobSchedule_Details", MachinId, Shift, Type, BatchNO, Process, FDate, TDate, FromTime, ToTime, BatchQty, Incharge, Operator, LastDate, LastTime, "And Released!=1", id);            
        }
       catch (Exception ex) { }
    }


    [System.Web.Services.WebMethodAttribute(), System.Web.Script.Services.ScriptMethodAttribute()]
    public static string[] GetCompletionList(string prefixText, int count, string contextKey)
    {
        clsFunctions fun = new clsFunctions();
        string connStr = fun.Connection();
        DataSet ds = new DataSet();
        SqlConnection con = new SqlConnection(connStr);
        con.Open();
        int CompId = Convert.ToInt32(HttpContext.Current.Session["compid"]);
        string cmdStr = fun.select("EmpId,EmployeeName", "tblHR_OfficeStaff", "CompId='" + CompId + "'");
        SqlDataAdapter da = new SqlDataAdapter(cmdStr, con);
        da.Fill(ds, "tblHR_OfficeStaff");
        con.Close();
        string[] main = new string[0];
        for (int i = 0; i < ds.Tables[0].Rows.Count; i++)
        {
            if (ds.Tables[0].Rows[i].ItemArray[1].ToString().ToLower().StartsWith(prefixText.ToLower()))
            {
                Array.Resize(ref main, main.Length + 1);
                main[main.Length - 1] = ds.Tables[0].Rows[i].ItemArray[1].ToString() + " [" + ds.Tables[0].Rows[i].ItemArray[0].ToString() + "]";
                //if (main.Length == 10)
                //    break;
            }
        }
        Array.Sort(main);
        return main;
    }


    protected void GridView1_RowDataBound(object sender, GridViewRowEventArgs e)
    {
        try
        {

            if (e.Row.RowType == DataControlRowType.DataRow)
            {
                LinkButton edit = (LinkButton)e.Row.Cells[1].Controls[0];
                edit.Attributes.Add("onclick", "return confirmationUpdate();");

            }
            
        }
        catch (Exception ex) { }
    }


    public void AddToTemp(string tblName, int MachineId, int Shift, int Type, double Batch, int ProId, string FromDt, string ToDt, string FromTime, string ToTime, double Qty, string Incharge, string Operator, string LastDate, string LastTime, string IsReleased,int Id)
    {


        try
        {
            string NextFromDate="";           
            int abc = 0;
            if (Convert.ToDateTime(FromDt.ToString()) < Convert.ToDateTime(ToDt.ToString()))
            {
                string sqlIsExist = fun.select("ToDate,ToTime,FromDate", "tblMS_JobSchedule_Details", "MachineId='" + MachineId + "'And Id='" + Id + "' " + IsReleased + " Order By ToDate Desc");
                SqlCommand cmdIsExist = new SqlCommand(sqlIsExist, con);
                SqlDataAdapter daIsExist = new SqlDataAdapter(cmdIsExist);
                DataSet DSIsExist = new DataSet();
                daIsExist.Fill(DSIsExist);               
                if (DSIsExist.Tables[0].Rows.Count > 0)               
                {

                   
                    LastDate = DSIsExist.Tables[0].Rows[0][0].ToString();
                    string sqlNextLastDt ="";
                    if ((Convert.ToDateTime(DSIsExist.Tables[0].Rows[0][2].ToString())).Date == (Convert.ToDateTime(LastDate)).Date)
                    {
                        sqlNextLastDt = fun.select("FromDate,FromTime", "" + tblName + "", "MachineId='" + MachineId + "'And Process='" + ProId + "' " + IsReleased + " And FromDate >'" + LastDate + "'  Order By FromDate Asc");
                    }
                    else
                    {
                        sqlNextLastDt = fun.select("FromDate,FromTime", "" + tblName + "", "MachineId='" + MachineId + "'And Process='" + ProId + "' " + IsReleased + " And FromDate >='" + LastDate + "'  Order By FromDate Asc");
                    }
                    SqlCommand cmdNextLastDt = new SqlCommand(sqlNextLastDt, con);
                    SqlDataAdapter daNextLastDt = new SqlDataAdapter(cmdNextLastDt);
                    DataSet DSNextLastDt = new DataSet();
                    daNextLastDt.Fill(DSNextLastDt);                   
                    if (DSNextLastDt.Tables[0].Rows.Count > 0)
                    {
                        NextFromDate = DSNextLastDt.Tables[0].Rows[0][0].ToString();                      
                        abc = ((Convert.ToDateTime(NextFromDate)) - ((Convert.ToDateTime(LastDate)))).Days;
                        
                        if (abc >= 0 && (Convert.ToDateTime(ToDt)).Date<=(Convert.ToDateTime(NextFromDate).Date))
                        {
                           
                            string sql = fun.update("tblMS_JobSchedule_Details", "Shift='" + Shift + "',Type='" + Type + "',FromDate='" + FromDt + "',ToDate='" + ToDt + "',FromTime='" + FromTime + "',ToTime='" + ToTime + "',Process='" + ProId + "',Qty='" + Qty + "',Incharge='" + Incharge + "',Operator='" + Operator + "',MachineId='" + MachineId + "',BatchNo='" + Batch + "'", "Id='" + Id + "'");                           
                            SqlCommand cmdDtls = new SqlCommand(sql, con);
                            con.Open();
                            cmdDtls.ExecuteNonQuery();
                            con.Close();
                            Page.Response.Redirect(Page.Request.Url.ToString(), true);
                        }
                        else
                        {                            
                                string mystring1 = string.Empty;
                                mystring1 = "Machine is busy upto " + fun.FromDateDMY(NextFromDate) + "," + LastTime;
                                ClientScript.RegisterStartupScript(this.GetType(), "myalert", "alert('" + mystring1 + "');", true);
                        }
                    }
                    else if (DSNextLastDt.Tables[0].Rows.Count== 0)
                    {
                        string sql = fun.update("tblMS_JobSchedule_Details", "Shift='" + Shift + "',Type='" + Type + "',FromDate='" + FromDt + "',ToDate='" + ToDt + "',FromTime='" + FromTime + "',ToTime='" + ToTime + "',Process='" + ProId + "',Qty='" + Qty + "',Incharge='" + Incharge + "',Operator='" + Operator + "',MachineId='" + MachineId + "',BatchNo='" + Batch + "'", "Id='" + Id + "'");                       
                        SqlCommand cmdDtls = new SqlCommand(sql, con);
                        con.Open();
                        cmdDtls.ExecuteNonQuery();
                        con.Close();                       
                        Page.Response.Redirect(Page.Request.Url.ToString(), true);
                    }                                      

                }                
            }
            else if (Convert.ToDateTime(FromDt.ToString()) == Convert.ToDateTime(ToDt.ToString()))
            {
                string FirstDate = "";
                string sqlIsExist = fun.select("ToDate,ToTime,FromDate", "" + tblName + "", "MachineId='" + MachineId + "' And Id='" + Id + "'" + IsReleased + " Order By ToDate Desc");
                SqlCommand cmdIsExist = new SqlCommand(sqlIsExist, con);
                SqlDataAdapter daIsExist = new SqlDataAdapter(cmdIsExist);
                DataSet DSIsExist = new DataSet();
                daIsExist.Fill(DSIsExist);

                if (DSIsExist.Tables[0].Rows.Count > 0)
                {
                    FirstDate = DSIsExist.Tables[0].Rows[0][2].ToString();
                    LastDate = DSIsExist.Tables[0].Rows[0][0].ToString();
                    LastTime = DSIsExist.Tables[0].Rows[0][1].ToString();
                    string sqlNextLastDt = fun.select("FromDate,FromTime", "" + tblName + "", "MachineId='" + MachineId + "'And Process='" + ProId + "' " + IsReleased + " And FromDate >='" + LastDate + "'  Order By FromDate Asc");
                    SqlCommand cmdNextLastDt = new SqlCommand(sqlNextLastDt, con);
                    SqlDataAdapter daNextLastDt = new SqlDataAdapter(cmdNextLastDt);
                    DataSet DSNextLastDt = new DataSet();
                    daNextLastDt.Fill(DSNextLastDt);
                    if (DSNextLastDt.Tables[0].Rows.Count > 0)
                    {
                        NextFromDate = DSNextLastDt.Tables[0].Rows[0][0].ToString();
                        abc = ((Convert.ToDateTime(NextFromDate)) - ((Convert.ToDateTime(LastDate)))).Days;
                        if (abc >= 0)
                        {
                            
                            if (Convert.ToDateTime(FromTime).TimeOfDay < Convert.ToDateTime(ToTime).TimeOfDay)
                            {
                              
                                string sql = fun.update("tblMS_JobSchedule_Details", "Shift='" + Shift + "',Type='" + Type + "',FromDate='" + FromDt + "',ToDate='" + ToDt + "',FromTime='" + FromTime + "',ToTime='" + ToTime + "',Process='" + ProId + "',Qty='" + Qty + "',Incharge='" + Incharge + "',Operator='" + Operator + "',MachineId='" + MachineId + "',BatchNo='" + Batch + "'", "Id='" + Id + "'");
                                SqlCommand cmdDtls = new SqlCommand(sql, con);
                                con.Open();                              
                                cmdDtls.ExecuteNonQuery();
                                con.Close();
                                Page.Response.Redirect(Page.Request.Url.ToString(), true);
                            }
                            else
                            {
                                string mystring = string.Empty;
                                mystring = "From Time Should Be Less than To Time.";
                                ClientScript.RegisterStartupScript(this.GetType(), "myalert", "alert('" + mystring + "');", true);
                            }
                        }
                        else
                        {
                            string mystring = string.Empty;
                            mystring = "Machine is busy  from " + fun.FromDateDMY(FirstDate) + " to " + fun.FromDateDMY(LastDate) + "," + LastTime;
                            ClientScript.RegisterStartupScript(this.GetType(), "myalert", "alert('" + mystring + "');", true);
                        }

                    }
                    else if (DSNextLastDt.Tables[0].Rows.Count == 0)
                    {
                        string sql = fun.update("tblMS_JobSchedule_Details", "Shift='" + Shift + "',Type='" + Type + "',FromDate='" + FromDt + "',ToDate='" + ToDt + "',FromTime='" + FromTime + "',ToTime='" + ToTime + "',Process='" + ProId + "',Qty='" + Qty + "',Incharge='" + Incharge + "',Operator='" + Operator + "',MachineId='" + MachineId + "',BatchNo='" + Batch + "'", "Id='" + Id + "'");
                        SqlCommand cmdDtls = new SqlCommand(sql, con);
                        con.Open();
                        cmdDtls.ExecuteNonQuery();
                        con.Close();
                        Page.Response.Redirect(Page.Request.Url.ToString(), true);
                    }  
                }               

            }
            else
            {
                string mystring = string.Empty;
                mystring = "From Date Should Be Less than To Date.";
                ClientScript.RegisterStartupScript(this.GetType(), "myalert", "alert('" + mystring + "');", true);

            }
        }
        catch (Exception ex)
        {
        }
    }
    

}
