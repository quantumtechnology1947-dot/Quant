=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/ProjectManagement/Transactions/OnSiteAttendance_Print_Details.aspx.txt ===

﻿<%@ Page Language="C#" AutoEventWireup="true" CodeFile="OnSiteAttendance_Print_Details.aspx.cs" Inherits="Module_ProjectManagement_Transactions_OnSiteAttendance_Print_Details" Theme="Default" %>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<%@ Register Assembly="CrystalDecisions.Web, Version=10.5.3700.0, Culture=neutral, PublicKeyToken=692fbea5521e1304"
    Namespace="CrystalDecisions.Web" TagPrefix="CR" %>
<%@ Register assembly="AjaxControlToolkit" namespace="AjaxControlToolkit" tagprefix="cc1" %>
<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title></title>
    <script src="../../../Javascript/loadingNotifier.js" type="text/javascript"></script>
</head>
<body>
    <form id="form1" runat="server">
    <div style="width:auto;">  
    <table width="100%">
    <tr>
    <td align="center">
     <CR:CrystalReportViewer ID="CrystalReportViewer1"  EnableDatabaseLogonPrompt="false" HasCrystalLogo="False" DisplayGroupTree="False" ReportSourceID="CrystalReportSource1"  runat="server" AutoDataBind="true" />
 <CR:CrystalReportSource ID="CrystalReportSource1" runat="server">
 <Report FileName="~/Module/ProjectManagement/Reports/OnSiteAttendance.rpt" > 
 </Report>
</CR:CrystalReportSource>
    
    </td>
    </tr>
    </table>

          
    </div>
    </form>
</body>
</html>


=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/ProjectManagement/Transactions/OnSiteAttendance_Print_Details.aspx.cs ===

﻿using System;
using System.Collections;
using System.Configuration;
using System.Data;
using System.Linq;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Xml.Linq;
using CrystalDecisions.CrystalReports.Engine;
using System.Data.SqlClient;

public partial class Module_ProjectManagement_Transactions_OnSiteAttendance_Print_Details : System.Web.UI.Page
{

    string connStr = "";
    SqlConnection con;
    int CompId = 0;
    int FinYearId = 0;
    clsFunctions fun = new clsFunctions();
    ReportDocument cryRpt = new ReportDocument();
    string z = "";// Onsite Date Wise
    string p = "";//Employee WIse
    string q = "";// BG 
    string m = "";
  

    protected void Page_Init(object sender, EventArgs e)
    {
                          connStr = fun.Connection();
                    con = new SqlConnection(connStr);
            try
            {

                    CompId = Convert.ToInt32(Session["compid"]);
                    FinYearId = Convert.ToInt32(Session["finyear"]); 
                    m = Request.QueryString["m"].ToString();
                    p = Request.QueryString["p"].ToString();
                    q = Request.QueryString["q"].ToString();
                    z = Request.QueryString["z"].ToString();
              
                    SqlDataAdapter da = new SqlDataAdapter("GetOnSiteEmp_Print", con);
                    da.SelectCommand.CommandType = CommandType.StoredProcedure;
                    da.SelectCommand.Parameters.Add(new SqlParameter("@m", SqlDbType.VarChar));
                    da.SelectCommand.Parameters.Add(new SqlParameter("@z", SqlDbType.VarChar));
                    da.SelectCommand.Parameters.Add(new SqlParameter("@p", SqlDbType.VarChar));
                    da.SelectCommand.Parameters.Add(new SqlParameter("@q", SqlDbType.VarChar));
                    da.SelectCommand.Parameters.Add(new SqlParameter("@CompId", SqlDbType.VarChar));
                    da.SelectCommand.Parameters["@m"].Value = m;
                    da.SelectCommand.Parameters["@z"].Value = z;
                    da.SelectCommand.Parameters["@p"].Value = p;
                    da.SelectCommand.Parameters["@q"].Value = q;
                    da.SelectCommand.Parameters["@CompId"].Value = CompId;
                    DataSet DSitem = new DataSet();
                    DataSet Xads = new OnSiteAttendance();
                    da.Fill(DSitem);
                    DataSet xsd = new OnSiteAttendance();
                    xsd.Tables[0].Merge(DSitem.Tables[0]);
                    xsd.AcceptChanges();
                    cryRpt = new ReportDocument();
                    cryRpt.Load(Server.MapPath("~/Module/ProjectManagement/Reports/OnSiteAttendance.rpt"));
                    cryRpt.SetDataSource(xsd);
                    string Address = fun.CompAdd(CompId);
                    cryRpt.SetParameterValue("Address", Address);
                    CrystalReportViewer1.ReportSource = cryRpt;

            }
            catch (Exception ex)
            {
            }
        
    }
   
    protected void Page_Load(object sender, EventArgs e)
    {
        

    }
    protected void Page_UnLoad(object sender, EventArgs e)
    {
        this.CrystalReportViewer1.Dispose();
        this.CrystalReportViewer1 = null;
        cryRpt.Close();
        cryRpt.Dispose();
        GC.Collect();
    }

   
}
