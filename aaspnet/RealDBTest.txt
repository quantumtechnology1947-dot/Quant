=== FILE: /Users/shiv/workspace/syncortext/NewERP/RealDBTest.aspx.txt ===

<%@ Page Language="C#" AutoEventWireup="true" CodeFile="RealDBTest.aspx.cs" Inherits="RealDBTest" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title>ERP_DB_Real Database Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1 { color: #003366; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; }
        th { background-color: #f2f2f2; text-align: left; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
    </style>
</head>
<body>
    <form id="form1" runat="server">
        <div>
            <h1>ERP_DB_Real Database Test</h1>
            
            <div>
                <h2>Connection Status:</h2>
                <asp:Label ID="lblConnectionStatus" runat="server" CssClass="status"></asp:Label>
            </div>
            
            <div>
                <h2>Table List (Top 20):</h2>
                <asp:GridView ID="gvTables" runat="server" AutoGenerateColumns="true"></asp:GridView>
            </div>
            
            <div>
                <h2>Sample Data (if available):</h2>
                <asp:DropDownList ID="ddlTables" runat="server" AutoPostBack="true" 
                    OnSelectedIndexChanged="ddlTables_SelectedIndexChanged">
                </asp:DropDownList>
                <asp:GridView ID="gvSampleData" runat="server" AutoGenerateColumns="true"></asp:GridView>
            </div>
            
            <div>
                <h2>Connection String:</h2>
                <asp:Label ID="lblConnectionString" runat="server"></asp:Label>
            </div>
            
            <div style="margin-top: 20px;">
                <asp:Button ID="btnBackToHome" runat="server" Text="Back to Home" 
                    OnClick="btnBackToHome_Click" />
            </div>
        </div>
    </form>
</body>
</html> 

=== FILE: /Users/shiv/workspace/syncortext/NewERP/RealDBTest.aspx.cs ===

using System;
using System.Configuration;
using System.Data;
using System.Data.SqlClient;
using System.Web.UI;
using System.Web.UI.WebControls;

public partial class RealDBTest : System.Web.UI.Page
{
    private string connectionString = ConfigurationManager.ConnectionStrings["LocalSqlServer"].ConnectionString;

    protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
        {
            lblConnectionString.Text = MaskConnectionString(connectionString);
            TestDatabaseConnection();
            LoadTablesList();
            PopulateTablesDropdown();
        }
    }

    private void TestDatabaseConnection()
    {
        try
        {
            using (SqlConnection connection = new SqlConnection(connectionString))
            {
                connection.Open();
                lblConnectionStatus.Text = "Connected successfully to the database!";
                lblConnectionStatus.CssClass = "success";
            }
        }
        catch (Exception ex)
        {
            lblConnectionStatus.Text = "Error connecting to database: " + ex.Message;
            lblConnectionStatus.CssClass = "error";
        }
    }

    private void LoadTablesList()
    {
        try
        {
            using (SqlConnection connection = new SqlConnection(connectionString))
            {
                connection.Open();
                string query = @"SELECT TOP 20 
                                    t.name AS TableName, 
                                    s.name AS SchemaName,
                                    t.create_date AS CreatedDate,
                                    (SELECT COUNT(*) FROM sys.columns WHERE object_id = t.object_id) AS ColumnCount
                                FROM 
                                    sys.tables t
                                INNER JOIN 
                                    sys.schemas s ON t.schema_id = s.schema_id
                                ORDER BY 
                                    t.name";

                SqlCommand command = new SqlCommand(query, connection);
                SqlDataAdapter adapter = new SqlDataAdapter(command);
                DataTable dataTable = new DataTable();
                adapter.Fill(dataTable);

                gvTables.DataSource = dataTable;
                gvTables.DataBind();
            }
        }
        catch (Exception ex)
        {
            lblConnectionStatus.Text += "<br/>Error loading tables: " + ex.Message;
            lblConnectionStatus.CssClass = "error";
        }
    }

    private void PopulateTablesDropdown()
    {
        try
        {
            using (SqlConnection connection = new SqlConnection(connectionString))
            {
                connection.Open();
                string query = @"SELECT TOP 30 name FROM sys.tables ORDER BY name";

                SqlCommand command = new SqlCommand(query, connection);
                SqlDataAdapter adapter = new SqlDataAdapter(command);
                DataTable dataTable = new DataTable();
                adapter.Fill(dataTable);

                ddlTables.Items.Clear();
                ddlTables.Items.Add(new ListItem("-- Select a table --", ""));

                foreach (DataRow row in dataTable.Rows)
                {
                    ddlTables.Items.Add(new ListItem(row["name"].ToString(), row["name"].ToString()));
                }
            }
        }
        catch (Exception ex)
        {
            lblConnectionStatus.Text += "<br/>Error loading table dropdown: " + ex.Message;
            lblConnectionStatus.CssClass = "error";
        }
    }

    protected void ddlTables_SelectedIndexChanged(object sender, EventArgs e)
    {
        string selectedTable = ddlTables.SelectedValue;
        if (!string.IsNullOrEmpty(selectedTable))
        {
            LoadSampleData(selectedTable);
        }
        else
        {
            gvSampleData.DataSource = null;
            gvSampleData.DataBind();
        }
    }

    private void LoadSampleData(string tableName)
    {
        try
        {
            using (SqlConnection connection = new SqlConnection(connectionString))
            {
                connection.Open();
                string query = string.Format("SELECT TOP 10 * FROM [{0}]", tableName);

                SqlCommand command = new SqlCommand(query, connection);
                SqlDataAdapter adapter = new SqlDataAdapter(command);
                DataTable dataTable = new DataTable();
                adapter.Fill(dataTable);

                gvSampleData.DataSource = dataTable;
                gvSampleData.DataBind();
            }
        }
        catch (Exception ex)
        {
            lblConnectionStatus.Text = "Error loading sample data: " + ex.Message;
            lblConnectionStatus.CssClass = "error";
        }
    }

    private string MaskConnectionString(string connectionString)
    {
        // Mask password if present
        if (connectionString.Contains("Password=") || connectionString.Contains("pwd="))
        {
            return "Connection string contains sensitive information (masked)";
        }
        return connectionString;
    }

    protected void btnBackToHome_Click(object sender, EventArgs e)
    {
        Response.Redirect("Default.aspx");
    }
} 