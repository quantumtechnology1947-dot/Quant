=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/MaterialManagement/Reports/RateLockUnlock.aspx.txt ===

﻿<%@ Page Language="C#" MasterPageFile="~/MasterPage.master" AutoEventWireup="true" CodeFile="RateLockUnlock.aspx.cs" Inherits="Module_MaterialManagement_Reports_RateLockUnlock" Title="ERP" Theme ="Default" %>

<%@ Register assembly="AjaxControlToolkit" namespace="AjaxControlToolkit" tagprefix="cc1" %>
<asp:Content ID="Content1" ContentPlaceHolderID="head" Runat="Server">
    <link href="../../../Css/yui-datatable.css" rel="stylesheet" type="text/css" /> 
    <link href="../../../Css/StyleSheet.css" rel="stylesheet" type="text/css" />
    <script src="../../../Javascript/PopUpMsg.js" type="text/javascript"></script>
     <script src="../../../Javascript/loadingNotifier.js" type="text/javascript"></script>
</asp:Content>
<asp:Content ID="Content2" ContentPlaceHolderID="cp3" Runat="Server">
</asp:Content>
<asp:Content ID="Content3" ContentPlaceHolderID="cp1" Runat="Server">
</asp:Content>
<asp:Content ID="Content4" ContentPlaceHolderID="cp2" Runat="Server">
</asp:Content>
<asp:Content ID="Content5" ContentPlaceHolderID="MainContent" Runat="Server">
</asp:Content>
<asp:Content ID="Content6" ContentPlaceHolderID="ContentPlaceHolder2" Runat="Server">
</asp:Content>
<asp:Content ID="Content7" ContentPlaceHolderID="ContentPlaceHolder3" Runat="Server">
                   
                    <table width="100%" cellpadding="0" cellspacing="0">
                      <tr>
                        <td   align="left" valign="middle"  scope="col" class="fontcsswhite" 
                            style="background:url(../../../images/hdbg.JPG)" height="21">
                    &nbsp;<b>Rate Lock Unlock &nbsp;</b></td>
                    </tr>
                   
                    <tr>
                    <td  height="25" valign="middle" >

                    &nbsp;<asp:DropDownList ID="DrpType" runat="server" AutoPostBack="True" 
                    Height="21px" Width="100px" CssClass="box3" 
                    onselectedindexchanged="DrpType_SelectedIndexChanged">
                     <asp:ListItem>Select</asp:ListItem>
                     <asp:ListItem Value="Category">Category</asp:ListItem>
                     <asp:ListItem Value="WOItems">WO Items</asp:ListItem>                    
                </asp:DropDownList>
                <asp:DropDownList ID="DrpCategory1" runat="server" Width="200px" 
                    AutoPostBack="True" 
                    onselectedindexchanged="DrpCategory1_SelectedIndexChanged" Height="21px" 
                    CssClass="box3">
                    
                </asp:DropDownList> 
                
                 <asp:DropDownList ID="DrpSearchCode" runat="server" Width="200px" 
                    CssClass="box3" AutoPostBack="True" 
                    onselectedindexchanged="DrpSearchCode_SelectedIndexChanged">
                     <asp:ListItem Value="Select">Select</asp:ListItem>
                     <asp:ListItem Value="1">Item Code</asp:ListItem>
                     <asp:ListItem Value="2">Description</asp:ListItem>                    
                     
                </asp:DropDownList>
                
            
                <asp:TextBox ID="txtSearchItemCode" runat="server" Width="207px" 
                    CssClass="box3"></asp:TextBox>
                
                        &nbsp;</td>
                    </tr>
                    <tr>
                    <td height="25" valign="middle">
                        &nbsp;From Date :<asp:TextBox ID="Txtfromdate" runat="server" CssClass="box3" 
                            Width="80px"></asp:TextBox>
                <cc1:CalendarExtender ID="Txtfromdate_CalendarExtender" runat="server" 
                    Enabled="True" TargetControlID="Txtfromdate" Format="dd-MM-yyyy">
                </cc1:CalendarExtender>
                <asp:RequiredFieldValidator ID="ReqFrDate" runat="server" 
                    ControlToValidate="Txtfromdate" ErrorMessage="*" ValidationGroup="view">
                    </asp:RequiredFieldValidator>
                    <asp:RegularExpressionValidator ID="RegularExpressionValidator1" runat="server" 
                ControlToValidate="Txtfromdate" ErrorMessage="*" ValidationGroup="view" 
                ValidationExpression="^([1-9]|0[1-9]|[12][0-9]|3[01])[- /.]([1-9]|0[1-9]|1[012])[- /.][0-9]{4}$"></asp:RegularExpressionValidator>
                    
                    
            &nbsp;&nbsp;&nbsp;&nbsp;To Date:
                <asp:TextBox ID="TxtTodate" runat="server" CssClass="box3" Width="80px"></asp:TextBox>
                <cc1:CalendarExtender ID="TxtTodate_CalendarExtender" runat="server" 
                    Enabled="True" TargetControlID="TxtTodate" Format="dd-MM-yyyy">
                </cc1:CalendarExtender>
                <asp:RequiredFieldValidator ID="ReqTODate" runat="server" 
                    ControlToValidate="TxtTodate" ErrorMessage="*" ValidationGroup="view"></asp:RequiredFieldValidator>
                       <asp:RegularExpressionValidator ID="RegularExpressionValidator2" runat="server" 
                ControlToValidate="TxtTodate" ErrorMessage="*" ValidationGroup="view" 
                ValidationExpression="^([1-9]|0[1-9]|[12][0-9]|3[01])[- /.]([1-9]|0[1-9]|1[012])[- /.][0-9]{4}$"></asp:RegularExpressionValidator>
                    
                    
&nbsp; Lock by User :
                        
                     <asp:TextBox ID="TxtEmpName" runat="server" Width="250px" CssClass="box3"></asp:TextBox>
                                          
                          <cc1:AutoCompleteExtender ID="TxtEmpName_AutoCompleteExtender" runat="server" 
                                DelimiterCharacters="" Enabled="True" ServiceMethod="GetCompletionList" 
                                ServicePath="" TargetControlID="TxtEmpName" UseContextKey="True"
                             CompletionInterval="100" CompletionSetCount="2" FirstRowSelected="True" MinimumPrefixLength="1" ShowOnlyCurrentWordInCompletionListItem="True" CompletionListItemCssClass="bg" CompletionListHighlightedItemCssClass="bgtext" CompletionListCssClass="almt">
                            </cc1:AutoCompleteExtender>
                        
                        
                    &nbsp;<asp:Button ID="btnSearch" runat="server" 
                    Text="  View  " CssClass="redbox" onclick="btnSearch_Click"  />
                        
                        
                    </td>
                    </tr>
                   
                    <tr>
                    <td>
                    <iframe id="Iframe1"  runat ="server" width="100%" height="390px" frameborder="0" scrolling="auto" ></iframe>
                    </td>   
                    </tr>
                    </table>       
                           
                      
</asp:Content>
<asp:Content ID="Content8" ContentPlaceHolderID="ContentPlaceHolder4" Runat="Server">
</asp:Content>



=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/MaterialManagement/Reports/RateLockUnlock.aspx.cs ===

﻿using System;
using System.Collections;
using System.Configuration;
using System.Data;
using System.Linq;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Xml.Linq;
using System.Data.SqlClient;

public partial class Module_MaterialManagement_Reports_RateLockUnlock : System.Web.UI.Page
{
    clsFunctions fun = new clsFunctions();
    DataSet DS = new DataSet();
    DataSet DS2 = new DataSet();

    string Cat = "Select";
    string Type = "";
    string SerCod = "0";
    string SerItem = "0";
    string fdate = "0";
    string tdate = "0";
    string LockBy = "0";
    int CompId = 0;
    int FinYearId = 0;

    protected void Page_Load(object sender, EventArgs e)
    {
      try
        {

            CompId = Convert.ToInt32(Session["compid"]);
            FinYearId = Convert.ToInt32(Session["finyear"]);
            if (!IsPostBack)
            {
                DrpCategory1.Items.Clear();
                DrpCategory1.Items.Insert(0, "Select");
                DrpCategory1.Visible = false;
                DrpSearchCode.Visible = false;
                txtSearchItemCode.Visible = false;
            }       

        }
        catch (Exception ex){  }
      
    }

    protected void btnSearch_Click(object sender, EventArgs e)
    {

        try
        {
            if (DrpType.SelectedValue != "Select")
            {
                if (DrpType.SelectedValue == "Category")
                { 
                    Type = "Category";
                    Cat = DrpCategory1.SelectedValue;
                    SerCod = DrpSearchCode.SelectedValue;                   
                    if (DrpSearchCode.SelectedValue != "Select")
                    { 
                        SerItem = txtSearchItemCode.Text;                        
                    }

                }
                else if (DrpType.SelectedValue == "WOItems")
                {
                    Type = "WOItems";
                    Cat = "Select";
                    SerCod = DrpSearchCode.SelectedValue;
                    
                    if (DrpSearchCode.SelectedValue != "Select")
                    {
                        SerItem = txtSearchItemCode.Text;
                    }        
                   
                }


                if (Txtfromdate.Text != "" && fun.DateValidation(Txtfromdate.Text) == true)
                {
                    fdate = fun.FromDate(Txtfromdate.Text);
                }

                if (TxtTodate.Text != "" && fun.DateValidation(TxtTodate.Text) == true)
                {
                    tdate = fun.FromDate(TxtTodate.Text);
                }
                if (TxtEmpName.Text != "")
                {
                    LockBy = fun.getCode(TxtEmpName.Text);
                }
                
                string getRandomKey = fun.GetRandomAlphaNumeric();

                Iframe1.Attributes.Add("src", "RateLockUnlock_Details.aspx?category=" + Cat + "&SearchCode=" + SerCod + "&FDate=" + fdate + "&TDate=" + tdate + "&LockedBy=" + LockBy + "&SearchItemCode=" + SerItem + "&loc=" + DrpSearchCode.SelectedItem.Text + "&Type=" + Type + "&Key=" + getRandomKey + "");

            }
            else
            {
                string myStringVariable = string.Empty;
                myStringVariable = "Select Category or WO Items.";
                ClientScript.RegisterStartupScript(this.GetType(), "myalert", "alert('" + myStringVariable + "');", true);
            }
        }
       catch(Exception ex){}

    }

  

    protected void DrpType_SelectedIndexChanged(object sender, EventArgs e)
    {

        switch (DrpType.SelectedValue)
        {
            case "Category":
                {
                    DrpSearchCode.Visible = true;
                    txtSearchItemCode.Visible = true;
                    txtSearchItemCode.Text = "";
                    DrpCategory1.Visible = true;

                    string connStr = fun.Connection();
                    SqlConnection con = new SqlConnection(connStr);

                    DataSet DS = new DataSet();
                    string StrCat = fun.select("CId,Symbol+'-'+CName as Category", "tblDG_Category_Master", "CompId='" + CompId + "'");
                    SqlCommand Cmd = new SqlCommand(StrCat, con);
                    SqlDataAdapter DA = new SqlDataAdapter(Cmd);
                    DA.Fill(DS, "tblDG_Category_Master");
                    DrpCategory1.DataSource = DS.Tables["tblDG_Category_Master"];
                    DrpCategory1.DataTextField = "Category";
                    DrpCategory1.DataValueField = "CId";
                    DrpCategory1.DataBind();
                    DrpCategory1.Items.Insert(0, "Select");
                    DrpCategory1.ClearSelection();
                    txtSearchItemCode.Visible = true;
                    txtSearchItemCode.Text = "";
                    DrpSearchCode.SelectedIndex = 0;
                }
                break;

            case "WOItems":
                {
                    txtSearchItemCode.Visible = true;
                    txtSearchItemCode.Text = "";
                    DrpSearchCode.Visible = true;
                    DrpCategory1.Visible = false;
                    DrpCategory1.Items.Clear();
                    DrpCategory1.Items.Insert(0, "Select");
                    DrpSearchCode.SelectedIndex = 0;

                                
                }
                break;

            case "Select":
                {
                    Page.Response.Redirect(Page.Request.Url.ToString(), true);
                }
                break;
        }
    }
    protected void DrpCategory1_SelectedIndexChanged(object sender, EventArgs e)
    {
        try
        {
            if (DrpCategory1.SelectedValue != "Select")
            {
                DrpSearchCode.SelectedIndex = 0;
                txtSearchItemCode.Text = "";
                string sd = DrpCategory1.SelectedValue;
                string c = DrpSearchCode.SelectedValue;
                string d = txtSearchItemCode.Text;
            }
            else
            {
                DrpSearchCode.SelectedIndex = 0;
                txtSearchItemCode.Text = "";
            }
        }
        catch (Exception ex) {}

    }
    protected void DrpSearchCode_SelectedIndexChanged(object sender, EventArgs e)
    {     
            string c = DrpSearchCode.SelectedValue;
            string sd = DrpCategory1.SelectedValue;
            string d = txtSearchItemCode.Text;
            txtSearchItemCode.Text = "";
    }
   
    [System.Web.Services.WebMethodAttribute(), System.Web.Script.Services.ScriptMethodAttribute()]
    public static string[] GetCompletionList(string prefixText, int count, string contextKey)
    {
        clsFunctions fun = new clsFunctions();
        string connStr = fun.Connection();
        DataSet ds = new DataSet();
        SqlConnection con = new SqlConnection(connStr);
        int CompId = Convert.ToInt32(HttpContext.Current.Session["compid"]);
        con.Open();
        string cmdStr = fun.select("EmpId,EmployeeName", "tblHR_OfficeStaff", "CompId='" + CompId + "'");
        SqlDataAdapter da = new SqlDataAdapter(cmdStr, con);
        da.Fill(ds, "tblHR_OfficeStaff");
        con.Close();
        string[] main = new string[0];
        for (int i = 0; i < ds.Tables[0].Rows.Count; i++)
        {
            if (ds.Tables[0].Rows[i].ItemArray[1].ToString().ToLower().StartsWith(prefixText.ToLower()))
            {
                Array.Resize(ref main, main.Length + 1);
                main[main.Length - 1] = ds.Tables[0].Rows[i].ItemArray[1].ToString() + " [" + ds.Tables[0].Rows[i].ItemArray[0].ToString() + "]";
                //if (main.Length == 10)
                //    break;
            }
        }
        Array.Sort(main);
        return main;
    }  

}