=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/HR/Transactions/TourIntimation.aspx.txt ===

﻿<%@ Page Language="C#" MasterPageFile="~/MasterPage.master" AutoEventWireup="true" CodeFile="TourIntimation.aspx.cs" 
Inherits="Module_HR_TourIntimation" Title="ERP" Theme="Default" %>
<%@ Register assembly="AjaxControlToolkit" namespace="AjaxControlToolkit" tagprefix="cc1" %>
<%@ Register assembly="TimePicker" namespace="MKB.TimePicker" tagprefix="MKB" %>
<asp:Content ID="Content1" ContentPlaceHolderID="head" Runat="Server">

    <link href="../../../Css/StyleSheet.css" rel="stylesheet" type="text/css" />   
    <script src="../../../Javascript/loadingNotifier.js" type="text/javascript"></script>
    <link href="../../../Css/yui-datatable.css" rel="stylesheet" type="text/css" />
    <script src="../../../Javascript/loadingNotifier.js" type="text/javascript"></script>
    <script src="../../../Javascript/PopUpMsg.js" type="text/javascript"></script>
    
    <style type="text/css">
        .style2
        {
            width: 100%;
        }
        </style>
    
</asp:Content>
<asp:Content ID="Content2" ContentPlaceHolderID="cp3" Runat="Server">
</asp:Content>
<asp:Content ID="Content3" ContentPlaceHolderID="cp1" Runat="Server">
</asp:Content>
<asp:Content ID="Content4" ContentPlaceHolderID="cp2" Runat="Server">
</asp:Content>
<asp:Content ID="Content5" ContentPlaceHolderID="MainContent" Runat="Server">
</asp:Content>
<asp:Content ID="Content6" ContentPlaceHolderID="ContentPlaceHolder2" Runat="Server">
</asp:Content>
<asp:Content ID="Content7" ContentPlaceHolderID="ContentPlaceHolder3" Runat="Server">
<table cellpadding="0" cellspacing="0" width="100%">
    <tr>
            <td align="left" valign="middle" style="background:url(../../../images/hdbg.JPG)" height="21" class="fontcsswhite">
            <b>&nbsp;Tour Intimation</b></td>
    </tr>
 <tr>
 <td>
     <table class="style2">
         <tr>
             <td width="3%">
                 </td>
             <td width="10%">
                 </td>
             <td width="20%" colspan="2">
                 </td>
             <td width="1%">
                 &nbsp;</td>
             <td width="18%">
                 </td>
             <td width="30%" colspan="2">
                 &nbsp;</td>
             <td width="2%">
                 </td>
         </tr>
         <tr>
             <td>
                 &nbsp;</td>
             <td>
                 <asp:RadioButtonList ID="RadioButtonList1" runat="server" 
                     RepeatDirection="Horizontal" AutoPostBack="True" 
                     onselectedindexchanged="RadioButtonList1_SelectedIndexChanged">
                     <asp:ListItem Selected="True" Value="0">Self</asp:ListItem>
                     <asp:ListItem Value="1">Others</asp:ListItem>
                 </asp:RadioButtonList>
             </td>
             <td colspan="2">
                 :<asp:TextBox ID="TextEmpName" runat="server" CssClass="box3" 
                     Text='<%# Eval("EmpName") %>' Width="90%" Enabled="False"></asp:TextBox>
                 <cc1:AutoCompleteExtender ID="Txt_AutoCompleteExtender" runat="server" 
                     CompletionInterval="100" CompletionListCssClass="almt" 
                     CompletionListHighlightedItemCssClass="bgtext" CompletionListItemCssClass="bg" 
                     CompletionSetCount="2" DelimiterCharacters="" Enabled="True" 
                     EnableViewState="true" FirstRowSelected="True" MinimumPrefixLength="1" 
                     ServiceMethod="GetCompletionList" ServicePath="" 
                     ShowOnlyCurrentWordInCompletionListItem="True" TargetControlID="TextEmpName" 
                     UseContextKey="True">
                 </cc1:AutoCompleteExtender>
                 <asp:RequiredFieldValidator ID="ReqTextEmpName" runat="server" 
                     ControlToValidate="TextEmpName" ErrorMessage="*" ValidationGroup="B"></asp:RequiredFieldValidator>
             </td>
             <td>
                 &nbsp;</td>
             <td>
                 <asp:RadioButtonList ID="RadioButtonWONoGroup" runat="server" 
                     AutoPostBack="True" 
                     onselectedindexchanged="RadioButtonWONoGroup_SelectedIndexChanged" 
                     RepeatDirection="Horizontal">
                     <asp:ListItem Selected="True" Value="0">WO No</asp:ListItem>
                     <asp:ListItem Value="1"> BG Group</asp:ListItem>
                 </asp:RadioButtonList>
             </td>
             <td colspan="2">
                 :<asp:TextBox ID="txtWONo" runat="server" CssClass="box3"></asp:TextBox>
                 <asp:RequiredFieldValidator ID="RequiredFieldtxtWONo" runat="server" 
                     ControlToValidate="txtWONo" ErrorMessage="*" ValidationGroup="B">
                 </asp:RequiredFieldValidator>
                <%-- 
                    <cc1:AutoCompleteExtender ID="txtWONo_AutoCompleteExtender1" 
                    runat="server" CompletionInterval="100" CompletionSetCount="1" 
                    DelimiterCharacters="" Enabled="True" FirstRowSelected="True" 
                    MinimumPrefixLength="1" ServiceMethod="sql" ServicePath="" 
                    ShowOnlyCurrentWordInCompletionListItem="True" 
                    TargetControlID="txtWONo" UseContextKey="True" CompletionListItemCssClass="bg" 
                    CompletionListHighlightedItemCssClass="bgtext" CompletionListCssClass="almt">
                    </cc1:AutoCompleteExtender>--%>
                 <asp:DropDownList ID="drpGroup" runat="server">
                 </asp:DropDownList>
             </td>
             <td>
                 &nbsp;</td>
         </tr>
         <tr>
             <td>
                 &nbsp;</td>
             <td>
                 Project Name</td>
             <td colspan="2">
                 :<asp:TextBox ID="txtProjectName" runat="server" CssClass="box3" Width="90%"></asp:TextBox>
                 <asp:RequiredFieldValidator ID="ReqtxtProjectName" runat="server" 
                     ControlToValidate="txtProjectName" ErrorMessage="*" ValidationGroup="B"></asp:RequiredFieldValidator>
             </td>
             <td>
                 &nbsp;</td>
             <td>
                 Place of&nbsp; Tour</td>
             <td colspan="2">
                 :<asp:DropDownList ID="ddlPlaceOfTourCountry" runat="server" 
                     AutoPostBack="True" CssClass="box3" 
                     onselectedindexchanged="ddlPlaceOfTourCountry_SelectedIndexChanged">
                 </asp:DropDownList>
                 <asp:RequiredFieldValidator ID="PlaceOfTourCountry" runat="server" 
                     ControlToValidate="ddlPlaceOfTourCountry" ErrorMessage="*" 
                     InitialValue="Select" ValidationGroup="B"></asp:RequiredFieldValidator>
                 <asp:DropDownList ID="ddlPlaceOfTourState" runat="server" AutoPostBack="True" 
                     CssClass="box3" 
                     onselectedindexchanged="ddlPlaceOfTourState_SelectedIndexChanged">
                 </asp:DropDownList>
                 <asp:RequiredFieldValidator ID="PlaceOfTourState" runat="server" 
                     ControlToValidate="ddlPlaceOfTourState" ErrorMessage="*" InitialValue="Select" 
                     ValidationGroup="B"></asp:RequiredFieldValidator>
                 <asp:DropDownList ID="ddlPlaceOfTourCity" runat="server" CssClass="box3">
                 </asp:DropDownList>
                 <asp:RequiredFieldValidator ID="PlaceOfTourCity" runat="server" 
                     ControlToValidate="ddlPlaceOfTourCity" ErrorMessage="*" InitialValue="Select" 
                     ValidationGroup="B"></asp:RequiredFieldValidator>
             </td>
             <td>
                 &nbsp;</td>
         </tr>
         <tr>
             <td>
                 &nbsp;</td>
             <td>
                 Tour Start Date</td>
             <td>
                 :<asp:TextBox ID="textStartDate" runat="server" CssClass="box3" Width="70px"></asp:TextBox>
                 <cc1:CalendarExtender ID="textStartDate_CalendarExtender" runat="server"  CssClass="cal_Theme2" PopupPosition="BottomRight" 
                     Enabled="True" Format="dd-MM-yyyy" TargetControlID="textStartDate">
                 </cc1:CalendarExtender>
                 <asp:RequiredFieldValidator ID="ReqtextStartDate" runat="server"
                     ControlToValidate="textStartDate" ErrorMessage="*" ValidationGroup="B">
                 </asp:RequiredFieldValidator>
                 <asp:RegularExpressionValidator ID="RegtextStartDate" runat="server" 
                     ControlToValidate="textStartDate" ErrorMessage="*" 
                     ValidationExpression="^([1-9]|0[1-9]|[12][0-9]|3[01])[- /.]([1-9]|0[1-9]|1[012])[- /.][0-9]{4}$" 
                     ValidationGroup="B">
                 </asp:RegularExpressionValidator>
                 &nbsp;Time :</td>
             <td>
                 <MKB:TimeSelector ID="TimeSelector1" runat="server" AmPm="AM" 
                     MinuteIncrement="1">
                 </MKB:TimeSelector>
             </td>
             <td>
                 &nbsp;</td>
             <td>
                 Tour End Date</td>
             <td>
                 :<asp:TextBox ID="textEndDate" runat="server" CssClass="box3" Width="70px"></asp:TextBox>
                 <cc1:CalendarExtender ID="textEndDate_CalendarExtender0" runat="server" CssClass="cal_Theme2" PopupPosition="BottomRight"
                     Enabled="True" Format="dd-MM-yyyy" TargetControlID="textEndDate">
                 </cc1:CalendarExtender>
                 <asp:RequiredFieldValidator ID="ReqtextEndDate" runat="server" 
                     ControlToValidate="textEndDate" ErrorMessage="*" ValidationGroup="B">
                 </asp:RequiredFieldValidator>
                 <asp:RegularExpressionValidator ID="RegtextEndDate" runat="server" 
                     ControlToValidate="textEndDate" ErrorMessage="*" 
                     ValidationExpression="^([1-9]|0[1-9]|[12][0-9]|3[01])[- /.]([1-9]|0[1-9]|1[012])[- /.][0-9]{4}$" 
                     ValidationGroup="B">
                 </asp:RegularExpressionValidator>
             &nbsp;Time :</td>
             <td>
                 <MKB:TimeSelector ID="TimeSelector2" runat="server" AmPm="AM" 
                     MinuteIncrement="1">
                 </MKB:TimeSelector>
             </td>
             <td>
                 &nbsp;</td>
         </tr>
         <tr>
             <td>
                 &nbsp;</td>
             <td>
                 No of Days</td>
             <td colspan="2">
                 :<asp:TextBox ID="txtNoOfDays" runat="server" CssClass="box3"></asp:TextBox>
                 <asp:RequiredFieldValidator ID="ReqNoOfDays" runat="server" 
                     ControlToValidate="txtNoOfDays" ErrorMessage="*" ValidationGroup="B">
                     </asp:RequiredFieldValidator>
                      <asp:RegularExpressionValidator ID="RegtxtNoOfDays" runat="server" 
             ValidationGroup="B" ControlToValidate="txtNoOfDays" ErrorMessage="*" ValidationExpression="^\d{1,15}(\.\d{0,3})?$">
            </asp:RegularExpressionValidator>
             </td>
             <td>
                 &nbsp;</td>
             <td>
                 Name &amp; Address of Accommodation service provider</td>
             <td colspan="2">
                 :<asp:TextBox ID="txtNameAndAddress" runat="server" CssClass="box3" TextMode="MultiLine" 
                     Width="90%" Height="30px"></asp:TextBox>
                 <asp:RequiredFieldValidator ID="ReqtxtNameAndAddress" runat="server" 
                     ControlToValidate="txtNameAndAddress" ErrorMessage="*" ValidationGroup="B"></asp:RequiredFieldValidator>
             </td>
             <td>
                 &nbsp;</td>
         </tr>
         <tr>
             <td>
                 &nbsp;</td>
             <td>
                 Contact Person</td>
             <td colspan="2">
                 :<asp:TextBox ID="txtContactPerson" runat="server" CssClass="box3" Width="90%"></asp:TextBox>
                 <asp:RequiredFieldValidator ID="ReqtxtContactPerson" runat="server" 
                     ControlToValidate="txtContactPerson" ErrorMessage="*" ValidationGroup="B"></asp:RequiredFieldValidator>
             </td>
             <td>
                 &nbsp;</td>
             <td>
                 Contact No</td>
             <td colspan="2">
                 :<asp:TextBox ID="txtContactNo" runat="server" CssClass="box3" Width="90%"></asp:TextBox>
                 <asp:RequiredFieldValidator ID="ReqtxtContactNo" runat="server" 
                     ControlToValidate="txtContactNo" ErrorMessage="*" ValidationGroup="B"></asp:RequiredFieldValidator>
             </td>
             <td>
                 &nbsp;</td>
         </tr>
         <tr>
             <td>
                 &nbsp;</td>
             <td>
                 Email </td>
             <td colspan="2">
                 :<asp:TextBox ID="txtEmail" runat="server" CssClass="box3" Width="75%"></asp:TextBox>
             </td>
             <td>
                 &nbsp;</td>
             <td>
                 &nbsp;</td>
             <td colspan="2">
                 &nbsp;</td>
             <td>
                 &nbsp;</td>
         </tr>
         </table>
 </td>
 </tr>
 <tr>
 <td height="15px">
 </td>
 </tr>
<tr>
              
                 <td>
                <cc1:TabContainer ID="TabContainer1" runat="server" ActiveTabIndex="0" Width="99%" >
                <cc1:TabPanel runat="server" HeaderText="TabPanel1" ID="TabPanel1"> 
                 <HeaderTemplate>Advance Details  </HeaderTemplate>
                 <ContentTemplate>
                    <asp:Panel ID="Panel1" runat="server" ScrollBars="Auto" Width="95%"  Height="230px">
                      
                      <asp:GridView ID="GridView2" runat="server" CssClass="yui-datatable-theme" 
        Width="100%" AutoGenerateColumns="False" DataKeyNames="Id" 
        DataSourceID="SqlDataSource1"><Columns><asp:TemplateField HeaderText="SN"><ItemTemplate><%# Container.DataItemIndex + 1%></ItemTemplate><ItemStyle Width="4%"  HorizontalAlign="Right"/></asp:TemplateField><asp:TemplateField HeaderText="Id" Visible="False"><ItemTemplate><asp:Label ID="lblAdId" runat="server" Text='<%# Bind("Id") %>'></asp:Label></ItemTemplate><ItemStyle HorizontalAlign="Center" Width="2%" /></asp:TemplateField><asp:BoundField DataField="Terms" HeaderText="Terms" SortExpression="Terms" /><asp:TemplateField HeaderText="Amount"><ItemTemplate><asp:TextBox ID="txtAmount" CssClass="box3" Text=""  Width="85%" runat="server"> </asp:TextBox><asp:RequiredFieldValidator ID="ReqtxtAmount" runat="server" 
            ControlToValidate="txtAmount" ErrorMessage="*" ValidationGroup="A"> </asp:RequiredFieldValidator><asp:RegularExpressionValidator ID="RegtxtAmount" runat="server" 
             ValidationGroup="A" ControlToValidate="txtAmount" ErrorMessage="*" ValidationExpression="^\d{1,15}(\.\d{0,3})?$"> </asp:RegularExpressionValidator></ItemTemplate><ItemStyle HorizontalAlign="Center" Width="20%" /></asp:TemplateField><asp:TemplateField HeaderText="Remarks"><ItemTemplate><asp:TextBox ID="txtRemarks" CssClass="box3" Text=""  Width="85%" runat="server"> </asp:TextBox><asp:RequiredFieldValidator ID="ReqtxtRemarks" runat="server" 
            ControlToValidate="txtRemarks" ErrorMessage="*" ValidationGroup="A"> </asp:RequiredFieldValidator></ItemTemplate><ItemStyle HorizontalAlign="Center" Width="20%" /></asp:TemplateField></Columns><EmptyDataTemplate><table width="100%" class="fontcss"><tr><td align="center"><asp:Label ID="Label1" runat="server"  Text="No data to display !" Font-Size="Larger" ForeColor="maroon"> </asp:Label></td></tr></table></EmptyDataTemplate><PagerSettings PageButtonCount="40" /></asp:GridView>
            
            </asp:Panel>
            </ContentTemplate>
            </cc1:TabPanel>
                
                <cc1:TabPanel runat="server" HeaderText="TabPanel1" ID="TabPanel2">              
                <HeaderTemplate>Advance Trans. To</HeaderTemplate>
                <ContentTemplate>
                    <asp:Panel ID="Panel2" runat="server" ScrollBars="Auto" Width="90%" Height="230px">
                    
                    <asp:GridView 
                            ID="GridView1" runat="server" CssClass="yui-datatable-theme" 
        Width="100%" AutoGenerateColumns="False" DataKeyNames="Id" 
       ShowFooter="True"   onrowcancelingedit="GridView1_RowCancelingEdit" 
        onrowcommand="GridView1_RowCommand" onrowdeleting="GridView1_RowDeleting" 
        onrowediting="GridView1_RowEditing" onrowupdating="GridView1_RowUpdating" 
        AllowPaging="True" PageSize="9" 
        onpageindexchanging="GridView1_PageIndexChanging">
        
        <Columns>
        
                   <asp:TemplateField ShowHeader="False">
                   <ItemTemplate>
                   <asp:LinkButton ID="LinkButton1"  runat="server"  CausesValidation="False" CommandName="Edit" Text="Edit">
                    </asp:LinkButton>
                    </ItemTemplate>
                    
                    <EditItemTemplate>
                    <asp:LinkButton ID="LinkButton3" OnClientClick="return confirmationUpdate();"  
                    runat="server" CausesValidation="True" CommandName="Update" Text="Update">
                    </asp:LinkButton>&#160; 
                    <asp:LinkButton ID="LinkButton2" runat="server" CausesValidation="False" 
                    CommandName="Cancel" Text="Cancel">
                    </asp:LinkButton>
                    </EditItemTemplate>
                    <ItemStyle  HorizontalAlign="Center" Width="7%" />
                    </asp:TemplateField>
                                
                                
                                <asp:TemplateField ShowHeader="False"><ItemTemplate><asp:LinkButton ID="LinkButton4" OnClientClick="return confirmationDelete();"  runat="server" 
                    CausesValidation="False" CommandName="Delete" Text="Delete"></asp:LinkButton></ItemTemplate><ItemStyle HorizontalAlign="Center" Width="3%" /></asp:TemplateField><asp:TemplateField HeaderText="SN"><ItemTemplate><%# Container.DataItemIndex + 1%></ItemTemplate><ItemStyle Width="2%"  HorizontalAlign="Right"/></asp:TemplateField><asp:TemplateField 
                                HeaderText="Id" Visible ="False"><ItemTemplate><asp:Label ID="lblId" Text='<%# Bind("Id") %>' runat="server"></asp:Label></ItemTemplate><ItemStyle 
                                HorizontalAlign="Center" Width="4%" /></asp:TemplateField><asp:TemplateField HeaderText="Employee Name"><ItemTemplate><asp:Label ID="lblEmpName" Text='<%# Bind("EmpName") %>' runat="server"></asp:Label></ItemTemplate><EditItemTemplate><asp:TextBox ID="txtEmpName1" Width="95%" Text='<%# Bind("EmpName") %>' CssClass="box3"  runat="server"></asp:TextBox><cc1:AutoCompleteExtender ID="txtEmpName1_AutoCompleteExtender" runat="server" 
                    DelimiterCharacters="" 
                    Enabled="True" ServiceMethod="GetCompletionList"  EnableViewState="true"
                    ServicePath="" TargetControlID="txtEmpName1" UseContextKey="True"
                    CompletionInterval="100" CompletionSetCount="2" FirstRowSelected="True" MinimumPrefixLength="1" 
                    ShowOnlyCurrentWordInCompletionListItem="True" CompletionListItemCssClass="bg" 
                    CompletionListHighlightedItemCssClass="bgtext" CompletionListCssClass="almt"></cc1:AutoCompleteExtender></EditItemTemplate><FooterTemplate><asp:TextBox ID="TextEmpName" runat="server" CssClass="box3" ValidationGroup="A" 
                    Width="95%"></asp:TextBox><cc1:AutoCompleteExtender ID="TextEmpName_AutoCompleteExtender" runat="server" 
                    DelimiterCharacters="" 
                    Enabled="True" ServiceMethod="GetCompletionList"  EnableViewState="true"
                    ServicePath="" TargetControlID="TextEmpName" UseContextKey="True"
                    CompletionInterval="100" CompletionSetCount="2" FirstRowSelected="True" MinimumPrefixLength="1" 
                    ShowOnlyCurrentWordInCompletionListItem="True" CompletionListItemCssClass="bg"
                     CompletionListHighlightedItemCssClass="bgtext" CompletionListCssClass="almt"></cc1:AutoCompleteExtender></FooterTemplate><ItemStyle HorizontalAlign="Left" Width="30%" /></asp:TemplateField><asp:TemplateField HeaderText="Amount"><ItemTemplate><asp:Label ID="lblAmount" Text='<%# Bind("Amount") %>' runat="server"></asp:Label></ItemTemplate><EditItemTemplate><asp:TextBox ID="txtAmt1" CssClass="box3" Text='<%# Bind("Amount") %>' Width="95%" runat="server"> </asp:TextBox><asp:RegularExpressionValidator ID="RegtxtAmt1" runat="server" 
             ValidationGroup="B" ControlToValidate="txtAmt1" ErrorMessage="*" ValidationExpression="^\d{1,15}(\.\d{0,3})?$"> </asp:RegularExpressionValidator></EditItemTemplate><FooterTemplate><asp:TextBox ID="txtAmt" CssClass="box3" Text=""  Width="95%" runat="server"> </asp:TextBox><asp:RegularExpressionValidator ID="RegtxtAmt" runat="server" 
             ValidationGroup="A" ControlToValidate="txtAmt" ErrorMessage="*" ValidationExpression="^\d{1,15}(\.\d{0,3})?$"> </asp:RegularExpressionValidator></FooterTemplate><ItemStyle HorizontalAlign="Right" Width="15%" /></asp:TemplateField><asp:TemplateField HeaderText="Remarks"><ItemTemplate><asp:Label ID="lblRemark" Text='<%# Bind("Remarks") %>' runat="server"></asp:Label></ItemTemplate><EditItemTemplate><asp:TextBox ID="txtRemark1" CssClass="box3" Text='<%# Bind("Remarks") %>'  Width="95%" runat="server"> </asp:TextBox></EditItemTemplate><FooterTemplate><asp:TextBox ID="txtRemark" CssClass="box3" Text=""  Width="95%" runat="server"> </asp:TextBox></FooterTemplate><ItemStyle HorizontalAlign="Left" Width="20%" /></asp:TemplateField><asp:TemplateField HeaderText=" "><FooterTemplate><asp:Button ID="btnAdd" runat="server" CommandName="Add"  Text=" Add "  OnClientClick="return confirmationAdd();"
              CssClass="redbox"  /></FooterTemplate><ItemStyle HorizontalAlign="Center" Width="4%" /></asp:TemplateField></Columns><EmptyDataTemplate><table width="100%" border="1" style="border-color:Gray"  class="fontcss"><tr><th>SN </th><th>Employee Name </th><th>Amount </th><th>Remarks </th><th></th></tr><tr><td 
                                align="right" style="width:1%">1 </td><td align="left" style="width:20%"><asp:TextBox 
                                    ID="TxtEmp" runat="server" CssClass="box3" ValidationGroup="E" Width="90%"> </asp:TextBox><cc1:AutoCompleteExtender 
                                    ID="TxtEmp_AutoCompleteExtender" runat="server" CompletionInterval="100" 
                                    CompletionListCssClass="almt" CompletionListHighlightedItemCssClass="bgtext" 
                                    CompletionListItemCssClass="bg" CompletionSetCount="2" DelimiterCharacters="" 
                                    Enabled="True" EnableViewState="true" FirstRowSelected="True" 
                                    MinimumPrefixLength="1" ServiceMethod="GetCompletionList" ServicePath="" 
                                    ShowOnlyCurrentWordInCompletionListItem="True" TargetControlID="TxtEmp" 
                                    UseContextKey="True">
                                </cc1:AutoCompleteExtender>
                            </td>
                            <td align="center" style="width:5%">
                                <asp:TextBox ID="TxtAmt2" runat="server" CssClass="box3" Width="85%">
                                 </asp:TextBox><asp:RegularExpressionValidator ID="RegAmt" runat="server" 
                                    ControlToValidate="TxtAmt2" ErrorMessage="*" 
                                    ValidationExpression="^\d{1,15}(\.\d{0,3})?$" ValidationGroup="E"> </asp:RegularExpressionValidator></td><td 
                                align="center" style="width:15%"><asp:TextBox ID="TxtRemarks2" runat="server" 
                                    CssClass="box3" ValidationGroup="E" Width="90%"> </asp:TextBox></td><td 
                                align="center" style="width:2%"><asp:Button ID="BtnAdd1" runat="server" 
                                    CommandName="Add1" CssClass="redbox" OnClientClick="return confirmationAdd();" 
                                    Text="Add" ValidationGroup="E" />
                            </td>
                            </tr></table></EmptyDataTemplate><PagerSettings PageButtonCount="40" /></asp:GridView>
                     
                     </asp:Panel>
                     </ContentTemplate>
                     </cc1:TabPanel>
                </cc1:TabContainer>
                </td>
 </tr>

<tr>
<td align="center" height="25px" valign="middle">
    <asp:Button ID="btnSubmit" runat="server" Text="Submit" CssClass="redbox" ValidationGroup="B" OnClientClick="return confirmationAdd();"
        onclick="btnSubmit_Click" />
 </td>
 </tr>
<tr>
<td>
<asp:SqlDataSource ID="SqlDataSource1" runat="server" 
       ConnectionString="<%$ ConnectionStrings:LocalSqlServer %>" 
         SelectCommand="SELECT * FROM [tblACC_TourExpencessType]"></asp:SqlDataSource>
         <asp:SqlDataSource ID="SqlDataSource2" runat="server" 
       ConnectionString="<%$ ConnectionStrings:LocalSqlServer %>" 
         SelectCommand="SELECT * FROM [tblACC_TourAdvance_Temp]"></asp:SqlDataSource>

 </td>
 </tr>
  </table>   

                </asp:Content>
<asp:Content ID="Content8" ContentPlaceHolderID="ContentPlaceHolder4" Runat="Server">
</asp:Content>



=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/HR/Transactions/TourIntimation.aspx.cs ===

﻿using System;
using System.Collections;
using System.Configuration;
using System.Data;
using System.Linq;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Xml.Linq;
using System.Data.SqlClient;
using MKB.TimePicker;

public partial class Module_HR_TourIntimation : System.Web.UI.Page
{
    clsFunctions fun = new clsFunctions();
    SqlConnection con;

    int CompId = 0;
    int FinYearId = 0;
    string sId = "";
    string CDate = "";
    string CTime = "";
    string wono = "";
    string connStr = "";

    protected void Page_Load(object sender, EventArgs e)
    {
        try
        {
            connStr = fun.Connection();
            con = new SqlConnection(connStr);
            CompId = Convert.ToInt32(Session["compid"]);
            FinYearId = Convert.ToInt32(Session["finyear"]);
            sId = Session["username"].ToString();
            CDate = fun.getCurrDate();
            CTime = fun.getCurrTime();

            textStartDate.Attributes.Add("readonly", "readonly");
            textEndDate.Attributes.Add("readonly", "readonly");    


            if (!IsPostBack)
            {
                fun.dropdownCountry(ddlPlaceOfTourCountry, ddlPlaceOfTourState);
                this.WONoGroup();
                this.FillGridAdvanceTo();

                string delsql = fun.delete("tblACC_TourAdvance_Temp", "CompId='" + CompId + "' AND SessionId='" + sId + "'AND FinYearId='" + FinYearId + "'");
                SqlCommand cmd12 = new SqlCommand(delsql, con);
                con.Open();
                cmd12.ExecuteNonQuery();
                con.Close();
                this.FillGridAdvanceTo();
            }
            if (RadioButtonList1.SelectedValue.ToString() == "0")
            {
                ReqTextEmpName.Visible = false;
            }
            else
            {
                ReqTextEmpName.Visible = true;
            }
        }
        catch (Exception ex) { }
    }

    public void WONoGroup()
    {
        string connStr = fun.Connection();
        SqlConnection con = new SqlConnection(connStr);
        try
        {
            if (RadioButtonWONoGroup.SelectedValue.ToString() == "0")
            {
                wono = txtWONo.Text;
                drpGroup.Visible = false;
                txtWONo.Visible = true;
                RequiredFieldtxtWONo.Visible = true;
            }
            if (RadioButtonWONoGroup.SelectedValue.ToString() == "1")
            {
                drpGroup.Visible = true;
                txtWONo.Visible = false;
                txtWONo.Text = "";
                RequiredFieldtxtWONo.Visible = false;
                string cmdStrGroup = fun.select1("Symbol,Id ", " BusinessGroup");
                SqlCommand cmdGroup = new SqlCommand(cmdStrGroup, con);
                SqlDataAdapter DAGroup = new SqlDataAdapter(cmdGroup);
                DataSet DSGroup = new DataSet();
                DAGroup.Fill(DSGroup, "BusinessGroup");
                drpGroup.DataSource = DSGroup;
                drpGroup.DataTextField = "Symbol";
                drpGroup.DataValueField = "Id";
                drpGroup.DataBind();
            }
        }
        catch (Exception ex) { }
    }

    protected void RadioButtonWONoGroup_SelectedIndexChanged(object sender, EventArgs e)
    {
        this.WONoGroup();
    }

    [System.Web.Services.WebMethodAttribute(), System.Web.Script.Services.ScriptMethodAttribute()]
    public static string[] GetCompletionList(string prefixText, int count, string contextKey)
    {
        clsFunctions fun = new clsFunctions();
        string connStr = fun.Connection();
        DataSet ds = new DataSet();
        SqlConnection con = new SqlConnection(connStr);
        con.Open();
        int CompId = Convert.ToInt32(HttpContext.Current.Session["compid"]);
        string cmdStr = fun.select("EmpId,EmployeeName", "tblHR_OfficeStaff", "CompId='" + CompId + "'");
        SqlDataAdapter da = new SqlDataAdapter(cmdStr, con);
        da.Fill(ds, "tblHR_OfficeStaff");
        con.Close();
        string[] main = new string[0];
        for (int i = 0; i < ds.Tables[0].Rows.Count; i++)
        {
            if (ds.Tables[0].Rows[i].ItemArray[1].ToString().ToLower().StartsWith(prefixText.ToLower()))
            {
                Array.Resize(ref main, main.Length + 1);
                main[main.Length - 1] = ds.Tables[0].Rows[i].ItemArray[1].ToString() + " [" + ds.Tables[0].Rows[i].ItemArray[0].ToString() + "]";
                //if (main.Length == 10)
                //    break;
            }
        }
        Array.Sort(main);
        return main;
    }

    public void FillGridAdvanceTo()
    {
        try
        {

            DataTable dt = new DataTable();
            con.Open();
            string str = fun.select("*", "tblACC_TourAdvance_Temp", "FinYearId<='" + FinYearId + "'And CompId='" + CompId + "' And SessionId='" + sId + "' Order by Id Desc");
            SqlCommand cmdCustWo = new SqlCommand(str, con);
            SqlDataAdapter daCustWo = new SqlDataAdapter(cmdCustWo);
            DataSet DSCustWo = new DataSet();
            daCustWo.Fill(DSCustWo);
            dt.Columns.Add(new System.Data.DataColumn("Id", typeof(int)));
            dt.Columns.Add(new System.Data.DataColumn("EmpName", typeof(string)));
            dt.Columns.Add(new System.Data.DataColumn("Amount", typeof(double)));
            dt.Columns.Add(new System.Data.DataColumn("Remarks", typeof(string)));

            DataRow dr;
            for (int i = 0; i < DSCustWo.Tables[0].Rows.Count; i++)
            {
                dr = dt.NewRow();
                dr[0] = DSCustWo.Tables[0].Rows[i]["Id"].ToString();
                string strEmp = fun.select("Title+'. '+EmployeeName+ ' ['+ EmpId +'] ' As EmpLoyeeName", "tblHR_OfficeStaff", "CompId='" + CompId + "'AND FinYearId<='" + FinYearId + "' AND EmpId='" + DSCustWo.Tables[0].Rows[i]["EmpId"] + "'");

                SqlCommand cmdEmp = new SqlCommand(strEmp, con);
                SqlDataAdapter daEmp = new SqlDataAdapter(cmdEmp);
                DataSet DSEmp = new DataSet();
                daEmp.Fill(DSEmp);
                if (DSEmp.Tables[0].Rows.Count > 0)
                {
                    dr[1] = DSEmp.Tables[0].Rows[0]["EmployeeName"].ToString();

                }

                dr[2] = Convert.ToDouble(decimal.Parse(DSCustWo.Tables[0].Rows[i]["Amount"].ToString()).ToString("N3"));
                dr[3] = DSCustWo.Tables[0].Rows[i]["Remarks"].ToString();
                dt.Rows.Add(dr);
                dt.AcceptChanges();
            }
            GridView1.DataSource = dt;
            GridView1.DataBind();
            con.Close();
        }

        catch (Exception ex)
        { }
    }

    protected void GridView1_RowCommand(object sender, GridViewCommandEventArgs e)
    {
        try
        {
            if (e.CommandName == "Add")
            {
                string strEmpName = fun.getCode(((TextBox)GridView1.FooterRow.FindControl("TextEmpName")).Text);
                double strAmount = 0;
                if (((TextBox)GridView1.FooterRow.FindControl("txtAmt")).Text != "")
                {
                    strAmount = Convert.ToDouble(((TextBox)GridView1.FooterRow.FindControl("txtAmt")).Text);
                }
                string strRemark = ((TextBox)GridView1.FooterRow.FindControl("txtRemark")).Text;

                string chkDuplicate = fun.select("EmpId", "tblACC_TourAdvance_Temp", "EmpId='" + strEmpName + "'");
                SqlCommand chkcmd = new SqlCommand(chkDuplicate, con);
                SqlDataAdapter chkDA = new SqlDataAdapter(chkcmd);
                DataSet ChkDS = new DataSet();
                chkDA.Fill(ChkDS);               
                if (ChkDS.Tables[0].Rows.Count == 0)
                {

                    if (fun.NumberValidationQty(strAmount.ToString()) == true)
                    {
                        if (strEmpName != "")
                        {
                            if (strAmount != 0)
                            {
                                string cmdstr = fun.insert("tblACC_TourAdvance_Temp", "SessionId,CompId,FinYearId,EmpId,Amount,Remarks", "'" + sId + "','" + CompId + "','" + FinYearId + "','" + strEmpName + "','" + Convert.ToDouble(decimal.Parse(strAmount.ToString()).ToString("N3")) + "','" + strRemark + "'");
                                SqlCommand cmd = new SqlCommand(cmdstr, con);

                                con.Open();
                                cmd.ExecuteNonQuery();
                                con.Close();
                                this.FillGridAdvanceTo();
                            }
                            else
                            {
                                string myStringVariable = string.Empty;
                                myStringVariable = "Insert Valid Amount.";
                                ClientScript.RegisterStartupScript(this.GetType(), "myalert", "alert('" + myStringVariable + "');", true);
                            }
                        }
                        else
                        {
                            string myStringVariable = string.Empty;
                            myStringVariable = "Invalid Employee Name.";
                            ClientScript.RegisterStartupScript(this.GetType(), "myalert", "alert('" + myStringVariable + "');", true);
                        }
                    }
                }
                else
                {
                    string myStringVariable = string.Empty;
                    string myStringVariable2 = "Employee is already exist";
                    ClientScript.RegisterStartupScript(this.GetType(), "myalert", "alert('" + myStringVariable2 + "');", true);
                }
                TabContainer1.ActiveTabIndex = 1;
            }

            if (e.CommandName == "Add1")
            {

                string strEmpName = fun.getCode(((TextBox)GridView1.Controls[0].Controls[0].FindControl("TxtEmp")).Text);
                double strAmount = 0;
                if (((TextBox)GridView1.Controls[0].Controls[0].FindControl("TxtAmt2")).Text != "")
                {
                    strAmount = Convert.ToDouble(((TextBox)GridView1.Controls[0].Controls[0].FindControl("TxtAmt2")).Text);
                }

                string strRemark = ((TextBox)GridView1.Controls[0].Controls[0].FindControl("TxtRemarks2")).Text;

                if (fun.NumberValidationQty(strAmount.ToString()) == true)
                {
                    if (strEmpName != "")
                    {
                        if (strAmount != 0)
                        {
                            string cmdstr = fun.insert("tblACC_TourAdvance_Temp", "SessionId,CompId,FinYearId,EmpId,Amount,Remarks", "'" + sId + "','" + CompId + "','" + FinYearId + "','" + strEmpName + "','" + Convert.ToDouble(decimal.Parse(strAmount.ToString()).ToString("N3")) + "','" + strRemark + "'");
                            SqlCommand cmd = new SqlCommand(cmdstr, con);
                            con.Open();
                            cmd.ExecuteNonQuery();
                            con.Close();
                            this.FillGridAdvanceTo();
                        }
                        else
                        {
                            string myStringVariable = string.Empty;
                            myStringVariable = "Insert Valid Amount.";
                            ClientScript.RegisterStartupScript(this.GetType(), "myalert", "alert('" + myStringVariable + "');", true);
                        }
                    }
                    else
                    {
                        string myStringVariable = string.Empty;
                        myStringVariable = "Invalid Employee Name.";
                        ClientScript.RegisterStartupScript(this.GetType(), "myalert", "alert('" + myStringVariable + "');", true);
                    }
                }
                TabContainer1.ActiveTabIndex = 1;
            }
        }

        catch (Exception er) { }
    }

    protected void GridView1_RowDeleting(object sender, GridViewDeleteEventArgs e)
    {
        try
        {
            int id = Convert.ToInt32(GridView1.DataKeys[e.RowIndex].Value);
            SqlCommand cmd = new SqlCommand("DELETE FROM tblACC_TourAdvance_Temp WHERE Id=" + id + " And CompId='" + CompId + "'", con);
            con.Open();
            cmd.ExecuteNonQuery();
            con.Close();
            this.FillGridAdvanceTo();
            TabContainer1.ActiveTabIndex = 1;
        }
        catch (Exception er) { }
    }

    protected void GridView1_RowUpdating(object sender, GridViewUpdateEventArgs e)
    {
        try
        {

            int index1 = GridView1.EditIndex;
            GridViewRow row = GridView1.Rows[index1];
            int id1 = Convert.ToInt32(GridView1.DataKeys[e.RowIndex].Value);

            string EmpName = fun.getCode(((TextBox)row.FindControl("txtEmpName1")).Text);
            double Amount = 0;
            if (((TextBox)row.FindControl("txtAmt1")).Text != "")
            {
                Amount = Convert.ToDouble(decimal.Parse(((TextBox)row.FindControl("txtAmt1")).Text).ToString("N3"));
            }
            string Remarks = ((TextBox)row.FindControl("txtRemark1")).Text;

            string chkDuplicate = fun.select("EmpId", "tblACC_TourAdvance_Temp", "EmpId='" + EmpName + "'");
            SqlCommand chkcmd = new SqlCommand(chkDuplicate, con);
            SqlDataAdapter chkDA = new SqlDataAdapter(chkcmd);
            DataSet ChkDS = new DataSet();
            chkDA.Fill(ChkDS);
            if (ChkDS.Tables[0].Rows.Count == 0)
            {

                if (fun.NumberValidationQty(Amount.ToString()) == true)
                {
                    if (EmpName != "")
                    {
                        if (Amount > 0)
                        {
                            string sql1 = fun.update("tblACC_TourAdvance_Temp", "SessionId='" + sId + "',EmpId='" + EmpName + "',Amount='" + Amount + "',Remarks='" + Remarks + "'", "Id='" + id1 + "'");
                            SqlCommand cmd1 = new SqlCommand(sql1, con);
                            con.Open();
                            cmd1.ExecuteNonQuery();
                            con.Close();
                            GridView1.EditIndex = -1;
                            this.FillGridAdvanceTo();
                        }
                        else
                        {
                            string myStringVariable = string.Empty;
                            myStringVariable = "Insert Valid Amount.";
                            ClientScript.RegisterStartupScript(this.GetType(), "myalert", "alert('" + myStringVariable + "');", true);
                        }
                    }
                    else
                    {
                        string myStringVariable = string.Empty;
                        myStringVariable = "Invalid Employee Name.";
                        ClientScript.RegisterStartupScript(this.GetType(), "myalert", "alert('" + myStringVariable + "');", true);
                    }
                }
            }
            else
            {
                string myStringVariable = string.Empty;
                string myStringVariable2 = "Employee is already exist";
                ClientScript.RegisterStartupScript(this.GetType(), "myalert", "alert('" + myStringVariable2 + "');", true);
            }
            TabContainer1.ActiveTabIndex = 1;
        }
        catch (Exception ex) { }

    }

    protected void GridView1_RowEditing(object sender, GridViewEditEventArgs e)
    {
        try
        {
            GridView1.EditIndex = e.NewEditIndex;
            this.FillGridAdvanceTo();
            TabContainer1.ActiveTabIndex = 1;
        }
        catch (Exception ex)
        { }
    }

    protected void GridView1_RowCancelingEdit(object sender, GridViewCancelEditEventArgs e)
    {
        GridView1.EditIndex = -1;
        this.FillGridAdvanceTo();
    }

    protected void GridView1_PageIndexChanging(object sender, GridViewPageEventArgs e)
    {
        GridView1.PageIndex = e.NewPageIndex;
        GridView1.EditIndex = -1;
        this.FillGridAdvanceTo();
    }

    protected void RadioButtonList1_SelectedIndexChanged(object sender, EventArgs e)
    {
        if (RadioButtonList1.SelectedValue.ToString() == "0")
        {
            TextEmpName.Enabled = false;
            TextEmpName.Text = string.Empty;
        }
        if (RadioButtonList1.SelectedValue.ToString() == "1")
        {
            TextEmpName.Enabled = true;
        }
    }

    protected void btnSubmit_Click(object sender, EventArgs e)
    {
        try
        {

            connStr = fun.Connection();
            con = new SqlConnection(connStr);
            string CDate = fun.getCurrDate();
            string CTime = fun.getCurrTime();

            string WOno = "NA";
            string BGGroup = "1";
            int u = 0;

            if (RadioButtonWONoGroup.SelectedValue.ToString() == "0")
            {
                if (txtWONo.Text != "")
                {

                    if (fun.CheckValidWONo(txtWONo.Text, CompId, FinYearId) == true)
                    {
                        WOno = txtWONo.Text;
                    }
                    else
                    {
                        u++;
                    }
                }
                else
                {
                    u++;
                }
            }
            else
            {
                BGGroup = drpGroup.SelectedValue.ToString();
            }

            string EmpName = string.Empty;
            int EType = 0;
            if (RadioButtonList1.SelectedValue.ToString() == "0")
            {
                EmpName = sId;
                EType = 0;
                ReqTextEmpName.Visible = false;
            }
            if (RadioButtonList1.SelectedValue.ToString() == "1")
            {
                string EmpCode = fun.getCode(TextEmpName.Text);
                int EmpId = fun.chkEmpCode(EmpCode, CompId);
                if (EmpId == 1 && TextEmpName.Text != string.Empty)
                {
                    EmpName = EmpCode;
                    EType = 1;
                }
                else
                {
                    EmpName = string.Empty;
                }

            }

            string FromTime = (TimeSelector1).Hour.ToString("D2") + ":" + (TimeSelector1).Minute.ToString("D2") + ":" + (TimeSelector1).Second.ToString("D2") + ":" + (TimeSelector1).AmPm.ToString();
            string ToTime = (TimeSelector2).Hour.ToString("D2") + ":" + (TimeSelector2).Minute.ToString("D2") + ":" + (TimeSelector2).Second.ToString("D2") + ":" + (TimeSelector2).AmPm.ToString();


            string cmdStr = fun.select("TINo", "tblACC_TourIntimation_Master", "CompId='" + CompId + "' AND FinYearId='" + FinYearId + "' order by Id desc");
            SqlCommand cmd1 = new SqlCommand(cmdStr, con);
            DataSet DS = new DataSet();
            SqlDataAdapter da = new SqlDataAdapter(cmd1);
            da.Fill(DS, "tblACC_TourIntimation_Master");
            string TINoStr;
            if (DS.Tables[0].Rows.Count > 0)
            {
                int TINo = Convert.ToInt32(DS.Tables[0].Rows[0][0].ToString()) + 1;
                TINoStr = TINo.ToString("D4");
            }
            else
            {
                TINoStr = "0001";
            }

            if (u == 0)
            {
                if (EmpName != string.Empty)
                {
                    if (textStartDate.Text != "" && fun.DateValidation(textStartDate.Text) == true && textEndDate.Text != "" && fun.DateValidation(textEndDate.Text) == true && txtNoOfDays.Text != "" && fun.NumberValidationQty(txtNoOfDays.Text) == true && txtProjectName.Text != "" && txtNoOfDays.Text != "" && txtNameAndAddress.Text != "" && txtContactPerson.Text != "" && txtContactNo.Text != "" && ddlPlaceOfTourCountry.SelectedValue != "Select" && ddlPlaceOfTourState.SelectedValue != "Select" && ddlPlaceOfTourCity.SelectedValue != "Select")
                    {
                        string StrSubmit = fun.insert("tblACC_TourIntimation_Master", "SysDate , SysTime , SessionId, CompId , FinYearId ,TINo ,EmpId, Type, WONo, BGGroupId, ProjectName,  TourStartDate, TourStartTime, TourEndDate , TourEndTime, NoOfDays, NameAddressSerProvider, ContactPerson , ContactNo, Email,PlaceOfTourCountry,PlaceOfTourState,PlaceOfTourCity", "'" + CDate + "','" + CTime + "','" + sId + "','" + CompId + "','" + FinYearId + "','" + TINoStr + "','" + EmpName + "','" + EType + "','" + WOno.ToUpper() + "','" + Convert.ToInt32(BGGroup) + "','" + txtProjectName.Text + "','" + fun.FromDate(textStartDate.Text) + "','" + FromTime + "','" + fun.FromDate(textEndDate.Text) + "','" + ToTime + "','" + Convert.ToInt32(txtNoOfDays.Text) + "','" + txtNameAndAddress.Text + "','" + txtContactPerson.Text + "','" + txtContactNo.Text + "','" + txtEmail.Text + "','" + ddlPlaceOfTourCountry.SelectedValue + "','" + ddlPlaceOfTourState.SelectedValue + "','" + ddlPlaceOfTourCity.SelectedValue + "'");
                        SqlCommand cmdSubmit = new SqlCommand(StrSubmit, con);
                        con.Open();
                        cmdSubmit.ExecuteNonQuery();
                        con.Close();

                        string sqlId = fun.select("Id", "tblACC_TourIntimation_Master", "CompId='" + CompId + "' Order by Id desc");
                        SqlCommand cmdId = new SqlCommand(sqlId, con);
                        SqlDataAdapter daId = new SqlDataAdapter(cmdId);
                        DataSet DSId = new DataSet();
                        daId.Fill(DSId, "tblACC_TourIntimation_Master");
                        int MId = 0;
                        if (DSId.Tables[0].Rows.Count > 0)
                        {
                            MId = Convert.ToInt32(DSId.Tables[0].Rows[0]["Id"].ToString());
                        }

                        // For Advance Details
                        foreach (GridViewRow grv in GridView2.Rows)
                        {
                            int Exid = Convert.ToInt32(((Label)grv.FindControl("lblAdId")).Text);
                            string ExRemarks = ((TextBox)grv.FindControl("txtRemarks")).Text;
                            if (((TextBox)grv.FindControl("txtAmount")).Text != "" && Convert.ToDouble(decimal.Parse(((TextBox)grv.FindControl("txtAmount")).Text).ToString("N2")) >= 0)
                            {
                                double ExAmount = Convert.ToDouble(decimal.Parse(((TextBox)grv.FindControl("txtAmount")).Text).ToString("N2"));
                                string StrAmt = fun.insert("tblACC_TourAdvance_Details", "MId,ExpencessId,Amount,Remarks", "'" + MId + "','" + Exid + "','" + ExAmount + "','" + ExRemarks + "'");
                                SqlCommand cmdAmt = new SqlCommand(StrAmt, con);
                                con.Open();
                                cmdAmt.ExecuteNonQuery();
                                con.Close();
                            }
                        }
                        foreach (GridViewRow grv1 in GridView2.Rows)
                        {
                            ((TextBox)grv1.FindControl("txtRemarks")).Text = "";
                            ((TextBox)grv1.FindControl("txtAmount")).Text = "";
                        }

                        // For Advance Trans. To

                        string sql5 = fun.select("*", "tblACC_TourAdvance_Temp", "CompId='" + CompId + "' AND SessionId='" + sId + "' AND FinYearId='" + FinYearId + "'");
                        SqlCommand cmd5 = new SqlCommand(sql5, con);
                        SqlDataAdapter da5 = new SqlDataAdapter(cmd5);
                        DataSet DS5 = new DataSet();
                        da5.Fill(DS5);
                        if (DS5.Tables[0].Rows.Count > 0)
                        {
                            for (int p = 0; p < DS5.Tables[0].Rows.Count; p++)
                            {
                                string StrADetails = fun.insert("tblACC_TourAdvance", "MId,EmpId,Amount,Remarks", "'" + MId + "','" + DS5.Tables[0].Rows[p]["EmpId"].ToString() + "','" + Convert.ToDouble(decimal.Parse(DS5.Tables[0].Rows[p]["Amount"].ToString()).ToString("N2")) + "','" + DS5.Tables[0].Rows[p]["Remarks"].ToString() + "'");
                                SqlCommand cmd15 = new SqlCommand(StrADetails, con);
                                con.Open();
                                cmd15.ExecuteNonQuery();
                                con.Close();
                            }
                            string delsql = fun.delete("tblACC_TourAdvance_Temp", "CompId='" + CompId + "' AND SessionId='" + sId + "'AND FinYearId='" + FinYearId + "'");
                            SqlCommand cmd12 = new SqlCommand(delsql, con);
                            con.Open();
                            cmd12.ExecuteNonQuery();
                            con.Close();
                            this.FillGridAdvanceTo();
                        }

                        this.WONoGroup();
                        Page.Response.Redirect(Page.Request.Url.ToString(), true);

                    }
                    else
                    {
                        string mystring = string.Empty;
                        mystring = "Invalid data entry.";
                        ClientScript.RegisterStartupScript(this.GetType(), "myalert", "alert('" + mystring + "');", true);
                    }
                }
                else
                {
                    string mystring = string.Empty;
                    mystring = "Invalid Employee Name.";
                    ClientScript.RegisterStartupScript(this.GetType(), "myalert", "alert('" + mystring + "');", true);
                }
            }
            else
            {
                string mystring = string.Empty;
                mystring = "Entered WO No is not valid !";
                ClientScript.RegisterStartupScript(this.GetType(), "myalert", "alert('" + mystring + "');", true);
            }
        }
        catch (Exception ex) { }

    }

    protected void ddlPlaceOfTourCountry_SelectedIndexChanged(object sender, EventArgs e)
    {
        fun.dropdownState(ddlPlaceOfTourState, ddlPlaceOfTourCity, ddlPlaceOfTourCountry);
    }

    protected void ddlPlaceOfTourState_SelectedIndexChanged(object sender, EventArgs e)
    {
        fun.dropdownCity(ddlPlaceOfTourCity, ddlPlaceOfTourState);
    }

//[System.Web.Services.WebMethodAttribute(), System.Web.Script.Services.ScriptMethodAttribute()]
//    public static string[] sql(string prefixText, int count, string contextKey)
//    {
//        clsFunctions fun = new clsFunctions();
//        string connStr = fun.Connection();
//        DataSet ds = new DataSet();
//        SqlConnection con = new SqlConnection(connStr);
//        int CompId = Convert.ToInt32(HttpContext.Current.Session["compid"]);
//        con.Open();
//        string cmdStr = fun.select("Id,WONo,TaskProjectTitle", "SD_Cust_WorkOrder_Master", "CompId='" + CompId + "'");
//        SqlDataAdapter da = new SqlDataAdapter(cmdStr, con);
//        da.Fill(ds, "SD_Cust_WorkOrder_Master");
//        con.Close();
//        string[] main = new string[0];
//        for (int i = 0; i < ds.Tables[0].Rows.Count; i++)
//        {
//            if (ds.Tables[0].Rows[i].ItemArray[1].ToString().ToLower().StartsWith(prefixText.ToLower()))
//            {
//                Array.Resize(ref main, main.Length + 1);
//                main[main.Length - 1] = " [ "+ ds.Tables[0].Rows[i].ItemArray[1].ToString() + " ] -" + ds.Tables[0].Rows[i].ItemArray[2].ToString();
//                //if (main.Length == 20)
//                //    break;
//            }
//        }
//        Array.Sort(main);
//        return main;
//    }

}
