=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/Inventory/Transactions/CustomerChallan_Delete_Details.aspx.txt ===

﻿<%@ Page Language="C#" MasterPageFile="~/MasterPage.master" AutoEventWireup="true" CodeFile="CustomerChallan_Delete_Details.aspx.cs" Inherits="Module_Inventory_Transactions_CustomerChallan_Delete_Details" Title="ERP" Theme="Default" %>

<%@ Register assembly="AjaxControlToolkit" namespace="AjaxControlToolkit" tagprefix="cc1" %>
<asp:Content ID="Content1" ContentPlaceHolderID="head" Runat="Server">
    <link href="../../../Css/yui-datatable.css" rel="stylesheet" type="text/css" />
    <link href="../../../Css/StyleSheet.css" rel="stylesheet" type="text/css" />
    <script src="../../../Javascript/PopUpMsg.js" type="text/javascript"></script>
    <script src="../../../Javascript/loadingNotifier.js" type="text/javascript"></script>
    </asp:Content>
<asp:Content ID="Content2" ContentPlaceHolderID="cp3" Runat="Server">
</asp:Content>
<asp:Content ID="Content3" ContentPlaceHolderID="cp1" Runat="Server">
</asp:Content>
<asp:Content ID="Content4" ContentPlaceHolderID="cp2" Runat="Server">
</asp:Content>
<asp:Content ID="Content5" ContentPlaceHolderID="MainContent" Runat="Server">
</asp:Content>
<asp:Content ID="Content6" ContentPlaceHolderID="ContentPlaceHolder2" Runat="Server">
</asp:Content>
<asp:Content ID="Content7" ContentPlaceHolderID="ContentPlaceHolder3" Runat="Server">

    <script type="text/javascript">
        function OnChanged(sender, args)
        {
            ServerUtilities.SetTabIndex(sender.get_activeTabIndex());
        }
    </script>
    
      <cc1:TabContainer ID="TabContainer1" runat="server" ActiveTabIndex="0" 
                    AutoPostBack="true"
                    Width="100%" 
        onactivetabchanged="TabContainer1_ActiveTabChanged">
                    <cc1:TabPanel runat="server" HeaderText="Customer Challan" ID="Add">                    
<ContentTemplate>
                        
                    <asp:Panel ID="Panel2" ScrollBars="Auto" runat="server">                    
                        
                         <table align="left" cellpadding="0" cellspacing="0" width="100%">
        <tr>
            <td height="5px" ></td>
        </tr>
        <tr>
            <td align="left"  valign="top">
               
                            <table align="left" cellpadding="0" cellspacing="0" width="100%" >
                               
                                <tr>
                                    <td valign="top" align="center"  >
                                        <asp:Panel ID="Panel1" ScrollBars="Auto" Height="430px" runat="server"> 
                                      
                                            <asp:GridView ID="GridView2" runat="server"
                                                AutoGenerateColumns="False" CssClass="yui-datatable-theme" 
                                                OnPageIndexChanging="GridView2_PageIndexChanging" style="position:static" 
                                                Width="100%" onrowcommand="GridView2_RowCommand"  DataKeyNames="Id"
                                              >
                                                
                                                <Columns>
                                                    <asp:TemplateField HeaderText="SN">
                                                        <ItemTemplate>
                                                            <%# Container.DataItemIndex+1 %>
                                                        </ItemTemplate>
                                                        <HeaderStyle Font-Size="10pt" />
                                                        <ItemStyle HorizontalAlign="Right" VerticalAlign="Top" Width="2%" />
                                                    </asp:TemplateField>
                                                    <asp:TemplateField>
                                                        <ItemTemplate>
                                                 <asp:CheckBox ID="CheckBox1" runat="server" AutoPostBack="true" oncheckedchanged="CheckBox1_CheckedChanged"
                                                 />
                                                
                                                        </ItemTemplate>                                                         
                                                        <HeaderStyle Font-Size="10pt" />
                                                        <ItemStyle HorizontalAlign="Center" VerticalAlign="Top" Width="2%" />
                                                    </asp:TemplateField>
                                                    
                                                    <asp:TemplateField HeaderText="Id" Visible="False" >
                                                        <ItemTemplate>
                                                           <asp:Label ID="lblId" runat="server" Text='<%# Eval("Id") %>'></asp:Label>
                                                    </ItemTemplate>
                                                        <ItemStyle VerticalAlign="Top" HorizontalAlign="Center"  />
                                                    </asp:TemplateField>
                                                    
                                                   <asp:TemplateField HeaderText="CC No">
                                                        <ItemTemplate>
                                                           <asp:Label ID="lblSCno" runat="server" Text='<%# Eval("CCNo") %>'></asp:Label>
                                                    </ItemTemplate>
                                                        <ItemStyle VerticalAlign="Top" HorizontalAlign="Center" Width="5%" />
                                                    </asp:TemplateField> 
                                                   
                                                   <asp:TemplateField HeaderText="WONo">
                                                        <ItemTemplate>
                                                           <asp:Label ID="lblWono" runat="server" Text='<%# Eval("WONo") %>'></asp:Label>
                                                    </ItemTemplate>
                                                        <ItemStyle VerticalAlign="Top" HorizontalAlign="Center" Width="6%" />
                                                    </asp:TemplateField> 
                                                   
                                                    
                                                    
                                                    
                                                    
                                                    <asp:TemplateField HeaderText="Date">
                                                        <ItemTemplate>
                                                           <asp:Label ID="lblCCDt" runat="server" Text='<%# Eval("CCDate") %>'></asp:Label>
                                                    </ItemTemplate>
                                                        <ItemStyle VerticalAlign="Top" HorizontalAlign="Center" Width="6%" />
                                                    </asp:TemplateField> 
                                                    
                                                    
                                                     <asp:TemplateField HeaderText="Item Code">
                                                        <ItemTemplate>
                                                            <asp:Label ID="lblItemcode" runat="server" Text='<%# Eval("ItemCode") %>'> </asp:Label>
                                                        </ItemTemplate>
                                                        <ItemStyle HorizontalAlign="Center" Width="8%" VerticalAlign="Top" />
                                                    </asp:TemplateField>
                                                    <asp:TemplateField HeaderText="Description">
                                                        <ItemTemplate>
                                                            <asp:Label ID="lbldesc" runat="server" Text='<%# Eval("ManfDesc") %>'> </asp:Label>
                                                        </ItemTemplate>
                                                        <ItemStyle HorizontalAlign="Left" Width="20%" VerticalAlign="Top" />
                                                    </asp:TemplateField>
                                                    <asp:TemplateField HeaderText="UOM">
                                                        <ItemTemplate>
                                                            <asp:Label ID="lbluom" runat="server" Text='<%# Eval("Symbol") %>'> </asp:Label>
                                                        </ItemTemplate>
                                                        <ItemStyle HorizontalAlign="Center" VerticalAlign="Top" Width="5%" />
                                                    </asp:TemplateField>
                                                    
                                                  
                                                     
                                                    
                                                    
                                                  
                                                   
                                                     <asp:TemplateField HeaderText=" Challan Qty">
                                                        <ItemTemplate>
                                                       <asp:Label ID="LblCHQty"    Text='<%# Eval("ChallanQty") %>' runat="server"></asp:Label>  
                                                        
                                                           
                                                          
                                                    </ItemTemplate>
                                                    
                                                 
                                                        <ItemStyle VerticalAlign="Top" HorizontalAlign="Right" Width="6%" />
                                                    </asp:TemplateField> 
                                                
                                                    
                                                </Columns>
                                                <EmptyDataTemplate>
                    <table width="100%" class="fontcss">
                    <tr>
                    <td align="center">
                    <asp:Label ID="Label1" runat="server"  Text="No data to display !" Font-Size="Larger" ForeColor="maroon">
                    </asp:Label>
                    
                   
                    </td>
                    </tr>
                    </table>
                    </EmptyDataTemplate>
                                                <FooterStyle Font-Bold="False" />
                                                <HeaderStyle Font-Size="9pt" />
                                                <PagerSettings PageButtonCount="40" />
                                            </asp:GridView>
                                        </asp:Panel>
                                        
                                    </td>
                                </tr>
                                
                                <tr>
                                    <td valign="top" align="center"  >
                                        <asp:Button ID="BtnAdd" ValidationGroup="A"  runat="server"  CssClass="redbox" 
                                       OnClientClick="return confirmationDelete();" Text="Delete" onclick="BtnAdd_Click" />
                                            
                                             &nbsp;&nbsp;&nbsp;&nbsp;
                                            
                                             <asp:Button ID="Btncancel"  runat="server"  CssClass="redbox" 
                                            Text="Cancel" onclick="Btncancel_Click"  />
                                        
                                    </td>
                                </tr>
                                
                            </table>
                      
                   </td>
        </tr>
        
    </table> </asp:Panel></ContentTemplate></cc1:TabPanel>
    
       <cc1:TabPanel ID="View" runat="server" HeaderText="Clear Challan">
                    <ContentTemplate>
                     <asp:Panel ID="Panel3" ScrollBars="Auto" runat="server">                    
                        
                         <table align="left" width="100%" cellpadding="0" cellspacing="0" >
        <tr>
            <td height="5px" ></td>
        </tr>
        <tr>
            <td align="left"  valign="top">
               
                            <table align="left" cellpadding="0" width="100%" cellspacing="0" >
                               
                                <tr>
                                    <td valign="top" align="center"  >
                                        <asp:Panel ID="Panel4" ScrollBars="Auto" Height="395px" runat="server">
                                       
                                      
                                            <asp:GridView ID="GridView1" runat="server"
                                                AutoGenerateColumns="False" CssClass="yui-datatable-theme" DataKeyNames="Id"
                                                OnPageIndexChanging="GridView1_PageIndexChanging" style="position:static" 
                                                Width="100%" onrowcommand="GridView1_RowCommand">
                                                
                                                <PagerSettings PageButtonCount="40" />
                                                
                                                <Columns>
                                                    <asp:TemplateField HeaderText="SN">
                                                        <ItemTemplate>
                                                            <%# Container.DataItemIndex+1 %>
                                                        </ItemTemplate>
                                                        <HeaderStyle Font-Size="10pt" />
                                                        <ItemStyle HorizontalAlign="Right" VerticalAlign="Top" Width="2%" />
                                                    </asp:TemplateField>
                                                    <asp:TemplateField>
                                                        <ItemTemplate>
                                                 <asp:CheckBox ID="CheckBox2" runat="server" AutoPostBack="true" oncheckedchanged="CheckBox2_CheckedChanged"
                                                 />
                                                
                                                        </ItemTemplate>                                                         
                                                        <HeaderStyle Font-Size="10pt" />
                                                        <ItemStyle HorizontalAlign="Center" VerticalAlign="Top" Width="2%" />
                                                    </asp:TemplateField>
                                                    
                                                        
                                                     <asp:TemplateField HeaderText="WONo">
                                                        <ItemTemplate>
                                                           <asp:Label ID="lblWono1" runat="server" Text='<%# Eval("WONo") %>'></asp:Label>
                                                    </ItemTemplate>
                                                        <ItemStyle VerticalAlign="Top" HorizontalAlign="Center" Width="6%" />
                                                    </asp:TemplateField> 
                                                    
                                                    <asp:TemplateField HeaderText="CC No">
                                                        <ItemTemplate>
                                                           <asp:Label ID="lblSCNo1" runat="server" Text='<%# Eval("CCNo") %>'></asp:Label>
                                                    </ItemTemplate>
                                                        <ItemStyle VerticalAlign="Top" HorizontalAlign="Center" Width="6%" />
                                                    </asp:TemplateField> 
                                                     <asp:TemplateField HeaderText="Date">
                                                        <ItemTemplate>
                                                           <asp:Label ID="lblprDt1" runat="server" Text='<%# Eval("PRDate") %>'></asp:Label>
                                                    </ItemTemplate>
                                                        <ItemStyle VerticalAlign="Top" HorizontalAlign="Center" Width="6%" />
                                                    </asp:TemplateField> 
                                                    
                                                    
                                                    <asp:TemplateField  Visible="False" HeaderText="Id">
                                                        <ItemTemplate>
                                                           <asp:Label ID="lblId1" runat="server" Text='<%# Eval("Id") %>'></asp:Label>
                                                    </ItemTemplate>
                                                        <ItemStyle VerticalAlign="Top" HorizontalAlign="Center" Width="6%" />
                                                    </asp:TemplateField> 
                                                    
                                                     <asp:TemplateField  Visible="False">
                                                        <ItemTemplate>
                                                           <asp:Label ID="lblDId1" runat="server" Text='<%# Eval("DId") %>'> </asp:Label>
                                                    </ItemTemplate>
                                                        <ItemStyle VerticalAlign="Top" HorizontalAlign="Center" Width="6%" />
                                                    </asp:TemplateField> 
                                                    
                                                                                                  
                                                   
                                                   
                                                  
                                                     <asp:TemplateField HeaderText="Item Code">
                                                        <ItemTemplate>
                                                            <asp:Label ID="lblit" runat="server" Text='<%# Eval("ItemCode") %>'> </asp:Label>
                                                        </ItemTemplate>
                                                        <ItemStyle HorizontalAlign="Center" Width="8%" VerticalAlign="Top" />
                                                    </asp:TemplateField>
                                                    <asp:TemplateField HeaderText="Description">
                                                        <ItemTemplate>
                                                            <asp:Label ID="lbldesc" runat="server" Text='<%# Eval("Descr") %>'> </asp:Label>
                                                        </ItemTemplate>
                                                        <ItemStyle HorizontalAlign="Left" Width="20%" VerticalAlign="Top" />
                                                    </asp:TemplateField>
                                                    <asp:TemplateField HeaderText="UOM">
                                                        <ItemTemplate>
                                                            <asp:Label ID="lbluom" runat="server" Text='<%# Eval("Symbol") %>'> </asp:Label>
                                                        </ItemTemplate>
                                                        <ItemStyle HorizontalAlign="Center" VerticalAlign="Top" Width="5%" />
                                                    </asp:TemplateField>
                                                    
                                                    <asp:TemplateField HeaderText="Challan Qty">
                                                        <ItemTemplate>
                                                           <asp:Label ID="lblprqty" runat="server" Text='<%# Eval("ChallanQty") %>'></asp:Label>
                                                    </ItemTemplate>
                                                        <ItemStyle VerticalAlign="Top" HorizontalAlign="Right" Width="6%" />
                                                    </asp:TemplateField> 
                                                    
                                                    <asp:TemplateField HeaderText="Cleared Qty"   Visible="False">
                                                        <ItemTemplate>
                                                           <asp:Label ID="lblqty"   runat="server" Text=""></asp:Label>
                                                    </ItemTemplate>
                                                        <ItemStyle VerticalAlign="Top" HorizontalAlign="Right" Width="6%" />
                                                    </asp:TemplateField> 
                                                   
                                                   
                                                     <asp:TemplateField HeaderText=" Clear Qty">
                                                        <ItemTemplate>
                                                        
                                                        <asp:Label ID="lblClearQty" runat="server"  Text='<%# Eval("ClearQty") %>'></asp:Label> 
                                                         
                                                          
                                                    </ItemTemplate>
                                                    
                                                        <ItemStyle VerticalAlign="Top" HorizontalAlign="Right" Width="10%" />
                                                    </asp:TemplateField> 
                                                
                                                    
                                                </Columns>
                                                <EmptyDataTemplate>
                    <table width="100%" class="fontcss">
                    <tr>
                    <td align="center">
                    <asp:Label ID="Label1" runat="server"  Text="No data to display !" Font-Size="Larger" ForeColor="maroon">
                    </asp:Label>
                    
                   
                    </td>
                    </tr>
                    </table>
                    </EmptyDataTemplate>
                                                <FooterStyle Font-Bold="False" />
                                                <HeaderStyle Font-Size="9pt" />
                                            </asp:GridView>
                                        </asp:Panel>
                                        
                                    </td>
                                </tr>
                                
                                <tr>
                                    <td valign="top" align="center"  >
                                        <asp:Button ID="BtnAdd1" ValidationGroup="B"  runat="server"  CssClass="redbox" 
                                OnClientClick="return confirmationDelete();"             Text="Delete" onclick="BtnAdd1_Click" />                                            
                                        
                                        &nbsp;<asp:Button ID="BtnCancel1"  runat="server"  CssClass="redbox" 
                                            Text="Cancel" onclick="BtnCancel1_Click"  /> 
                                        
                                    </td>
                                </tr>
                                
                            </table>
                      
                   </td>
        </tr>
        
    </table>
                        </asp:Panel>
                    </ContentTemplate>
                    </cc1:TabPanel>
    </cc1:TabContainer>
</asp:Content>
<asp:Content ID="Content8" ContentPlaceHolderID="ContentPlaceHolder4" Runat="Server">
</asp:Content>




=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/Inventory/Transactions/CustomerChallan_Delete_Details.aspx.cs ===

﻿using System;
using System.Collections;
using System.Configuration;
using System.Data;
using System.Linq;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Xml.Linq;
using System.Data.SqlClient;

public partial class Module_Inventory_Transactions_CustomerChallan_Delete_Details : System.Web.UI.Page
{
    clsFunctions fun = new clsFunctions();
    string sId = "";
    int CompId = 0;
    int fyid = 0;
    string supid = "";
    string str = "";
    SqlConnection con;
    string CDate = "";
    string CTime = "";
    int id = 0;
    protected void Page_Load(object sender, EventArgs e)
    {
        try
        {
            CompId = Convert.ToInt32(Session["compid"]);
            fyid = Convert.ToInt32(Session["finyear"]);
            sId = Session["username"].ToString();
            id = Convert.ToInt32(Request.QueryString["Id"]);
            str = fun.Connection();
            con = new SqlConnection(str);
          
            CDate = fun.getCurrDate();
            CTime = fun.getCurrTime();
            if (!IsPostBack)
            {
                this.fillGrid();
                this.LoadGrid();
            }
        }
          catch (Exception es)
        {

        }
    }

  
    public void fillGrid()
    {
       try
        {
            SqlDataAdapter da = new SqlDataAdapter("GetCustomerChallan_Details", con);
            da.SelectCommand.CommandType = CommandType.StoredProcedure;
            da.SelectCommand.Parameters.Add(new SqlParameter("@Id", SqlDbType.VarChar));
            da.SelectCommand.Parameters.Add(new SqlParameter("@CompId", SqlDbType.VarChar));
            da.SelectCommand.Parameters["@Id"].Value = id;
            da.SelectCommand.Parameters["@CompId"].Value = CompId;
            DataSet DSitem = new DataSet();
            da.Fill(DSitem);
            GridView2.DataSource = DSitem;
            GridView2.DataBind();
         
        }
         catch (Exception ex)
        {
        }
    }
    public void LoadGrid()
    {
         try
        {
            SqlDataAdapter da = new SqlDataAdapter("GetCust_Challan_Clear_Edit", con);
            da.SelectCommand.CommandType = CommandType.StoredProcedure;
            da.SelectCommand.Parameters.Add(new SqlParameter("@Id", SqlDbType.VarChar));
            da.SelectCommand.Parameters.Add(new SqlParameter("@CompId", SqlDbType.VarChar));
            da.SelectCommand.Parameters.Add(new SqlParameter("@FinYearId", SqlDbType.VarChar));
            da.SelectCommand.Parameters["@Id"].Value = id;
            da.SelectCommand.Parameters["@CompId"].Value = CompId;
            da.SelectCommand.Parameters["@FinYearId"].Value = fyid;
            DataSet DSitem = new DataSet();
            da.Fill(DSitem);
            GridView1.DataSource = DSitem;
            GridView1.DataBind();
         
        }
        catch (Exception ex)
        {
        }
    }
    protected void GridView2_PageIndexChanging(object sender, GridViewPageEventArgs e)
    {

    }
    protected void GridView2_RowCommand(object sender, GridViewCommandEventArgs e)
    {

    }
    protected void CheckBox1_CheckedChanged(object sender, EventArgs e)
    {
      
    }
   






    protected void BtnAdd_Click(object sender, EventArgs e)
    {
        try
        {
            int k = 0;
            foreach (GridViewRow grv in GridView2.Rows)
            {
                if (((CheckBox)grv.FindControl("CheckBox1")).Checked == true)
                {
                    int Id = Convert.ToInt32(((Label)grv.FindControl("lblId")).Text);
                    SqlCommand exeme2 = new SqlCommand(fun.delete("tblInv_Customer_Challan_Details", "Id='" + Id + "'"), con);
                    con.Open();
                    exeme2.ExecuteNonQuery();
                    con.Close();
                    SqlCommand exeme3 = new SqlCommand(fun.delete("tblInv_Customer_Challan_Clear", "DId='" + Id + "'"), con);
                    con.Open();
                    exeme3.ExecuteNonQuery();
                    con.Close();

                    string StrSql = fun.select("tblInv_Customer_Challan_Details.Id", "tblInv_Customer_Challan_Details,tblInv_Customer_Challan_Master", "  tblInv_Customer_Challan_Master.Id= tblInv_Customer_Challan_Details.MId and tblInv_Customer_Challan_Master.FinYearId='" + fyid + "' AND tblInv_Customer_Challan_Master.CompId='" + CompId + "'  And tblInv_Customer_Challan_Details.MId='" + id + "' ");
                    SqlCommand cmd = new SqlCommand(StrSql, con);
                    SqlDataAdapter da = new SqlDataAdapter(cmd);
                    DataSet DS = new DataSet();
                    da.Fill(DS);
                    if (DS.Tables[0].Rows.Count == 0)
                    {
                        string delMastr = fun.delete("tblInv_Customer_Challan_Master", "CompId='" + CompId + "' and FinYearId='" + fyid + "' and Id='" + id + "' ");
                        con.Open();
                        SqlCommand cmdMstr = new SqlCommand(delMastr, con);
                        cmdMstr.ExecuteNonQuery();
                        con.Close();
                        Response.Redirect("CustomerChallan_Delete.aspx?ModId=9&SubModId=121");

                    }

                    k++;
                }

            }

            if (k > 0)
            {
                Page.Response.Redirect(Page.Request.Url.ToString(), true);
            }


        }
        catch (Exception ex) { }
    }
    protected void Btncancel_Click(object sender, EventArgs e)
    {
        Response.Redirect("~/Module/Inventory/Transactions/CustomerChallan_Delete.aspx?ModId=9&SubModId=121");
    }
    protected void TabContainer1_ActiveTabChanged(object sender, EventArgs e)
    {
    }
    ///// for Cleared Grid
    protected void GridView1_PageIndexChanging(object sender, GridViewPageEventArgs e)
    {
    }
    protected void GridView1_RowCommand(object sender, GridViewCommandEventArgs e)
    {
    }
    protected void CheckBox2_CheckedChanged(object sender, EventArgs e)
    {
        
    }
    protected void BtnAdd1_Click(object sender, EventArgs e)
    {
        try
        {
            int k = 0;
            foreach (GridViewRow grv in GridView1.Rows)
            {
                if (((CheckBox)grv.FindControl("CheckBox2")).Checked == true)
                {
                    int Id = Convert.ToInt32(((Label)grv.FindControl("lblId1")).Text);
                    SqlCommand exeme3 = new SqlCommand(fun.delete("tblInv_Customer_Challan_Clear", "Id='" + Id + "'"), con);
                    con.Open();
                    exeme3.ExecuteNonQuery();
                    con.Close();
                    k++;
                }

            }

            if (k > 0)
            {
                this.LoadGrid();
            }


        }
        catch (Exception ex) { }
    }
    protected void BtnCancel1_Click(object sender, EventArgs e)
    {
        Response.Redirect("~/Module/Inventory/Transactions/CustomerChallan_Delete.aspx?ModId=9&SubModId=121");
    }
}
