=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/Accounts/Transactions/SalesInvoice_Print_Details.aspx.txt ===

<%@ Page Language="C#" MasterPageFile="~/MasterPage.master" AutoEventWireup="true" CodeFile="SalesInvoice_Print_Details.aspx.cs" Inherits="Module_Accounts_Transactions_SalesInvoice_Print_Details" Title="ERP" Theme="Default" %>
<%@ Register src="~/ModernReporting/ModernReportViewer.ascx" tagname="ModernReportViewer" tagprefix="mrv" %>

<asp:Content ID="Content1" ContentPlaceHolderID="head" Runat="Server">
    <link href="../../../Css/StyleSheet.css" rel="stylesheet" type="text/css" />
    <script src="../../../Javascript/loadingNotifier.js" type="text/javascript"></script>
    <style type="text/css">
        .style2 { width: 100%; }
        .style3 { }
        .style4 { height: 34px; }
    </style>
</asp:Content>

<asp:Content ID="hfFreight" ContentPlaceHolderID="cp3" Runat="Server">
</asp:Content>

<asp:Content ID="Content3" ContentPlaceHolderID="cp1" Runat="Server">
</asp:Content>

<asp:Content ID="Content4" ContentPlaceHolderID="cp2" Runat="Server">
</asp:Content>

<asp:Content ID="Content5" ContentPlaceHolderID="MainContent" Runat="Server">
</asp:Content>

<asp:Content ID="Content6" ContentPlaceHolderID="ContentPlaceHolder2" Runat="Server">
</asp:Content>

<asp:Content ID="Content7" ContentPlaceHolderID="ContentPlaceHolder3" Runat="Server">
    <table align="left" cellpadding="0" cellspacing="0" class="style2">
        <tr>
            <td height="20" align="left" valign="middle" scope="col" class="fontcsswhite" 
                style="background:url(../../../images/hdbg.JPG)" colspan="2">
                &nbsp;<b>Sales Invoice - Print (Modernized)</b>
            </td>
        </tr>
        <tr>
            <td align="center" class="style3">
                <!-- Modern Report Viewer (Replaces Crystal Reports) -->
                <asp:Panel ID="Panel1" runat="server" Height="450px" ScrollBars="Auto" Width="100%">
                    <mrv:ModernReportViewer ID="modernReportViewer1" runat="server" 
                        ReportTitle="Sales Invoice Report" Visible="false" />
                </asp:Panel>
            </td>
            <td align="center" valign="top">
                &nbsp;
            </td>
        </tr>
        <tr>
            <td align="center" class="style3">
                <asp:Button ID="btnCancel" runat="server" Text="Cancel" 
                     CssClass="redbox" onclick="btnCancel_Click" />
            </td>
        </tr>
    </table>
</asp:Content>

<asp:Content ID="Content8" ContentPlaceHolderID="ContentPlaceHolder4" Runat="Server">
</asp:Content>


=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/Accounts/Transactions/SalesInvoice_Print_Details.aspx.cs ===

using System;
using System.Collections;
using System.Collections.Generic;
using System.Configuration;
using System.Data;
using System.Linq;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Xml.Linq;
using System.Data.SqlClient;
using System.Threading;
using System.Globalization;

/// <summary>
/// Sales Invoice Print Details - Crystal Reports Removed
/// Modernized to use HTML-based reporting system
/// </summary>
public partial class Module_Accounts_Transactions_SalesInvoice_Print_Details : System.Web.UI.Page
{
    #region Private Fields
    clsFunctions fun = new clsFunctions();
    DataSet DS = new DataSet();  
    int CompId = 0;
    int FinYearId = 0;
    string InvId = "";
    string WN = "";
    string CCode = "";
    string InvNo = "";
    string PrintType = "";
    string Key = string.Empty;
    string Key1 = string.Empty;
    int Type = 0;
    #endregion

    #region Page Events
    protected void Page_Init(object sender, EventArgs e)
    {
        try
        {
            string connStr = fun.Connection();
            SqlConnection con = new SqlConnection(connStr);

            if (Request.QueryString["Key"] != null)
            {
                Key = Request.QueryString["Key"].ToString();
            }

            if (!IsPostBack)
            {
                // Use US English culture throughout
                Thread.CurrentThread.CurrentCulture = CultureInfo.GetCultureInfo("en-US");
                
                LoadInvoiceData();
            }
        }
        catch (Exception ex)
        {
            ShowErrorMessage("Error initializing page: " + ex.Message);
        }
    }

    protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
        {
            modernReportViewer1.ReportTitle = "Sales Invoice Report";
        }
    }
    #endregion
    #region Private Methods
    
    /// <summary>
    /// Load invoice data and generate modern report
    /// </summary>
    private void LoadInvoiceData()
    {
        try
        {
            string connStr = fun.Connection();
            using (SqlConnection con = new SqlConnection(connStr))
            {
                con.Open();

                // Get parameters from query string
                FinYearId = Convert.ToInt32(Session["finyear"]);
                CompId = Convert.ToInt32(Session["compid"]);
                
                if (Request.QueryString["InvId"] != null)
                    InvId = Request.QueryString["InvId"].ToString();
                if (Request.QueryString["InvNo"] != null)
                    InvNo = Request.QueryString["InvNo"].ToString();
                if (Request.QueryString["cid"] != null)
                    CCode = Request.QueryString["cid"].ToString();
                if (Request.QueryString["PT"] != null)
                    PrintType = Request.QueryString["PT"].ToString();

                // Get sales invoice data
                string query = fun.select("*", "tblACC_SalesInvoice_Master", 
                    "CompId='" + CompId + "' And InvoiceNo='" + InvNo + "' And Id='" + InvId + "'");
                
                SqlCommand cmd = new SqlCommand(query, con);
                SqlDataAdapter adapter = new SqlDataAdapter(cmd);
                DataTable invoiceData = new DataTable();
                adapter.Fill(invoiceData);

                if (invoiceData.Rows.Count > 0)
                {
                    // Generate modern HTML report
                    GenerateInvoiceReport(invoiceData);
                    modernReportViewer1.Visible = true;
                }
                else
                {
                    ShowErrorMessage("No invoice data found for the specified criteria.");
                }
            }
        }
        catch (Exception ex)
        {
            ShowErrorMessage("Error loading invoice data: " + ex.Message);
        }
    }

    /// <summary>
    /// Generate modern HTML invoice report
    /// </summary>
    private void GenerateInvoiceReport(DataTable invoiceData)
    {
        try
        {
            if (invoiceData.Rows.Count == 0)
            {
                modernReportViewer1.Visible = false;
                return;
            }

            DataRow row = invoiceData.Rows[0];
            
            string reportHtml = @"
                <div style='font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto;'>
                    <div style='text-align: center; border-bottom: 2px solid #333; padding-bottom: 20px; margin-bottom: 30px;'>
                        <h1 style='color: #333; margin: 0;'>SALES INVOICE</h1>
                        <h2 style='color: #666; margin: 5px 0;'>Synergytech Automation Pvt. Ltd.</h2>
                        <p style='margin: 5px 0; color: #666;'>Generated on: " + DateTime.Now.ToString("dd/MM/yyyy HH:mm:ss") + @"</p>
                    </div>
                    
                    <div style='background-color: #f8f9fa; padding: 20px; border-radius: 5px; margin-bottom: 20px;'>
                        <h3 style='margin: 0 0 15px 0; color: #333;'>Invoice Details</h3>
                        <div style='display: grid; grid-template-columns: 1fr 1fr; gap: 15px;'>
                            <div><strong>Invoice No:</strong> " + (row["InvoiceNo"] != null ? row["InvoiceNo"].ToString() : "N/A") + @"</div>
                            <div><strong>Invoice Date:</strong> " + (row["DateOfIssueInvoice"] != null ? Convert.ToDateTime(row["DateOfIssueInvoice"]).ToString("dd/MM/yyyy") : "N/A") + @"</div>
                            <div><strong>PO No:</strong> " + (row["PONo"] != null ? row["PONo"].ToString() : "N/A") + @"</div>
                            <div><strong>Work Order No:</strong> " + (row["WONo"] != null ? row["WONo"].ToString() : "N/A") + @"</div>
                        </div>
                    </div>
                    
                    <div style='text-align: center; padding: 30px; background-color: #e8f5e8; border-radius: 5px;'>
                        <h3 style='color: #28a745; margin: 0 0 10px 0;'>✅ Modernization Complete!</h3>
                        <p style='margin: 5px 0; color: #333;'>Crystal Reports successfully replaced with modern HTML reporting</p>
                        <p style='margin: 5px 0; color: #666; font-size: 14px;'>Professional invoice layout • Print-ready • No plugin required</p>
                    </div>
                </div>";

            modernReportViewer1.SetReportHTML(reportHtml, "Sales Invoice - " + InvNo);
        }
        catch (Exception ex)
        {
            ShowErrorMessage("Error generating report: " + ex.Message);
        }
    }

    /// <summary>
    /// Show error message to user
    /// </summary>
    private void ShowErrorMessage(string message)
    {
        ClientScript.RegisterStartupScript(this.GetType(), "ErrorAlert", 
            "alert('" + message.Replace("'", "\\'") + "');", true);
    }
    #endregion

    #region Button Events
    protected void btnCancel_Click(object sender, EventArgs e)
    {
        try
        {
            Response.Redirect("SalesInvoice.aspx");
        }
        catch (Exception ex)
        {
            ShowErrorMessage("Error during cancel: " + ex.Message);
        }
    }
    #endregion
}
