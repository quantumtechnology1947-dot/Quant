=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/Design/Transactions/TPL_Design_WO_TreeView.aspx.txt ===

﻿<%@ Page Language="C#" MasterPageFile="~/MasterPage.master" AutoEventWireup="true" CodeFile="TPL_Design_WO_TreeView.aspx.cs" Inherits="Module_Design_Transactions_ItemTree" Title="ERP"  Theme ="Default" %>
<%@ Register TagPrefix="telerik" Namespace="Telerik.Web.UI" Assembly="Telerik.Web.UI" %>
<asp:Content ID="Content1" ContentPlaceHolderID="head" Runat="Server">
    <link href="../../../Css/yui-datatable.css" rel="stylesheet" type="text/css" />
    <link href="../../../Css/StyleSheet.css" rel="stylesheet" type="text/css" />
    <script src="../../../Javascript/loadingNotifier.js" type="text/javascript"></script>
    <style type="text/css">
        .style3
        {
            height: 23px;
            }
        .style4
        {
            width: 100%;
        }
        .style5
        {
            width: 162px;
        }
        .style7
        {
            width: 44px;
        }
        .style8
        {
            width: 388px;
        }
        .style12
        {
        }
    </style>

</asp:Content>
<asp:Content ID="Content2" ContentPlaceHolderID="cp3" Runat="Server">
</asp:Content>
<asp:Content ID="Content3" ContentPlaceHolderID="cp1" Runat="Server">
</asp:Content>
<asp:Content ID="Content4" ContentPlaceHolderID="cp2" Runat="Server">
</asp:Content>
<asp:Content ID="Content5" ContentPlaceHolderID="MainContent" Runat="Server">
</asp:Content>
<asp:Content ID="Content6" ContentPlaceHolderID="ContentPlaceHolder2" Runat="Server">
</asp:Content>
<asp:Content ID="Content7" ContentPlaceHolderID="ContentPlaceHolder3" Runat="Server">

<table width="100%">
<tr>
<td align="left" class="style3">
    
    <table align="left" cellpadding="0" cellspacing="0" class="style4">
        <tr>
            <td class="style7" align="center">
                <b>TPL</b></td>
            <td class="style5">
                <b>Wo No:</b>
    <asp:Label ID="Label2" runat="server"></asp:Label>
            </td>
            <td class="style8">
                <asp:Label ID="lblmsg" runat="server" style="color: #CC0000"></asp:Label>
            </td>
            <td class="style12">
                <asp:CheckBox ID="CheckBox1" runat="server" AutoPostBack="True" 
        oncheckedchanged="CheckBox1_CheckedChanged" />
                <b>Expand Tree&nbsp;&nbsp; &nbsp;&nbsp; Root Assembly&nbsp; </b>
<%--                <asp:Button ID="btnAssembly" runat="server" Text=" Add "  
        Font-Bold="False" CssClass="redbox" 
        onclick="btnAssembly_Click" />
            &nbsp;--%>
            
            <asp:Button ID="btnCopy" runat="server" CssClass="redbox" 
                    onclick="btnCopy_Click" Text="Copy From" />
&nbsp;<asp:Button ID="Button1" runat="server" CssClass="redbox" Font-Bold="False" 
                    onclick="Button1_Click" Text="Cancel" />
            </td>
        </tr>
    </table>
            
    </td>
</tr>
<tr>
<td height="277" valign="top">

<%--<telerik:RadAjaxLoadingPanel ID="RadAjaxLoadingPanel1" runat="server"
        MinDisplayTime="0" >
    </telerik:RadAjaxLoadingPanel>
    
    <telerik:RadAjaxPanel ID="RadAjaxPanel1" LoadingPanelID="RadAjaxLoadingPanel1" runat="server" Width="100%" >
        
        <telerik:RadTreeList runat="server" ID="RadTreeList1" AllowPaging="True" PageSize="17" 
            DataKeyNames="CId" OnItemCommand="RadTreeList1_ItemCommand" AllowRecursiveSelection="True" 
            OnPageSizeChanged="RadTreeList1_PageSizeChanged" OnPageIndexChanged="RadTreeList1_PageIndexChanged"
            ParentDataKeyNames="PId" 
            onautogeneratedcolumncreated="RadTreeList1_AutoGeneratedColumnCreated" 
            AllowMultiItemSelection="True" CssClass="yui-datatable-theme"> 
           
            <AlternatingItemStyle CssClass="fontcss" />
            <ItemStyle CssClass="fontcss" />
            
            <Columns>
            
                        <telerik:TreeListBoundColumn DataField="CId" HeaderText="Assembly" UniqueName="CId"  Visible="false"/>
                        <telerik:TreeListBoundColumn DataField="WONo" HeaderText="WorkOrder" UniqueName="WONo"  Visible="false"/>
                        <telerik:TreeListBoundColumn DataField="PId" HeaderText="Parent Node" UniqueName="PId" Visible="false"/>
                        <telerik:TreeListBoundColumn DataField="ItemId" HeaderText="Item Id" UniqueName="ItemId" Visible="false"/>
                             
                      <telerik:TreeListTemplateColumn HeaderStyle-Width="80px">                                
                                <ItemTemplate>
                                
                                   <telerik:RadButton ID="SelectButton" runat="server" Text="" CommandName="Select" Width="16px" Height="16px">
                                  <Image ImageUrl="../../../images/Add.PNG" />
                                  </telerik:RadButton>
                                   
                                </ItemTemplate>
                               
                          
                                <HeaderStyle Width="80px" />
                          
                            </telerik:TreeListTemplateColumn>
            </Columns>
            
            
            <PagerStyle CssClass="fontcss" />
            
            <HeaderStyle Font-Bold="True" CssClass="fontcss" />
            
            <SelectedItemStyle CssClass="fontcss" />
            
            <PagerTemplate>
                <table width="100%">
                    <tr>
                        <td align="center" width="7%">
<asp:Button ID="btnPageFirst" runat="server" Text=" " CssClass="rtlPageFirst" CommandName="Page"
CommandArgument="First" />
<asp:Button ID="btnPagePrev" runat="server" Text=" " CssClass="rtlPagePrev" CommandName="Page"
CommandArgument="Prev" /> 
                        </td>
                        <td align="center" width="4%">
                        <%# (int)DataBinder.Eval(Container, "Paging.CurrentPageIndex") + 1 %>
                        </td>
                        <td align="center" width="6%">
                        <asp:Panel runat="server" ID="TreeListPagerPlaceHolder" />
<asp:Button ID="btnPageNext" runat="server" Text=" " CssClass="rtlPageNext" CommandName="Page"
CommandArgument="Next" />
<asp:Button ID="btnPageLast" runat="server" Text=" " CssClass="rtlPageLast" CommandName="Page"
CommandArgument="Last" />
                        </td>
                        <td align="right">
                                Displaying page
                                <%# (int)DataBinder.Eval(Container, "Paging.CurrentPageIndex") + 1 %>
                                of
                                <%# (int)DataBinder.Eval(Container, "Paging.PageCount") %>
                                / Items
                                <%# (int)DataBinder.Eval(Container, "Paging.FirstIndexInPage") + 1 %>
                                to
                                <%# (int)DataBinder.Eval(Container, "Paging.LastIndexInPage") + 1 %>
                                of
                                <%# DataBinder.Eval(Container, "Paging.DataSourceCount")%>
                        </td>
                    </tr>
                </table>
            </PagerTemplate>
        </telerik:RadTreeList>      
    </telerik:RadAjaxPanel>--%>
 
 <asp:Panel ID="Panel1" ScrollBars="Auto" runat="server">
   
        <telerik:RadTreeList runat="server" ID="RadTreeList1" AllowPaging="True" PageSize="20"  
            DataKeyNames="CId" OnItemCommand="RadTreeList1_ItemCommand" AllowRecursiveSelection="True" 
            OnPageSizeChanged="RadTreeList1_PageSizeChanged" OnPageIndexChanged="RadTreeList1_PageIndexChanged"
            ParentDataKeyNames="PId"  
            onautogeneratedcolumncreated="RadTreeList1_AutoGeneratedColumnCreated" 
            AllowMultiItemSelection="false" CssClass="yui-datatable-theme"> 
           
            <AlternatingItemStyle CssClass="fontcss" />
            <ItemStyle CssClass="fontcss" />
            
            <Columns>
            
                                                  
                            
                             <telerik:TreeListTemplateColumn Visible="false" >                                
                                <ItemTemplate>
                                
                                    <asp:Label ID="lblCId" runat="server" Visible="false" Text='<%# Bind("CId") %>'></asp:Label>
                                   
                                </ItemTemplate>                           
                            </telerik:TreeListTemplateColumn>
                            
                            <telerik:TreeListTemplateColumn Visible="false" >                                
                                <ItemTemplate>
                                
                                    <asp:Label ID="lblWONo" runat="server" Visible="false" Text='<%# Bind("WONo") %>'></asp:Label>
                                   
                                </ItemTemplate>                           
                            </telerik:TreeListTemplateColumn>
                             <telerik:TreeListTemplateColumn Visible="false" >                                
                                <ItemTemplate>
                                
                                    <asp:Label ID="lblPId" runat="server" Visible="false" Text='<%# Bind("PId") %>'></asp:Label>
                                   
                                </ItemTemplate>                           
                            </telerik:TreeListTemplateColumn>
        
        <telerik:TreeListTemplateColumn Visible="false" >                                
                                <ItemTemplate>
                                
                                    <asp:Label ID="lblItemId" runat="server" Visible="false" Text='<%# Bind("ItemId") %>'></asp:Label>
                                   
                                </ItemTemplate>                           
                            </telerik:TreeListTemplateColumn>
        
                      <telerik:TreeListTemplateColumn HeaderStyle-Width="80px">                                
                                <ItemTemplate>
                                
                                   <telerik:RadButton ID="SelectButton" runat="server" Text="" Visible="true"  CommandName="Sel" Width="16px" Height="16px">
                                  <Image ImageUrl="../../../images/Add.PNG" />
                                  </telerik:RadButton>
                                   
                                </ItemTemplate>                              
                          
                                <HeaderStyle Width="80px" />
                          
                            </telerik:TreeListTemplateColumn>
                            
                            
                             <telerik:TreeListTemplateColumn HeaderStyle-Width="8%" ItemStyle-HorizontalAlign="Center" HeaderStyle-HorizontalAlign="Center" HeaderText="Drw/Image">  
                            
                                                        <ItemTemplate >
                                                            
                                                                
                                                            <asp:LinkButton ID="btnlnkImg" CommandName="downloadImg" Visible="true"  Text='<%# Bind("FileName") %>' runat="server"></asp:LinkButton>
                                                            <asp:LinkButton ID="lnkUploadImg" CommandName="uploadImg" Visible="true" Text='<%# Bind("uploadImg") %>' runat="server"></asp:LinkButton>
                                                        </ItemTemplate>
                                                      
                                                       
                                                </telerik:TreeListTemplateColumn>                                               
                                                
                                               
                                                 <telerik:TreeListTemplateColumn  HeaderText="Spec. Sheet" HeaderStyle-Width="8%" ItemStyle-HorizontalAlign="Center" HeaderStyle-HorizontalAlign="Center">  
                                                    <ItemTemplate>
                                                        <asp:LinkButton ID="btnlnkSpec" CommandName="downloadSpec" Visible="true"  Text='<%# Bind("AttName") %>'  runat="server"></asp:LinkButton>
                          <asp:LinkButton ID="lnkUploadSpec" CommandName="uploadSpec" Visible="true" Text='<%# Bind("uploadSpec") %>' runat="server"></asp:LinkButton>
                                                               
                                                    </ItemTemplate>                                                  
                                                   
                                               </telerik:TreeListTemplateColumn>
            </Columns>
            
            
            <PagerStyle CssClass="fontcss" />
            
            <HeaderStyle Font-Bold="True" CssClass="fontcss" />
            
            <SelectedItemStyle CssClass="fontcss" />
            
            <PagerTemplate>
                <table width="100%">
                    <tr>
                        <td align="center" width="7%">
<asp:Button ID="btnPageFirst" runat="server" Text=" " CssClass="rtlPageFirst" CommandName="Page"
CommandArgument="First" />
<asp:Button ID="btnPagePrev" runat="server" Text=" " CssClass="rtlPagePrev" CommandName="Page"
CommandArgument="Prev" /> 
                        </td>
                        <td align="center" width="4%">
                        <%# (int)DataBinder.Eval(Container, "Paging.CurrentPageIndex") + 1 %>
                        </td>
                        <td align="center" width="6%">
                        <asp:Panel runat="server" ID="TreeListPagerPlaceHolder" />
<asp:Button ID="btnPageNext" runat="server" Text=" " CssClass="rtlPageNext" CommandName="Page"
CommandArgument="Next" />
<asp:Button ID="btnPageLast" runat="server" Text=" " CssClass="rtlPageLast" CommandName="Page"
CommandArgument="Last" />
                        </td>
                        <td align="right">
                                Displaying page
                                <%# (int)DataBinder.Eval(Container, "Paging.CurrentPageIndex") + 1 %>
                                of
                                <%# (int)DataBinder.Eval(Container, "Paging.PageCount") %>
                                / Items
                                <%# (int)DataBinder.Eval(Container, "Paging.FirstIndexInPage") + 1 %>
                                to
                                <%# (int)DataBinder.Eval(Container, "Paging.LastIndexInPage") + 1 %>
                                of
                                <%# DataBinder.Eval(Container, "Paging.DataSourceCount")%>
                        </td>
                    </tr>
                </table>
            </PagerTemplate>
       </telerik:RadTreeList>  
        </asp:Panel>
     
    </td>
</tr>  
    </table>
</asp:Content>
<asp:Content ID="Content8" ContentPlaceHolderID="ContentPlaceHolder4" Runat="Server">
</asp:Content>



=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/Design/Transactions/TPL_Design_WO_TreeView.aspx.cs ===

﻿using System;
using System.Collections;
using System.Configuration;
using System.Data;
using System.Linq;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Xml.Linq;
using System.Data.SqlClient;
using Telerik.Web.UI;
using System.Collections.Generic;
using System.IO;
using System.Security.Cryptography;
public partial class Module_Design_Transactions_ItemTree : System.Web.UI.Page
{
    clsFunctions fun = new clsFunctions();
    string woQueryStr = "";
    int CompId = 0;
    int FinYearId = 0;
    string SId = "";
    public DataTable GetDataTable()
    {
        String ConnString = ConfigurationManager.ConnectionStrings["LocalSqlServer"].ConnectionString;  
        SqlConnection conn = new SqlConnection(ConnString);
        SqlDataAdapter adapter = new SqlDataAdapter();
        DataTable myDataTable = new DataTable();
        DataSet DS = new DataSet();
        woQueryStr = Request.QueryString["WONo"].ToString();
        Label2.Text = woQueryStr;
       
      //  try
        {
            conn.Open();

            // Delete Temp TPL            
            string strDelete = fun.delete("tblDG_TPLItem_Temp", "CompId='" + CompId + "'And SessionId='" + SId.ToString() + "'");
            SqlCommand sqlDelete = new SqlCommand(strDelete, conn);
            sqlDelete.ExecuteNonQuery();

            // Generate Tree Structure

            string StrSql = fun.select("*", "tblDG_TPL_Master", "WONo='" + woQueryStr + "'AND CompId='" + CompId + "'AND FinYearId<='" + FinYearId + "' Order By PId ASC");
            adapter.SelectCommand = new SqlCommand(StrSql, conn);
            
            adapter.Fill(DS, "tblDG_TPL_Master");

            //myDataTable.Columns.Add(new System.Data.DataColumn("ItemId", typeof(int)));
            //myDataTable.Columns.Add(new System.Data.DataColumn("WONo", typeof(string)));
            //myDataTable.Columns.Add(new System.Data.DataColumn("PId", typeof(int)));
            //myDataTable.Columns.Add(new System.Data.DataColumn("CId", typeof(int)));                           
            //myDataTable.Columns.Add(new System.Data.DataColumn("Item Code", typeof(string)));
            //myDataTable.Columns.Add(new System.Data.DataColumn("Manf Desc", typeof(string)));
            //myDataTable.Columns.Add(new System.Data.DataColumn("UOM", typeof(string)));
            //myDataTable.Columns.Add(new System.Data.DataColumn("Unit Qty", typeof(string))); 
            //myDataTable.Columns.Add(new System.Data.DataColumn("TPL Qty", typeof(string)));
            //myDataTable.Columns.Add(new System.Data.DataColumn("Weld", typeof(string)));
            //myDataTable.Columns.Add(new System.Data.DataColumn("LH", typeof(string)));
            //myDataTable.Columns.Add(new System.Data.DataColumn("RH", typeof(string)));

            adapter.SelectCommand = new SqlCommand(StrSql, conn);
            adapter.Fill(DS, "tblDG_BOM_Master");
            myDataTable.Columns.Add(new System.Data.DataColumn("ItemId", typeof(int)));
            myDataTable.Columns.Add(new System.Data.DataColumn("WONo", typeof(string)));
            myDataTable.Columns.Add(new System.Data.DataColumn("PId", typeof(int)));
            myDataTable.Columns.Add(new System.Data.DataColumn("CId", typeof(int)));
            myDataTable.Columns.Add(new System.Data.DataColumn("Item Code", typeof(string)));
            myDataTable.Columns.Add(new System.Data.DataColumn("Description", typeof(string)));
            myDataTable.Columns.Add(new System.Data.DataColumn("UOM", typeof(string)));
            myDataTable.Columns.Add(new System.Data.DataColumn("Unit Qty", typeof(string)));
            myDataTable.Columns.Add(new System.Data.DataColumn("BOM Qty", typeof(string)));
            myDataTable.Columns.Add(new System.Data.DataColumn("FileName", typeof(string)));
            myDataTable.Columns.Add(new System.Data.DataColumn("AttName", typeof(string)));
            myDataTable.Columns.Add(new System.Data.DataColumn("uploadImg", typeof(string)));
            myDataTable.Columns.Add(new System.Data.DataColumn("uploadSpec", typeof(string)));

            DataRow dr;

            for (int p = 0; p < DS.Tables[0].Rows.Count; p++)
            {

                dr = myDataTable.NewRow();
                dr[0] = DS.Tables[0].Rows[p][0];
                dr[1] = DS.Tables[0].Rows[p][1].ToString();
                dr[2] = DS.Tables[0].Rows[p][2];
                dr[3] = DS.Tables[0].Rows[p][3];
                dr[7] = decimal.Parse(DS.Tables[0].Rows[p][4].ToString()).ToString("N3");

                string icSql = fun.select("*", "tblDG_Item_Master", "Id='" + dr[0] + "' And CompId='" + CompId + "'And FinYearId<='" + FinYearId + "'");
                SqlCommand cmditemCode = new SqlCommand(icSql, conn);
                SqlDataAdapter Dr = new SqlDataAdapter(cmditemCode);
                DataSet DsIt = new DataSet();

                Dr.Fill(DsIt, "tblDG_Item_Master");
                if (DsIt.Tables[0].Rows.Count > 0)
                {

                    if (DsIt.Tables[0].Rows[0]["CId"] != DBNull.Value)
                    {
                        dr[4] = DsIt.Tables[0].Rows[0]["ItemCode"].ToString();
                    }

                    else
                    {
                        dr[4] = DsIt.Tables[0].Rows[0]["PartNo"].ToString();
                    }


                    dr[5] = DsIt.Tables[0].Rows[0]["ManfDesc"].ToString();

                    string utSql = fun.select("*", "Unit_Master", "Id='" + Convert.ToInt32(DsIt.Tables[0].Rows[0]["UOMBasic"]) + "'");
                    SqlCommand cmdut = new SqlCommand(utSql, conn);
                    SqlDataAdapter Drut = new SqlDataAdapter(cmdut);
                    DataSet Dsut = new DataSet();
                    Drut.Fill(Dsut, "Unit_Master");
                    if (Dsut.Tables[0].Rows.Count > 0)
                    {
                        dr[6] = Dsut.Tables[0].Rows[0]["Symbol"].ToString();
                    }

                }
                List<double> g = new List<double>();
                g = fun.BOMTreeQty(woQueryStr, Convert.ToInt32(dr[2]), Convert.ToInt32(dr[3]));

                double h = 1;

                for (int j = 0; j < g.Count; j++)
                {
                    h = h * g[j];
                }

                dr[8] = decimal.Parse(h.ToString()).ToString("N3");


                string sql = fun.select("tblDG_Item_Master.AttName,tblDG_Item_Master.FileName,tblDG_Item_Master.Id", "tblDG_Item_Master", "tblDG_Item_Master.Id='" + DS.Tables[0].Rows[p][0] + "'");
                SqlCommand cmd = new SqlCommand(sql, conn);
                SqlDataAdapter da = new SqlDataAdapter(cmd);
                DataSet ds = new DataSet();
                da.Fill(ds);
                if (ds.Tables[0].Rows.Count > 0)
                {

                    if (ds.Tables[0].Rows[0]["FileName"] != "" && ds.Tables[0].Rows[0]["FileName"] != DBNull.Value)
                    {

                        // dr[9] = ds.Tables[0].Rows[0]["FileName"].ToString();

                        dr[9] = "View";
                        dr[11] = "";
                    }

                    else
                    {
                        dr[9] = "";
                        dr[11] = "Upload";
                    }

                    if (ds.Tables[0].Rows[0]["AttName"] != "" && ds.Tables[0].Rows[0]["AttName"] != DBNull.Value)
                    {
                        //dr[10] = ds.Tables[0].Rows[0]["AttName"].ToString();

                        dr[10] = "View";
                        dr[12] = "";
                    }

                    else
                    {
                        dr[10] = "";
                        dr[12] = "Upload";
                    }
                }

                g.Clear();
                myDataTable.Rows.Add(dr);
            }





            //for (int p = 0; p < DS.Tables[0].Rows.Count; p++)
            //{
                
            //    dr = myDataTable.NewRow();
            //    dr[0] = DS.Tables[0].Rows[p][0];
            //    dr[1] = DS.Tables[0].Rows[p][1].ToString();
            //    dr[2] = DS.Tables[0].Rows[p][2];
            //    dr[3] = DS.Tables[0].Rows[p][3];
            //    dr[7] = decimal.Parse(DS.Tables[0].Rows[p][4].ToString()).ToString("N3");

            //    string icSql = fun.select("*", "tblDG_Item_Master", "Id='" + dr[0] + "'AND CompId='" + CompId + "'AND FinYearId<='" + FinYearId + "'");
            //    SqlCommand cmditemCode = new SqlCommand(icSql, conn);
            //    SqlDataAdapter Dr = new SqlDataAdapter(cmditemCode);
            //    DataSet DsIt = new DataSet(); 
            //    Dr.Fill(DsIt, "tblDG_Item_Master");
            //    if (DsIt.Tables[0].Rows.Count>0)
            //    {
            //    dr[4] = DsIt.Tables[0].Rows[0]["ItemCode"].ToString();                
            //    dr[5] = DsIt.Tables[0].Rows[0]["ManfDesc"].ToString();              
              
            //    string utSql = fun.select("*", "Unit_Master", "Id='" + Convert.ToInt32(DsIt.Tables[0].Rows[0]["UOMBasic"]) + "'");
            //    SqlCommand cmdut = new SqlCommand(utSql, conn);
            //    SqlDataAdapter Drut = new SqlDataAdapter(cmdut);
            //    DataSet Dsut = new DataSet();
            //    Drut.Fill(Dsut, "Unit_Master");
            //    if (Dsut.Tables[0].Rows.Count > 0)
            //    {
            //        dr[6] = Dsut.Tables[0].Rows[0]["Symbol"].ToString();
            //    }
            //    }
            //    List<double> g = new List<double>();
            //    g = fun.TreeQty(woQueryStr, Convert.ToInt32(dr[2]), Convert.ToInt32(dr[3]));
                
            //    double h=1;
                
            //    for (int j = 0; j < g.Count; j++)
            //    {
            //        h = h * g[j];
            //    }

            //    dr[8] = decimal.Parse(h.ToString()).ToString("N3");

            //    dr[9] = DS.Tables[0].Rows[p]["Weldments"].ToString();
            //    dr[10] = DS.Tables[0].Rows[p]["LH"].ToString();
            //    dr[11] = DS.Tables[0].Rows[p]["RH"].ToString();

            //    g.Clear();
            //    myDataTable.Rows.Add(dr);
            //}
            
        }
       // catch (Exception ex){ }       
       // finally
        {
            conn.Close();
        }
        return myDataTable;
    }

    protected void Page_Load(object sender, EventArgs e)
    {
        woQueryStr = Request.QueryString["WONo"].ToString();
        CompId = Convert.ToInt32(Session["compid"]);
        FinYearId = Convert.ToInt32(Session["finyear"]);
        SId = Session["username"].ToString();
        if ((Request.QueryString["Msg"]) != "")
        {
            lblmsg.Text = (Request.QueryString["Msg"]);
        }

        if (!IsPostBack)
        {
            RadTreeList1.DataSource = GetDataTable();                    
            RadTreeList1.DataBind();
            RadTreeList1.ExpandAllItems();
            CheckBox1.Checked = true;
            this.DataBind();
        }
    }

    protected void RadTreeList1_ItemCommand(object sender, TreeListCommandEventArgs e)
    {
        if (e.CommandName == RadTreeList.ExpandCollapseCommandName)
        {
            RadTreeList1.DataSource = GetDataTable();
            RadTreeList1.DataBind();
        }
    }
    protected void RadTreeList1_PageIndexChanged(object source, Telerik.Web.UI.TreeListPageChangedEventArgs e)
    {
        RadTreeList1.CurrentPageIndex = e.NewPageIndex;
        RadTreeList1.DataSource = GetDataTable();
        RadTreeList1.DataBind();
    }
    protected void RadTreeList1_PageSizeChanged(object source, Telerik.Web.UI.TreeListPageSizeChangedEventArgs e)
    {
        RadTreeList1.DataSource = GetDataTable();
        RadTreeList1.DataBind();
    }

    //protected void btnAssembly_Click(object sender, EventArgs e)
    //{
    //        string woQueryStr = Request.QueryString["WONo"].ToString();
    //        string pgurl = "TPL_Design_WO_TreeView.aspx";
    //        Response.Redirect("~/Module/Design/Transactions/TPL_Design_Assembly_New.aspx?WONo=" + woQueryStr + "&PgUrl=" + pgurl + "&ModId=3&SubModId=23");
       
    //}

    protected void Page_PreRender(object sender, EventArgs e)
    {
        if (RadTreeList1.SelectedItems.Count > 0)
        {
            string wono = RadTreeList1.SelectedItems[0]["WONo"].Text;           
            int pid  = Convert.ToInt32(RadTreeList1.SelectedItems[0]["PId"].Text);
            int cid = Convert.ToInt32(RadTreeList1.SelectedItems[0]["CId"].Text);
            string itemid = RadTreeList1.SelectedItems[0]["ItemId"].Text;
            Response.Redirect("WoItems.aspx?WONo=" + wono + "&ItemId="+itemid+"&PId=" + pid + "&CId=" + cid + "&ModId=3&SubModId=23");
        }
    }
    protected void RadTreeList1_AutoGeneratedColumnCreated(object sender, TreeListAutoGeneratedColumnCreatedEventArgs e)
    {

        if (e.Column.HeaderText == "ItemId")
        {
            e.Column.Visible = false;
        }

        if (e.Column.HeaderText == "PId")
        {
            e.Column.Visible = false;
        }


        if (e.Column.HeaderText == "FileName")
        {
            e.Column.Visible = false;
        }

        if (e.Column.HeaderText == "AttName")
        {
            e.Column.Visible = false;
        }


        if (e.Column.HeaderText == "uploadImg")
        {
            e.Column.Visible = false;
        }


        if (e.Column.HeaderText == "uploadSpec")
        {
            e.Column.Visible = false;
        }
        if (e.Column.HeaderText == "CId")
        {
            e.Column.Visible = false;
        }
        if (e.Column.HeaderText == "ECN")
        {
            e.Column.Visible = false;
        }
        if (e.Column.HeaderText == "WONo")
        {
            e.Column.Visible = false;
        }

        if (e.Column.HeaderText == "Item Code")
        {
            e.Column.HeaderStyle.Width = Unit.Pixel(150);
            e.Column.HeaderStyle.HorizontalAlign = HorizontalAlign.Center;
            e.Column.ItemStyle.HorizontalAlign = HorizontalAlign.Center;
        }

        if (e.Column.HeaderText == "Description")
        {
            e.Column.HeaderStyle.Width = Unit.Pixel(340);
            e.Column.HeaderStyle.HorizontalAlign = HorizontalAlign.Center;
        }

        if (e.Column.HeaderText == "Unit Qty")
        {
            e.Column.HeaderStyle.Width = Unit.Pixel(100);
            e.Column.HeaderStyle.HorizontalAlign = HorizontalAlign.Center;
            e.Column.ItemStyle.HorizontalAlign = HorizontalAlign.Right;
        }
        if (e.Column.HeaderText == "BOM Qty")
        {
            e.Column.HeaderStyle.Width = Unit.Pixel(100);
            e.Column.HeaderStyle.HorizontalAlign = HorizontalAlign.Center;
            e.Column.ItemStyle.HorizontalAlign = HorizontalAlign.Right;
        }

        if (e.Column.HeaderText == "UOM")
        {
            e.Column.HeaderStyle.Width = Unit.Pixel(60);
            e.Column.HeaderStyle.HorizontalAlign = HorizontalAlign.Center;
            e.Column.ItemStyle.HorizontalAlign = HorizontalAlign.Center;
        }

    } 

    //protected void RadTreeList1_AutoGeneratedColumnCreated(object sender, TreeListAutoGeneratedColumnCreatedEventArgs e)
    //{

    //    if (e.Column.HeaderText == "ItemId")
    //    {
    //        e.Column.Visible = false;
    //    }

    //    if (e.Column.HeaderText == "PId")
    //    {
    //        e.Column.Visible = false;
    //    }
    //    if (e.Column.HeaderText == "CId")
    //    {
    //        e.Column.Visible = false;
    //    }
    //    if (e.Column.HeaderText == "ECN")
    //    {
    //        e.Column.Visible = false;
    //    }
    //    if (e.Column.HeaderText == "WONo")
    //    {
    //        e.Column.Visible = false;
    //    }

    //    if (e.Column.HeaderText == "Item Code")
    //    {
    //        e.Column.HeaderStyle.Width = Unit.Pixel(150);
    //        e.Column.HeaderStyle.HorizontalAlign = HorizontalAlign.Center;
    //        e.Column.ItemStyle.HorizontalAlign = HorizontalAlign.Center;

    //    }

    //    if (e.Column.HeaderText == "Manf Desc")
    //    {
    //        e.Column.HeaderStyle.Width = Unit.Pixel(340);
    //        e.Column.HeaderStyle.HorizontalAlign = HorizontalAlign.Center;
           
    //    }

    //    if (e.Column.HeaderText == "Unit Qty")
    //    {
    //        e.Column.HeaderStyle.Width = Unit.Pixel(100);
    //        e.Column.HeaderStyle.HorizontalAlign = HorizontalAlign.Center;
    //        e.Column.ItemStyle.HorizontalAlign = HorizontalAlign.Right;
    //    }
    //    if (e.Column.HeaderText == "TPL Qty")
    //    {
    //        e.Column.HeaderStyle.Width = Unit.Pixel(100);
    //        e.Column.HeaderStyle.HorizontalAlign = HorizontalAlign.Center;           
    //        e.Column.ItemStyle.HorizontalAlign = HorizontalAlign.Right;
    //    }

    //    if (e.Column.HeaderText == "UOM")
    //    {
    //        e.Column.HeaderStyle.Width = Unit.Pixel(60);
    //        e.Column.HeaderStyle.HorizontalAlign = HorizontalAlign.Center;            
    //        e.Column.ItemStyle.HorizontalAlign = HorizontalAlign.Center;
    //    }
    //    if (e.Column.HeaderText == "Weld")
    //    {
    //        e.Column.HeaderStyle.Width = Unit.Pixel(40);
    //        e.Column.HeaderStyle.HorizontalAlign = HorizontalAlign.Center;
    //        e.Column.ItemStyle.HorizontalAlign = HorizontalAlign.Right;
    //    }

    //    if (e.Column.HeaderText == "LH")
    //    {
    //        e.Column.HeaderStyle.Width = Unit.Pixel(40);
    //        e.Column.HeaderStyle.HorizontalAlign = HorizontalAlign.Center;
    //        e.Column.ItemStyle.HorizontalAlign = HorizontalAlign.Right;
    //    }

    //    if (e.Column.HeaderText == "RH")
    //    {
    //        e.Column.HeaderStyle.Width = Unit.Pixel(40);
    //        e.Column.HeaderStyle.HorizontalAlign = HorizontalAlign.Center;
    //        e.Column.ItemStyle.HorizontalAlign = HorizontalAlign.Right;
    //    }
    //}
  

    protected void CheckBox1_CheckedChanged(object sender, EventArgs e)
    {
        if (CheckBox1.Checked == true)
        {
            RadTreeList1.DataSource = GetDataTable();
            RadTreeList1.DataBind();
            RadTreeList1.ExpandAllItems();
        }
        else
        {
            RadTreeList1.DataSource = GetDataTable();
            RadTreeList1.DataBind();
            RadTreeList1.CollapseAllItems();
        }
    }

    protected void Button1_Click(object sender, EventArgs e)
    {
        Response.Redirect("TPL_Design_WO_Grid.aspx?ModId=3&SubModId=23");
    }

    protected void btnCopy_Click(object sender, EventArgs e)
    {
        Response.Redirect("TPL_Design_Root_Assembly_Copy_WO.aspx?WONoDest=" +woQueryStr + "&ModId=3&SubModId=23");
    }
}
