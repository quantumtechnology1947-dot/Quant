=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/HR/Transactions/OfferLetter_Edit_Details.aspx.txt ===

ï»¿<%@ Page Language="C#" MasterPageFile="~/MasterPage.master" AutoEventWireup="true" CodeFile="OfferLetter_Edit_Details.aspx.cs" Inherits="Module_HR_Transactions_OfferLetter_Edit_Details" Title="ERP" Theme ="Default"  %>
<%@ Register assembly="AjaxControlToolkit" namespace="AjaxControlToolkit" tagprefix="cc1" %>

<asp:Content ID="Content1" ContentPlaceHolderID="head" Runat="Server">
    <link href="../../../Css/StyleSheet.css" rel="stylesheet" type="text/css" /> 
    <script src="../../../Javascript/loadingNotifier.js" type="text/javascript"></script> 
    <link href="../../../Css/styles.css" rel="stylesheet" type="text/css" />
    <link href="../../../Css/yui-datatable.css" rel="stylesheet" type="text/css" />
    <style type="text/css">
        .style4
        {
            text-align: left;
            font-weight: bold;
        }
      
        .style5
        {
            
            float: left;
        }
      
    </style>
   
    </asp:Content>
<asp:Content ID="Content2" ContentPlaceHolderID="cp3" Runat="Server">
</asp:Content>
<asp:Content ID="Content3" ContentPlaceHolderID="cp1" Runat="Server">
</asp:Content>
<asp:Content ID="Content4" ContentPlaceHolderID="cp2" Runat="Server">
</asp:Content>
<asp:Content ID="Content5" ContentPlaceHolderID="MainContent" Runat="Server">
</asp:Content>
<asp:Content ID="Content6" ContentPlaceHolderID="ContentPlaceHolder2" Runat="Server">
</asp:Content>
<asp:Content ID="Content7" ContentPlaceHolderID="ContentPlaceHolder3" Runat="Server">
    <table  width="100%" cellpadding="0" cellspacing="0">
        <%--  <asp:TemplateField ShowHeader="False">
                                                    <ItemTemplate>
                                                        <asp:LinkButton ID="LinkButton1" runat="server" CausesValidation="False" 
                                                            CommandName="Delete" Text="Delete"></asp:LinkButton>
                                                    </ItemTemplate>
                                                
                                                    
                                                </asp:TemplateField>--%>
        
        <tr>
        <td colspan="2" height="20" align="left" valign="middle"  scope="col" class="fontcsswhite" 
                style="background:url(../../../images/hdbg.JPG)">
        &nbsp;<b> 
            <asp:Label ID="lblOfferIncrement" runat="server" Text=""></asp:Label>
            &nbsp;&nbsp;&nbsp;&nbsp;Offer Id: <asp:Label ID="lblOfferId" runat="server" Text=""></asp:Label></b></td>
        
        
        </tr>
        
        <tr>
        <td>
            &nbsp;</td>
        
        <td>
        
        
            <table width="100%" border="0" cellpadding="0" cellspacing="0" >
                <tr __designer:mapid="83">
                    <td 
         width="12%">
                        Designation</td>
                    <td 
         width="20%">
                        <asp:DropDownList runat="server" DataTextField="Designation" 
                            DataValueField="Id" DataSourceID="SqlDataSource3" CssClass="box3" 
                            ID="DrpDesignation">
                        </asp:DropDownList>
                    </td>
                    <td 
         width="10%">
                        Name</td>
                    <td width="21%" >
                        <asp:DropDownList ID="DrpTitle" runat="server">
                            <asp:ListItem Value="Mr.">Mr.</asp:ListItem>
                            <asp:ListItem Value="Mrs."></asp:ListItem>
                            <asp:ListItem Value="Miss."></asp:ListItem>
                        </asp:DropDownList>
                        <asp:TextBox runat="server" CssClass="box3" Width="200px" ID="TxtName"></asp:TextBox>
                        <asp:RequiredFieldValidator runat="server" ControlToValidate="TxtName" 
                            ErrorMessage="*" ValidationGroup="A" ID="RequiredFieldValidator2"></asp:RequiredFieldValidator>
                    </td>
                    <td rowspan="7" valign="top" width="20%" >
                        <table align="left" cellpadding="0" cellspacing="0" width="100%">
                            <tr>
                                <td>
                                    <asp:TextBox ID="txtHeader" runat="server" CssClass="box3" Height="59px" 
                                        TextMode="MultiLine" Width="250px" Visible="False">You will be on a probation for the period of Six Months.You should join on or before dt. / / .You should submit Xerox copies of certificates and two passport size Photographs at the time of joining.</asp:TextBox>
                                    <asp:RequiredFieldValidator ID="RequiredFieldValidator19" runat="server" 
                                        ControlToValidate="txtHeader" ErrorMessage="*" ValidationGroup="A"></asp:RequiredFieldValidator>
                                    <br />
                                    <asp:Label ID="lblEffectFromForTheYeartext" runat="server" 
                                        style="font-weight: 700" Text="Effect From For The Year" Visible="False"></asp:Label>
                                    <br />
                                    <asp:TextBox ID="txtIncrementForTheYear" runat="server" CssClass="box3" 
                                        Visible="False" Width="90px"></asp:TextBox>
                                &nbsp;<asp:Label ID="lblIncrementForTheYear" runat="server" Text="Ex- 2014 - 2015" 
                                        style="font-weight: 700" Visible="False"></asp:Label>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <asp:TextBox ID="txtFooter" runat="server" CssClass="box3" Height="59px" 
                                        TextMode="MultiLine" Width="250px" Visible="False">If you are agreed to above terms and conditions then please sign the second copy . We have pleasure in welcoming you to our Organization.</asp:TextBox>
                                    <asp:RequiredFieldValidator ID="RequiredFieldValidator20" runat="server" 
                                        ControlToValidate="txtFooter" ErrorMessage="*" ValidationGroup="A"></asp:RequiredFieldValidator>
                                    <br />
                                    <asp:Label ID="lblEffectFromtext" runat="server" style="font-weight: 700" 
                                        Text="Effect From" Visible="False"></asp:Label>
                                    <br />
                                    <asp:TextBox ID="txtEffectFrom" runat="server" CssClass="box3" Visible="False" 
                                        Width="90px"></asp:TextBox>
                                    <cc1:CalendarExtender ID="txtEffectFrom_CalendarExtender" runat="server" 
                                    Enabled="True" Format="dd-MM-yyyy" TargetControlID="txtEffectFrom">
                                    </cc1:CalendarExtender>                                    
                                    <asp:RegularExpressionValidator ID="RegtxtEffectFrom" runat="server" 
                                    ControlToValidate="txtEffectFrom" ErrorMessage="*" 
                                    ValidationExpression="^([1-9]|0[1-9]|[12][0-9]|3[01])[- /.]([1-9]|0[1-9]|1[012])[- /.][0-9]{4}$" 
                                    ValidationGroup="A">
                                    </asp:RegularExpressionValidator>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr 
        >
                    <td __designer:mapid="8b">
                        Duty Hours</td>
                    <td 
            >
                        <asp:DropDownList runat="server" DataTextField="Hours" DataValueField="Id" 
                            DataSourceID="SqlDataSource1" CssClass="box3" ID="DrpDutyHrs">
                        </asp:DropDownList>
                    </td>
                    <td 
            >
                        Contact Nos.</td>
                    <td >
                        <asp:TextBox runat="server" CssClass="box3" Width="150px" ID="TxtContactNo"></asp:TextBox>
                        <asp:RequiredFieldValidator runat="server" ControlToValidate="TxtContactNo" 
                            ErrorMessage="*" ValidationGroup="A" ID="RequiredFieldValidator4"></asp:RequiredFieldValidator>
                    </td>
                </tr>
                <tr >
                    <td >
                        OT Hours</td>
                    <td 
            >
                        <asp:DropDownList runat="server" DataTextField="Hours" DataValueField="Id" 
                            DataSourceID="SqlDataSource2" CssClass="box3" ID="DrpOTHrs">
                        </asp:DropDownList>
                    </td>
                    <td 
             rowspan="2" valign="top">
                        Address</td>
                    <td 
             rowspan="2">
                        <asp:TextBox runat="server" TextMode="MultiLine" ValidationGroup="A" 
                            CssClass="box3" Height="45px" Width="250px" ID="TxtAddress"></asp:TextBox>
                        <asp:RequiredFieldValidator runat="server" ControlToValidate="TxtAddress" 
                            ErrorMessage="*" ValidationGroup="A" ID="RequiredFieldValidator3"></asp:RequiredFieldValidator>
                    </td>
                </tr>
                <tr 
        >
                    <td >
                        OT Applicable</td>
                    <td 
            >
                        <asp:DropDownList runat="server" 
                            DataTextField="Description" DataValueField="Id" DataSourceID="SqlDataSource5" 
                            CssClass="box3" ID="DrpOvertime">
                        </asp:DropDownList>
                    </td>
                </tr>
                <tr 
        >
                    <td >
                        Type of Employee</td>
                    <td 
           >
                        <asp:DropDownList ID="DrpEmpTypeOf" runat="server" AutoPostBack="True" 
                            onselectedindexchanged="DrpEmpTypeOf_SelectedIndexChanged">
                            <asp:ListItem Value="0">Select</asp:ListItem>
                            <asp:ListItem Value="1">SAPL</asp:ListItem>
                            <asp:ListItem Value="2">NEHA</asp:ListItem>
                        </asp:DropDownList>
                        <asp:RequiredFieldValidator ID="RequiredFieldValidator18" runat="server" 
                            ControlToValidate="DrpEmpTypeOf" ErrorMessage="*" InitialValue="0" 
                            ValidationGroup="B"></asp:RequiredFieldValidator>
                        <asp:DropDownList runat="server" 
                            DataTextField="Description" DataValueField="Id" DataSourceID="SqlDataSource4" 
                            CssClass="box3" ID="DrpEmpType" AutoPostBack="True" 
                            onselectedindexchanged="DrpEmpType_SelectedIndexChanged">
                        </asp:DropDownList>
                    </td>
                    <td 
            >
                        Email Id</td>
                    <td >
                        <asp:TextBox runat="server" CssClass="box3" Width="250px" ID="TxtEmail"></asp:TextBox>
                        <asp:RequiredFieldValidator runat="server" ControlToValidate="TxtEmail" 
                            ErrorMessage="*" ValidationGroup="A" ID="RequiredFieldValidator5"></asp:RequiredFieldValidator>
                        <asp:RegularExpressionValidator runat="server" 
                            ValidationExpression="\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*" 
                            ControlToValidate="TxtEmail" ErrorMessage="*" ValidationGroup="A" 
                            ID="RegularExpressionValidator1"></asp:RegularExpressionValidator>
                    </td>
                </tr>
                <tr 
        >
                    <td >
                        Interviewed By</td>
                    <td 
            >
                        <asp:TextBox runat="server" CssClass="box3" Width="300px" ID="Txtinterviewedby"></asp:TextBox>
                        <cc1:AutoCompleteExtender runat="server" MinimumPrefixLength="1" 
                            CompletionInterval="100" CompletionSetCount="1" 
                            ServiceMethod="GetCompletionList" ServicePath="" UseContextKey="True" 
                            CompletionListCssClass="almt2" CompletionListItemCssClass="bg" 
                            CompletionListHighlightedItemCssClass="bgtext" DelimiterCharacters="" 
                            FirstRowSelected="True" ShowOnlyCurrentWordInCompletionListItem="True" 
                            Enabled="True" TargetControlID="Txtinterviewedby" 
                            ID="TxtEmpName_AutoCompleteExtender">
                        </cc1:AutoCompleteExtender>
                  
                        
                        <asp:RequiredFieldValidator runat="server" ControlToValidate="Txtinterviewedby" 
                            ErrorMessage="*" ValidationGroup="A" ID="RequiredFieldValidator6"></asp:RequiredFieldValidator>
                    </td>
                    <td 
            >
                        Authorized By</td>
                    <td >
                        <asp:TextBox runat="server" CssClass="box3" Width="250px" ID="TxtAuthorizedby"></asp:TextBox>
                        <cc1:AutoCompleteExtender runat="server" MinimumPrefixLength="1" 
                            CompletionInterval="100" CompletionSetCount="2" 
                            ServiceMethod="GetCompletionList" ServicePath="" UseContextKey="True" 
                            CompletionListCssClass="almt2" CompletionListItemCssClass="bg" 
                            CompletionListHighlightedItemCssClass="bgtext" DelimiterCharacters="" 
                            FirstRowSelected="True" ShowOnlyCurrentWordInCompletionListItem="True" 
                            Enabled="True" TargetControlID="TxtAuthorizedby" ID="AutoCompleteExtender1">
                        </cc1:AutoCompleteExtender>
                        <asp:RequiredFieldValidator runat="server" ControlToValidate="TxtAuthorizedby" 
                            ErrorMessage="*" ValidationGroup="A" ID="RequiredFieldValidator7"></asp:RequiredFieldValidator>
                    </td>
                </tr>
                <tr 
        >
                    <td >
                        Reference By</td>
                    <td 
            >
                        <asp:TextBox runat="server" CssClass="box3" Width="300px" ID="TxtReferencedby"></asp:TextBox>
                    </td>
                    <td 
            >
                        Gross Salary</td>
                    <td >
                        <asp:TextBox runat="server" CssClass="box3" ID="TxtGrossSalry" 
                            ValidationGroup="B"></asp:TextBox>
                        <asp:RequiredFieldValidator runat="server" ControlToValidate="TxtGrossSalry" 
                            ErrorMessage="*" ValidationGroup="B" ID="RequiredFieldValidator1"></asp:RequiredFieldValidator><asp:RegularExpressionValidator ValidationExpression="^\d{1,15}(\.\d{0,3})?$" ValidationGroup="B" ControlToValidate="TxtGrossSalry"
                                ID="RegularExpressionValidator2" runat="server" ErrorMessage="*"></asp:RegularExpressionValidator>
&nbsp;</td>
                </tr>
                <tr 
        >
                    <td colspan="5">
                        <table width="100%" 
                class="box3" align="center" border="0" cellpadding="1" cellspacing="1">
                            <tr __designer:mapid="cc">
                                <td __designer:mapid="cd" 
                    class="style4" width="100">
                                    Description<asp:SqlDataSource runat="server" 
                            ConnectionString="<%$ ConnectionStrings:LocalSqlServer %>" 
                            SelectCommand="SELECT * FROM [tblHR_OverTime]" ID="SqlDataSource5">
                        </asp:SqlDataSource>
                                </td>
                                <td width="70"  __designer:mapid="ce">
                                    <b>%<asp:SqlDataSource runat="server" 
                            ConnectionString="<%$ ConnectionStrings:LocalSqlServer %>" 
                            SelectCommand="SELECT * FROM [tblHR_OTHour]" ID="SqlDataSource2">
                        </asp:SqlDataSource>
        
        
        
                                    </b></td>
                                <td __designer:mapid="cf" align="left">
                                    <b>Per Month<asp:SqlDataSource runat="server" 
                            ConnectionString="<%$ ConnectionStrings:LocalSqlServer %>" 
                            SelectCommand="SELECT * FROM [tblHR_DutyHour]" ID="SqlDataSource1">
                        </asp:SqlDataSource>
                                    </b></td>
                                <td width="60" __designer:mapid="cf" align="left" colspan="2">
                                    <b>Annual<asp:SqlDataSource runat="server" 
                            ConnectionString="<%$ ConnectionStrings:LocalSqlServer %>" 
                            SelectCommand="SELECT Symbol + ' - ' +Type  AS Designation, [Id] FROM [tblHR_Designation]" 
                            ID="SqlDataSource3"></asp:SqlDataSource>
                                    </b></td>
                                <td __designer:mapid="d0" colspan="2">
                                      <%--  <asp:TemplateField ShowHeader="False">
                                                    <ItemTemplate>
                                                        <asp:LinkButton ID="LinkButton1" runat="server" CausesValidation="False" 
                                                            CommandName="Delete" Text="Delete"></asp:LinkButton>
                                                    </ItemTemplate>
                                                
                                                    
                                                </asp:TemplateField>--%>
        
                                </td>
                                <td width="100"  __designer:mapid="177" align="justify">
                                    &nbsp;</td>
                                <td width="200"
                    __designer:mapid="192" align="justify">
                                    &nbsp;</td>
                                <td width="100" __designer:mapid="1ba" 
                    align="justify">
                                    <b>Per Month</b></td>
                                <td __designer:mapid="1ba" 
                    align="justify">
                                    <b>Annual</b></td>
                            </tr>
                            <tr __designer:mapid="d2">
                                <td 
                    __designer:mapid="d3" class="style5">
                                    Gross Salary</td>
                                <td 
                    __designer:mapid="d4">
                                    100</td>
                                <td __designer:mapid="d5">
                                    <asp:label runat="server" Enabled="False" ID="TxtGSal"></asp:label>
                                </td>
                                <td __designer:mapid="d5" colspan="2">
                                    <asp:label runat="server"  Enabled="False" ID="TxtANNualSal"></asp:label>
                                </td>
                                <td 
                    __designer:mapid="d7" colspan="2">
                                    LTA</td>
                                <td __designer:mapid="178">
                                    <asp:TextBox runat="server" CssClass="box3" ID="TxtGLTA" Width="80px">0</asp:TextBox>
                                    <asp:RegularExpressionValidator ID="RegularExpressionValidator9" runat="server" 
                                        ControlToValidate="TxtGLTA" ErrorMessage="*" 
                                        ValidationExpression="^\d{1,15}(\.\d{0,3})?$" ValidationGroup="A"></asp:RegularExpressionValidator>
                                    <asp:RequiredFieldValidator ID="RequiredFieldValidator14" runat="server" 
                                        ControlToValidate="TxtGLTA" ErrorMessage="*" ValidationGroup="A"></asp:RequiredFieldValidator>
                                </td>
                                <td 
                    __designer:mapid="193">
        
        
                                    Take Home</td>
                                <td __designer:mapid="1bb">
        
        
                                    <asp:Label ID="lblTH" runat="server"></asp:Label>
                                </td>
                                <td __designer:mapid="1bb">
        
        
                                    <asp:Label ID="lblTHAnn" runat="server"></asp:Label>
                                </td>
                            </tr>
                            <tr 
                __designer:mapid="d9">
                                <td __designer:mapid="da" class="style5">
                                    Basic</td>
                                <td 
                    __designer:mapid="db">
                                    30</td>
                                <td __designer:mapid="dc">
                                    <asp:label runat="server"  Enabled="False" ID="TxtGBasic"></asp:label>
                                </td>
                                <td __designer:mapid="dc" colspan="2">
                                    <asp:label runat="server"  Enabled="False" ID="TxtAnBasic"></asp:label>
                                </td>
                                <td 
                    __designer:mapid="de" colspan="2">
                                    Ex Gratia</td>
                                <td __designer:mapid="179">
                                    <asp:TextBox runat="server" CssClass="box3" ID="TxtGGratia" Width="80px">0</asp:TextBox>
                                    <asp:RegularExpressionValidator ID="RegularExpressionValidator4" runat="server" 
                                        ControlToValidate="TxtGGratia" ErrorMessage="*" 
                                        ValidationExpression="^\d{1,15}(\.\d{0,3})?$" ValidationGroup="A"></asp:RegularExpressionValidator>
                                    <asp:RequiredFieldValidator ID="RequiredFieldValidator9" runat="server" 
                                        ControlToValidate="TxtGGratia" ErrorMessage="*" ValidationGroup="A"></asp:RequiredFieldValidator>
                                </td>
                                <td 
                    __designer:mapid="194">
        
        
                                    Take Home&nbsp; (With Attd. Bonus - 1)*</td>
                                <td __designer:mapid="1bc">
        
        
                                    <asp:Label ID="lblTH1" runat="server"></asp:Label>
                                </td>
                                <td __designer:mapid="1bc">
        
        
                                    <asp:Label ID="lblTHAnn1" runat="server"></asp:Label>
                                </td>
                            </tr>
                            <tr 
                __designer:mapid="e0">
                                <td __designer:mapid="e1" class="style5">
                                    DA</td>
                                <td 
                    __designer:mapid="e2">
                                    20</td>
                                <td __designer:mapid="e3">
                                    <asp:label runat="server" Enabled="False" ID="TxtGDA"></asp:label>
                                </td>
                                <td __designer:mapid="e3" colspan="2">
                                    <asp:label runat="server" Enabled="False" ID="TxtAnDA"></asp:label>
                                </td>
                                <td 
                    __designer:mapid="e5" colspan="2" >
                                    Loyalty Benefits</td>
                                <td __designer:mapid="17a" >
                                    <asp:TextBox runat="server" CssClass="box3" ID="TxtAnnLOYAlty" Width="80px">0</asp:TextBox>
                                    <asp:RegularExpressionValidator ID="RegularExpressionValidator10" 
                                        runat="server" ControlToValidate="TxtAnnLOYAlty" ErrorMessage="*" 
                                        ValidationExpression="^\d{1,15}(\.\d{0,3})?$" ValidationGroup="A"></asp:RegularExpressionValidator>
                                    <asp:RequiredFieldValidator ID="RequiredFieldValidator15" runat="server" 
                                        ControlToValidate="TxtAnnLOYAlty" ErrorMessage="*" ValidationGroup="A"></asp:RequiredFieldValidator>
                                </td>
                                <td 
                    __designer:mapid="195" >
        
        
                                    Take Home&nbsp; (With Attd. Bonus - 2)*</td>
                                <td __designer:mapid="1bd" >
        
        
                                    <asp:Label ID="lblTH2" runat="server"></asp:Label>
                                </td>
                                <td __designer:mapid="1bd" >
        
        
                                    <asp:Label ID="lblTHAnn2" runat="server"></asp:Label>
                                </td>
                            </tr>
                            <tr 
                __designer:mapid="e7">
                                <td __designer:mapid="e8" class="style5">
                                    HRA</td>
                                <td 
                    __designer:mapid="e9">
                                    20</td>
                                <td __designer:mapid="ea">
                                    <asp:label runat="server" Enabled="False" ID="TxtGHRA"></asp:label>
                                </td>
                                <td __designer:mapid="ea" colspan="2">
                                    <asp:label runat="server" Enabled="False" ID="TxtANHRA"></asp:label>
                                </td>
                                <td 
                    __designer:mapid="ec" colspan="2">
                                    Vehicle Allowance</td>
                                <td __designer:mapid="17b">
                                    <asp:TextBox runat="server" CssClass="box3" ID="TxtGVehAll" Width="80px">0</asp:TextBox>
                                    <asp:RegularExpressionValidator ID="RegularExpressionValidator6" runat="server" 
                                        ControlToValidate="TxtGVehAll" ErrorMessage="*" 
                                        ValidationExpression="^\d{1,15}(\.\d{0,3})?$" ValidationGroup="A"></asp:RegularExpressionValidator>
                                    <asp:RequiredFieldValidator ID="RequiredFieldValidator11" runat="server" 
                                        ControlToValidate="TxtGVehAll" ErrorMessage="*" ValidationGroup="A"></asp:RequiredFieldValidator>
                                </td>
                                <td 
                    __designer:mapid="196">
        
        
                                    CTC</td>
                                <td __designer:mapid="1be">
        
        
                                    <asp:Label ID="lblCTC" runat="server"></asp:Label>
                                </td>
                                <td __designer:mapid="1be">
        
        
                                    <asp:Label ID="lblCTCAnn" runat="server"></asp:Label>
                                </td>
                            </tr>
                            <tr 
                __designer:mapid="ee">
                                <td __designer:mapid="ef" class="style5">
                                    Convenience</td>
                                <td 
                    __designer:mapid="f0">
                                    20</td>
                                <td __designer:mapid="f1">
                                    <asp:label runat="server" Enabled="False" 
                                        ID="TxtGConvenience"></asp:label>
                                </td>
                                <td __designer:mapid="f1" colspan="2">
                                    <asp:label runat="server" Enabled="False" 
                                        ID="TxtANConvenience"></asp:label>
                                </td>
                                <td 
                    __designer:mapid="f3" colspan="2">
                                    Paid Leaves</td>
                                <td __designer:mapid="17c">
                                    <asp:TextBox runat="server" CssClass="box3" ID="TxtAnnpaidleaves" Width="80px">0</asp:TextBox>
                                    <asp:RegularExpressionValidator ID="RegularExpressionValidator11" 
                                        runat="server" ControlToValidate="TxtAnnpaidleaves" ErrorMessage="*" 
                                        ValidationExpression="^\d{1,15}(\.\d{0,3})?$" ValidationGroup="A"></asp:RegularExpressionValidator>
                                    <asp:RequiredFieldValidator ID="RequiredFieldValidator16" runat="server" 
                                        ControlToValidate="TxtAnnpaidleaves" ErrorMessage="*" ValidationGroup="A"></asp:RequiredFieldValidator>
                                </td>
                                <td 
                    __designer:mapid="197">
        
        
                                    CTC&nbsp; (With Attd. Bonus - 1)*</td>
                                <td __designer:mapid="1bf">
                                    <asp:Label ID="lblCTC1" runat="server"></asp:Label>
                                </td>
                                <td __designer:mapid="1bf">
                                    <asp:Label ID="lblCTCAnn1" runat="server"></asp:Label>
                                </td>
                            </tr>
                            <tr 
                __designer:mapid="f5">
                                <td __designer:mapid="f6" class="style5">
                                    Education</td>
                                <td 
                __designer:mapid="f7">
                                    5</td>
                                <td __designer:mapid="f8">
                                    <asp:label runat="server" Enabled="False" ID="TxtGEdu"></asp:label>
                                </td>
                                <td __designer:mapid="f8" colspan="2">
                                    <asp:label runat="server"  Enabled="False" ID="TxtANEDU"></asp:label>
                                </td>
                                <td 
                __designer:mapid="fa" colspan="2">
                                    PF-Employee <asp:TextBox ID="txtPFEmployee" runat="server" CssClass="box3" Width="35px">0</asp:TextBox>
                                    <asp:RequiredFieldValidator ID="ReqtxtPFEmployee" runat="server" 
                                        ControlToValidate="txtPFEmployee" ErrorMessage="*" ValidationGroup="B"></asp:RequiredFieldValidator>
                                    <asp:RegularExpressionValidator ID="RegutxtPFEmployee" 
                                        runat="server" ControlToValidate="txtPFEmployee" ErrorMessage="*" 
                                        ValidationExpression="^\d{1,15}(\.\d{0,3})?$" ValidationGroup="B"></asp:RegularExpressionValidator>
                                </td>
                                <td __designer:mapid="17d">
                                    <asp:label runat="server" Enabled="False" ID="TxtGEmpPF"></asp:label>
                                </td>
                                <td 
                __designer:mapid="198" valign="top">
        
        
                                    CTC&nbsp; (With Attd. Bonus - 2)*</td>
                                <td 
                __designer:mapid="198" valign="top">
        
        
                                    <asp:Label ID="lblCTC2" runat="server"></asp:Label>
                                </td>
                                <td 
                __designer:mapid="198" valign="top">
        
        
                                    <asp:Label ID="lblCTCAnn2" runat="server"></asp:Label>
                                </td>
                            </tr>
                            <tr 
                __designer:mapid="fc">
                                <td __designer:mapid="fd" class="style5" height="20">
                                    Medical</td>
                                <td 
                __designer:mapid="fe">
                                    5</td>
                                <td __designer:mapid="ff">
                                    <asp:label runat="server" Enabled="False" ID="TxtGWash"></asp:label>
                                </td>
                                <td __designer:mapid="ff" colspan="2">
                                    <asp:label runat="server" Enabled="False" ID="TxtANWash"></asp:label>
                                </td>
                                <td 
                __designer:mapid="101" colspan="2">
                                    PF-Company&nbsp; <asp:TextBox ID="txtPFCompany" runat="server" CssClass="box3" Width="35px">0</asp:TextBox>
                                    <asp:RequiredFieldValidator ID="ReqtxtPFCompany" runat="server" 
                                        ControlToValidate="txtPFCompany" ErrorMessage="*" ValidationGroup="B"></asp:RequiredFieldValidator>
                                    <asp:RegularExpressionValidator ID="RegutxtPFCompany" 
                                        runat="server" ControlToValidate="txtPFCompany" ErrorMessage="*" 
                                        ValidationExpression="^\d{1,15}(\.\d{0,3})?$" ValidationGroup="B"></asp:RegularExpressionValidator>
                                </td>
                                <td __designer:mapid="17e">
                                    <asp:label runat="server" Enabled="False" ID="TxtGCompPF"></asp:label>
                                </td>
                                <td 
                __designer:mapid="198" valign="top" colspan="3" rowspan="5" width="590px">
        
         <asp:GridView ID="GridView1" runat="server" AutoGenerateColumns="False" 
                                            DataKeyNames="Id" 
                                            CssClass="yui-datatable-theme" Width ="99%" AllowPaging="True" 
                                            PageSize="2" ShowFooter="True" onrowcommand="GridView1_RowCommand" 
                                        onrowupdating="GridView1_RowUpdating" 
                                        onpageindexchanging="GridView1_PageIndexChanging" 
                                        onrowcancelingedit="GridView1_RowCancelingEdit" 
                                        onrowdeleting="GridView1_RowDeleting" onrowediting="GridView1_RowEditing">
                                            <PagerSettings PageButtonCount="20" />
                                            <Columns>
                                                <asp:TemplateField ShowHeader="False">
                                                    <EditItemTemplate>
                                                        <asp:LinkButton ID="LinkButton1" runat="server" CausesValidation="True" 
                                                            CommandName="Update" Text="Update"></asp:LinkButton>
                                                        &nbsp; <asp:LinkButton ID="LinkButton2" runat="server" CausesValidation="False" 
                                                            CommandName="Cancel" Text="Cancel"></asp:LinkButton>
                                                    </EditItemTemplate>
                                                    <ItemTemplate>
                                                        <asp:LinkButton ID="LinkButton2" runat="server" CausesValidation="False" 
                                                            CommandName="Edit" Text="Edit"></asp:LinkButton>
                                                        &nbsp; <asp:LinkButton ID="LinkButton3" runat="server" CausesValidation="False" 
                                                            CommandName="Delete" Text="Delete"></asp:LinkButton>
                                                    </ItemTemplate>
                                                    
                                                     
                                                      <ItemStyle Width="15%" />
                                                </asp:TemplateField>
                                              <%--  <asp:TemplateField ShowHeader="False">
                                                    <ItemTemplate>
                                                        <asp:LinkButton ID="LinkButton1" runat="server" CausesValidation="False" 
                                                            CommandName="Delete" Text="Delete"></asp:LinkButton>
                                                    </ItemTemplate>
                                                
                                                    
                                                </asp:TemplateField>--%>
                                                
                                                 <asp:TemplateField HeaderText="SN">
                                                <ItemTemplate><%# Container.DataItemIndex+1 %></ItemTemplate>
                                                <ItemStyle HorizontalAlign="Right" Width="4%" />                                      
                                                </asp:TemplateField>
                                                
                                                <asp:TemplateField HeaderText="Include In">
                                                  <ItemTemplate>
                                                  <asp:Label ID="lblIncludesInId" runat="server" Text='<%#Eval("IncludesIn")%>' Visible="false"></asp:Label>
                                                  <asp:Label ID="lblIncludesIn" runat="server"></asp:Label></ItemTemplate>
                                                  <FooterTemplate>
                                                    <asp:DropDownList ID="IncludeIn" runat="server" CssClass="box3" DataSourceID="SqlDataSource6" DataTextField="IncludesIn" DataValueField="Id"> </asp:DropDownList> </FooterTemplate>
                                                  </asp:TemplateField>
                                                  
                                                <asp:BoundField DataField="Id" HeaderText="Id" InsertVisible="False" 
                                                    ReadOnly="True" SortExpression="Id" Visible="False">
                                                    <ItemStyle Width="2%" />
                                                </asp:BoundField>
                                            <%--    <asp:BoundField DataField="SessionId" HeaderText="SessionId" 
                                                    SortExpression="SessionId" Visible="False" >
                                                    <ItemStyle Width="2%" />
                                                </asp:BoundField>--%>
                                                <asp:BoundField DataField="MId" HeaderText="MId" SortExpression="MId" 
                                                    Visible="False">
                                                    <ItemStyle Width="2%" />
                                                </asp:BoundField>
                                                
                                                  <asp:TemplateField HeaderText="Perticulars" SortExpression="Perticulars">
                                                      <EditItemTemplate>
                                                       <asp:TextBox ID="txtPerticularsE" Text='<%# Bind("Perticulars") %>'
                                                        Width="90%" runat="server"  CssClass="box3"> 
                                                    </asp:TextBox>
                                                    <asp:RequiredFieldValidator ID="ReqtxtPerticularsE" runat="server"
                                                     ControlToValidate="txtPerticularsE" ValidationGroup="InsE" ErrorMessage="*">
                                                    </asp:RequiredFieldValidator>
                                                      </EditItemTemplate>
                                                      <ItemTemplate>
                                                          <asp:Label ID="Label3" runat="server" Text='<%# Bind("Perticulars") %>'></asp:Label>
                                                      </ItemTemplate>
                                                      
                                                                                                          <FooterTemplate>
                                                    <asp:TextBox ID="txtPerticulars" Width="95%" Text='<%# Bind("Perticulars") %>'
                                                    runat="server"  CssClass="box3"> 
                                                    </asp:TextBox>
                                                    <asp:RequiredFieldValidator ID="ReqPerticulars" runat="server"
                                                     ControlToValidate="txtPerticulars" ValidationGroup="Ins" ErrorMessage="*">
                                                    </asp:RequiredFieldValidator>
                                                    </FooterTemplate>
                                                      <ItemStyle Width="30%" />
                                                </asp:TemplateField>
                                                <asp:TemplateField HeaderText="Qty" SortExpression="Qty">
                                                    <EditItemTemplate>
                                                 <asp:TextBox ID="txtAccQtyE" runat="server" CssClass="box3" Width="70%" Text='<%# Bind("Qty") %>'> 
                                                      </asp:TextBox>
                                    <asp:RequiredFieldValidator ID="RequiredtxtAccQtyE" runat="server" 
                                        ControlToValidate="txtAccQtyE" ErrorMessage="*" ValidationGroup="InsE"></asp:RequiredFieldValidator>
                                    <asp:RegularExpressionValidator ID="RegulartxtAccQtyE" 
                                        runat="server" ControlToValidate="txtAccQtyE" ErrorMessage="*" 
                                        ValidationExpression="^\d{1,15}(\.\d{0,3})?$" ValidationGroup="InsE"></asp:RegularExpressionValidator>
                                                    </EditItemTemplate>
                                                    <ItemTemplate>
                                                        <asp:Label ID="Label1" runat="server" Text='<%# Bind("Qty") %>'></asp:Label>
                                                    </ItemTemplate>
                                                     <FooterTemplate>
                                                     <asp:TextBox ID="txtAccQty" runat="server" CssClass="box3" Width="75%"> </asp:TextBox>
                                    <asp:RequiredFieldValidator ID="RequiredtxtAccQty" runat="server" 
                                        ControlToValidate="txtAccQty" ErrorMessage="*" ValidationGroup="Ins"></asp:RequiredFieldValidator>
                                    <asp:RegularExpressionValidator ID="RegulartxtAccQty" 
                                        runat="server" ControlToValidate="txtAccQty" ErrorMessage="*" 
                                        ValidationExpression="^\d{1,15}(\.\d{0,3})?$" ValidationGroup="Ins"></asp:RegularExpressionValidator>
                                                     </FooterTemplate>
                                                    
                                                    <ItemStyle Width="13%" HorizontalAlign="Right" />
                                                    
                                                </asp:TemplateField>
                                                <asp:TemplateField HeaderText="Amount" SortExpression="Amount">
                                                    <EditItemTemplate>
                                              <asp:TextBox ID="txtAccAmountE" runat="server" CssClass="box3"  Text='<%# Bind("Amount") %>'
                                               Width="70%">
                                                       </asp:TextBox>
                                    <asp:RequiredFieldValidator ID="RequiredtxtAccAmountE" runat="server" 
                                        ControlToValidate="txtAccAmountE" ErrorMessage="*" ValidationGroup="InsE"></asp:RequiredFieldValidator>
                                    <asp:RegularExpressionValidator ID="RegulartxtAccAmountE" 
                                        runat="server" ControlToValidate="txtAccAmountE" ErrorMessage="*" 
                                        ValidationExpression="^\d{1,15}(\.\d{0,3})?$" ValidationGroup="InsE"></asp:RegularExpressionValidator>
                                                    </EditItemTemplate>
                                                    <ItemTemplate>
                                                        <asp:Label ID="Label2" runat="server" Text='<%# Bind("Amount") %>'></asp:Label>
                                                    </ItemTemplate>
                                                    
                                                      <FooterTemplate>
                                                     <asp:TextBox ID="txtAccAmount" runat="server" CssClass="box3" Width="75%"> </asp:TextBox>
                                    <asp:RequiredFieldValidator ID="RequiredtxtAccAmount" runat="server" 
                                        ControlToValidate="txtAccAmount" ErrorMessage="*" ValidationGroup="Ins"></asp:RequiredFieldValidator>
                                    <asp:RegularExpressionValidator ID="RegulartxtAccAmount" 
                                        runat="server" ControlToValidate="txtAccAmount" ErrorMessage="*" 
                                        ValidationExpression="^\d{1,15}(\.\d{0,3})?$" ValidationGroup="Ins"></asp:RegularExpressionValidator>
                                                     </FooterTemplate>
                                                    
                                                    <ItemStyle Width="12%" HorizontalAlign="Right" />
                                                    
                                                </asp:TemplateField>
                                                
                                                  <asp:TemplateField HeaderText="Total" SortExpression="Total">
                                                      <EditItemTemplate>
                                          <asp:Label ID="LabTot" runat="server" Text='<%# Bind("Total") %>'></asp:Label>
                                         <%-- <asp:TextBox ID="txtAccTotalE" runat="server" Text='<%# Bind("Total") %>' CssClass="box3"> 
                                         </asp:TextBox> --%>
                                                           
                                                      </EditItemTemplate>
                                                      <ItemTemplate>
                                                          <asp:Label ID="Label4" runat="server" Text='<%# Bind("Total") %>'></asp:Label>
                                                      </ItemTemplate>
                                                      <FooterTemplate>
                                                    <asp:Button ID="btnInsert" runat="server" CommandName="Add" ValidationGroup="Ins" 
                                                    OnClientClick=" return confirmationAdd() " CssClass="redbox"  Width="40px"
                                                    Text="Insert" />
                                                    </FooterTemplate>
                                                      <ItemStyle HorizontalAlign="Right" Width="10%" />
                                                </asp:TemplateField>
                                            </Columns>


                                            <EmptyDataTemplate>
                                            <table  width="100%" border="1" style="border-color:Gray">
                                            <tr>
                                             <td align="center">
                                              <asp:Label ID="SN" Font-Bold="true" Font-Size="Medium" Font-Names="Times New Roman" 
                                            runat="server" Text="SN"></asp:Label></td>
                                            <td align="center">
                                            IncludeIn
                                            </td>
                                            <td align="center">
                                            <asp:Label ID="Label1" Font-Bold="true" Font-Size="Medium" Font-Names="Times New Roman" 
                                            runat="server" Text="Perticulars"></asp:Label></td>

                                            <td align="center">
                                            <asp:Label ID="Label2" runat="server" Font-Size="Medium" Font-Names="Times New Roman" 
                                             Font-Bold="true" Text="Qty"></asp:Label>
                                             </td>
                                             <td align="center">
                                            <asp:Label ID="Label4" runat="server" Font-Size="Medium" Font-Names="Times New Roman" 
                                             Font-Bold="true" Text="Amount"></asp:Label>
                                             </td>
                                             

                                            </tr>
                                            <tr>
                                            
                                            <td style="width:60px">
                                            <asp:Button ID="btnInsert" runat="server" CommandName="Add1" ValidationGroup="Ins1"
                                             OnClientClick=" return confirmationAdd() " CssClass="redbox" Text="Insert" />
                                            </td>
<td>
<asp:DropDownList ID="IncludeIn0" runat="server" CssClass="box3" DataSourceID="SqlDataSource6" DataTextField="IncludesIn" DataValueField="Id"> </asp:DropDownList>
</td>
                                            <td style="width:300px">
                                            <asp:TextBox ID="txtPerticulars1"  Width="90%" runat="server" CssClass="box3"></asp:TextBox>
                                              
                                                    <asp:RequiredFieldValidator ID="ReqPerticulars1" runat="server"
                                                     ControlToValidate="txtPerticulars1" ValidationGroup="Ins1" ErrorMessage="*">
                                                    </asp:RequiredFieldValidator>
                                            </td>
                                            <td style="width:100px">
                                            <asp:TextBox ID="txtAccQty1" runat="server" CssClass="box3" Width="70%"></asp:TextBox>                
                                    <asp:RequiredFieldValidator ID="RequiredtxtAccQty1" runat="server" 
                                        ControlToValidate="txtAccQty1" ErrorMessage="*" ValidationGroup="Ins1"></asp:RequiredFieldValidator>
                                    <asp:RegularExpressionValidator ID="RegulartxtAccQty1" 
                                        runat="server" ControlToValidate="txtAccQty1" ErrorMessage="*" 
                                        ValidationExpression="^\d{1,15}(\.\d{0,3})?$" ValidationGroup="Ins1"></asp:RegularExpressionValidator>
                                            
                                            </td>
                                            <td style="width:100px">
                                            <asp:TextBox ID="txtAccAmount1" runat="server" CssClass="box3" Width="70%"></asp:TextBox>
                                       
                                    <asp:RequiredFieldValidator ID="RequiredtxtAccAmount1" runat="server" 
                                        ControlToValidate="txtAccAmount1" ErrorMessage="*" ValidationGroup="Ins1"></asp:RequiredFieldValidator>
                                    <asp:RegularExpressionValidator ID="RegulartxtAccAmount1" 
                                        runat="server" ControlToValidate="txtAccAmount1" ErrorMessage="*" 
                                        ValidationExpression="^\d{1,15}(\.\d{0,3})?$" ValidationGroup="Ins1"></asp:RegularExpressionValidator>
                                            </td>
                                            </tr>
                                            </table>

                                            </EmptyDataTemplate>        
                                            
                                            
                                            
                                        </asp:GridView>
        
        </td>
                            </tr>
                            <tr 
                __designer:mapid="103">
                                <td __designer:mapid="104" class="style5" height="20">
                                    Attend Bonus - 1</td>
                                <td 
                __designer:mapid="105" >
                                    <asp:TextBox ID="txtAttB1" runat="server" CssClass="box3" Width="35px">0</asp:TextBox>
                                    <asp:RequiredFieldValidator ID="RequiredFieldValidator22" runat="server" 
                                        ControlToValidate="txtAttB1" ErrorMessage="*" ValidationGroup="B"></asp:RequiredFieldValidator>
                                    <asp:RegularExpressionValidator ID="RegularExpressionValidator12" 
                                        runat="server" ControlToValidate="txtAttB1" ErrorMessage="*" 
                                        ValidationExpression="^\d{1,15}(\.\d{0,3})?$" ValidationGroup="B"></asp:RegularExpressionValidator>
                                </td>
                                <td __designer:mapid="106">
                                    <asp:label runat="server" Enabled="False" ID="TxtGATTBN1"></asp:label>
                                </td>
                                <td __designer:mapid="106" colspan="2">
                                    &nbsp;</td>
                                <td __designer:mapid="108" colspan="2">
                                    P. Tax</td>
                                <td 
                __designer:mapid="17f">
                                    <asp:label runat="server" Enabled="False" ID="TxtGPTax"></asp:label>
                                </td>
                            </tr>
                            <tr 
                __designer:mapid="10f">
                                <td class="style5" __designer:mapid="110" height="20">
                                    Attend Bonus - 2</td>
                                <td 
                __designer:mapid="111">
                                    <asp:TextBox ID="txtAttB2" runat="server" CssClass="box3" Width="35px">0</asp:TextBox>
                                    <asp:RequiredFieldValidator ID="RequiredFieldValidator23" runat="server" 
                                        ControlToValidate="txtAttB2" ErrorMessage="*" ValidationGroup="B"></asp:RequiredFieldValidator>
                                    <asp:RegularExpressionValidator ID="RegularExpressionValidator13" 
                                        runat="server" ControlToValidate="txtAttB2" ErrorMessage="*" 
                                        ValidationExpression="^\d{1,15}(\.\d{0,3})?$" ValidationGroup="B"></asp:RegularExpressionValidator>
                                </td>
                                <td __designer:mapid="112" >
                                    <asp:label runat="server" Enabled="False" ID="TxtGATTBN2"></asp:label>
                                </td>
                                <td __designer:mapid="112" colspan="2" >
                                    &nbsp;</td>
                                <td __designer:mapid="114" colspan="2">
                                    &nbsp;</td>
                                <td 
                __designer:mapid="181">
                                    &nbsp;</td>
                            </tr>
                            <tr 
                __designer:mapid="115">
                                <td class="style5" __designer:mapid="116">
                                    Bonus</td>
                                <td 
                align="left" __designer:mapid="117">
                                    &nbsp;</td>
                                <td 
                align="left" __designer:mapid="117" colspan="2">
                                    <asp:TextBox ID="txtBonus" runat="server" CssClass="box3" Width="50px">0</asp:TextBox>
                                    <asp:RequiredFieldValidator ID="RequiredFieldValidator21" runat="server" 
                                        ControlToValidate="txtBonus" ErrorMessage="*" ValidationGroup="B"></asp:RequiredFieldValidator>
                                    <asp:RegularExpressionValidator ID="RegularExpressionValidator14" 
                                        runat="server" ControlToValidate="txtBonus" ErrorMessage="*" 
                                        ValidationExpression="^\d{1,15}(\.\d{0,3})?$" ValidationGroup="B"></asp:RegularExpressionValidator>
                                </td>
                                <td 
                align="left" __designer:mapid="117">
                                    <asp:label runat="server" Enabled="False" ID="TxtAnnBonus"></asp:label>
                                </td>
                                <td 
                align="left" __designer:mapid="117">
                                    &nbsp;</td>
                                <td 
                align="left" __designer:mapid="117" colspan="2">
                                    &nbsp;</td>
                            </tr>
                            <tr 
                __designer:mapid="115">
                                <td class="style5" __designer:mapid="116">
                                    Gratuity</td>
                                <td 
                align="left" __designer:mapid="117">
                                    &nbsp;</td>
                                <td 
                align="left" __designer:mapid="117" colspan="2">
                                    <asp:Label ID="lblGratuaty" runat="server"></asp:Label>
                                </td>
                                <td 
                align="left" __designer:mapid="117">
                                    <asp:label runat="server" Enabled="False" ID="TxtAnnGratuaty"></asp:label>
                                </td>
                                <td 
                align="left" __designer:mapid="117">
                                    &nbsp;</td>
                                <td 
                align="left" __designer:mapid="117" colspan="2">
                                    &nbsp;</td>
                            </tr>
                            </table>
                    </td>
                </tr>
                <tr 
        >
                    <td colspan="5" height="30" valign="middle">
        
        
            Remarks <asp:TextBox runat="server" CssClass="box3" ID="TxtRemarks" Width="400px"></asp:TextBox>
                                &nbsp;
                                    <asp:Button runat="server" Text="Calculate" ValidationGroup="B" CssClass="redbox" 
                            ID="ButtonSubmit" OnClick="ButtonSubmit_Click"></asp:Button>
                                    &nbsp;
                                    <asp:Button runat="server" Text="Update" ValidationGroup="A" CssClass="redbox" 
                ID="BtnSubmit" OnClick="BtnSubmit_Click"></asp:Button>
                                    &nbsp;   
                                    <asp:Button runat="server" Text="Increment" ValidationGroup="A" CssClass="redbox" 
                ID="BtnIncrement" OnClick="BtnIncrement_Click"></asp:Button>
                                  &nbsp;
                                    <asp:Button ID="Button1" runat="server" CssClass="redbox" 
                                        onclick="Button1_Click" Text="Cancel" />
                                &nbsp; <asp:Label runat="server" Font-Bold="True" ForeColor="#FF3300" ID="Label2"></asp:Label>
        
        
        
                        <asp:SqlDataSource runat="server" 
                            ConnectionString="<%$ ConnectionStrings:LocalSqlServer %>" 
                            SelectCommand="SELECT * FROM [tblHR_EmpType]" ID="SqlDataSource4">
                        </asp:SqlDataSource>
        <asp:SqlDataSource ID="SqlDataSource6" runat="server" 
                        ConnectionString="<%$ ConnectionStrings:LocalSqlServer %>" 
                        SelectCommand="SELECT * FROM [tblHR_IncludesIn]"></asp:SqlDataSource>
        
        
                    </td>
                </tr>
            </table>
        
        
        
          </td>
        
        </tr>
        
        </table>
</asp:Content>
<asp:Content ID="Content8" ContentPlaceHolderID="ContentPlaceHolder4" Runat="Server">
</asp:Content>



=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/HR/Transactions/OfferLetter_Edit_Details.aspx.cs ===

ï»¿using System;
using System.Collections;
using System.Configuration;
using System.Data;
using System.Linq;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Xml.Linq;
using System.Data.SqlClient;
using System.Web.Mail;

public partial class Module_HR_Transactions_OfferLetter_Edit_Details : System.Web.UI.Page
{
    clsFunctions fun = new clsFunctions();
    DataSet DS = new DataSet();

    int CompId = 0;
    int FinYearId = 0;
    string OfferId = string.Empty ;
    string valDrpEmpTypeOf = string.Empty;
    string valDrpEmpType = string.Empty;
    string SessionId = string.Empty;
    int OI = 0;

    protected void Page_Load(object sender, EventArgs e)
    {
        try
        {
            string connStr = fun.Connection();
            SqlConnection con = new SqlConnection(connStr);
            con.Open();

            CompId = Convert.ToInt32(Session["compid"]);
            FinYearId = Convert.ToInt32(Session["finyear"]);
            OfferId = Request.QueryString["offid"];
            SessionId = Session["Username"].ToString();
            OI =Convert.ToInt32(Request.QueryString["OI"]);
            lblOfferId.Text = OfferId;
          
            if (!IsPostBack)
            {
                Label2.Text = "";
                if (Request.QueryString["msg"] != null)
                {
                    Label2.Text = Request.QueryString["msg"].ToString();
                }

                if (OI == 0)
                {
                    lblOfferIncrement.Text = "Offer Letter - Edit";
                    BtnSubmit.Visible = true;
                    BtnIncrement.Visible = false;
                }
                else
                {
                    lblOfferIncrement.Text = "Increment Letter";
                    BtnSubmit.Visible = false;
                    BtnIncrement.Visible = true;
                }

                this.FillAccegrid();

                string sql = fun.select("*", "tblHR_Offer_Master", "OfferId='" + OfferId + "'");
                SqlCommand cmd = new SqlCommand(sql, con);
                SqlDataAdapter da = new SqlDataAdapter(cmd);
                DataSet ds = new DataSet();
                da.Fill(ds);

                if (ds.Tables[0].Rows.Count > 0)
                {

                    DrpDesignation.SelectedValue = ds.Tables[0].Rows[0]["Designation"].ToString();
                    DrpDutyHrs.SelectedValue = ds.Tables[0].Rows[0]["DutyHrs"].ToString();
                    DrpOTHrs.SelectedValue = ds.Tables[0].Rows[0]["OTHrs"].ToString();
                    DrpOvertime.SelectedValue = ds.Tables[0].Rows[0]["OverTime"].ToString();
                    DrpTitle.SelectedValue = ds.Tables[0].Rows[0]["Title"].ToString();
                    DrpEmpType.SelectedValue = ds.Tables[0].Rows[0]["StaffType"].ToString();
                    DrpEmpTypeOf.SelectedValue = ds.Tables[0].Rows[0]["TypeOf"].ToString();
                    TxtName.Text = ds.Tables[0].Rows[0]["EmployeeName"].ToString();
                    TxtContactNo.Text = ds.Tables[0].Rows[0]["ContactNo"].ToString();
                    TxtAddress.Text = ds.Tables[0].Rows[0]["Address"].ToString();
                    TxtEmail.Text = ds.Tables[0].Rows[0]["EmailId"].ToString();
                    TxtReferencedby.Text = ds.Tables[0].Rows[0]["ReferenceBy"].ToString();
                    TxtGrossSalry.Text = ds.Tables[0].Rows[0]["salary"].ToString();
                    txtHeader.Text = ds.Tables[0].Rows[0]["HeaderText"].ToString();
                    txtFooter.Text = ds.Tables[0].Rows[0]["FooterText"].ToString();
                    TxtRemarks.Text = ds.Tables[0].Rows[0]["Remarks"].ToString();

                    string sql2 = fun.select("Title+' '+EmployeeName+' ['+EmpId+']' as Name", "tblHR_OfficeStaff", "EmpId='" + ds.Tables[0].Rows[0]["InterviewedBy"].ToString() + "'");
                    SqlCommand cmd2 = new SqlCommand(sql2, con);
                    SqlDataAdapter da2 = new SqlDataAdapter(cmd2);
                    DataSet ds2 = new DataSet();
                    da2.Fill(ds2);

                    if (ds2.Tables[0].Rows.Count > 0)
                    {
                        Txtinterviewedby.Text = ds2.Tables[0].Rows[0]["Name"].ToString();
                    }

                    string sql3 = fun.select("Title+' '+EmployeeName +' ['+EmpId+']' as Name", "tblHR_OfficeStaff", "EmpId='" + ds.Tables[0].Rows[0]["AuthorizedBy"].ToString() + "'");
                    SqlCommand cmd3 = new SqlCommand(sql3, con);
                    SqlDataAdapter da3 = new SqlDataAdapter(cmd3);
                    DataSet ds3 = new DataSet();
                    da3.Fill(ds3);

                    if (ds3.Tables[0].Rows.Count > 0)
                    {
                        TxtAuthorizedby.Text = ds3.Tables[0].Rows[0]["Name"].ToString();
                    }

                    txtBonus.Text = ds.Tables[0].Rows[0]["Bonus"].ToString();
                    txtAttB1.Text = ds.Tables[0].Rows[0]["AttBonusPer1"].ToString();
                    txtAttB2.Text = ds.Tables[0].Rows[0]["AttBonusPer2"].ToString();
                    TxtGLTA.Text = ds.Tables[0].Rows[0]["LTA"].ToString();
                    TxtGVehAll.Text = ds.Tables[0].Rows[0]["VehicleAllowance"].ToString(); 
                    TxtGGratia.Text = ds.Tables[0].Rows[0]["ExGratia"].ToString();
                    TxtAnnLOYAlty.Text = ds.Tables[0].Rows[0]["Loyalty"].ToString();
                    txtPFEmployee.Text = ds.Tables[0].Rows[0]["PFEmployee"].ToString();
                    txtPFCompany.Text = ds.Tables[0].Rows[0]["PFCompany"].ToString();
                    valDrpEmpTypeOf = ds.Tables[0].Rows[0]["TypeOf"].ToString();
                    valDrpEmpType = ds.Tables[0].Rows[0]["StaffType"].ToString();
                    txtIncrementForTheYear.Text = ds.Tables[0].Rows[0]["IncrementForTheYear"].ToString();
                    txtEffectFrom.Text = ds.Tables[0].Rows[0]["EffectFrom"].ToString();

                    if (Convert.ToInt32(ds.Tables[0].Rows[0]["Increment"]) == 0 && OI == 0)
                    {
                        txtHeader.Visible = true;
                        txtFooter.Visible = true;
                    }

                    if (Convert.ToInt32(ds.Tables[0].Rows[0]["Increment"]) == 0 && OI == 1 || Convert.ToInt32(ds.Tables[0].Rows[0]["Increment"]) > 0)
                    {
                        lblEffectFromForTheYeartext.Visible = true;
                        txtIncrementForTheYear.Visible = true;
                        lblIncrementForTheYear.Visible = true;
                        lblEffectFromtext.Visible = true;
                        txtEffectFrom.Visible = true;
                    }
                   
                }
            }
            this.CalSalary(valDrpEmpTypeOf, valDrpEmpType);
            con.Close();
        }
       catch (Exception et)
        {
        }
    }

    //public void CalSalary()
    //{
    //    if (TxtGrossSalry.Text != "")
    //    {
    //        double GrossSalary = Convert.ToDouble(TxtGrossSalry.Text);
    //        double AnSalary = GrossSalary * 12;

    //        TxtGSal.Text = GrossSalary.ToString();
    //        TxtANNualSal.Text = AnSalary.ToString();
    //        TxtGBasic.Text = fun.Offer_Cal(GrossSalary, 1, 1, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
    //        TxtAnBasic.Text = fun.Offer_Cal(GrossSalary, 1, 2, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
    //        TxtGDA.Text = fun.Offer_Cal(GrossSalary, 2, 1, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
    //        TxtAnDA.Text = fun.Offer_Cal(GrossSalary, 2, 2, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
    //        TxtGHRA.Text = fun.Offer_Cal(GrossSalary, 3, 1, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
    //        TxtANHRA.Text = fun.Offer_Cal(GrossSalary, 3, 2, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
    //        TxtGConvenience.Text = fun.Offer_Cal(GrossSalary, 4, 1, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
    //        TxtANConvenience.Text = fun.Offer_Cal(GrossSalary, 4, 2, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
    //        TxtGEdu.Text = fun.Offer_Cal(GrossSalary, 5, 1, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
    //        TxtANEDU.Text = fun.Offer_Cal(GrossSalary, 5, 2, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
    //        TxtGWash.Text = fun.Offer_Cal(GrossSalary, 6, 1, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
    //        TxtANWash.Text = fun.Offer_Cal(GrossSalary, 6, 2, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
    //        double AttBonus1 = 0;
    //        AttBonus1 = GrossSalary * Convert.ToDouble(txtAttB1.Text) / 100;
    //        double AttBonus2 = 0;
    //        AttBonus2 = GrossSalary * Convert.ToDouble(txtAttB2.Text) / 100;

    //        TxtGATTBN1.Text = AttBonus1.ToString();
    //        TxtGATTBN2.Text = AttBonus2.ToString(); 

    //        double pfe = 0;
    //        pfe = fun.Pf_Cal(GrossSalary, 1);
    //        TxtGEmpPF.Text = pfe.ToString();

    //        double pfc = 0;
    //        pfc = fun.Pf_Cal(GrossSalary, 2);
    //        TxtGCompPF.Text = pfc.ToString();

    //        double ptax = 0;
    //        //PTax = Gross + Att. Bonus 1 + Ex Gratia
    //        ptax = fun.PTax_Cal((GrossSalary + fun.Offer_Cal(GrossSalary, 7, 0, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)) + Convert.ToDouble(TxtGGratia.Text)), "0");
    //        TxtGPTax.Text = ptax.ToString();

    //        lblGratuaty.Text = fun.Gratuity_Cal(GrossSalary, 1, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
    //        double Bonus = 0;
    //        Bonus = Convert.ToDouble(txtBonus.Text) * 12;
    //        TxtAnnBonus.Text = Bonus.ToString();
    //        TxtAnnGratuaty.Text = fun.Gratuity_Cal(GrossSalary, 2, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();

    //        double th = 0;
    //        // Gross + ExGratia - PFE+PTax
    //        th = Math.Round((GrossSalary + Convert.ToDouble(TxtGGratia.Text)) - (pfe + ptax));
    //        lblTH.Text = decimal.Parse(th.ToString()).ToString("N2");

    //        double thatt1 = 0;
    //        thatt1 = Math.Round(th + fun.Offer_Cal(GrossSalary, 7, 0, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)));
    //        lblTH1.Text = decimal.Parse(thatt1.ToString()).ToString("N2");

    //        double thatt2 = 0;
    //        thatt2 = Math.Round(th + fun.Offer_Cal(GrossSalary, 8, 0, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)));
    //        lblTH2.Text = decimal.Parse(thatt2.ToString()).ToString("N2");

    //        lblTHAnn.Text = decimal.Parse((Math.Round(th * 12)).ToString()).ToString("N2");
    //        lblTHAnn1.Text = decimal.Parse((Math.Round(thatt1 * 12)).ToString()).ToString("N2");
    //        lblTHAnn2.Text = decimal.Parse((Math.Round(thatt2 * 12)).ToString()).ToString("N2");

    //        double ctc = 0;

    //        ctc = Math.Round(GrossSalary + Convert.ToDouble(TxtAnnLOYAlty.Text) + Convert.ToDouble(TxtGLTA.Text) + fun.Bonus_Cal(GrossSalary, 1) + fun.Gratuity_Cal(GrossSalary, 1, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)) + pfe + Convert.ToDouble(TxtGVehAll.Text) + Convert.ToDouble(TxtGGratia.Text));

    //        lblCTC.Text = decimal.Parse(ctc.ToString()).ToString("N2");

    //        double ctcatt1 = 0;
    //        ctcatt1 = Math.Round(ctc + fun.Offer_Cal(GrossSalary, 7, 0, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)));
    //        lblCTC1.Text = decimal.Parse(ctcatt1.ToString()).ToString("N2");

    //        double ctcatt2 = 0;
    //        ctcatt2 = Math.Round(ctc + fun.Offer_Cal(GrossSalary, 8, 0, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)));
    //        lblCTC2.Text = decimal.Parse(ctcatt2.ToString()).ToString("N2");

    //        lblCTCAnn.Text = decimal.Parse((Math.Round(ctc * 12)).ToString()).ToString("N2");
    //        lblCTCAnn1.Text = decimal.Parse((Math.Round(ctcatt1 * 12)).ToString()).ToString("N2");
    //        lblCTCAnn2.Text = decimal.Parse((Math.Round(ctcatt2 * 12)).ToString()).ToString("N2");
    //    }
    //    else
    //    {
    //        string mystring = string.Empty;
    //        mystring = "Input data is invalid.";
    //        ClientScript.RegisterStartupScript(this.GetType(), "myalert", "alert('" + mystring + "');", true);
    //    }
    //}


    //public void CalSalary()
    //{
    //    if (TxtGrossSalry.Text != "")
    //    {
    //        double GrossSalary = Convert.ToDouble(TxtGrossSalry.Text);
    //        double AnSalary = GrossSalary * 12;

    //        TxtGSal.Text = GrossSalary.ToString();
    //        TxtANNualSal.Text = AnSalary.ToString();
    //        TxtGBasic.Text = fun.Offer_Cal(GrossSalary, 1, 1, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
    //        TxtAnBasic.Text = fun.Offer_Cal(GrossSalary, 1, 2, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
    //        TxtGDA.Text = fun.Offer_Cal(GrossSalary, 2, 1, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
    //        TxtAnDA.Text = fun.Offer_Cal(GrossSalary, 2, 2, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
    //        TxtGHRA.Text = fun.Offer_Cal(GrossSalary, 3, 1, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
    //        TxtANHRA.Text = fun.Offer_Cal(GrossSalary, 3, 2, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
    //        TxtGConvenience.Text = fun.Offer_Cal(GrossSalary, 4, 1, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
    //        TxtANConvenience.Text = fun.Offer_Cal(GrossSalary, 4, 2, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
    //        TxtGEdu.Text = fun.Offer_Cal(GrossSalary, 5, 1, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
    //        TxtANEDU.Text = fun.Offer_Cal(GrossSalary, 5, 2, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
    //        TxtGWash.Text = fun.Offer_Cal(GrossSalary, 6, 1, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
    //        TxtANWash.Text = fun.Offer_Cal(GrossSalary, 6, 2, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
    //        double AttBonus1 = 0;
    //        AttBonus1 = GrossSalary * Convert.ToDouble(txtAttB1.Text) / 100;
    //        double AttBonus2 = 0;
    //        AttBonus2 = GrossSalary * Convert.ToDouble(txtAttB2.Text) / 100;

    //        TxtGATTBN1.Text = AttBonus1.ToString();
    //        TxtGATTBN2.Text = AttBonus2.ToString();

    //        double pfe = 0;
    //        pfe = fun.Pf_Cal(GrossSalary, 1);
    //        TxtGEmpPF.Text = pfe.ToString();

    //        double pfc = 0;
    //        pfc = fun.Pf_Cal(GrossSalary, 2);
    //        TxtGCompPF.Text = pfc.ToString();

    //        double ptax = 0;
    //        //PTax = Gross + Att. Bonus 1 + Ex Gratia
    //        ptax = fun.PTax_Cal((GrossSalary + AttBonus1 + Convert.ToDouble(TxtGGratia.Text)), "0");
    //        TxtGPTax.Text = ptax.ToString();

    //        lblGratuaty.Text = fun.Gratuity_Cal(GrossSalary, 1, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
    //        double Bonus = 0;
    //        Bonus = Convert.ToDouble(txtBonus.Text) * 12;
    //        TxtAnnBonus.Text = Bonus.ToString();
    //        TxtAnnGratuaty.Text = fun.Gratuity_Cal(GrossSalary, 2, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();

    //        double th = 0;
    //        // Gross + ExGratia - PFE+PTax
    //        th = Math.Round((GrossSalary + Convert.ToDouble(TxtGGratia.Text)) - (pfe + ptax));
    //        lblTH.Text = decimal.Parse(th.ToString()).ToString("N2");

    //        double thatt1 = 0;
    //        thatt1 = Math.Round(th + AttBonus1);
    //        lblTH1.Text = decimal.Parse(thatt1.ToString()).ToString("N2");

    //        double thatt2 = 0;
    //        thatt2 = Math.Round(th + AttBonus2);
    //        lblTH2.Text = decimal.Parse(thatt2.ToString()).ToString("N2");

    //        lblTHAnn.Text = decimal.Parse((Math.Round(th * 12)).ToString()).ToString("N2");
    //        lblTHAnn1.Text = decimal.Parse((Math.Round(thatt1 * 12)).ToString()).ToString("N2");
    //        lblTHAnn2.Text = decimal.Parse((Math.Round(thatt2 * 12)).ToString()).ToString("N2");

    //        double ctc = 0;

    //        ctc = Math.Round(GrossSalary + Convert.ToDouble(txtBonus.Text) + Convert.ToDouble(TxtAnnLOYAlty.Text) + Convert.ToDouble(TxtGLTA.Text) + fun.Gratuity_Cal(GrossSalary, 1, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)) + pfc + Convert.ToDouble(TxtGGratia.Text));
    //        lblCTC.Text = decimal.Parse(ctc.ToString()).ToString("N2");

    //        double ctcatt1 = 0;
    //        ctcatt1 = Math.Round(ctc + AttBonus1);
    //        lblCTC1.Text = decimal.Parse(ctcatt1.ToString()).ToString("N2");

    //        double ctcatt2 = 0;
    //        ctcatt2 = Math.Round(ctc + AttBonus2);
    //        lblCTC2.Text = decimal.Parse(ctcatt2.ToString()).ToString("N2");

    //        lblCTCAnn.Text = decimal.Parse((Math.Round(ctc * 12)).ToString()).ToString("N2");
    //        lblCTCAnn1.Text = decimal.Parse((Math.Round(ctcatt1 * 12)).ToString()).ToString("N2");
    //        lblCTCAnn2.Text = decimal.Parse((Math.Round(ctcatt2 * 12)).ToString()).ToString("N2");
    //    }
    //    else
    //    {
    //        string mystring = string.Empty;
    //        mystring = "Input data is invalid.";
    //        ClientScript.RegisterStartupScript(this.GetType(), "myalert", "alert('" + mystring + "');", true);
    //    }
    //}

    public void CalSalary(string valDrpEmpTypeOf1, string valDrpEmpType1)
    {
        try
        {
            string constr = fun.Connection();
            SqlConnection con = new SqlConnection(constr);

            if (TxtGrossSalry.Text != "")
            {
                double GrossSalary = Convert.ToDouble(TxtGrossSalry.Text);
                double AnSalary = GrossSalary * 12;

                TxtGSal.Text = GrossSalary.ToString();
                TxtANNualSal.Text = AnSalary.ToString();

                TxtGBasic.Text = fun.Offer_Cal(GrossSalary, 1, 1, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
                TxtAnBasic.Text = fun.Offer_Cal(GrossSalary, 1, 2, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
                TxtGDA.Text = fun.Offer_Cal(GrossSalary, 2, 1, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
                TxtAnDA.Text = fun.Offer_Cal(GrossSalary, 2, 2, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
                TxtGHRA.Text = fun.Offer_Cal(GrossSalary, 3, 1, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
                TxtANHRA.Text = fun.Offer_Cal(GrossSalary, 3, 2, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
                TxtGConvenience.Text = fun.Offer_Cal(GrossSalary, 4, 1, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
                TxtANConvenience.Text = fun.Offer_Cal(GrossSalary, 4, 2, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
                TxtGEdu.Text = fun.Offer_Cal(GrossSalary, 5, 1, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
                TxtANEDU.Text = fun.Offer_Cal(GrossSalary, 5, 2, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
                TxtGWash.Text = fun.Offer_Cal(GrossSalary, 6, 1, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
                TxtANWash.Text = fun.Offer_Cal(GrossSalary, 6, 2, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();

                double AttBonus1 = 0;
                double AttBonus2 = 0;
                double pfe = 0;
                double pfc = 0;
                double ptax = 0;

                //if (DrpEmpType.SelectedItem.Text != "Select")
                {
                    if (valDrpEmpType1 != "5")
                    {
                        AttBonus1 = GrossSalary * Convert.ToDouble(txtAttB1.Text) / 100;
                        AttBonus2 = GrossSalary * Convert.ToDouble(txtAttB2.Text) / 100;
                        TxtGATTBN1.Text = AttBonus1.ToString();
                        TxtGATTBN2.Text = AttBonus2.ToString();
                        pfe = fun.Pf_Cal(GrossSalary, 1, Convert.ToDouble(txtPFEmployee.Text));
                        TxtGEmpPF.Text = pfe.ToString();
                        pfc = fun.Pf_Cal(GrossSalary, 2, Convert.ToDouble(txtPFCompany.Text));
                        TxtGCompPF.Text = pfc.ToString();
                        //PTax = Gross + Att. Bonus 1 + Ex Gratia
                        ptax = fun.PTax_Cal((GrossSalary + AttBonus1 + Convert.ToDouble(TxtGGratia.Text)), "0");
                        TxtGPTax.Text = ptax.ToString();

                        txtPFEmployee.Enabled = true;
                        txtPFCompany.Enabled = true;
                        txtBonus.Enabled = true;
                        txtAttB1.Enabled = true;
                        txtAttB2.Enabled = true;
                        txtBonus.Enabled = true;

                        //if (DrpEmpTypeOf.SelectedValue == "1")
                        //{
                        //    txtAttB1.Text = "10";
                        //    txtAttB2.Text = "20";
                        //}
                        //else if (DrpEmpTypeOf.SelectedValue == "2")
                        //{
                        //    txtAttB1.Text = "5";
                        //    txtAttB2.Text = "15";
                        //}

                        lblGratuaty.Text = fun.Gratuity_Cal(GrossSalary, 1, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
                        TxtAnnGratuaty.Text = fun.Gratuity_Cal(GrossSalary, 2, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
                    }
                    else
                    {
                        txtBonus.Text = "0";
                        txtBonus.Enabled = false;
                        TxtGATTBN1.Text = "0";
                        txtAttB1.Text = "0";
                        txtAttB1.Enabled = false;
                        TxtGATTBN2.Text = "0";
                        txtAttB2.Text = "0";
                        txtAttB2.Enabled = false;
                        txtBonus.Text = "0";
                        txtBonus.Enabled = false;
                        TxtGEmpPF.Text = "0";
                        TxtGCompPF.Text = "0";
                        txtPFEmployee.Text = "0";
                        txtPFEmployee.Enabled = false;
                        txtPFCompany.Text = "0";
                        txtPFCompany.Enabled = false;
                        TxtGPTax.Text = "0";
                        lblGratuaty.Text = "0";
                        TxtAnnGratuaty.Text = "0";
                    }

                    if (valDrpEmpTypeOf1 == "2")
                    {
                        lblGratuaty.Text = "0";
                        TxtAnnGratuaty.Text = "0";
                    }
                }

                double Bonus = 0;
                Bonus = Convert.ToDouble(txtBonus.Text) * 12;
                TxtAnnBonus.Text = Bonus.ToString();

                // Accessories Amt
                double AccessoriesAmt_CTC = 0;
                double AccessoriesAmt_TakeHome = 0;
                double AccessoriesAmt_Both = 0;
                
                string sql98 = fun.select("*", "tblHR_Offer_Accessories", "MId='" + OfferId + "'");
                SqlCommand cmd98 = new SqlCommand(sql98, con);
                SqlDataAdapter da98 = new SqlDataAdapter(cmd98);
                DataSet ds98 = new DataSet();
                da98.Fill(ds98);

                if (ds98.Tables[0].Rows.Count > 0)
                {
                    for (int h = 0; h < ds98.Tables[0].Rows.Count; h++)
                    {
                        switch (ds98.Tables[0].Rows[h]["IncludesIn"].ToString())
                        {
                            case "1":
                                AccessoriesAmt_CTC += Convert.ToDouble(ds98.Tables[0].Rows[h]["Qty"]) * Convert.ToDouble(ds98.Tables[0].Rows[h]["Amount"]);
                                break;
                            case "2":
                                AccessoriesAmt_TakeHome += Convert.ToDouble(ds98.Tables[0].Rows[h]["Qty"]) * Convert.ToDouble(ds98.Tables[0].Rows[h]["Amount"]);
                                break;
                            case "3":
                                AccessoriesAmt_Both += Convert.ToDouble(ds98.Tables[0].Rows[h]["Qty"]) * Convert.ToDouble(ds98.Tables[0].Rows[h]["Amount"]);
                                break;
                        }
                    }
                }

                double th = 0;

                //Gross + ExGratia - PFE+PTax

                th = Math.Round((GrossSalary + Convert.ToDouble(TxtGGratia.Text) + AccessoriesAmt_TakeHome + AccessoriesAmt_Both) - (pfe + ptax));
                lblTH.Text = decimal.Parse(th.ToString()).ToString("N2");

                double thatt1 = 0;
                thatt1 = Math.Round(th + AttBonus1);
                lblTH1.Text = decimal.Parse(thatt1.ToString()).ToString("N2");

                double thatt2 = 0;
                thatt2 = Math.Round(th + AttBonus2);
                lblTH2.Text = decimal.Parse(thatt2.ToString()).ToString("N2");

                lblTHAnn.Text = decimal.Parse((Math.Round(th * 12)).ToString()).ToString("N2");
                lblTHAnn1.Text = decimal.Parse((Math.Round(thatt1 * 12)).ToString()).ToString("N2");
                lblTHAnn2.Text = decimal.Parse((Math.Round(thatt2 * 12)).ToString()).ToString("N2");

                double ctc = 0;

                ctc = Math.Round(GrossSalary + Convert.ToDouble(txtBonus.Text) + Convert.ToDouble(TxtAnnLOYAlty.Text) + Convert.ToDouble(TxtGLTA.Text) + Convert.ToDouble(lblGratuaty.Text) + pfc + Convert.ToDouble(TxtGGratia.Text)) + AccessoriesAmt_CTC + AccessoriesAmt_Both;

                //fun.Gratuity_Cal(GrossSalary, 1, Convert.ToInt32(DrpEmpTypeOf.SelectedValue))

                lblCTC.Text = decimal.Parse(ctc.ToString()).ToString("N2");

                double ctcatt1 = 0;
                ctcatt1 = Math.Round(ctc + AttBonus1);
                lblCTC1.Text = decimal.Parse(ctcatt1.ToString()).ToString("N2");

                double ctcatt2 = 0;
                ctcatt2 = Math.Round(ctc + AttBonus2);
                lblCTC2.Text = decimal.Parse(ctcatt2.ToString()).ToString("N2");

                lblCTCAnn.Text = decimal.Parse((Math.Round(ctc * 12)).ToString()).ToString("N2");
                lblCTCAnn1.Text = decimal.Parse((Math.Round(ctcatt1 * 12)).ToString()).ToString("N2");
                lblCTCAnn2.Text = decimal.Parse((Math.Round(ctcatt2 * 12)).ToString()).ToString("N2");


            }
            else
            {
                string mystring = string.Empty;
                mystring = "Input data is invalid.";
                ClientScript.RegisterStartupScript(this.GetType(), "myalert", "alert('" + mystring + "');", true);
            }
        }
        catch (Exception ex) { }
    }
    protected void ButtonSubmit_Click(object sender, EventArgs e)
    {
        try
        {
            this.CalSalary(DrpEmpTypeOf.SelectedValue, DrpEmpType.SelectedValue);
        }
        catch (Exception ex)
        {

        }
    }

    //------------------------------- Increment --------------------------------------------------------------------

    protected void BtnIncrement_Click(object sender, EventArgs e)
    {
        string constr = fun.Connection();
        SqlConnection con = new SqlConnection(constr);

          try
        {
            con.Open();

            string CDate = fun.getCurrDate();
            string CTime = fun.getCurrTime();
            string sId = Session["username"].ToString();

            if (txtFooter.Text != "" && txtHeader.Text != "" && TxtGrossSalry.Text != "" && TxtName.Text != "" && TxtAddress.Text != "" && DrpEmpTypeOf.SelectedValue != "0")
            {
                if (txtIncrementForTheYear.Text != "" && txtEffectFrom.Text != "")
                {
                    //-------------------------------In Increment Table ------------------------------------------------------------------


                    string SqlOffer = fun.select("OfferId, SysDate, SysTime, SessionId, CompId, FinYearId, Title, EmployeeName, StaffType, TypeOf, salary, DutyHrs, OTHrs, OverTime, Address, ContactNo, EmailId, InterviewedBy, AuthorizedBy ,ReferenceBy, Designation, ExGratia, VehicleAllowance, LTA , Loyalty, PaidLeaves , Remarks, HeaderText, FooterText, Bonus , AttBonusPer1 , AttBonusPer2, PFEmployee, PFCompany,Increment,IncrementForTheYear,EffectFrom", "tblHR_Offer_Master", "OfferId='" + OfferId + "'");
                    SqlCommand cmdOffer = new SqlCommand(SqlOffer, con);
                    SqlDataAdapter daOffer = new SqlDataAdapter(cmdOffer);
                    DataSet dsOffer = new DataSet();
                    daOffer.Fill(dsOffer);
                    if (dsOffer.Tables[0].Rows.Count > 0)
                    {
                        int Increment = 0;
                        Increment = Convert.ToInt32(dsOffer.Tables[0].Rows[0]["Increment"]) + 1;

                        string StrIncrement = fun.insert("tblHR_Increment_Master", "SysDate, SysTime, SessionId, CompId, FinYearId,OfferId, Title, EmployeeName, StaffType, TypeOf, salary, DutyHrs, OTHrs, OverTime, Address, ContactNo, EmailId, InterviewedBy, AuthorizedBy ,ReferenceBy, Designation, ExGratia, VehicleAllowance, LTA , Loyalty, PaidLeaves , Remarks, HeaderText, FooterText, Bonus , AttBonusPer1 , AttBonusPer2, PFEmployee, PFCompany,Increment,IncrementForTheYear,EffectFrom", "'" + dsOffer.Tables[0].Rows[0]["SysDate"].ToString() + "','" + dsOffer.Tables[0].Rows[0]["SysTime"].ToString() + "','" + dsOffer.Tables[0].Rows[0]["SessionId"].ToString() + "','" + Convert.ToInt32(dsOffer.Tables[0].Rows[0]["CompId"]) + "', '" + Convert.ToInt32(dsOffer.Tables[0].Rows[0]["FinYearId"]) + "','" + Convert.ToInt32(dsOffer.Tables[0].Rows[0]["OfferId"]) + "','" + dsOffer.Tables[0].Rows[0]["Title"].ToString() + "','" + dsOffer.Tables[0].Rows[0]["EmployeeName"].ToString() + "','" + Convert.ToInt32(dsOffer.Tables[0].Rows[0]["StaffType"]) + "','" + Convert.ToInt32(dsOffer.Tables[0].Rows[0]["TypeOf"]) + "','" + Convert.ToDouble(dsOffer.Tables[0].Rows[0]["salary"]) + "','" + Convert.ToDouble(dsOffer.Tables[0].Rows[0]["DutyHrs"]) + "','" + Convert.ToDouble(dsOffer.Tables[0].Rows[0]["OTHrs"]) + "','" + Convert.ToInt32(dsOffer.Tables[0].Rows[0]["OverTime"]) + "','" + dsOffer.Tables[0].Rows[0]["Address"].ToString() + "','" + dsOffer.Tables[0].Rows[0]["ContactNo"].ToString() + "','" + dsOffer.Tables[0].Rows[0]["EmailId"].ToString() + "','" + dsOffer.Tables[0].Rows[0]["InterviewedBy"].ToString() + "','" + dsOffer.Tables[0].Rows[0]["AuthorizedBy"].ToString() + "','" + dsOffer.Tables[0].Rows[0]["ReferenceBy"].ToString() + "','" + Convert.ToInt32(dsOffer.Tables[0].Rows[0]["Designation"]) + "','" + Convert.ToDouble(dsOffer.Tables[0].Rows[0]["ExGratia"]) + "','" + Convert.ToDouble(dsOffer.Tables[0].Rows[0]["VehicleAllowance"]) + "','" + Convert.ToDouble(dsOffer.Tables[0].Rows[0]["LTA"]) + "','" + Convert.ToDouble(dsOffer.Tables[0].Rows[0]["Loyalty"]) + "','" + Convert.ToDouble(dsOffer.Tables[0].Rows[0]["PaidLeaves"]) + "','" + dsOffer.Tables[0].Rows[0]["Remarks"].ToString() + "','" + dsOffer.Tables[0].Rows[0]["HeaderText"] + "','" + dsOffer.Tables[0].Rows[0]["FooterText"] + "','" + Convert.ToDouble(dsOffer.Tables[0].Rows[0]["Bonus"]) + "','" + Convert.ToDouble(dsOffer.Tables[0].Rows[0]["AttBonusPer1"]) + "','" + Convert.ToDouble(dsOffer.Tables[0].Rows[0]["AttBonusPer2"]) + "','" + Convert.ToDouble(dsOffer.Tables[0].Rows[0]["PFEmployee"]) + "','" + Convert.ToDouble(dsOffer.Tables[0].Rows[0]["PFCompany"]) + "','" + Convert.ToDouble(dsOffer.Tables[0].Rows[0]["Increment"]) + "','" + dsOffer.Tables[0].Rows[0]["IncrementForTheYear"].ToString() + "','" + dsOffer.Tables[0].Rows[0]["EffectFrom"].ToString() + "'");
                        SqlCommand cmdIncrement = new SqlCommand(StrIncrement, con);
                        cmdIncrement.ExecuteNonQuery();

                        string strp = fun.select("Id", "tblHR_Increment_Master", "CompId='" + CompId + "' order by Id DESC");
                        SqlCommand cmdp = new SqlCommand(strp, con);
                        SqlDataAdapter dap = new SqlDataAdapter(cmdp);
                        DataSet dsp = new DataSet();
                        dap.Fill(dsp, "tblHR_Increment_Master");
                        int MId = 0;
                        if (dsp.Tables[0].Rows.Count > 0)
                        {
                            MId = Convert.ToInt32(dsp.Tables[0].Rows[0]["Id"]);
                            string SqlOfferAcc = fun.select("Id, MId, Perticulars, Qty, Amount, IncludesIn ", "tblHR_Offer_Accessories", "MId='" + OfferId + "'");
                            SqlCommand cmdOfferAcc = new SqlCommand(SqlOfferAcc, con);
                            SqlDataAdapter daOfferAcc = new SqlDataAdapter(cmdOfferAcc);
                            DataSet dsOfferAcc = new DataSet();
                            daOfferAcc.Fill(dsOfferAcc);
                            for (int i = 0; i < dsOfferAcc.Tables[0].Rows.Count; i++)
                            {
                                string StrIncrementAcc = fun.insert("tblHR_Increment_Accessories", "MId , OfferMId , Perticulars, Qty, Amount, IncludesIn ", "'" + MId + "','" + Convert.ToInt32(dsOfferAcc.Tables[0].Rows[i]["MId"]) + "','" + dsOfferAcc.Tables[0].Rows[i]["Perticulars"] + "','" + Convert.ToDouble(dsOfferAcc.Tables[0].Rows[i]["Qty"]) + "','" + Convert.ToDouble(dsOfferAcc.Tables[0].Rows[i]["Amount"]) + "','" + Convert.ToInt32(dsOfferAcc.Tables[0].Rows[i]["IncludesIn"]) + "'");
                                SqlCommand cmdIncrementAcc = new SqlCommand(StrIncrementAcc, con);
                                cmdIncrementAcc.ExecuteNonQuery();

                            }
                        }

                        //-------------------------------In Offer Letter Table -----------------------------------------------------------

                        string strInsert = fun.update("tblHR_Offer_Master", "SysDate='" + CDate + "',SysTime='" + CTime + "',SessionId='" + sId + "',Title='" + DrpTitle.SelectedValue + "',EmployeeName='" + TxtName.Text + "',TypeOf='" + DrpEmpTypeOf.SelectedValue + "',StaffType='" + DrpEmpType.SelectedValue + "',salary='" + TxtGrossSalry.Text + "',DutyHrs='" + DrpDutyHrs.SelectedValue + "',OTHrs='" + DrpOTHrs.SelectedValue + "',OverTime='" + DrpOvertime.SelectedValue + "',Address='" + TxtAddress.Text + "',ContactNo='" + TxtContactNo.Text + "',EmailId='" + TxtEmail.Text + "',InterviewedBy='" + fun.getCode(Txtinterviewedby.Text) + "',AuthorizedBy='" + fun.getCode(TxtAuthorizedby.Text) + "',ReferenceBy='" + TxtReferencedby.Text + "',Designation='" + DrpDesignation.SelectedValue + "',ExGratia='" + TxtGGratia.Text + "',VehicleAllowance='" + TxtGVehAll.Text + "',LTA='" + TxtGLTA.Text + "',Loyalty='" + TxtAnnLOYAlty.Text + "',PaidLeaves='" + TxtAnnpaidleaves.Text + "',HeaderText='" + txtHeader.Text + "',FooterText='" + txtFooter.Text + "',Remarks='" + TxtRemarks.Text + "',Bonus='" + txtBonus.Text + "',AttBonusPer1='" + txtAttB1.Text + "',AttBonusPer2='" + txtAttB2.Text + "',PFEmployee='" + txtPFEmployee.Text + "',PFCompany='" + txtPFCompany.Text + "',Increment='" + Increment + "',IncrementForTheYear='" + txtIncrementForTheYear.Text + "',EffectFrom='" + txtEffectFrom.Text + "'", "OfferId='" + OfferId + "'");

                        SqlCommand cmd1 = new SqlCommand(strInsert, con);
                        cmd1.ExecuteNonQuery();
                        string sql95 = fun.delete("tblHR_Offer_Accessories_Temp", "SessionId='" + SessionId + "'");
                        SqlCommand cmd95 = new SqlCommand(sql95, con);
                        cmd95.ExecuteNonQuery();
                        con.Close();

                        //------------------------------- Send Mail--------------------------------------------------------------------
                        MailMessage msg = new MailMessage();
                        string ErpMail = "";
                        string EmailId = string.Empty;
                        string ChangeBy = string.Empty;
                        string EmployeeName = string.Empty;
                        string sql21 = "";
                        sql21 = fun.select("Title+'. '+EmployeeName+' ['+EmpId+']' as ChengedByName", "tblHR_OfficeStaff", " CompId='" + CompId + "' And FinYearId<='" + FinYearId + "'   And EmpId='" + sId + "'");
                        SqlCommand cmd21 = new SqlCommand(sql21, con);
                        SqlDataAdapter DA21 = new SqlDataAdapter(cmd21);
                        DataSet DS21 = new DataSet();
                        DA21.Fill(DS21);
                        if (DS21.Tables[0].Rows.Count > 0)
                        {
                            ChangeBy = DS21.Tables[0].Rows[0]["ChengedByName"].ToString();
                        }
                        string sql3 = fun.select("Title+'. '+EmployeeName +' ['+EmpId+']' as EmpName", "tblHR_OfficeStaff", "OfferId='" + OfferId + "'");
                        SqlCommand cmd3 = new SqlCommand(sql3, con);
                        SqlDataAdapter da3 = new SqlDataAdapter(cmd3);
                        DataSet ds3 = new DataSet();
                        da3.Fill(ds3);

                        if (ds3.Tables[0].Rows.Count > 0)
                        {
                            EmployeeName = ds3.Tables[0].Rows[0]["EmpName"].ToString();
                        }
                        string sqlmailserverip = fun.select("MailServerIp,ErpSysmail", "tblCompany_master", "CompId = '" + CompId + "'");
                        SqlCommand cmd4 = new SqlCommand(sqlmailserverip, con);
                        SqlDataAdapter da4 = new SqlDataAdapter(cmd4);
                        DataSet ds4 = new DataSet();
                        da4.Fill(ds4);
                        if (ds4.Tables[0].Rows.Count > 0)
                        {
                            SmtpMail.SmtpServer = ds4.Tables[0].Rows[0]["MailServerIp"].ToString();
                            ErpMail = ds4.Tables[0].Rows[0]["ErpSysmail"].ToString();
                        }
                        msg.From = ErpMail;
                        msg.To = "shridhar@sapl.com";
                       // msg.To = "dhananjay@sapl.com,narendra@sapl.com,meera@sapl.com";
                       // msg.Bcc = "ashish@sapl.com,shridhar@sapl.com,kumar@sapl.com,shrikrishna@sapl.com";
                        msg.Subject = "Increment Letter";
                        msg.Body = "  The Increment Letter of " + EmployeeName + " is generated by " + ChangeBy + ".<br><br><br><br>This is Auto generated mail by ERP system, please do not reply.<br><br> Thank you.";
                        msg.BodyFormat = MailFormat.Html;
                        SmtpMail.Send(msg);

                        //------------------------------------------------------------------------------------------------------------------

                        Response.Redirect("OfferLetter_Edit.aspx?ModId=12&SubModId=25&msg=Employee data is updated.");
                    }
                }
                else
                {
                    string mystring = string.Empty;
                    mystring = "Please fill increment year or effect date properly.";                  
                    ClientScript.RegisterStartupScript(this.GetType(), "myalert", "alert('" + mystring + "');", true);
                }
            }
            else
            {
                string mystring = string.Empty;
                mystring = "Please fill Data properly.";
                ClientScript.RegisterStartupScript(this.GetType(), "myalert", "alert('" + mystring + "');", true);
            }
        }
          catch (Exception ex)
        {
        }
    }



    protected void BtnSubmit_Click(object sender, EventArgs e)
    {
        string constr = fun.Connection();
        SqlConnection con = new SqlConnection(constr);

        try
        {
            con.Open();

            string CDate = fun.getCurrDate();
            string CTime = fun.getCurrTime();
            string sId = Session["username"].ToString();

            if (txtFooter.Text != "" && txtHeader.Text != "" && TxtGrossSalry.Text != "" && TxtName.Text != "" && TxtAddress.Text != "" && DrpEmpTypeOf.SelectedValue != "0")
            {
                string strInsert = fun.update("tblHR_Offer_Master", "SysDate='" + CDate + "',SysTime='" + CTime + "',SessionId='" + sId + "',Title='" + DrpTitle.SelectedValue + "',EmployeeName='" + TxtName.Text + "',TypeOf='" + DrpEmpTypeOf.SelectedValue + "',StaffType='" + DrpEmpType.SelectedValue + "',salary='" + TxtGrossSalry.Text + "',DutyHrs='" + DrpDutyHrs.SelectedValue + "',OTHrs='" + DrpOTHrs.SelectedValue + "',OverTime='" + DrpOvertime.SelectedValue + "',Address='" + TxtAddress.Text + "',ContactNo='" + TxtContactNo.Text + "',EmailId='" + TxtEmail.Text + "',InterviewedBy='" + fun.getCode(Txtinterviewedby.Text) + "',AuthorizedBy='" + fun.getCode(TxtAuthorizedby.Text) + "',ReferenceBy='" + TxtReferencedby.Text + "',Designation='" + DrpDesignation.SelectedValue + "',ExGratia='" + TxtGGratia.Text + "',VehicleAllowance='" + TxtGVehAll.Text + "',LTA='" + TxtGLTA.Text + "',Loyalty='" + TxtAnnLOYAlty.Text + "',PaidLeaves='" + TxtAnnpaidleaves.Text + "',HeaderText='" + txtHeader.Text + "',FooterText='" + txtFooter.Text + "',Remarks='" + TxtRemarks.Text + "',Bonus='" + txtBonus.Text + "',AttBonusPer1='" + txtAttB1.Text + "',AttBonusPer2='" + txtAttB2.Text + "',PFEmployee='" + txtPFEmployee.Text + "',PFCompany='" + txtPFCompany.Text + "',IncrementForTheYear='" + txtIncrementForTheYear.Text + "',EffectFrom='" + txtEffectFrom.Text + "'", "OfferId='" + OfferId + "'");

                SqlCommand cmd1 = new SqlCommand(strInsert, con);
                cmd1.ExecuteNonQuery();
                string sql95 = fun.delete("tblHR_Offer_Accessories_Temp", "SessionId='" + SessionId + "'");
                SqlCommand cmd95 = new SqlCommand(sql95, con);
                cmd95.ExecuteNonQuery();
                con.Close();

                //------------------------------- Send Mail--------------------------------------------------------------------

                MailMessage msg = new MailMessage();
                string ErpMail = "";
                string EmailId = string.Empty;
                string ChangeBy = string.Empty;
                string EmployeeName = string.Empty;
                string sql21 = "";
                sql21 = fun.select("Title+'. '+EmployeeName+' ['+EmpId+']' as ChengedByName", "tblHR_OfficeStaff", " CompId='" + CompId + "' And FinYearId<='" + FinYearId + "'   And EmpId='" + sId + "'");
                SqlCommand cmd21 = new SqlCommand(sql21, con);
                SqlDataAdapter DA21 = new SqlDataAdapter(cmd21);
                DataSet DS21 = new DataSet();
                DA21.Fill(DS21);
                if (DS21.Tables[0].Rows.Count > 0)
                {
                    ChangeBy = DS21.Tables[0].Rows[0]["ChengedByName"].ToString();
                }
                string sql3 = fun.select("Title+'. '+EmployeeName +' ['+EmpId+']' as EmpName", "tblHR_OfficeStaff", "OfferId='" + OfferId + "'");
                SqlCommand cmd3 = new SqlCommand(sql3, con);
                SqlDataAdapter da3 = new SqlDataAdapter(cmd3);
                DataSet ds3 = new DataSet();
                da3.Fill(ds3);

                if (ds3.Tables[0].Rows.Count > 0)
                {
                    EmployeeName = ds3.Tables[0].Rows[0]["EmpName"].ToString();
                }
                string sqlmailserverip = fun.select("MailServerIp,ErpSysmail", "tblCompany_master", "CompId = '" + CompId + "'");
                SqlCommand cmd4 = new SqlCommand(sqlmailserverip, con);
                SqlDataAdapter da4 = new SqlDataAdapter(cmd4);
                DataSet ds4 = new DataSet();
                da4.Fill(ds4);
    
                if (ds4.Tables[0].Rows.Count > 0)
                {
                    SmtpMail.SmtpServer = ds4.Tables[0].Rows[0]["MailServerIp"].ToString();
                    ErpMail = ds4.Tables[0].Rows[0]["ErpSysmail"].ToString();
                }
                msg.From = ErpMail;
                msg.To = "dhananjay@sapl.com,narendra@sapl.com,meera@sapl.com";
                msg.Bcc = "ashish@sapl.com,shridhar@sapl.com,kumar@sapl.com,shrikrishna@sapl.com";
                msg.Subject = "Offer Letter Change";
                msg.Body = "  The Offer Letter of " + EmployeeName + " is Changed/updated by " + ChangeBy + ".<br><br><br><br>This is Auto generated mail by ERP system, please do not reply.<br><br> Thank you.";
                msg.BodyFormat = MailFormat.Html;
                SmtpMail.Send(msg);

                //----------------------------------------------------------------------------------------------------------------------

                Response.Redirect("OfferLetter_Edit.aspx?ModId=12&SubModId=25&msg=Employee data is updated.");
            }
            else
            {
                string mystring = string.Empty;
                mystring = "Please fill Data properly.";
                ClientScript.RegisterStartupScript(this.GetType(), "myalert", "alert('" + mystring + "');", true);
            }
        }
        catch (Exception ex)
        {
        }
    }
    [System.Web.Services.WebMethodAttribute(), System.Web.Script.Services.ScriptMethodAttribute()]

    public static string[] GetCompletionList(string prefixText, int count, string contextKey)
    {
        clsFunctions fun = new clsFunctions();
        string connStr = fun.Connection();
        DataSet ds = new DataSet();
        SqlConnection con = new SqlConnection(connStr);
        con.Open();
        int CompId = Convert.ToInt32(HttpContext.Current.Session["compid"]);
        string cmdStr = fun.select("EmpId,EmployeeName", "tblHR_OfficeStaff", "CompId='" + CompId + "'");
        SqlDataAdapter da = new SqlDataAdapter(cmdStr, con);
        da.Fill(ds, "tblHR_OfficeStaff");
        con.Close();
        string[] main = new string[0];
        for (int i = 0; i < ds.Tables[0].Rows.Count; i++)
        {
            if (ds.Tables[0].Rows[i].ItemArray[1].ToString().ToLower().StartsWith(prefixText.ToLower()))
            {
                Array.Resize(ref main, main.Length + 1);
                main[main.Length - 1] = ds.Tables[0].Rows[i].ItemArray[1].ToString() + " [" + ds.Tables[0].Rows[i].ItemArray[0].ToString() + "]";
                if (main.Length == 10)
                    break;
            }
        }
        Array.Sort(main);
        return main;
    }
    
    protected void DrpEmpTypeOf_SelectedIndexChanged(object sender, EventArgs e)
    {
        if (DrpEmpTypeOf.SelectedValue == "1")
        {
            txtAttB1.Text = "10";
            txtAttB2.Text = "20";
        }
        else if (DrpEmpTypeOf.SelectedValue == "2")
        {
            txtAttB1.Text = "5";
            txtAttB2.Text = "15";
        }

        this.CalSalary(DrpEmpTypeOf.SelectedValue, DrpEmpType.SelectedValue);
    }

    protected void Button1_Click(object sender, EventArgs e)
    {
        Response.Redirect("OfferLetter_Edit.aspx?ModId=12&SubModId=25");
    }

    public void FillAccegrid()
    {
        try
        {
            string connStr = fun.Connection();
            SqlConnection con = new SqlConnection(connStr);
            DataTable dt = new DataTable();
            string sql = fun.select("[Id],[MId],[Perticulars],[Qty],[Amount],Round(([Qty]*[Amount]),2)As Total,IncludesIn", "tblHR_Offer_Accessories", "MId='" + OfferId + "' Order by Id DESC");
            SqlCommand cmd = new SqlCommand(sql, con);
            SqlDataAdapter da = new SqlDataAdapter(cmd);
            DataSet ds = new DataSet();
            da.Fill(ds);
            GridView1.DataSource = ds;
            GridView1.DataBind();

            foreach (GridViewRow grv in GridView1.Rows)
            {
                string id = ((Label)grv.FindControl("lblIncludesInId")).Text;
                string sql1 = fun.select("*", "tblHR_IncludesIn", "Id='" + id + "'");

                SqlCommand cmd1 = new SqlCommand(sql1, con);
                SqlDataAdapter da1 = new SqlDataAdapter(cmd1);
                DataSet ds1 = new DataSet();
                da1.Fill(ds1);
                ((Label)grv.FindControl("lblIncludesIn")).Text = ds1.Tables[0].Rows[0]["IncludesIn"].ToString();
            }


        }
        catch (Exception ex) { }
    }

    protected void GridView1_RowCommand(object sender, GridViewCommandEventArgs e)
    {
        try
        {
            string connStr = fun.Connection();
            SqlConnection con = new SqlConnection(connStr);

            string SId = Session["username"].ToString();
            if (e.CommandName == "Add")
            {
                string strPerticulars = string.Empty;
                double strAccQty = 0;
                double strAccAmount = 0;
                string IncludeIn = string.Empty; 

                if (((TextBox)GridView1.FooterRow.FindControl("txtPerticulars")).Text != "" && ((TextBox)GridView1.FooterRow.FindControl("txtAccAmount")).Text != "" && ((TextBox)GridView1.FooterRow.FindControl("txtAccQty")).Text != "" && fun.NumberValidationQty(((TextBox)GridView1.FooterRow.FindControl("txtAccAmount")).Text) == true && fun.NumberValidationQty(((TextBox)GridView1.FooterRow.FindControl("txtAccQty")).Text) == true)
                {

                    strPerticulars = ((TextBox)GridView1.FooterRow.FindControl("txtPerticulars")).Text;
                    strAccQty = Convert.ToDouble(decimal.Parse(((TextBox)GridView1.FooterRow.FindControl("txtAccQty")).Text).ToString("N2"));
                    strAccAmount = Convert.ToDouble(decimal.Parse(((TextBox)GridView1.FooterRow.FindControl("txtAccAmount")).Text).ToString("N2"));
                    IncludeIn = ((DropDownList)GridView1.FooterRow.FindControl("IncludeIn")).SelectedValue;
                    string insert = fun.insert("tblHR_Offer_Accessories", "MId,Perticulars,Qty,Amount,IncludesIn", "'" + OfferId + "','" + strPerticulars + "','" + strAccQty + "','" + strAccAmount + "','" + IncludeIn + "'");

                    SqlCommand cmd = new SqlCommand(insert, con);
                    con.Open();
                    cmd.ExecuteNonQuery();
                    con.Close();
                    this.FillAccegrid();
                }

            }
            else if (e.CommandName == "Add1")
            {

                string strPerticulars1 = string.Empty;
                double strAccQty1 = 0;
                double strAccAmount1 = 0;
                string IncludeIn = string.Empty; 

                if (((TextBox)GridView1.Controls[0].Controls[0].FindControl("txtPerticulars1")).Text != "" && ((TextBox)GridView1.Controls[0].Controls[0].FindControl("txtAccAmount1")).Text != "" && ((TextBox)GridView1.Controls[0].Controls[0].FindControl("txtAccQty1")).Text != "" && fun.NumberValidationQty(((TextBox)GridView1.Controls[0].Controls[0].FindControl("txtAccAmount1")).Text) == true && fun.NumberValidationQty(((TextBox)GridView1.Controls[0].Controls[0].FindControl("txtAccQty1")).Text) == true)
                {

                    strPerticulars1 = ((TextBox)GridView1.Controls[0].Controls[0].FindControl("txtPerticulars1")).Text;
                    strAccQty1 = Convert.ToDouble(decimal.Parse(((TextBox)GridView1.Controls[0].Controls[0].FindControl("txtAccQty1")).Text).ToString("N2"));
                    strAccAmount1 = Convert.ToDouble(decimal.Parse(((TextBox)GridView1.Controls[0].Controls[0].FindControl("txtAccAmount1")).Text).ToString("N2"));
                    IncludeIn = ((DropDownList)GridView1.Controls[0].Controls[0].FindControl("IncludeIn0")).SelectedValue;
                    string insert1 = fun.insert("tblHR_Offer_Accessories", "MId,Perticulars,Qty,Amount,IncludesIn", "'" + OfferId + "','" + strPerticulars1 + "','" + strAccQty1 + "','" + strAccAmount1 + "','" + IncludeIn + "'");
                    SqlCommand cmd1 = new SqlCommand(insert1, con);
                    con.Open();
                    cmd1.ExecuteNonQuery();
                    con.Close();
                    this.FillAccegrid();
                }

            }

            this.CalSalary(DrpEmpTypeOf.SelectedValue, DrpEmpType.SelectedValue);
        }
        catch (Exception ex)
        {
        }
    }

    protected void GridView1_RowUpdating(object sender, GridViewUpdateEventArgs e)
    {

        try
        {
            string connStr = fun.Connection();
            SqlConnection con = new SqlConnection(connStr);

            DataSet ds = new DataSet();
            int rowIndex = GridView1.EditIndex;
            GridViewRow row = GridView1.Rows[rowIndex];
            int id = Convert.ToInt32(GridView1.DataKeys[e.RowIndex].Value);
            string strPerticularsE = string.Empty;
            double strAccQtyE = 0;
            double strAccAmountE = 0;

            if (((TextBox)row.FindControl("txtPerticularsE")).Text != "" && ((TextBox)row.FindControl("txtAccAmountE")).Text != "" && ((TextBox)row.FindControl("txtAccQtyE")).Text != "" && fun.NumberValidationQty(((TextBox)row.FindControl("txtAccAmountE")).Text) == true && fun.NumberValidationQty(((TextBox)row.FindControl("txtAccQtyE")).Text) == true)
            {
                strPerticularsE = ((TextBox)row.FindControl("txtPerticularsE")).Text;
                strAccQtyE = Convert.ToDouble(decimal.Parse(((TextBox)row.FindControl("txtAccQtyE")).Text).ToString("N2"));
                strAccAmountE = Convert.ToDouble(decimal.Parse(((TextBox)row.FindControl("txtAccAmountE")).Text).ToString("N2"));
                string UpDateStr = fun.update("tblHR_Offer_Accessories", "[MId] ='" + OfferId + "', [Perticulars] ='" + strPerticularsE + "',[Qty]='" + strAccQtyE + "',[Amount] = " + strAccAmountE + "", "Id ='" + id + "'");
                SqlCommand cmd = new SqlCommand(UpDateStr, con);
                con.Open();
                cmd.ExecuteNonQuery();
                con.Close();
                GridView1.EditIndex = -1;
                this.FillAccegrid();
                this.CalSalary(DrpEmpTypeOf.SelectedValue, DrpEmpType.SelectedValue);
            }

        }
        catch (Exception ex) { }
    }

    protected void GridView1_RowDeleting(object sender, GridViewDeleteEventArgs e)
    {
        try
        {
            string connStr = fun.Connection();
            SqlConnection con = new SqlConnection(connStr);

            int id = Convert.ToInt32(GridView1.DataKeys[e.RowIndex].Value);
            SqlCommand cmd = new SqlCommand(fun.delete("tblHR_Offer_Accessories", "Id='" + id + "'"), con);
            con.Open();
            cmd.ExecuteNonQuery();
            con.Close();
            this.FillAccegrid();
            this.CalSalary(DrpEmpTypeOf.SelectedValue, DrpEmpType.SelectedValue);
        }
        catch (Exception er) { }
    }

    protected void GridView1_PageIndexChanging(object sender, GridViewPageEventArgs e)
    {
        GridView1.PageIndex = e.NewPageIndex;
        GridView1.EditIndex = -1;
        this.FillAccegrid();
        this.CalSalary(DrpEmpTypeOf.SelectedValue, DrpEmpType.SelectedValue);
    }

    protected void GridView1_RowEditing(object sender, GridViewEditEventArgs e)
    {
        GridView1.EditIndex = e.NewEditIndex;
        this.FillAccegrid();
        this.CalSalary(DrpEmpTypeOf.SelectedValue, DrpEmpType.SelectedValue);
    }

    protected void GridView1_RowCancelingEdit(object sender, GridViewCancelEditEventArgs e)
    {
        GridView1.EditIndex = -1;
        this.FillAccegrid();
        this.CalSalary(DrpEmpTypeOf.SelectedValue, DrpEmpType.SelectedValue);
    }

    protected void DrpEmpType_SelectedIndexChanged(object sender, EventArgs e)
    {
        try
        {
            string constr = fun.Connection();
            SqlConnection con = new SqlConnection(constr);

            double GrossSalary = Convert.ToDouble(TxtGrossSalry.Text);
            double AnSalary = GrossSalary * 12;

            if (DrpEmpType.SelectedItem.Text != "Casuals")
            {
                txtPFEmployee.Enabled = true;
                txtPFCompany.Enabled = true;
                txtBonus.Enabled = true;
                txtAttB1.Enabled = true;
                txtAttB2.Enabled = true;
                txtBonus.Enabled = true;

                string sql = fun.select("*", "tblHR_PF_Slab", "Active=1");
                SqlCommand cmd = new SqlCommand(sql, con);
                SqlDataAdapter da = new SqlDataAdapter(cmd);
                DataSet ds = new DataSet();
                da.Fill(ds);

                txtPFEmployee.Text = ds.Tables[0].Rows[0]["PFEmployee"].ToString();
                txtPFCompany.Text = ds.Tables[0].Rows[0]["PFCompany"].ToString();

                if (DrpEmpTypeOf.SelectedValue == "1")
                {
                    txtAttB1.Text = "10";
                    txtAttB2.Text = "20";
                }
                else if (DrpEmpTypeOf.SelectedValue == "2")
                {
                    txtAttB1.Text = "5";
                    txtAttB2.Text = "15";
                }

                lblGratuaty.Text = fun.Gratuity_Cal(GrossSalary, 1, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
                TxtAnnGratuaty.Text = fun.Gratuity_Cal(GrossSalary, 2, Convert.ToInt32(DrpEmpTypeOf.SelectedValue)).ToString();
            }
            else
            {
                txtBonus.Text = "0";
                txtBonus.Enabled = false;
                TxtGATTBN1.Text = "0";
                txtAttB1.Text = "0";
                txtAttB1.Enabled = false;
                TxtGATTBN2.Text = "0";
                txtAttB2.Text = "0";
                txtAttB2.Enabled = false;
                txtBonus.Text = "0";
                txtBonus.Enabled = false;
                TxtGEmpPF.Text = "0";
                TxtGCompPF.Text = "0";
                txtPFEmployee.Text = "0";
                txtPFEmployee.Enabled = false;
                txtPFCompany.Text = "0";
                txtPFCompany.Enabled = false;
                TxtGPTax.Text = "0";
                lblGratuaty.Text = "0";
                TxtAnnGratuaty.Text = "0";
            }

            this.CalSalary(DrpEmpTypeOf.SelectedValue, DrpEmpType.SelectedValue);
        }
        catch (Exception ex) { }
    }
}
