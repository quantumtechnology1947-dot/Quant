=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/HR/Transactions/AuthorizeGatePass.aspx.txt ===

﻿<%@ Page Language="C#" MasterPageFile="~/MasterPage.master" AutoEventWireup="true" CodeFile="AuthorizeGatePass.aspx.cs" Inherits="Module_HR_Transactions_AuthorizeGatePass" Title="ERP" Theme="Default" %>

<%@ Register assembly="AjaxControlToolkit" namespace="AjaxControlToolkit" tagprefix="cc1" %>

<asp:Content ID="Content1" ContentPlaceHolderID="head" Runat="Server">
    <link href="../../../Css/yui-datatable.css" rel="stylesheet" type="text/css" />
    <link href="../../../Css/StyleSheet.css" rel="stylesheet" type="text/css" />
    <script src="../../../Javascript/PopUpMsg.js" type="text/javascript"></script>
    <script src="../../../Javascript/loadingNotifier.js" type="text/javascript"></script>
    </asp:Content>
<asp:Content ID="Content2" ContentPlaceHolderID="cp3" Runat="Server">
</asp:Content>
<asp:Content ID="Content3" ContentPlaceHolderID="cp1" Runat="Server">
</asp:Content>
<asp:Content ID="Content4" ContentPlaceHolderID="cp2" Runat="Server"> 
</asp:Content>
<asp:Content ID="Content5" ContentPlaceHolderID="MainContent" Runat="Server">
</asp:Content>
<asp:Content ID="Content6" ContentPlaceHolderID="ContentPlaceHolder2" Runat="Server">
</asp:Content>
<asp:Content ID="Content7" ContentPlaceHolderID="ContentPlaceHolder3" Runat="Server">
 
   
   
   
   <table align="left" cellpadding="0" cellspacing="0" width="100%">
        <tr>
            <td height="20" align="left" valign="middle"  scope="col" class="fontcsswhite" 
                style="background:url(../../../images/hdbg.JPG)">
        &nbsp;<b>GatePass - Authorize</b></td>
        </tr>
        <tr ><td align="left" valign="middle" height="25">
                From Date: <asp:TextBox ID="txtFromDate" CssClass="box3" runat="server" 
                    Width="80px"></asp:TextBox>
                <cc1:CalendarExtender ID="txtFromDate_CalendarExtender" runat="server" CssClass="cal_Theme2" PopupPosition="BottomLeft"
                            Enabled="True" Format="dd-MM-yyyy" TargetControlID="txtFromDate">
                        </cc1:CalendarExtender>
                To Date: <asp:TextBox ID="txtToDate" CssClass="box3" runat="server" Width="80px"></asp:TextBox>
                <cc1:CalendarExtender ID="txtToDate_CalendarExtender" runat="server"  CssClass="cal_Theme2" PopupPosition="BottomLeft"
                            Enabled="True" Format="dd-MM-yyyy" TargetControlID="txtToDate">
                </cc1:CalendarExtender>
        
           
                       
                       
                           
                            Employee Name&nbsp; &nbsp;<asp:TextBox ID="txtEmpName" runat="server" 
                                CssClass="box3"  Width="150px"></asp:TextBox>
                            <cc1:AutoCompleteExtender ID="txtEmpName_AutoCompleteExtender" runat="server" 
                                DelimiterCharacters="" Enabled="True" ServiceMethod="GetCompletionList" 
                                ServicePath="" TargetControlID="txtEmpName" UseContextKey="True"
                                 CompletionInterval="100" CompletionSetCount="2" FirstRowSelected="True" MinimumPrefixLength="1" ShowOnlyCurrentWordInCompletionListItem="True" CompletionListItemCssClass="bg" CompletionListHighlightedItemCssClass="bgtext" CompletionListCssClass="almt">
                            </cc1:AutoCompleteExtender>
                            &nbsp;&nbsp;<asp:Button ID="Button1" runat="server" CssClass="redbox" onclick="Button1_Click" Text="Search" />
                        &nbsp;<asp:Button ID="Check" runat="server" CommandName="check" CssClass="redbox" 
                                onclick="Check_Click" OnClientClick=" return confirmation()" Text="Authorize" />
                        &nbsp;</td>
                       
                    </tr>
        
        <tr>
        <td valign="top">
<table align="left" cellpadding="0" 
            cellspacing="0" width="100%" style="height: 162px">
                            
                <tr>
        <td width="35%" valign="top">
         <asp:Panel ID="Panel1" runat="server"  ScrollBars="Auto"  Height="430px"  >
         
          <asp:GridView ID="GridView2" CssClass="yui-datatable-theme" runat="server" 
                    Width="98%" PageSize="20"
                    onpageindexchanging="GridView2_PageIndexChanging"  onrowcommand="GridView2_RowCommand" 
                   AutoGenerateColumns="False" DataKeyNames="Id"  >
                   
                    <PagerSettings PageButtonCount="40" />
                   
                    <Columns>
                        <asp:TemplateField HeaderText="SN" ItemStyle-HorizontalAlign="Right">
                <ItemTemplate><%#Container.DataItemIndex+1%></ItemTemplate>             
                <HeaderStyle Font-Size="10pt" />
                <ItemStyle HorizontalAlign="Right" VerticalAlign="Top" Width="4%"/>
                </asp:TemplateField>                       
                        
                      <asp:TemplateField  HeaderText="Id" Visible="false">
                        <ItemTemplate>
                      <asp:Label ID="lblId" runat="server" Text='<%#Eval("Id") %>'></asp:Label>                        
                        </ItemTemplate>
                        </asp:TemplateField>
                     
                         <asp:TemplateField HeaderText="Fin Year">
                         <ItemTemplate>
                        <asp:Label ID="lblFinYear" runat="server" Text='<%#Eval("FinYear") %>'></asp:Label>
                        </ItemTemplate>
                             <ItemStyle HorizontalAlign="Center" Width="15%" />
                        </asp:TemplateField>
                         <asp:TemplateField HeaderText="Date">
                         <ItemTemplate>
                        <asp:Label ID="lblDate" runat="server" Text='<%#Eval("SysDate") %>'></asp:Label>
                        </ItemTemplate>
                             <ItemStyle HorizontalAlign="Center" Width="15%" />
                        </asp:TemplateField>
                          
                        <asp:TemplateField HeaderText="GP No">
                         <ItemTemplate>
                          <asp:LinkButton ID="BtnGPNo" ValidationGroup="A" CommandName="Sel" Text='<%# Bind("GPNo") %>' runat="server"></asp:LinkButton>
                         
                       <asp:Label ID="lblGPNo" runat="server"  Visible="false" Text='<%#Eval("GPNo") %>'></asp:Label>
                        </ItemTemplate>
                             <ItemStyle HorizontalAlign="Center" Width="15%" />
                        </asp:TemplateField>
                         <asp:TemplateField HeaderText="Employee Name">
                         <ItemTemplate>
                        <asp:Label ID="lblEmpName" runat="server" Text='<%#Eval("EmpName") %>'></asp:Label>
                        </ItemTemplate>
                            <ItemStyle HorizontalAlign="Left" Width="40%" />
                        </asp:TemplateField>
                        
                         <asp:TemplateField HeaderText="Authorize" ItemStyle-HorizontalAlign="center">
                                            <ItemTemplate>
                                                <asp:CheckBox ID="CK" runat="server"/>
                                               <asp:Label ID="lblcheck" runat="server" Text='<%# Bind("AuthorizeDate") %>'></asp:Label>
                                            </ItemTemplate>
                                            <ItemStyle HorizontalAlign="Center"></ItemStyle>
                                           
                                        </asp:TemplateField>
                    </Columns>
                    
                     <EmptyDataTemplate>
                    <table width="100%" class="fontcss">
                    <tr>
                    <td align="center">
                    <asp:Label ID="Label1" runat="server"  Text="No data to display !" Font-Size="Larger" ForeColor="maroon">
                    </asp:Label>
                    </td>
                    </tr>
                    </table>
                    </EmptyDataTemplate>
                </asp:GridView>           
             </asp:Panel>
             
             
                    </td>
                    <td valign="top" width="70%">

         <div id="Up" runat="server" >
        
        
          <asp:Panel ID="Panel2" runat="server"  ScrollBars="Auto" Height="430px"  >          
            <asp:GridView ID="GridView3" runat="server"   DataKeyNames="Id"
                                AutoGenerateColumns="False" CssClass="yui-datatable-theme"                                
                                Width="100%" 
                 onpageindexchanging="GridView3_PageIndexChanging" PageSize="20" 
                  onrowcommand="GridView3_RowCommand1">
                                <PagerSettings PageButtonCount="40" />
                                <Columns>
                                    <asp:TemplateField HeaderText="SN">
                                        <ItemTemplate>
                                            <%#Container.DataItemIndex+1 %>
                                        </ItemTemplate>
                                    </asp:TemplateField>
                                    
                                      <asp:TemplateField >
                                        <ItemTemplate>
                             <asp:LinkButton ID="LinkButton1" CommandName="Del" runat="server">Delete</asp:LinkButton>  
                                        </ItemTemplate>
                                        
                                    </asp:TemplateField>
                                    <asp:TemplateField HeaderText="Id" Visible="false">
                                        <ItemTemplate>
                                            <asp:Label ID="lblId" runat="server" Text='<%#Eval("Id") %>'></asp:Label>
                                        </ItemTemplate>
                                        
                                    </asp:TemplateField>
                                    
                                    <asp:TemplateField HeaderText="Date">
                                        <ItemTemplate>
                                            <asp:Label ID="lblDate" runat="server" Text='<%#Eval("FromDate") %>'></asp:Label>
                                        </ItemTemplate>
                                        
                                    </asp:TemplateField>
                                    
                                                             <asp:TemplateField HeaderText="Employee Name">
                         <ItemTemplate>
                        <asp:Label ID="lblEmpName" runat="server" Text='<%#Eval("EmpName") %>'></asp:Label>
                        </ItemTemplate>
                            <ItemStyle HorizontalAlign="Left" Width="22%" />
                        </asp:TemplateField>
                                    <asp:TemplateField HeaderText="Type">
                                        <ItemTemplate>
                                            <asp:Label ID="lblType" runat="server" Text='<%#Eval("Type") %>' ></asp:Label>
                                        </ItemTemplate>
                                        
                                    </asp:TemplateField>
                                    <asp:TemplateField HeaderText="Type Of">
                                        <ItemTemplate>
                                            <asp:Label ID="lblTypeOf" runat="server" Text='<%#Eval("TypeOf") %>'></asp:Label>
                                        </ItemTemplate>
                                        
                                    </asp:TemplateField>
                                    <asp:TemplateField  HeaderText="Type For" >
                                        <ItemTemplate>
                                            <asp:Label ID="lblTypeFor" runat="server" Text='<%#Eval("TypeFor") %>'></asp:Label>
                                        </ItemTemplate>
                                        
                                    </asp:TemplateField>
                                    <asp:TemplateField HeaderText="F Time">
                                        <ItemTemplate>
                                            <asp:Label ID="lblFTime" runat="server"  Text='<%#Eval("FromTime") %>' ></asp:Label>
                                        </ItemTemplate>
                                        
                                    </asp:TemplateField>
                                    <asp:TemplateField HeaderText="T Time">
                                        <ItemTemplate>
                                            <asp:Label ID="lblTTime" runat="server"  Text='<%#Eval("ToTime") %>'></asp:Label>
                                        </ItemTemplate>
                                        
                                    </asp:TemplateField>
                                    <asp:TemplateField HeaderText="Visit Place">
                                        <ItemTemplate>
                                            <asp:Label ID="lblPlace" runat="server" Text='<%#Eval("Place") %>'></asp:Label>
                                        </ItemTemplate>
                                        
                                    </asp:TemplateField>
                                    <asp:TemplateField HeaderText="Contact Person">
                                        <ItemTemplate>
                                            <asp:Label ID="lblContPerson" runat="server" Text='<%#Eval("ContactPerson") %>'></asp:Label>
                                        </ItemTemplate>
                                        
                                    </asp:TemplateField>
                                    <asp:TemplateField HeaderText="Contact No">
                                        <ItemTemplate>
                                            <asp:Label ID="lblContNo" runat="server" Text='<%#Eval("ContactNo") %>'></asp:Label>
                                        </ItemTemplate>
                                        
                                    </asp:TemplateField>
                                    <asp:TemplateField HeaderText="Reason">
                                        <ItemTemplate>
                                            <asp:Label ID="lblReason" runat="server" Text='<%#Eval("Reason") %>'></asp:Label>
                                        </ItemTemplate>
                                        </asp:TemplateField>
                                  
                                </Columns>
                                <EmptyDataTemplate>
                                  <table width="100%" class="fontcss">
                                            <tr>
                                                <td align="center">
                                                    <asp:Label ID="Label1" runat="server"  Text="No data to display !" 
                            Font-Size="Larger" ForeColor="maroon"> </asp:Label>
                                                </td>
                                            </tr>
                                        </table>  
                                </EmptyDataTemplate>
                            </asp:GridView>       
       </asp:Panel>
             </div>

    </td>
    </tr>                    
    </table>
    </td> 


    </tr> 
    
    
    </table>
    
</asp:Content>
<asp:Content ID="Content8" ContentPlaceHolderID="ContentPlaceHolder4" Runat="Server">
</asp:Content>



=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/HR/Transactions/AuthorizeGatePass.aspx.cs ===

﻿using System;
using System.Collections;
using System.Configuration;
using System.Data;
using System.Linq;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Xml.Linq;
using System.Data.SqlClient;
using System.Globalization;

/*
 Modified by & Date
 * Ashish 17.01.14
 * 
 */

public partial class Module_HR_Transactions_AuthorizeGatePass : System.Web.UI.Page
{
    clsFunctions fun = new clsFunctions();

    string sId = "";
    int CompId = 0;  
    string emp = "";
    string CDate = "";
    string CTime = "";
    string FyId = "";
    string d = "";
  
    protected void Page_Load(object sender, EventArgs e)
    {
        string connStr = fun.Connection();
        SqlConnection con = new SqlConnection(connStr);
        con.Open();

        try
        {
            CompId = Convert.ToInt32(Session["compid"]);
            sId = fun.firstchar(Session["username"].ToString());
            CDate = fun.getCurrDate();
            CTime = fun.getCurrTime();
            FyId = Session["finyear"].ToString();

            txtFromDate.Attributes.Add("readonly", "readonly");
            txtToDate.Attributes.Add("readonly", "readonly");

            if (!IsPostBack)
            {
                string x = "";

                if (txtFromDate.Text != string.Empty && txtToDate.Text != string.Empty)
                {
                    x = " And tblGate_Pass.SySDate Between '" + fun.FromDate(txtFromDate.Text) + "' And '" + fun.FromDate(txtToDate.Text) + "' ";
                }
                this.loaddata( emp,x);               
            }
            Up.Visible = true;
        }
        catch (Exception ex)
        {
        }
        finally
        {
            con.Close();
        }
    }
    protected void GridView2_PageIndexChanging(object sender, GridViewPageEventArgs e)
    {
        GridView2.PageIndex = e.NewPageIndex;
        this.loaddata( emp,d);

    }
    public void loaddata(string empid, string DT)
    {
        try
        {
            string connStr = fun.Connection();
            SqlConnection con = new SqlConnection(connStr);
            con.Open();

            string y = "";
            if (txtEmpName.Text != "")
            {
                y = " AND SessionId='" + fun.getCode(txtEmpName.Text) + "'";
            }

            string x = "";

            if (txtFromDate.Text != string.Empty && txtToDate.Text != string.Empty)
            {
                x = " And tblGate_Pass.SySDate Between '" + fun.FromDate(txtFromDate.Text) + "' And '" + fun.FromDate(txtToDate.Text) + "' ";
            }

            string sqlInv = fun.select("*", "tblGate_Pass", "  Authorize='0'  And CompId='" + CompId + "' And FinYearId<='" + FyId + "'" + x + y + "  Order By Id Desc");
            
            SqlCommand cmdInv = new SqlCommand(sqlInv, con);
            SqlDataReader DSInv = cmdInv.ExecuteReader();
            DataTable dt = new DataTable();

            dt.Columns.Add(new System.Data.DataColumn("Id", typeof(int)));
            dt.Columns.Add(new System.Data.DataColumn("FinYear", typeof(string)));
            dt.Columns.Add(new System.Data.DataColumn("EmpName", typeof(string)));
            dt.Columns.Add(new System.Data.DataColumn("AuthorizeDate", typeof(string)));
            dt.Columns.Add(new System.Data.DataColumn("GPNo", typeof(string)));
            dt.Columns.Add(new System.Data.DataColumn("SysDate", typeof(string)));

            DataRow dr;

            while (DSInv.Read())
            {
                dr = dt.NewRow();

                string sql = string.Empty;
                string ckHod = string.Empty;

                int k = 0;
                int j = 0;

                if (DSInv["EmpId"] != DBNull.Value)
                {
                    //sql = fun.select("EmpId,DeptHead", "tblHR_OfficeStaff", " CompId='" + CompId + "' And FinYearId<='" + FyId + "'   And   UserId=(select DeptHead From tblHR_OfficeStaff where EmpId ='" + DSInv["EmpId"].ToString() + "' ) "); 

                    sql = fun.select("EmpId,DeptHead", "tblHR_OfficeStaff", " CompId='" + CompId + "' And FinYearId<='" + FyId + "' AND EmpId ='" + DSInv["EmpId"].ToString() + "'");

                    k = 1;
                }
                else
                {
                    sql = fun.select("EmpId", "tblHR_OfficeStaff", "CompId='" + CompId + "' And FinYearId<='" + FyId + "' And  EmpId ='" + DSInv["SessionId"].ToString() + "'");
                    
                    j = 1;                                       
                }

                SqlCommand cmd = new SqlCommand(sql, con);
                SqlDataReader DS = cmd.ExecuteReader();
                DS.Read();

                if (DS.HasRows == true)
                {   
                    int i = 0;

                    if (sId == "Sapl0001" || sId == "Sapl0002" || sId == "Sapl0003" || sId == "Sapl0205")
                    {
                        i = 1;
                    }
                    else
                    {
                        if (k == 1)
                        {
                            ckHod = fun.select("EmpId", "tblHR_OfficeStaff", "UserID='" + DS["DeptHead"].ToString() + "'");
                            SqlCommand cmdckHod = new SqlCommand(ckHod, con);
                            SqlDataReader DSckHod = cmdckHod.ExecuteReader();
                            DSckHod.Read();

                            if (DSckHod.HasRows == true)
                            {
                                if (DSckHod["EmpId"].ToString() == sId)
                                {
                                    i = 1;
                                }
                            }
                        }

                        if (j == 1)
                        {
                            if (DSInv["SessionId"].ToString() == sId)
                            {
                                i = 1;
                            }
                        }
                    }

                    if(i==1)
                    {
                        string sqlFin = fun.select("FinYear", "tblFinancial_master", "FinYearId='" + DSInv["FinYearId"].ToString() + "'");
                        SqlCommand cmdFinYr = new SqlCommand(sqlFin, con);
                        SqlDataReader DSFin = cmdFinYr.ExecuteReader();
                        DSFin.Read();

                        dr[0] = DSInv["Id"].ToString();
                        dr[1] = DSFin["FinYear"].ToString();

                        string StrEmp = fun.select("Title,EmployeeName", "tblHR_OfficeStaff", "EmpId='" + DSInv["EmpId"].ToString() + "'And CompId='" + CompId + "'");
                        SqlCommand CmdEmp = new SqlCommand(StrEmp, con);
                        SqlDataReader DSEmp = CmdEmp.ExecuteReader();
                        DSEmp.Read();

                        if (DSEmp.HasRows == true)
                        {
                            dr[2] = DSEmp["Title"].ToString() + ". " + DSEmp["EmployeeName"].ToString();
                        }
                        else
                        {
                            string StrEmp2 = fun.select("Title,EmployeeName", "tblHR_OfficeStaff", "EmpId='" + DSInv["SessionId"].ToString() + "'And CompId='" + CompId + "'");
                            SqlCommand CmdEmp2 = new SqlCommand(StrEmp2, con);
                            SqlDataReader DSEmp2 = CmdEmp2.ExecuteReader();
                            DSEmp2.Read();

                            if (DSEmp2.HasRows == true)
                            {
                                dr[2] = DSEmp2["Title"].ToString() + ". " + DSEmp2["EmployeeName"].ToString();
                            }
                        }

                        if (Convert.ToInt32(DSInv["Authorize"]) == 1)
                        {
                            dr[3] = fun.FromDateDMY(DSInv["AuthorizeDate"].ToString());
                        }

                        dr[4] = (DSInv["GPNo"].ToString());
                        dr[5] = fun.FromDateDMY((DSInv["SysDate"].ToString()));

                        dt.Rows.Add(dr);
                        dt.AcceptChanges();
                    }
                }
            }

            GridView2.DataSource = dt;
            GridView2.DataBind();

            foreach (GridViewRow grv in GridView2.Rows)
            {
                if (((Label)grv.FindControl("lblcheck")).Text != "")
                {
                    CheckBox chk = (CheckBox)grv.FindControl("CK");
                    chk.Visible = false;
                }
            }
        }
        catch (Exception ex)
        {

        }
    }
    protected void GridView2_RowCommand(object sender, GridViewCommandEventArgs e)
    {
      try
        {
            if (e.CommandName == "Sel")
            {               
                GridViewRow row = (GridViewRow)(((LinkButton)e.CommandSource).NamingContainer);
                int id = 0;
                id = Convert.ToInt32(((Label)row.FindControl("lblId")).Text);
                ViewState["Id"] = id;
                this.FillGrid();
            }
        }
      catch (Exception es) { }
    }
    public void FillGrid()
    {
        try
        {
            string connStr = fun.Connection();
            SqlConnection con = new SqlConnection(connStr);
            con.Open();

            int Id1 = 0;
            if (!string.IsNullOrEmpty(ViewState["Id"].ToString()))
            {
                Id1 = Convert.ToInt32(ViewState["Id"]);
            }

            string sqlInv = fun.select("*", "tblGatePass_Details", "MId='" + Id1 + "'");
            SqlCommand cmdInv = new SqlCommand(sqlInv, con);
            SqlDataReader DSInv = cmdInv.ExecuteReader();

            DataTable dt = new DataTable();

            dt.Columns.Add(new System.Data.DataColumn("Id", typeof(int)));
            dt.Columns.Add(new System.Data.DataColumn("FromDate", typeof(string)));
            dt.Columns.Add(new System.Data.DataColumn("FromTime", typeof(string)));
            dt.Columns.Add(new System.Data.DataColumn("ToTime", typeof(string)));
            dt.Columns.Add(new System.Data.DataColumn("Place", typeof(string)));
            dt.Columns.Add(new System.Data.DataColumn("ContactPerson", typeof(string)));
            dt.Columns.Add(new System.Data.DataColumn("ContactNo", typeof(string)));
            dt.Columns.Add(new System.Data.DataColumn("Reason", typeof(string)));
            dt.Columns.Add(new System.Data.DataColumn("Type", typeof(string)));
            dt.Columns.Add(new System.Data.DataColumn("TypeOf", typeof(string)));
            dt.Columns.Add(new System.Data.DataColumn("TypeFor", typeof(string)));
            dt.Columns.Add(new System.Data.DataColumn("EmpName", typeof(string)));

            DataRow dr;

            while (DSInv.Read())
            {
                dr = dt.NewRow();

                dr[0] = DSInv["Id"].ToString();
                dr[1] = fun.FromDate(DSInv["FromDate"].ToString());
                dr[2] = DSInv["FromTime"].ToString();
                dr[3] = DSInv["ToTime"].ToString();
                dr[4] = DSInv["Place"].ToString();
                dr[5] = DSInv["ContactPerson"].ToString();
                dr[6] = DSInv["ContactNo"].ToString();
                dr[7] = DSInv["Reason"].ToString();

                string sql = fun.select("*", "tblGatePass_Reason", "Id='" + DSInv["Type"].ToString() + "'");
                SqlCommand cmd = new SqlCommand(sql, con);
                SqlDataReader DS = cmd.ExecuteReader();
                DS.Read();

                dr[8] = (DS["Reason"].ToString());

                string typof = "";
                if (DSInv["TypeOf"].ToString() == "1")
                {
                    typof = "WONo";
                }

                if (DSInv["TypeOf"].ToString() == "2")
                {
                    typof = "Enquiry";
                }

                if (DSInv["TypeOf"].ToString() == "3")
                {
                    typof = "Others";
                }

                dr[9] = typof;
                dr[10] = DSInv["TypeFor"].ToString();

                if (DSInv["EmpId"] != DBNull.Value)
                {
                    string StrEmp = fun.select("Title,EmployeeName", "tblHR_OfficeStaff", "EmpId='" + DSInv["EmpId"].ToString() + "'And CompId='" + CompId + "'");
                    SqlCommand CmdEmp1 = new SqlCommand(StrEmp, con);
                    SqlDataReader DSEmp1 = CmdEmp1.ExecuteReader();
                    DSEmp1.Read();

                    dr[11] = DSEmp1["Title"].ToString() + ". " + DSEmp1["EmployeeName"].ToString();
                }

                else
                {
                    string Str1 = fun.select("EmpId", "tblGate_Pass", "Id='" + Id1 + "'And CompId='" + CompId + "'");
                    SqlCommand Cmd1 = new SqlCommand(Str1, con);
                    SqlDataReader DS1 = Cmd1.ExecuteReader();
                    DS1.Read();

                    string StrEmp = fun.select("Title,EmployeeName", "tblHR_OfficeStaff", "EmpId='" + DS1["EmpId"].ToString() + "'And CompId='" + CompId + "'");
                    SqlCommand CmdEmp1 = new SqlCommand(StrEmp, con);
                    SqlDataReader DSEmp1 = CmdEmp1.ExecuteReader();
                    DSEmp1.Read();

                    dr[11] = DSEmp1["Title"].ToString() + ". " + DSEmp1["EmployeeName"].ToString();
                }

                dt.Rows.Add(dr);
                dt.AcceptChanges();

            }
            GridView3.DataSource = dt;
            GridView3.DataBind();
        }
        catch (Exception ex)
        {

        }
    }
    protected void Button1_Click(object sender, EventArgs e)
    {
        try
        {
            string x = "";

            if (txtFromDate.Text != string.Empty && txtToDate.Text != string.Empty)
            {

                x = " And tblGate_Pass.SySDate Between '" + fun.FromDate(txtFromDate.Text) + "' And '" + fun.FromDate(txtToDate.Text) + "' ";
            }
            string y = "";
            if (txtEmpName.Text != "")
            {
                y = " AND EmpId='" + fun.getCode(txtEmpName.Text) + "'";
            }
            this.loaddata(y, x);
        }
        catch (Exception ex)
        {
        }
    }
    [System.Web.Services.WebMethodAttribute(), System.Web.Script.Services.ScriptMethodAttribute()]
    public static string[] GetCompletionList(string prefixText, int count, string contextKey)
    {

        clsFunctions fun = new clsFunctions();
        string connStr = fun.Connection();
        DataSet ds = new DataSet();
        SqlConnection con = new SqlConnection(connStr);
        int CompId1 = Convert.ToInt32(HttpContext.Current.Session["compid"]);
        con.Open();
        string cmdStr = fun.select("EmpId,EmployeeName", "tblHR_OfficeStaff", "CompId='" + CompId1 + "'");
        SqlDataAdapter da = new SqlDataAdapter(cmdStr, con);
        da.Fill(ds, "tblHR_OfficeStaff");
        con.Close();
        string[] main = new string[0];
        for (int i = 0; i < ds.Tables[0].Rows.Count; i++)
        {
            if (ds.Tables[0].Rows[i].ItemArray[1].ToString().ToLower().StartsWith(prefixText.ToLower()))
            {
                Array.Resize(ref main, main.Length + 1);
                main[main.Length - 1] = ds.Tables[0].Rows[i].ItemArray[1].ToString() + " [" + ds.Tables[0].Rows[i].ItemArray[0].ToString() + "]";
                //if (main.Length == 10)
                //    break;
            }
        }
        Array.Sort(main);
        return main;
    }
    protected void Check_Click(object sender, EventArgs e)
    {
        try
        {
            int i = 0;

            foreach (GridViewRow grv in GridView2.Rows)
            {
                CheckBox chk = (CheckBox)grv.FindControl("CK");

                if (chk.Checked == true)
                {
                    string str = fun.Connection();
                    SqlConnection con = new SqlConnection(str);
                    con.Open();
                    string id = ((Label)grv.FindControl("lblId")).Text;

                    string sql3 = fun.update("tblGate_Pass", "Authorize='1',AuthorizedBy='" + sId + "',AuthorizeDate='" + CDate + "',AuthorizeTime='" + CTime + "'", "CompId='" + CompId + "' AND Id='" + id + "'");
                    SqlCommand cmd3 = new SqlCommand(sql3, con);
                    cmd3.ExecuteNonQuery();
                    con.Close();
                    i++;
                }
            }

            if (i > 0)
            {
                Page.Response.Redirect(Page.Request.Url.ToString(), true);
            }
            else
            {
                string mystring = string.Empty;
                mystring = "No record is found to checked.";
                ClientScript.RegisterStartupScript(this.GetType(), "myalert", "alert('" + mystring + "');", true);
            }
        }
        catch (Exception es)
        {

        }
    }
    protected void GridView3_PageIndexChanging(object sender, GridViewPageEventArgs e)
    {
        GridView2.PageIndex = e.NewPageIndex;
        this.FillGrid();
    }
    protected void GridView3_RowCommand1(object sender, GridViewCommandEventArgs e)
    {
        try
        {
            if (e.CommandName == "Del")
            {
                string connStr = fun.Connection();
                SqlConnection con = new SqlConnection(connStr);
                GridViewRow grv = (GridViewRow)(((LinkButton)e.CommandSource).NamingContainer);
                con.Open();
                string id = ((Label)grv.FindControl("lblId")).Text;
                int Id1 = 0;
                if (!string.IsNullOrEmpty(ViewState["Id"].ToString()))
                {
                    Id1 = Convert.ToInt32(ViewState["Id"]);

                }
                SqlCommand cmd = new SqlCommand(fun.delete("tblGatePass_Details", " Id=" + id + "    "), con);

                cmd.ExecuteNonQuery();
                string sqlInv = fun.select("*", "tblGatePass_Details", "MId='" + Id1 + "'");
                SqlCommand cmdInv = new SqlCommand(sqlInv, con);
                SqlDataReader DSInv = cmdInv.ExecuteReader();
                DSInv.Read();

                if (DSInv.HasRows == false)
                {
                    SqlCommand cmd2 = new SqlCommand(fun.delete("tblGate_Pass", " Id=" + Id1 + "    "), con);
                    cmd2.ExecuteNonQuery();
                }

                con.Close();
                Page.Response.Redirect(Page.Request.Url.ToString(), true);
            }
        }

        catch (Exception ex)
        {

        }
    }
        
}
