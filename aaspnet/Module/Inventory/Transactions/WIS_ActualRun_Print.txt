=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/Inventory/Transactions/WIS_ActualRun_Print.aspx.txt ===

﻿<%@ Page Language="C#" MasterPageFile="~/MasterPage.master" AutoEventWireup="true" CodeFile="WIS_ActualRun_Print.aspx.cs" Inherits="Module_Inventory_Transactions_WIS_ActualRun_Print" Title="ERP" Theme="Default" %>

<%@ Register Assembly="AjaxControlToolkit" Namespace="AjaxControlToolkit" TagPrefix="cc1" %>
<%@ Register assembly="CrystalDecisions.Web, Version=10.5.3700.0, Culture=neutral, PublicKeyToken=692fbea5521e1304" namespace="CrystalDecisions.Web" tagprefix="CR" %>

<asp:Content ID="Content1" ContentPlaceHolderID="head" Runat="Server">
    <link href="../../../Css/yui-datatable.css" rel="stylesheet" type="text/css" />
    <link href="../../../Css/StyleSheet.css" rel="stylesheet" type="text/css" />
<script src="../../../Javascript/loadingNotifier.js" type="text/javascript"></script>
    <script src="../../../Javascript/PopUpMsg.js" type="text/javascript"></script>
</asp:Content>
<asp:Content ID="Content2" ContentPlaceHolderID="cp3" Runat="Server">
</asp:Content>
<asp:Content ID="Content3" ContentPlaceHolderID="cp1" Runat="Server">
</asp:Content>
<asp:Content ID="Content4" ContentPlaceHolderID="cp2" Runat="Server">
</asp:Content>
<asp:Content ID="Content5" ContentPlaceHolderID="MainContent" Runat="Server">
</asp:Content>
<asp:Content ID="Content6" ContentPlaceHolderID="ContentPlaceHolder2" Runat="Server">
</asp:Content>
<asp:Content ID="Content7" ContentPlaceHolderID="ContentPlaceHolder3" Runat="Server">
    <asp:UpdatePanel ID="UpdatePanel1" UpdateMode="Conditional" runat="server">
    <ContentTemplate>
    <table align="left" cellpadding="0" cellspacing="0" width="100%">
        <tr>
            <td  align="left" valign="middle" style="background:url(../../../images/hdbg.JPG)" height="21" class="fontcsswhite"><b>&nbsp;WIS Print</b></td>
        </tr><tr>
        <td>
      
       <cc1:TabContainer ID="TabContainer1" runat="server" ActiveTabIndex="0" 
                    Width="100%" AutoPostBack="True">
                    <cc1:TabPanel runat="server" HeaderText=" Search by WO No " ID="TabPanel1">
                        <HeaderTemplate>
&nbsp;&nbsp; Search by WO No &nbsp;        </HeaderTemplate>
                        
<ContentTemplate>
      
        <table width="100%">
        <tr>
        <td>
        
        
            <asp:DropDownList ID="DrpWOType" runat="server" AutoPostBack="True" 
                CssClass="box3" onselectedindexchanged="DrpWOType_SelectedIndexChanged">
            </asp:DropDownList>
            WONo
            <asp:TextBox ID="TxtWO" runat="server" CssClass="box3"></asp:TextBox>
            <asp:Button ID="Button1" runat="server" CssClass="redbox" 
                onclick="Button1_Click" Text="Search" />
        
        
        </td>
        </tr>        
        <tr>
        <td>       
        
      
                <asp:GridView ID="GridView2" runat="server" CssClass="yui-datatable-theme" 
                    AllowPaging="True" AutoGenerateColumns="False" Width="100%" 
                    onrowcommand="GridView2_RowCommand" 
                    onpageindexchanging="GridView2_PageIndexChanging" PageSize="15">
                    <Columns>
                        <asp:TemplateField HeaderText="SN">
                        <ItemTemplate>
                        <%# Container.DataItemIndex+1 %>
                        </ItemTemplate>
                            <ItemStyle HorizontalAlign="Right" Width="5%" />
                        </asp:TemplateField>                        
                           <asp:TemplateField Visible="False">
                        <ItemTemplate>
                            <asp:Button ID="btnRun" runat="server" CommandName="add" CssClass="redbox" 
                                Text="Dry Run" />
                        </ItemTemplate>
                            <ItemStyle HorizontalAlign="Center" />
                        </asp:TemplateField>                       
                        <asp:TemplateField>
                          <ItemTemplate>
                              <asp:DropDownList ID="drpIssueShortage" runat="server">
                                  <asp:ListItem Selected="True" Text="Transaction wise Issue" Value="0"></asp:ListItem>
                                  <asp:ListItem Text="Issue List" Value="1"></asp:ListItem>
                                  <asp:ListItem Text="Shortage List" Value="2"></asp:ListItem>
                              </asp:DropDownList>
                            </ItemTemplate>
                            <ItemStyle HorizontalAlign="Center" />                        
                        </asp:TemplateField> 
                        <asp:TemplateField>
                        <ItemTemplate>
                        <asp:Button  ID="btnView" CommandName="view" runat="server"  Text="View" CssClass="redbox" />
                        </ItemTemplate>
                            <ItemStyle HorizontalAlign="Center" Width="7%" />
                        </asp:TemplateField>
                        <asp:TemplateField HeaderText="Id" Visible="False">
                            <ItemTemplate>
                            <asp:Label ID="lblId" runat="server" Text='<%#Eval("Id") %>' />
                            </ItemTemplate>
                            <ItemStyle HorizontalAlign="Center" />
                        </asp:TemplateField>
                        <asp:TemplateField HeaderText="WO No">
                            <ItemTemplate>
                            <asp:Label ID="lblwono" runat="server" Text='<%#Eval("WONo") %>' />
                            </ItemTemplate>
                            <ItemStyle HorizontalAlign="Center" Width="10%" />
                        </asp:TemplateField>
                        <asp:TemplateField HeaderText="Date">
                            <ItemTemplate>
                            <asp:Label ID="lbldate" runat="server" Text='<%#Eval("SysDate") %>' />
                            </ItemTemplate>
                            <ItemStyle HorizontalAlign="Center" Width="10%" />
                        </asp:TemplateField>
                        <asp:TemplateField HeaderText="Project Title">
                            <ItemTemplate>
                            <asp:Label ID="lblprjtitle" runat="server" Text='<%#Eval("PrjTitle") %>'  />
                            </ItemTemplate>
                            <ItemStyle Width="70%" HorizontalAlign="Left" />
                        </asp:TemplateField>
                        
                    </Columns>
                    <EmptyDataTemplate>
                                    <table width="100%" class="fontcss"><tr><td align="center" >
                                    <asp:Label ID="Label1" runat="server"  Text="No  data found to display" Font-Bold="true"
    Font-Names="Calibri" ForeColor="red"></asp:Label></td></tr>
    </table>
                                    </EmptyDataTemplate>
                    <PagerSettings PageButtonCount="40" />
                </asp:GridView> 
                
                             
             </td>       
        </tr>        
        </table>   
            
        </ContentTemplate>
        </cc1:TabPanel>
        
                    <cc1:TabPanel ID="TabPanel2" runat="server" HeaderText="Custom Search">
                        <HeaderTemplate>
&nbsp;&nbsp;WIP&nbsp;&nbsp;
                        
                        
                    </HeaderTemplate>
                        
<ContentTemplate>
        
          <table width="100%" cellpadding="0" cellspacing="0">
        
        <tr>
        <td valign="bottom">
                 From Date: <asp:TextBox ID="txtFromDate" CssClass="box3" runat="server" Width="80px"></asp:TextBox>
                <cc1:CalendarExtender ID="txtFromDate_CalendarExtender" runat="server" 
                 Enabled="True" Format="dd-MM-yyyy" TargetControlID="txtFromDate">
                        </cc1:CalendarExtender>
                To Date:
                <asp:TextBox ID="txtToDate" runat="server" CssClass="box3" Width="80px"></asp:TextBox>
                <cc1:CalendarExtender ID="txtToDate_CalendarExtender" runat="server" 
                    Enabled="True" Format="dd-MM-yyyy" TargetControlID="txtToDate">
                </cc1:CalendarExtender>
                WONo:
                <asp:TextBox ID="txtWONo" runat="server" CssClass="box3" Width="100px"></asp:TextBox>

                 Over heads:
                <asp:TextBox ID="txtOverheads" runat="server" CssClass="box3" Width="30px">75</asp:TextBox>&nbsp;%
<asp:RegularExpressionValidator ID="RegtxtOverheads" runat="server" ErrorMessage="*"
 ControlToValidate="txtOverheads" ValidationExpression="^\d{1,15}(\.\d{0,3})?$" ValidationGroup="A">
 </asp:RegularExpressionValidator>
  
<asp:RequiredFieldValidator ID="ReqtxtOverheads" runat="server" ErrorMessage="*" 
 ControlToValidate="txtOverheads" ValidationGroup="A" >
 </asp:RequiredFieldValidator>
                <asp:Button ID="BtnSearch" runat="server" CssClass="redbox" ValidationGroup="A"
                    OnClick="BtnSearch_Click" Text="Search" />
        </td>
        </tr>
        
        
        
         <tr>  
           <td>
             <iframe id="Iframe1"  runat ="server" width="100%" height="410px" frameborder="0" 
                   scrolling="auto" ></iframe>
           </td> 
        </tr>      
        
        
        
                    
        </table>
        
        </ContentTemplate></cc1:TabPanel>
        
        
         </cc1:TabContainer>
           </td>
        </tr>
    </table>   
     
    </ContentTemplate>
    </asp:UpdatePanel>
</asp:Content>
<asp:Content ID="Content8" ContentPlaceHolderID="ContentPlaceHolder4" Runat="Server">
</asp:Content>



=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/Inventory/Transactions/WIS_ActualRun_Print.aspx.cs ===

﻿using System;
using System.Collections;
using System.Configuration;
using System.Data;
using System.Linq;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Xml.Linq;
using System.Data.SqlClient;
using CrystalDecisions.CrystalReports.Engine;

public partial class Module_Inventory_Transactions_WIS_ActualRun_Print : System.Web.UI.Page
{
    clsFunctions fun = new clsFunctions();
    DataSet DS = new DataSet();
    int CompId = 0;
    int FinYearId = 0;
    string SId = "";
    string connStr = "";
    SqlConnection con;
    string CDate = "";
    string CTime = "";
    string Wo = "";
    int h = 0;
    private ReportDocument report = new ReportDocument(); 

    protected void BtnSearch_Click(object sender, EventArgs e)
    {
        string x = "";
        string z = "";
        string FDate = "";
        string TDate = "";
        double OverHeads =0;

        if (txtWONo.Text != "")
        {
            x = "  And WONo='" + txtWONo.Text + "'";
        }

        if (txtFromDate.Text != string.Empty && txtToDate.Text != string.Empty )
        {
            z = "    And SysDate Between '" + fun.FromDate(txtFromDate.Text) + "' And '" + fun.FromDate(txtToDate.Text) + "' ";
        }

        if (txtOverheads.Text != "" && fun.NumberValidationQty(txtOverheads.Text))
        {
           OverHeads = Convert.ToDouble(txtOverheads.Text);
        }

        string getRandomKey = fun.GetRandomAlphaNumeric();
        Iframe1.Attributes.Add("src", "WISWONO_Print_.aspx?z=" + z + "&Key=" + getRandomKey + "&x=" + x + "&FDate=" + FDate + "&TDate=" + TDate + "&OverHeads=" + OverHeads + "");

    }

    protected void Page_Load(object sender, EventArgs e)
    {
        try
        {
            FinYearId = Convert.ToInt32(Session["finyear"]);
            CompId = Convert.ToInt32(Session["compid"]);
            SId = Session["username"].ToString();
            connStr = fun.Connection();
            con = new SqlConnection(connStr);
            CDate = fun.getCurrDate();
            CTime = fun.getCurrTime();
            if (!IsPostBack)
            {
                string StrCat = fun.select("CId,Symbol+' - '+CName as Category", "tblSD_WO_Category", "CompId='" + CompId + "'");
                SqlCommand Cmd = new SqlCommand(StrCat, con);
                SqlDataAdapter DA = new SqlDataAdapter(Cmd);
                DataSet DS = new DataSet();
                DA.Fill(DS, "tblSD_WO_Category");
                DrpWOType.DataSource = DS.Tables["tblSD_WO_Category"];
                DrpWOType.DataTextField = "Category";
                DrpWOType.DataValueField = "CId";
                DrpWOType.DataBind();
                DrpWOType.Items.Insert(0, "WO Category");
                this.loadgrid(Wo,h);
            }
        }
        catch(Exception ex){}
    }

    public void loadgrid(string WO, int C)
    {
        try
        {
            string x = "";
            if (TxtWO.Text != "")
            {
                x = " AND WONo='" + WO + "'";
            }
            string Z = "";
            if (DrpWOType.SelectedValue != "WO Category")
            {

                Z = " AND CId='" + Convert.ToInt32(DrpWOType.SelectedValue) + "'";
            }
            string y = "";
            SqlDataAdapter da = new SqlDataAdapter("Sp_WIS_ActualRun_Grid", con);
            da.SelectCommand.CommandType = CommandType.StoredProcedure;
            da.SelectCommand.Parameters.Add(new SqlParameter("@CompId", SqlDbType.VarChar));
            da.SelectCommand.Parameters["@CompId"].Value = CompId;
            da.SelectCommand.Parameters.Add(new SqlParameter("@z", SqlDbType.VarChar));
            da.SelectCommand.Parameters["@z"].Value = Z;
            da.SelectCommand.Parameters.Add(new SqlParameter("@x", SqlDbType.VarChar));
            da.SelectCommand.Parameters["@x"].Value = x;
            da.SelectCommand.Parameters.Add(new SqlParameter("@y", SqlDbType.VarChar));
            da.SelectCommand.Parameters["@y"].Value = y;
            DataSet DSitem = new DataSet();
            da.Fill(DSitem);
            GridView2.DataSource = DSitem;
            GridView2.DataBind();
            

        }
        catch (Exception st)
        {

        }
        
    }

    protected void GridView2_RowCommand(object sender, GridViewCommandEventArgs e)
    {
        if (e.CommandName == "add")
        {   
            GridViewRow row = (GridViewRow)(((Button)e.CommandSource).NamingContainer);
            string wono = ((Label)row.FindControl("lblwono")).Text;
            
            Response.Redirect("~/Module/Inventory/Transactions/WIS_ActualRun_Assembly.aspx?WONo=" + wono + "&ModId=9&SubModId=53");
        }

        if (e.CommandName == "view")
        {
            GridViewRow row = (GridViewRow)(((Button)e.CommandSource).NamingContainer);
            string wono = ((Label)row.FindControl("lblwono")).Text;
            int typ = Convert.ToInt32(((DropDownList)row.FindControl("drpIssueShortage")).SelectedValue);
            string getRandomKey = fun.GetRandomAlphaNumeric();
            switch (typ)
            {
                case 0:
                    Response.Redirect("~/Module/Inventory/Transactions/WIS_View_TransWise.aspx?WONo=" + wono + "&ModId=9&SubModId=53&Type=" + typ + "&status=1");
                    break;

                case 1:
                    Response.Redirect("~/Module/Inventory/Transactions/TotalIssueAndShortage_Print.aspx?WONo=" + wono + "&Key=" + getRandomKey + "&ModId=9&SubModId=53&Type=" + typ + "&status=1");

                    break;
                case 2:
                    Response.Redirect("~/Module/Inventory/Transactions/TotalShortage_Print.aspx?WONo=" + wono + "&Key=" + getRandomKey + "&ModId=9&SubModId=53&Type=" + typ + "&status=1");

                    break;

            }

        }

    }

    protected void GridView2_PageIndexChanging(object sender, GridViewPageEventArgs e)
    {
        GridView2.PageIndex = e.NewPageIndex;
        this.loadgrid(Wo,h);
    }
    protected void Button1_Click(object sender, EventArgs e)
    {
        this.loadgrid(TxtWO.Text, h);

    }
    protected void DrpWOType_SelectedIndexChanged(object sender, EventArgs e)
    {
        if (DrpWOType.SelectedValue != "WO Category")
        {
            int k = Convert.ToInt32(DrpWOType.SelectedValue);
            this.loadgrid(Wo, k);
        }
        else
        {
            this.loadgrid(Wo, h);
        }
    }
}
