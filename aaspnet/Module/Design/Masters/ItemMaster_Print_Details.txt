=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/Design/Masters/ItemMaster_Print_Details.aspx.txt ===

﻿<%@ Page Language="C#" AutoEventWireup="true" CodeFile="ItemMaster_Print_Details.aspx.cs" Inherits="Module_Design_Masters_ItemMaster_Print_Details" Theme="Default"  %>

<%@ Register assembly="CrystalDecisions.Web, Version=10.5.3700.0, Culture=neutral, PublicKeyToken=692fbea5521e1304" namespace="CrystalDecisions.Web" tagprefix="CR" %>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title>ERP</title>

    <script src="../../../Javascript/loadingNotifier.js" type="text/javascript"></script>
   
    <style type="text/css">
        #form1
        {
            width: 100%;
        }
      
    </style>
   
</head>
<body style="margin-bottom:0; margin-left:0; margin-right:0; margin-top:0;">
    <form id="form1" runat="server">    
    <table width="100%" cellpadding="0" cellspacing="0">
        <tr>
            <td>
                <asp:Panel ID="Panel1" runat="server" ScrollBars="Both" Height="440" Width="100%">                
                <CR:CrystalReportViewer ID="CrystalReportViewer1" runat="server" HasCrystalLogo="False" Width="100%"
                    AutoDataBind="true" ReportSourceID="CrystalReportSource1" 
                    EnableDatabaseLogonPrompt="False" EnableParameterPrompt="False" 
                    DisplayGroupTree="False" />
                <CR:CrystalReportSource ID="CrystalReportSource1" runat="server">
                    <Report FileName="~\Module\Design\Reports\ItemMaster.rpt">
                    </Report>
                </CR:CrystalReportSource>
                </asp:Panel>
            </td>
        </tr>
        </table>
    
    </form>
</body>
</html>


=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/Design/Masters/ItemMaster_Print_Details.aspx.cs ===

﻿using System;
using System.Collections;
using System.Configuration;
using System.Data;
using System.Linq;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Xml.Linq;
using CrystalDecisions.CrystalReports.Engine;
using System.Data.SqlClient;
using System.IO;
using System.Security.Cryptography;

public partial class Module_Design_Masters_ItemMaster_Print_Details : System.Web.UI.Page
{
    string Category = "";
    string SearchCode = "";
    string SearchItemCode = "";
    string DrpTypeVal = "";
    string DrpLocVal="";
    DataSet DS = new DataSet();
    clsFunctions fun = new clsFunctions();
    int CompId = 0;
    int FYId = 0;
    string Key = string.Empty;
    private ReportDocument cryRpt = new ReportDocument();
    protected void Page_Init(object sender, EventArgs e)
    {
      if (!IsPostBack)
        {
            try
            {
                Category = Request.QueryString["category"].ToString();
                SearchCode = Request.QueryString["SearchCode"].ToString();
                SearchItemCode = Request.QueryString["SearchItemCode"].ToString();
                DrpTypeVal = Request.QueryString["DrpTypeVal"].ToString();
                DrpLocVal = Request.QueryString["DrplocationVal"].ToString();
                CompId = Convert.ToInt32(Session["compid"]);
                FYId = Convert.ToInt32(Session["finyear"]);
                Key = Request.QueryString["Key"].ToString();
                this.Fillgrid(Category, SearchCode, SearchItemCode, DrpTypeVal);

            }
           catch (Exception ex)
            {
            }
        }

       else
        {
            Key = Request.QueryString["Key"].ToString();
            ReportDocument doc = (ReportDocument)Session[Key];
            //ReportDocument doc = (ReportDocument)Session["ReportDocument"];
            CrystalReportViewer1.ReportSource = doc;
        }  
    }





    protected void Page_Load(object sender, EventArgs e)
    {
        cryRpt = new ReportDocument();        
    }

    protected void Page_UnLoad(object sender, EventArgs e)
    {
        this.CrystalReportViewer1.Dispose();
        this.CrystalReportViewer1 = null;
        cryRpt.Close();
        cryRpt.Dispose();
        GC.Collect();
    }

    public void Fillgrid(string sd, string B, string s, string drptype)
    {

        string connStr = fun.Connection();
        SqlConnection con = new SqlConnection(connStr);
        DataSet DSitem = new DataSet();
       try
        {

            string x = "";
            string p = "";
            string q = "";
            string y = "";
            if (drptype != "Select")
            {
                if (drptype == "Category")
                {
                    if (sd != "Select")
                    {

                        x = " AND tblDG_Item_Master.CId='" + sd + "'";

                        if (B != "Select")
                        {
                            if (B == "tblDG_Item_Master.ItemCode")
                            {
                                //txtSearchItemCode.Visible = true;
                                p = " And tblDG_Item_Master.ItemCode Like '" + s + "%'";
                            }

                            if (B == "tblDG_Item_Master.ManfDesc")
                            {
                                //txtSearchItemCode.Visible = true;
                                p = " And tblDG_Item_Master.ManfDesc Like '%" + s + "%'";
                            }


                            if (B == "tblDG_Item_Master.Location")
                            {
                                //txtSearchItemCode.Visible = false;
                                //DropDownList3.Visible = true;

                                if (DrpLocVal != "Select")
                                {
                                    p = " And tblDG_Item_Master.Location='" + DrpLocVal + "'";
                                }
                            }


                        }
                        q = "And tblDG_Item_Master.CompId='" + CompId + "' And tblDG_Item_Master.FinYearId<='" + FYId + "'";

                    }
                    else if (sd == "Select" && B == "Select" && s != string.Empty)
                    {
                        y = " And tblDG_Item_Master.ManfDesc Like '%" + s + "%'";

                    }


                }

                else if (drptype != "Select" && drptype == "WOItems")
                {

                    if (B != "Select")
                    {
                        if (B == "tblDG_Item_Master.ItemCode")
                        {
                            //txtSearchItemCode.Visible = true;
                            p = " And tblDG_Item_Master.ItemCode Like '%" + s + "%'";
                        }

                        if (B == "tblDG_Item_Master.ManfDesc")
                        {
                            //txtSearchItemCode.Visible = true;
                            p = " And tblDG_Item_Master.ManfDesc Like '%" + s + "%'";
                        }
                    }
                    else if (B == "Select" && s != string.Empty)
                    {
                        y = " And tblDG_Item_Master.ManfDesc Like '%" + s + "%'";

                    }

                }

                SqlCommand cmd = new SqlCommand();
                SqlDataAdapter da = new SqlDataAdapter("GetAllItem", con);
                da.SelectCommand.CommandType = CommandType.StoredProcedure;
                da.SelectCommand.Parameters.Add(new SqlParameter("@startIndex", SqlDbType.VarChar));
                da.SelectCommand.Parameters["@startIndex"].Value = sd;
                da.SelectCommand.Parameters.Add(new SqlParameter("@pageSize", SqlDbType.VarChar));
                da.SelectCommand.Parameters["@pageSize"].Value = x;
                da.SelectCommand.Parameters.Add(new SqlParameter("@startIndex1", SqlDbType.VarChar));
                da.SelectCommand.Parameters["@startIndex1"].Value = p;
                da.SelectCommand.Parameters.Add(new SqlParameter("@pageSize1", SqlDbType.VarChar));
                da.SelectCommand.Parameters["@pageSize1"].Value = q;
                da.SelectCommand.Parameters.Add(new SqlParameter("@drpType", SqlDbType.VarChar));
                da.SelectCommand.Parameters["@drpType"].Value = drptype;
                da.SelectCommand.Parameters.Add(new SqlParameter("@drpCode", SqlDbType.VarChar));
                da.SelectCommand.Parameters["@drpCode"].Value = B;
                da.SelectCommand.Parameters.Add(new SqlParameter("@y", SqlDbType.VarChar));
                da.SelectCommand.Parameters["@y"].Value = y;
                da.Fill(DSitem);
                cryRpt = new ReportDocument();
                cryRpt.Load(Server.MapPath("~/Module/Design/Reports/ItemMaster.rpt"));
                cryRpt.SetDataSource(DSitem.Tables[0]);
                string Company = fun.getCompany(CompId);
                cryRpt.SetParameterValue("Company", Company);
                string Address = fun.CompAdd(CompId);
                cryRpt.SetParameterValue("Address", Address);
                CrystalReportViewer1.ReportSource = cryRpt;
                //Session["ReportDocument"] = cryRpt;
                Session[Key] = cryRpt;
            }

        }
       catch (Exception ex)
        {

        }
       finally
       {
           DSitem.Clear();
           DSitem.Dispose();
           con.Close();
           con.Dispose();
       }

    }
    
  
   
}