=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/Scheduler/IOU.aspx.txt ===

﻿<%@ Page Language="C#" MasterPageFile="~/MasterPage.master" AutoEventWireup="true" CodeFile="IOU.aspx.cs" Inherits="Module_Scheduler_IOU" Title="ERP" Theme="Default" %>
<%@ Register assembly="AjaxControlToolkit" namespace="AjaxControlToolkit" tagprefix="cc1" %>
<asp:Content ID="Content1" ContentPlaceHolderID="head" Runat="Server">

    <link href="../../Css/StyleSheet.css" rel="stylesheet" type="text/css" />
    <link href="../../Css/yui-datatable.css" rel="stylesheet" type="text/css" /> 
    <script src="../../Javascript/PopUpMsg.js" type="text/javascript"></script>
    <script src="../../Javascript/loadingNotifier.js" type="text/javascript"></script>
    
</asp:Content>
<asp:Content ID="Content2" ContentPlaceHolderID="cp3" Runat="Server">
</asp:Content>
<asp:Content ID="Content3" ContentPlaceHolderID="cp1" Runat="Server">
</asp:Content>
<asp:Content ID="Content4" ContentPlaceHolderID="cp2" Runat="Server">
</asp:Content>
<asp:Content ID="Content5" ContentPlaceHolderID="MainContent" Runat="Server">
</asp:Content>
<asp:Content ID="Content6" ContentPlaceHolderID="ContentPlaceHolder2" Runat="Server">
</asp:Content>
<asp:Content ID="Content7" ContentPlaceHolderID="ContentPlaceHolder3" Runat="Server">
    <table cellpadding="0" cellspacing="0" width="100%">
    <tr>
            <td align="left" valign="middle" style="background:url(../../images/hdbg.JPG)" height="21" class="fontcsswhite"><b>&nbsp;IOU</b></td>
        </tr>
 
 
 <td>
  
  <asp:GridView ID="GridView2" 
                        runat="server" 
                    CssClass="yui-datatable-theme" AutoGenerateColumns="False" DataKeyNames="Id" 
                    OnPageIndexChanging="GridView2_PageIndexChanging" AllowPaging="True" 
                        onselectedindexchanged="GridView2_SelectedIndexChanged" 
         Width="100%" PageSize="20" ShowFooter="True" 
         onrowcancelingedit="GridView2_RowCancelingEdit" 
         onrowediting="GridView2_RowEditing" onrowupdating="GridView2_RowUpdating" 
         onrowcommand="GridView2_RowCommand" onrowdeleting="GridView2_RowDeleting">
                        <PagerSettings PageButtonCount="40" />
                        <Columns>
                            
                            
                            <asp:TemplateField ShowHeader="False">
                                <EditItemTemplate>
                                    <asp:LinkButton ID="LinkButton3" OnClientClick="return confirmationUpdate();"  
                                    runat="server" CausesValidation="True" ValidationGroup="B"
                                        CommandName="Update" Text="Update"></asp:LinkButton>
                                    &nbsp; <asp:LinkButton ID="LinkButton2" runat="server" CausesValidation="False" 
                                        CommandName="Cancel" Text="Cancel"></asp:LinkButton>
                                </EditItemTemplate>
                                
                                <ItemTemplate>
                                    <asp:LinkButton ID="LinkButton1" OnClientClick="return confirmationUpdate();" runat="server" 
                                    CausesValidation="False" 
                                        CommandName="Edit" Text="Edit"></asp:LinkButton>
                                </ItemTemplate>
                                
                                <ItemStyle HorizontalAlign="Center" Width="4%" />
                                
                            </asp:TemplateField>
                            
                            <asp:TemplateField ShowHeader="False">
                                <ItemTemplate>
                                    <asp:LinkButton ID="LinkButton4" OnClientClick="return confirmationDelete();"  runat="server" 
                                    CausesValidation="False" CommandName="Delete" Text="Delete"></asp:LinkButton>
                                </ItemTemplate>
                                <ItemStyle HorizontalAlign="Center" Width="3%" />
                            </asp:TemplateField>
                            
                            
                            <asp:TemplateField HeaderText="SN">
                            
                                <ItemTemplate>
                                <asp:Label ID="Label2" runat="server" Text='<%# Bind("Id") %>'></asp:Label>
                                </ItemTemplate>
                                
                                <EditItemTemplate>
                                <asp:Label ID="Label2" runat="server" Text='<%# Bind("Id") %>'></asp:Label>                           
                                </EditItemTemplate> 
                                
                                <ItemStyle HorizontalAlign="Right" Width="2%"></ItemStyle> 
                                <FooterStyle HorizontalAlign="right" />
                            
                            </asp:TemplateField>                            
                            
                                            
                             <asp:TemplateField HeaderText="Sanctioned">
                                
                                <ItemTemplate>
                                    <asp:Label ID="lblx" Text='<%# Bind("Sanctioned") %>' runat="server"></asp:Label>
                                </ItemTemplate>
                                <ItemStyle HorizontalAlign="center" Width="4%" />                               
                                
                            </asp:TemplateField>
                            
                             <asp:TemplateField HeaderText="Date" Visible="false">
                                
                                <ItemTemplate>
                                    <asp:Label ID="lblDate" Text='<%# Eval("SysDate") %>' runat="server"></asp:Label>
                                </ItemTemplate>
                                <ItemStyle HorizontalAlign="center" Width="4%" />                               
                                
                            </asp:TemplateField>
                            <asp:TemplateField HeaderText="Time" Visible="false">
                                
                                <ItemTemplate>
                                    <asp:Label ID="lblTime" Text='<%# Eval("SysTime") %>' runat="server"></asp:Label>
                                </ItemTemplate>
                                <ItemStyle HorizontalAlign="center" Width="4%" />                               
                                
                            </asp:TemplateField>
                            
                            <asp:TemplateField HeaderText="Employee Name">
                                
                                <ItemTemplate>
                                    <asp:Label ID="lblEmpName" Text='<%# Eval("EmpName") %>' runat="server"></asp:Label>
                                </ItemTemplate>
                               
                                <EditItemTemplate>
                                    
                                    
                                    <asp:TextBox ID="TextBox1" Width="95%" Text='<%# Eval("EmpName") %>' CssClass="box3"  runat="server"></asp:TextBox>
                                                <cc1:AutoCompleteExtender ID="Txt_AutoCompleteExtender" runat="server" 
                                DelimiterCharacters="" 
                                Enabled="True" ServiceMethod="GetCompletionList"  EnableViewState="true"
                                ServicePath="" TargetControlID="TextBox1" UseContextKey="True"
                                 CompletionInterval="100" CompletionSetCount="2" FirstRowSelected="True" MinimumPrefixLength="1" ShowOnlyCurrentWordInCompletionListItem="True" CompletionListItemCssClass="bg" CompletionListHighlightedItemCssClass="bgtext" CompletionListCssClass="almt"></cc1:AutoCompleteExtender>
                                                <asp:RequiredFieldValidator ID="ReqEmpEdit" runat="server" 
                                                ControlToValidate="TextBox1" ErrorMessage="*" ValidationGroup="B">
                                                
                                                </asp:RequiredFieldValidator>
                                </EditItemTemplate>
                                <FooterTemplate><asp:TextBox ID="TxtEmp1" runat="server" CssClass="box3" ValidationGroup="D" 
                                                Width="96%"></asp:TextBox>
                                                
                                                <cc1:AutoCompleteExtender ID="TxtEmp1_AutoCompleteExtender" runat="server" 
                                DelimiterCharacters="" 
                                Enabled="True" ServiceMethod="GetCompletionList"  EnableViewState="true"
                                ServicePath="" TargetControlID="TxtEmp1" UseContextKey="True"
                                 CompletionInterval="100" CompletionSetCount="2" FirstRowSelected="True" MinimumPrefixLength="1" ShowOnlyCurrentWordInCompletionListItem="True" CompletionListItemCssClass="bg" CompletionListHighlightedItemCssClass="bgtext" CompletionListCssClass="almt"></cc1:AutoCompleteExtender>
                                                <asp:RequiredFieldValidator ID="Req15" runat="server" 
                                                ControlToValidate="TxtEmp1" ErrorMessage="*" ValidationGroup="D">
                                                
                                                </asp:RequiredFieldValidator></FooterTemplate>
                                 <ItemStyle HorizontalAlign="Left" Width="20%" />
                            </asp:TemplateField>
                            
                            
                            
                            
                            
                            
                               
                            
                                    <asp:TemplateField HeaderText="Date">
                                <EditItemTemplate>
                                <asp:TextBox ID="txtDate" CssClass="box3" Text='<%# Eval("Date") %>' Width="80%" runat="server">
                                </asp:TextBox>
                                                   
                <cc1:CalendarExtender ID="textDate_CalendarExtender" runat="server"  CssClass="cal_Theme2" PopupPosition="BottomRight"
                 Enabled="True" Format="dd-MM-yyyy" TargetControlID="txtDate">
                 </cc1:CalendarExtender>
                                <asp:RequiredFieldValidator ID="ReqtxtDate" runat="server"
                                ControlToValidate="txtDate" ErrorMessage="*" ValidationGroup="B">
                                </asp:RequiredFieldValidator>
                                
                               <asp:RegularExpressionValidator ID="RegtxtDate" ValidationGroup="B" runat="server" 
                  ControlToValidate="txtDate" ErrorMessage="*"
                    ValidationExpression="^([1-9]|0[1-9]|[12][0-9]|3[01])[- /.]([1-9]|0[1-9]|1[012])[- /.][0-9]{4}$">
                  </asp:RegularExpressionValidator>                  
                                
                                </EditItemTemplate>

                                <ItemTemplate>
                                <asp:Label ID="lblDate1" Text='<%# Eval("Date") %>' runat="server"></asp:Label>
                                </ItemTemplate>
                                <ItemStyle HorizontalAlign="Center" Width="6%" />
                                                               
                                 <FooterTemplate>
                                <asp:TextBox ID="txtDate2" runat="server" CssClass="box3" ValidationGroup="D" Width="80%">
                                </asp:TextBox>
                                   
                <cc1:CalendarExtender ID="textDate_CalendarExtender" runat="server" CssClass="cal_Theme2" PopupPosition="BottomRight"
                 Enabled="True" Format="dd-MM-yyyy" TargetControlID="txtDate2">
                 </cc1:CalendarExtender>
                                <asp:RequiredFieldValidator ID="ReqtxtDate2" runat="server" 
                                ControlToValidate="txtDate2" ErrorMessage="*" ValidationGroup="D">
                                </asp:RequiredFieldValidator>
                                
                                 
                               <asp:RegularExpressionValidator ID="RegtxtDate2" ValidationGroup="D" runat="server" 
                  ControlToValidate="txtDate2" ErrorMessage="*"
                    ValidationExpression="^([1-9]|0[1-9]|[12][0-9]|3[01])[- /.]([1-9]|0[1-9]|1[012])[- /.][0-9]{4}$">
                  </asp:RegularExpressionValidator>

                                </FooterTemplate>
                                </asp:TemplateField>                                
                            
                            
                            
                            <asp:TemplateField HeaderText="Amount">
                                <EditItemTemplate>
                                    <asp:TextBox ID="TextBox2" CssClass="box3" Text='<%# Eval("Amount") %>'  Width="85%" runat="server">
                                    </asp:TextBox>
                                    <asp:RequiredFieldValidator ID="ReqAmt2" runat="server" 
                                                ControlToValidate="TextBox2" ErrorMessage="*" ValidationGroup="B">
                                                
                                                </asp:RequiredFieldValidator>
                                                
                                                <asp:RegularExpressionValidator ID="RegularExpressionValidator1" runat="server"  ValidationGroup="B" ControlToValidate="TextBox2" ErrorMessage="*" ValidationExpression="^\d{1,15}(\.\d{0,3})?$">
                                                         </asp:RegularExpressionValidator>
                                                
                                </EditItemTemplate>
                                <ItemTemplate>
                                    <asp:Label ID="lblAmt" Text='<%# Eval("Amount") %>' runat="server"></asp:Label>
                                </ItemTemplate>
                                <ItemStyle HorizontalAlign="Center" Width="7%" />
                               
                                 <FooterTemplate><asp:TextBox ID="TxtAmt" runat="server" CssClass="box3" ValidationGroup="D" 
                                                Width="80%"></asp:TextBox>
                                                <asp:RequiredFieldValidator ID="ReqAmt" runat="server" 
                                                ControlToValidate="TxtAmt" ErrorMessage="*" ValidationGroup="D">
                                                
                                                </asp:RequiredFieldValidator>
                                                <asp:RegularExpressionValidator ID="Reg1" runat="server"  ValidationGroup="D" ControlToValidate="TxtAmt" ErrorMessage="*" ValidationExpression="^\d{1,15}(\.\d{0,3})?$">
                                                         </asp:RegularExpressionValidator>
                                                
                                                </FooterTemplate>
                            </asp:TemplateField>
                            <asp:TemplateField HeaderText="Reason">
                                <EditItemTemplate>
                                                    <asp:Label ID="lblReason2" Visible="false" Text='<%# Eval("ReasonId") %>' runat="server"></asp:Label>                                 
                                                <asp:DropDownList ID="DrpReason2" DataValueField="Id" DataTextField="Terms" DataSourceID="SqlDataSource1"   CssClass="box3" Width="92%" runat="server">
                                    </asp:DropDownList>
                                                <asp:RequiredFieldValidator ID="ReqReason2" runat="server" 
                                                ControlToValidate="DrpReason2" InitialValue="Select" ErrorMessage="*" ValidationGroup="B">
                                                
                                                </asp:RequiredFieldValidator>
                                </EditItemTemplate>
                                <ItemTemplate>
                                    <asp:Label ID="lblReason" Text='<%# Eval("reason") %>' runat="server"></asp:Label>
                                </ItemTemplate>
                                <ItemStyle HorizontalAlign="Left" Width="15%" />
                                
                                <FooterTemplate>
                                    <asp:DropDownList ID="DrpReason" CssClass="box3" DataValueField="Id" DataTextField="Terms" DataSourceID="SqlDataSource1" Width="92%" runat="server">
                                    </asp:DropDownList>
                                                <asp:RequiredFieldValidator ID="ReqReason" runat="server" 
                                                ControlToValidate="DrpReason" InitialValue="Select" ErrorMessage="*" ValidationGroup="D">
                                                
                                                </asp:RequiredFieldValidator></FooterTemplate>
                            </asp:TemplateField>
                            <asp:TemplateField HeaderText="Narration">
                                <EditItemTemplate>
                                    <asp:TextBox ID="TextBox4" Width="100%" CssClass="box3" Text='<%# Eval("Narration") %>' runat="server"></asp:TextBox>
                                </EditItemTemplate>
                                <ItemTemplate>
                                    <asp:Label ID="lblNarration" Text='<%# Eval("Narration") %>'  runat="server"></asp:Label>
                                </ItemTemplate>
                                <ItemStyle Width="15%" />
                                
                                 <FooterTemplate><asp:TextBox ID="TxtNarrat" runat="server" CssClass="box3" ValidationGroup="D" 
                                                Width="100%"></asp:TextBox>
                                                </FooterTemplate>
                            </asp:TemplateField>
                                 <asp:TemplateField HeaderText=" ">
                                
                            
                            <FooterTemplate>
                                                        
                                <asp:Button ID="Button1" runat="server" OnClientClick="return confirmationAdd();" CommandName="Add" ValidationGroup="D" CssClass="redbox" Text="Add" />
                            </FooterTemplate>
                            
                            <FooterStyle HorizontalAlign="right" Width="2%" />
                                     <ItemStyle Width="2%" />
                            </asp:TemplateField>
                            
                            
                                    </Columns>
                                    <EmptyDataTemplate>
                    <table width="100%" border="1" style="border-color:Gray"  class="fontcss">
                    <tr>
                    <th>Employee Name</th>
                     <th>Date</th>
                    <th>Amount</th>
                    <th>Reason</th>
                    <th>Narration</th>
                     <th> </th>
                    </tr> 
                     
                     <tr>                  
                    <td >
                    <asp:TextBox ID="TxtEmp" runat="server" CssClass="box3" ValidationGroup="D" 
                                                Width="90%"></asp:TextBox>
                                                
                                                <cc1:AutoCompleteExtender ID="TxtEmp_AutoCompleteExtender" runat="server" 
                                DelimiterCharacters="" 
                                Enabled="True" ServiceMethod="GetCompletionList"  EnableViewState="true"
                                ServicePath="" TargetControlID="TxtEmp" UseContextKey="True"
                                 CompletionInterval="100" CompletionSetCount="2" FirstRowSelected="True" MinimumPrefixLength="1" ShowOnlyCurrentWordInCompletionListItem="True" CompletionListItemCssClass="bg" CompletionListHighlightedItemCssClass="bgtext" CompletionListCssClass="almt"></cc1:AutoCompleteExtender>
                                                <asp:RequiredFieldValidator ID="ReqEmp" runat="server" 
                                                ControlToValidate="TxtEmp" ErrorMessage="*" ValidationGroup="A">
                                                
                                                </asp:RequiredFieldValidator>
                    </td>
                    
                     <td style="width:9%" >
                                   
                <asp:TextBox ID="textDate" runat="server"  CssClass="box3" Width="75%">
                 </asp:TextBox>                
                
                <cc1:CalendarExtender ID="textDate_CalendarExtender" runat="server" CssClass="cal_Theme2" PopupPosition="BottomRight"
                 Enabled="True" Format="dd-MM-yyyy" TargetControlID="textDate">
                 </cc1:CalendarExtender>
                 <asp:RequiredFieldValidator ID="ReqDate" runat="server" 
                 ControlToValidate="textDate" ErrorMessage="*" ValidationGroup="A"> 
                 </asp:RequiredFieldValidator>
                 <asp:RegularExpressionValidator ID="RegDate" ValidationGroup="A" runat="server" 
                  ControlToValidate="textDate" ErrorMessage="*"
                    ValidationExpression="^([1-9]|0[1-9]|[12][0-9]|3[01])[- /.]([1-9]|0[1-9]|1[012])[- /.][0-9]{4}$">
                  </asp:RegularExpressionValidator>
                  
                    </td>
                    
                    <td style="width:12%" >
                    <asp:TextBox ID="TxtAmt1" runat="server" CssClass="box3" Width="80%">
                    </asp:TextBox>
                    <asp:RequiredFieldValidator ID="ReqAmt1" runat="server" 
                    ControlToValidate="TxtAmt1" ErrorMessage="*" ValidationGroup="A">
                    </asp:RequiredFieldValidator>

                    <asp:RegularExpressionValidator ID="RegAmt" runat="server"  ValidationGroup="A" 
                    ControlToValidate="TxtAmt1" ErrorMessage="*" ValidationExpression="^\d{1,15}(\.\d{0,3})?$">
                    </asp:RegularExpressionValidator>
                    </td>
                    
                    <td >
                    
                    <asp:DropDownList ID="DrpReason1" DataValueField="Id" DataTextField="Terms" DataSourceID="SqlDataSource1" Width="96%" runat="server">
                                    </asp:DropDownList>
                                                <asp:RequiredFieldValidator ID="ReqReason1" runat="server" 
                                                ControlToValidate="DrpReason1" InitialValue="Select" ErrorMessage="*" ValidationGroup="A">
                                                
                                                </asp:RequiredFieldValidator>
                    
                    </td>
                    
                    <td>
                    
                    <asp:TextBox ID="TxtNarrat1" runat="server" CssClass="box3" ValidationGroup="A" 
                                                Width="98%"></asp:TextBox>
                                                
                    
                    </td> 
                    <td align="center" >
                        <asp:Button ID="BtnAdd" runat="server" CommandName="Add1" OnClientClick="return confirmationAdd();" ValidationGroup="A" CssClass="redbox"   Text="Add" />
                    </td>                  
                                        
                    </tr>
                   
                    </table>
                    </EmptyDataTemplate>
                              </asp:GridView>
                
             </td>   
          
  
 <tr>
 
 
 <td>
  
     <asp:SqlDataSource ID="SqlDataSource1" runat="server" 
        ConnectionString="<%$ ConnectionStrings:LocalSqlServer %>"
         ProviderName="System.Data.SqlClient" 
         SelectCommand="SELECT * FROM [tblACC_IOU_Reasons]"></asp:SqlDataSource>
                
             </td>   
             </tr>
         </table>   

</asp:Content>
<asp:Content ID="Content8" ContentPlaceHolderID="ContentPlaceHolder4" Runat="Server">
</asp:Content>



=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/Scheduler/IOU.aspx.cs ===

﻿using System;
using System.Collections;
using System.Configuration;
using System.Data;
using System.Linq;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Xml.Linq;
using System.Data.SqlClient;

public partial class Module_Scheduler_IOU : System.Web.UI.Page
{
    clsFunctions fun = new clsFunctions();
    string connStr = "";
    SqlConnection con;
    int CompId = 0;
    int FinYearId = 0;
    string sId = "";
    string CDate = "";
    string CTime = "";
    protected void Page_Load(object sender, EventArgs e)
    {
        try
        {
            connStr = fun.Connection();
            con = new SqlConnection(connStr);
            CompId = Convert.ToInt32(Session["compid"]);
            FinYearId = Convert.ToInt32(Session["finyear"]);
            sId = Session["username"].ToString();
            CDate = fun.getCurrDate();
            CTime = fun.getCurrTime();
            if (!IsPostBack)
            {
                this.BindDataGrid();
                this.NED();

            }

           
        }
        catch (Exception ex) { }
    }

    public void NED()
    {
        try
        {
            foreach (GridViewRow row in GridView2.Rows)
            {

                int Id = Convert.ToInt32(((Label)row.FindControl("Label2")).Text);
                string SqlStr = fun.select("Authorize", "tblACC_IOU_Master", "Id='" + Id + "' And CompId='" + CompId + "'");

                SqlCommand SQLCmd = new SqlCommand(SqlStr, con);
                SqlDataAdapter SqlDa = new SqlDataAdapter(SQLCmd);
                DataSet SqlDs = new DataSet();
                SqlDa.Fill(SqlDs);

                if (SqlDs.Tables[0].Rows.Count > 0)
                    if (Convert.ToInt32(SqlDs.Tables[0].Rows[0]["Authorize"]) == 1)
                    {
                        ((LinkButton)row.FindControl("LinkButton1")).Visible = false;
                        ((LinkButton)row.FindControl("LinkButton4")).Visible = false;
                    }
            }

            if (GridView2.Rows.Count == 0)
            {
                ((TextBox)GridView2.Controls[0].Controls[0].FindControl("textDate")).Attributes.Add("readonly", "readonly");
            }
            else
            {
                ((TextBox)GridView2.FooterRow.FindControl("txtDate2")).Attributes.Add("readonly", "readonly");

                GridViewRow row = GridView2.Rows[GridView2.EditIndex];
                ((TextBox)row.FindControl("txtDate")).Attributes.Add("readonly", "readonly");
            }
        }
        catch (Exception ex) { }

    }

    public void BindDataGrid()
    {
        try
        {

            DataTable dt = new DataTable();
            con.Open();
            string str = fun.select("*", "tblACC_IOU_Master", "FinYearId<='" + FinYearId + "'And CompId='" + CompId + "' And SessionId='" + sId + "' Order by Id Desc");
            SqlCommand cmdCustWo = new SqlCommand(str, con);
            SqlDataAdapter daCustWo = new SqlDataAdapter(cmdCustWo);
            DataSet DSCustWo = new DataSet();
            daCustWo.Fill(DSCustWo);
            dt.Columns.Add(new System.Data.DataColumn("SysDate", typeof(string)));
            dt.Columns.Add(new System.Data.DataColumn("SysTime", typeof(string)));
            dt.Columns.Add(new System.Data.DataColumn("EmpName", typeof(string)));
            dt.Columns.Add(new System.Data.DataColumn("Amount", typeof(double)));
            dt.Columns.Add(new System.Data.DataColumn("Reason", typeof(string)));
            dt.Columns.Add(new System.Data.DataColumn("Narration", typeof(string)));
            dt.Columns.Add(new System.Data.DataColumn("Id", typeof(Int32)));
            dt.Columns.Add(new System.Data.DataColumn("ReasonId", typeof(Int32)));
            dt.Columns.Add(new System.Data.DataColumn("Sanctioned", typeof(string)));
            dt.Columns.Add(new System.Data.DataColumn("Date", typeof(string)));
            DataRow dr;
            for (int i = 0; i < DSCustWo.Tables[0].Rows.Count; i++)
            {

                dr = dt.NewRow();
                dr[0] = fun.FromDateDMY(DSCustWo.Tables[0].Rows[i]["SysDate"].ToString());
                dr[1] = DSCustWo.Tables[0].Rows[i]["SysTime"].ToString();

                string stryr = fun.select("Terms", "tblACC_IOU_Reasons", "Id='" + DSCustWo.Tables[0].Rows[i]["Reason"].ToString() + "'");
                SqlCommand cmdyr = new SqlCommand(stryr, con);
                SqlDataAdapter dayr = new SqlDataAdapter(cmdyr);
                DataSet DSyr = new DataSet();
                dayr.Fill(DSyr);

                if (DSyr.Tables[0].Rows.Count > 0)
                {
                    dr[4] = DSyr.Tables[0].Rows[0]["Terms"].ToString();
                }

                string strEmp = fun.select("Title+'.'+EmployeeName+ ' ['+ EmpId +'] ' As EmpLoyeeName", "tblHR_OfficeStaff", "CompId='" + CompId + "'AND FinYearId<='" + FinYearId + "' AND EmpId='" + DSCustWo.Tables[0].Rows[i]["EmpId"] + "'");

                SqlCommand cmdEmp = new SqlCommand(strEmp, con);
                SqlDataAdapter daEmp = new SqlDataAdapter(cmdEmp);
                DataSet DSEmp = new DataSet();
                daEmp.Fill(DSEmp);
                if (DSEmp.Tables[0].Rows.Count > 0)
                {
                    dr[2] = DSEmp.Tables[0].Rows[0]["EmployeeName"].ToString();

                }

                dr[3] = Convert.ToDouble(decimal.Parse(DSCustWo.Tables[0].Rows[i]["Amount"].ToString()).ToString("N3"));
                dr[5] = DSCustWo.Tables[0].Rows[i]["Narration"].ToString();
                dr[6] = DSCustWo.Tables[0].Rows[i]["Id"].ToString();
                dr[7] = DSCustWo.Tables[0].Rows[i]["Reason"].ToString();

                if (DSCustWo.Tables[0].Rows[i]["Authorize"].ToString() == "1" && DSCustWo.Tables[0].Rows[i]["Authorize"] != DBNull.Value)
                {
                    dr[8] = "Yes";
                }
                else
                {
                    dr[8] = "No";
                }
                dr[9] = fun.FromDate(DSCustWo.Tables[0].Rows[i]["PaymentDate"].ToString());
                dt.Rows.Add(dr);
                dt.AcceptChanges();
            }
            GridView2.DataSource = dt;
            GridView2.DataBind();
            con.Close();


        }

        catch (Exception ex)
        { }
    }

    [System.Web.Services.WebMethodAttribute(), System.Web.Script.Services.ScriptMethodAttribute()]
    public static string[] GetCompletionList(string prefixText, int count, string contextKey)
    {
        clsFunctions fun = new clsFunctions();
        string connStr = fun.Connection();
        DataSet ds = new DataSet();
        SqlConnection con = new SqlConnection(connStr);
        con.Open();
        int CompId = Convert.ToInt32(HttpContext.Current.Session["compid"]);
        string cmdStr = fun.select("EmpId,EmployeeName", "tblHR_OfficeStaff", "CompId='" + CompId + "'");
        SqlDataAdapter da = new SqlDataAdapter(cmdStr, con);
        da.Fill(ds, "tblHR_OfficeStaff");
        con.Close();
        string[] main = new string[0];
        for (int i = 0; i < ds.Tables[0].Rows.Count; i++)
        {
            if (ds.Tables[0].Rows[i].ItemArray[1].ToString().ToLower().StartsWith(prefixText.ToLower()))
            {
                Array.Resize(ref main, main.Length + 1);
                main[main.Length - 1] = ds.Tables[0].Rows[i].ItemArray[1].ToString() + " [" + ds.Tables[0].Rows[i].ItemArray[0].ToString() + "]";
                //if (main.Length == 10)
                //    break;
            }
        }
        Array.Sort(main);
        return main;
    }
    protected void GridView2_PageIndexChanging(object sender, GridViewPageEventArgs e)
    {
        GridView2.PageIndex = e.NewPageIndex;
        GridView2.EditIndex = -1;
        this.BindDataGrid();
    }
    protected void GridView2_SelectedIndexChanged(object sender, EventArgs e)
    {

    }
    protected void GridView2_RowCancelingEdit(object sender, GridViewCancelEditEventArgs e)
    {
        GridView2.EditIndex = -1;
        this.BindDataGrid();
        this.NED();

    }
    protected void GridView2_RowEditing(object sender, GridViewEditEventArgs e)
    {
        try
        {
            GridView2.EditIndex = e.NewEditIndex;
            this.BindDataGrid();
            int index = GridView2.EditIndex;
            GridViewRow grv = GridView2.Rows[index];
            string labelLoc = ((Label)grv.FindControl("lblReason2")).Text;
            ((DropDownList)grv.FindControl("DrpReason2")).SelectedValue = labelLoc.ToString();

            this.NED();


        }
        catch (Exception ex)
        { }
    }

    protected void GridView2_RowUpdating(object sender, GridViewUpdateEventArgs e)
    {
        try
        {
            int index1 = GridView2.EditIndex;
            GridViewRow row = GridView2.Rows[index1];
            int id1 = Convert.ToInt32(GridView2.DataKeys[e.RowIndex].Value);
            string EmpName = fun.getCode(((TextBox)row.FindControl("TextBox1")).Text);

            double Amount = 0;
            if (((TextBox)row.FindControl("TextBox2")).Text != "")
            {
                Amount = Convert.ToDouble(decimal.Parse(((TextBox)row.FindControl("TextBox2")).Text).ToString("N3"));
            }
            string Date = fun.FromDate(((TextBox)row.FindControl("txtDate")).Text);
            int Reason = Convert.ToInt32(((DropDownList)row.FindControl("DrpReason2")).SelectedValue);
            string Narration = ((TextBox)row.FindControl("TextBox4")).Text;
            if (fun.NumberValidationQty(Amount.ToString()) == true && fun.DateValidation(((TextBox)row.FindControl("txtDate")).Text) == true && ((TextBox)row.FindControl("txtDate")).Text != "")
            {

                if (EmpName != "")
                {
                    if (Amount != 0)
                    {
                        string sql1 = fun.update("tblACC_IOU_Master", "SysDate='" + CDate + "',SysTime='" + CTime + "',SessionId='" + sId + "',EmpId='" + EmpName + "',PaymentDate='" + Date + "',Amount='" + Amount + "',Reason='" + Reason + "',Narration='" + Narration + "'", "Id='" + id1 + "'");
                        SqlCommand cmd1 = new SqlCommand(sql1, con);
                        con.Open();
                        cmd1.ExecuteNonQuery();
                        con.Close();

                        GridView2.EditIndex = -1;
                        this.BindDataGrid();

                        this.NED();


                    }
                    else
                    {
                        string myStringVariable = string.Empty;
                        myStringVariable = "Insert Valid Amount.";
                        ClientScript.RegisterStartupScript(this.GetType(), "myalert", "alert('" + myStringVariable + "');", true);
                    }
                }
                else
                {
                    string myStringVariable = string.Empty;
                    myStringVariable = "Invalid Employee Name.";
                    ClientScript.RegisterStartupScript(this.GetType(), "myalert", "alert('" + myStringVariable + "');", true);
                }
            }
        }
        catch (Exception ex)
        {
        }

    }

    protected void GridView2_RowCommand(object sender, GridViewCommandEventArgs e)
    {

        try
        {
            if (e.CommandName == "Add")
            {

                int strCategory_Reason = Convert.ToInt32(((DropDownList)GridView2.FooterRow.FindControl("DrpReason")).SelectedValue);
                string strEmpName = fun.getCode(((TextBox)GridView2.FooterRow.FindControl("TxtEmp1")).Text);
                double strAmount = 0;
                if (((TextBox)GridView2.FooterRow.FindControl("TxtAmt")).Text != "")
                {
                    strAmount = Convert.ToDouble(((TextBox)GridView2.FooterRow.FindControl("TxtAmt")).Text);
                }
                string strNarrat = ((TextBox)GridView2.FooterRow.FindControl("TxtNarrat")).Text;
                string Date = fun.FromDate(((TextBox)GridView2.FooterRow.FindControl("txtDate2")).Text);

                if (fun.NumberValidationQty(strAmount.ToString()) == true && fun.DateValidation(((TextBox)GridView2.FooterRow.FindControl("txtDate2")).Text) == true && ((TextBox)GridView2.FooterRow.FindControl("txtDate2")).Text != "")
                {
                    if (strEmpName != "")
                    {
                        if (strAmount != 0)
                        {
                            string cmdstr = fun.insert("tblACC_IOU_Master", "SysDate,SysTime,SessionId,CompId,FinYearId,EmpId,PaymentDate,Amount,Reason,Narration", "'" + CDate + "','" + CTime + "','" + sId + "','" + CompId + "','" + FinYearId + "','" + strEmpName + "','" + Date + "','" + Convert.ToDouble(decimal.Parse(strAmount.ToString()).ToString("N3")) + "','" + strCategory_Reason + "','" + strNarrat + "'");
                            SqlCommand cmd = new SqlCommand(cmdstr, con);

                            con.Open();
                            cmd.ExecuteNonQuery();
                            con.Close();
                            this.BindDataGrid();

                            this.NED();


                        }
                        else
                        {
                            string myStringVariable = string.Empty;
                            myStringVariable = "Insert Valid Amount.";
                            ClientScript.RegisterStartupScript(this.GetType(), "myalert", "alert('" + myStringVariable + "');", true);
                        }
                    }
                    else
                    {
                        string myStringVariable = string.Empty;
                        myStringVariable = "Invalid Employee Name.";
                        ClientScript.RegisterStartupScript(this.GetType(), "myalert", "alert('" + myStringVariable + "');", true);
                    }

                }

            }

            if (e.CommandName == "Add1")
            {
                int strCategory_Reason = Convert.ToInt32(((DropDownList)GridView2.Controls[0].Controls[0].FindControl("DrpReason1")).SelectedValue);
                string strEmpName = fun.getCode(((TextBox)GridView2.Controls[0].Controls[0].FindControl("TxtEmp")).Text);
                double strAmount = 0;
                if (((TextBox)GridView2.Controls[0].Controls[0].FindControl("TxtAmt1")).Text != "")
                {
                    strAmount = Convert.ToDouble(((TextBox)GridView2.Controls[0].Controls[0].FindControl("TxtAmt1")).Text);
                }


                string strNarrat = ((TextBox)GridView2.Controls[0].Controls[0].FindControl("TxtNarrat1")).Text;
                string Date = fun.FromDate(((TextBox)GridView2.Controls[0].Controls[0].FindControl("textDate")).Text);
                if (fun.NumberValidationQty(strAmount.ToString()) == true && fun.DateValidation(((TextBox)GridView2.Controls[0].Controls[0].FindControl("textDate")).Text) == true && ((TextBox)GridView2.Controls[0].Controls[0].FindControl("textDate")).Text != "")
                {
                    if (strEmpName != "")
                    {

                        if (strAmount != 0)
                        {
                            string cmdstr = fun.insert("tblACC_IOU_Master", "SysDate,SysTime,SessionId,CompId,FinYearId,EmpId,PaymentDate,Amount,Reason,Narration", "'" + CDate + "','" + CTime + "','" + sId + "','" + CompId + "','" + FinYearId + "','" + strEmpName + "','" + Date + "','" + Convert.ToDouble(decimal.Parse(strAmount.ToString()).ToString("N3")) + "','" + strCategory_Reason + "','" + strNarrat + "'");
                            SqlCommand cmd = new SqlCommand(cmdstr, con);
                            con.Open();
                            cmd.ExecuteNonQuery();
                            con.Close();
                            Page.Response.Redirect(Page.Request.Url.ToString(), true);
                        }
                        else
                        {
                            string myStringVariable = string.Empty;
                            myStringVariable = "Insert Valid Amount.";
                            ClientScript.RegisterStartupScript(this.GetType(), "myalert", "alert('" + myStringVariable + "');", true);
                        }
                    }
                    else
                    {
                        string myStringVariable = string.Empty;
                        myStringVariable = "Invalid Employee Name.";
                        ClientScript.RegisterStartupScript(this.GetType(), "myalert", "alert('" + myStringVariable + "');", true);
                    }
                }

            }


        }

        catch (Exception er) { }

    }

    protected void GridView2_RowDeleting(object sender, GridViewDeleteEventArgs e)
    {
        try
        {
            int id = Convert.ToInt32(GridView2.DataKeys[e.RowIndex].Value);
            SqlCommand cmd = new SqlCommand("DELETE FROM tblACC_IOU_Master WHERE Id=" + id + " And CompId='" + CompId + "'", con);
            con.Open();
            cmd.ExecuteNonQuery();
            con.Close();
            this.BindDataGrid();
            this.NED();

        }
        catch (Exception er) { }
    }
}
