=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/Design/Transactions/TPL_Design_Root_Assembly_Copy_Grid.aspx.txt ===

﻿<%@ Page Language="C#" MasterPageFile="~/MasterPage.master" AutoEventWireup="true" CodeFile="TPL_Design_Root_Assembly_Copy_Grid.aspx.cs" Inherits="Module_Design_Transactions_TPL_Design_Assembly_Edit_Assbly" Title="ERP" Theme ="Default" %>

<asp:Content ID="Content1" ContentPlaceHolderID="head" Runat="Server">
<link href="../../../Css/yui-datatable.css" rel="stylesheet" type="text/css" />
 <link href="../../../Css/StyleSheet.css" rel="stylesheet" type="text/css" />
<script src="../../../Javascript/loadingNotifier.js" type="text/javascript"></script>
    <script src="../../../Javascript/PopUpMsg.js" type="text/javascript"></script>
</asp:Content>
<asp:Content ID="Content2" ContentPlaceHolderID="cp3" Runat="Server">
</asp:Content>
<asp:Content ID="Content3" ContentPlaceHolderID="cp1" Runat="Server">
</asp:Content>
<asp:Content ID="Content4" ContentPlaceHolderID="cp2" Runat="Server">
</asp:Content>
<asp:Content ID="Content5" ContentPlaceHolderID="MainContent" Runat="Server">
</asp:Content>
<asp:Content ID="Content6" ContentPlaceHolderID="ContentPlaceHolder2" Runat="Server">
</asp:Content>
<asp:Content ID="Content7" ContentPlaceHolderID="ContentPlaceHolder3" Runat="Server">
<table width="100%" align="center" cellpadding="0" cellspacing="0" Class="fontcss">
        <tr>
            <td>
                <table width="100%" align="center" cellpadding="0" cellspacing="0">
                    <tr height="21">
                        <td style="background:url(../../../images/hdbg.JPG)" class="fontcsswhite" height="21" ><strong>&nbsp;TPL Root Assembly Copy&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WO No From: <asp:Label ID="lblWONoFrm" runat="server"></asp:Label>&nbsp;&nbsp;&nbsp;To: <asp:Label runat="server" ID="lblWONo"></asp:Label> </strong></td></tr>
             <tr>
            <td class="fontcsswhite" height="25" >
            
                <asp:DropDownList ID="DropDownList1" runat="server" Width="200px" 
                    CssClass="box3">
                    <asp:ListItem Value="0">Select</asp:ListItem>
                    <asp:ListItem Value="tblDG_Item_Master.ItemCode">Assembly No</asp:ListItem>
                    <asp:ListItem Value="tblDG_Item_Master.ManfDesc">Description</asp:ListItem>
                   <%-- <asp:ListItem Value="tblDG_Item_Master.PurchDesc">Purchase Description</asp:ListItem>--%>
                </asp:DropDownList>
            
                <asp:TextBox ID="txtSearchCustomer" runat="server" Width="350px" 
                    CssClass="box3"></asp:TextBox>
                
        <asp:Button ID="btnSearch" runat="server" Text="Search" CssClass="redbox" onclick="btnSearch_Click"/>&nbsp;<asp:Button ID="btnCancel" runat="server" CssClass="redbox" onclick="btnCancel_Click" Text="Cancel" />&nbsp;&nbsp;<asp:Label ID="lblMsg" runat="server" style="color: #FF0000"></asp:Label>
             </td>
             </tr>

             <tr>
            <td>
            
             <asp:GridView ID="SearchGridView1" runat="server" AllowPaging="True" 
                    AllowSorting="True" AutoGenerateColumns="False" CssClass="yui-datatable-theme"            
                    onpageindexchanging="SearchGridView1_PageIndexChanging" Width="700px" 
                    ShowFooter="True" PageSize="12" onrowcommand="SearchGridView1_RowCommand">
            <Columns>
                        <asp:TemplateField HeaderText="SN">
                        <ItemTemplate>
                        <%# Container.DataItemIndex+1 %>
                        </ItemTemplate>
                            <ItemStyle HorizontalAlign="Right" Width="2%"  />
                        </asp:TemplateField>
                        <asp:TemplateField>
                        <ItemTemplate>
                            <asp:CheckBox runat="server" ID="chkSelect" AutoPostBack="False"></asp:CheckBox>
                         </ItemTemplate>
                        <FooterTemplate>
                         <asp:Button ID="btnAdd" runat="server" Text="Add" CommandName="Add"  OnClientClick=" return confirmationAdd()" 
                         CssClass="redbox"/>
                         </FooterTemplate>
                        <HeaderTemplate>
                        <asp:CheckBox ID="chkSelectAll" runat="server"  AutoPostBack="true" OnCheckedChanged="chkSelectAll_CheckedChanged" />
                        </HeaderTemplate>
                            <HeaderStyle HorizontalAlign="Center" />
                            <ItemStyle HorizontalAlign="Center" Width="3%" />
                        </asp:TemplateField>
                        <asp:TemplateField HeaderText="Assembly No">
                            <ItemTemplate>
                                <asp:Label ID="Label1" runat="server" Text='<%# Bind("ItemCode") %>'>
                                </asp:Label>
                            </ItemTemplate>
                            <ItemStyle Width="13%" HorizontalAlign="Center" />
                        </asp:TemplateField>
                        <asp:BoundField DataField="ManfDesc" HeaderText="Description" >
                            <ItemStyle Width="40%" />
                        </asp:BoundField>
                        
                        
                        <asp:BoundField DataField="UOMBasic" HeaderText="UOM" >
                            <ItemStyle HorizontalAlign="Center" Width="9%" />
                        </asp:BoundField>
                        
                        <asp:BoundField DataField="Qty" HeaderText="Qty" >
                            <ItemStyle HorizontalAlign="Right" Width="10%" />
                        </asp:BoundField>
                        
                        
                        <asp:TemplateField HeaderText="Id" Visible="False">

                        <ItemTemplate>

                            <asp:Label ID="Id" runat="server" Text='<%# Bind("Id") %>' />

                        </ItemTemplate>

                        </asp:TemplateField>
                        
                        <asp:TemplateField HeaderText="CId" Visible="False">

                        <ItemTemplate>

                            <asp:Label ID="CId" runat="server" Text='<%# Bind("CId") %>' />

                        </ItemTemplate>

                        </asp:TemplateField>
                        
                        
                        <asp:TemplateField HeaderText="ItemId" Visible="False">

                        <ItemTemplate>

            <asp:Label ID="ItemId" runat="server" Text='<%# Bind("ItemId") %>' />

        </ItemTemplate>

        </asp:TemplateField>
                    </Columns>
                    <EmptyDataTemplate>
                    <table width="100%" class="fontcss">
                    <tr>
                    <td align="center">
                    <asp:Label ID="Label1" runat="server"  Text="No data to display !" Font-Size="Larger" ForeColor="maroon">
                    </asp:Label>
                    </td>
                    </tr>
                    </table>
                    </EmptyDataTemplate>
                    
        </asp:GridView>
              <%-- <asp:GridView ID="SearchGridView1" runat="server" AllowPaging="True" 
                    AllowSorting="True" AutoGenerateColumns="False" CssClass="yui-datatable-theme"            
                    onpageindexchanging="SearchGridView1_PageIndexChanging" Width="100%" 
                    ShowFooter="True" PageSize="12" onrowcommand="SearchGridView1_RowCommand">
            <RowStyle />
            <Columns>
                        <asp:TemplateField HeaderText="SN">
                        <ItemTemplate>
                        <%# Container.DataItemIndex+1 %>
                        </ItemTemplate>
                            <ItemStyle HorizontalAlign="Right" />
                        </asp:TemplateField>
                        <asp:TemplateField>
                        <HeaderTemplate>
                        <asp:CheckBox ID="chkSelectAll" runat="server"  AutoPostBack="true" OnCheckedChanged="chkSelectAll_CheckedChanged" />
                        </HeaderTemplate>
                        <ItemTemplate>
                            <asp:CheckBox runat="server" ID="chkSelect" AutoPostBack="true"></asp:CheckBox>
                         </ItemTemplate>
                            <HeaderStyle HorizontalAlign="Center" />
                            <ItemStyle HorizontalAlign="Center" />
                        <FooterTemplate>
                         <asp:Button ID="btnAdd" runat="server" Text="Add" CommandName="Add"  OnClientClick=" return confirmationAdd()" 
                         CssClass="redbox"/>
                         </FooterTemplate>
                        </asp:TemplateField>
                        <asp:BoundField DataField="ItemCode" HeaderText="Assembly No" >
                            <ItemStyle Width="14%" HorizontalAlign="Center" />
                        </asp:BoundField>
                        <asp:BoundField DataField="ManfDesc" HeaderText="Manf. Desc." >
                            <ItemStyle Width="20%" />
                        </asp:BoundField>
                        <asp:BoundField DataField="PurchDesc" HeaderText="Purch . Desc." >
                            <ItemStyle Width="20%" />
                        </asp:BoundField>
                        <asp:BoundField DataField="UOMBasic" HeaderText="UOM Basic" >
                            <ItemStyle HorizontalAlign="Center" Width="9%" />
                        </asp:BoundField>
                        <asp:BoundField DataField="UOMPurchase" HeaderText="UOM Purch." >
                            <ItemStyle HorizontalAlign="Center" Width="10%" />
                        </asp:BoundField>
                        <asp:BoundField DataField="Qty" HeaderText="Qty" >
                            <ItemStyle HorizontalAlign="Right" Width="10%" />
                        </asp:BoundField>
                        <asp:BoundField DataField="Weldments" HeaderText="Weld." >
                            <ItemStyle HorizontalAlign="Right" Width="5%" />
                        </asp:BoundField>
                        <asp:BoundField DataField="LH" HeaderText="LH" >
                            <ItemStyle HorizontalAlign="Right" Width="5%" />
                        </asp:BoundField>
                        <asp:BoundField DataField="RH" HeaderText="RH" >
                            <ItemStyle HorizontalAlign="Right" Width="5%" />
                        </asp:BoundField>
                        
                        <asp:TemplateField HeaderText="Id" Visible="False">

                        <ItemTemplate>

                            <asp:Label ID="Id" runat="server" Text='<%# Bind("Id") %>' />

                        </ItemTemplate>

                        </asp:TemplateField>
                        
                        <asp:TemplateField HeaderText="CId" Visible="False">

                        <ItemTemplate>

                            <asp:Label ID="CId" runat="server" Text='<%# Bind("CId") %>' />

                        </ItemTemplate>

                        </asp:TemplateField>
                        
                        
                        <asp:TemplateField HeaderText="ItemId" Visible="False">

                        <ItemTemplate>

            <asp:Label ID="ItemId" runat="server" Text='<%# Bind("ItemId") %>' />

        </ItemTemplate>

        </asp:TemplateField>
                    </Columns>
                <EmptyDataTemplate>
                    <table width="100%" class="fontcss">
                    <tr>
                    <td align="center">
                    <asp:Label ID="Label1" runat="server"  Text="No data to display !" Font-Size="Larger" ForeColor="maroon">
                    </asp:Label>
                    </td>
                    </tr>
                    </table>
                    </EmptyDataTemplate>    
                    
        </asp:GridView>--%>

    <asp:HiddenField ID="hfSort" runat="server" Value=" " />
        <asp:HiddenField ID="hfSearchText" runat="server" />
        </td>
         </tr>
          </table>
        </td>
        </tr>
     </table>
</asp:Content>
<asp:Content ID="Content8" ContentPlaceHolderID="ContentPlaceHolder4" Runat="Server">
</asp:Content>



=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/Design/Transactions/TPL_Design_Root_Assembly_Copy_Grid.aspx.cs ===

﻿using System;
using System.Collections;
using System.Configuration;
using System.Data;
using System.Linq;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Xml.Linq;
using System.Data.SqlClient;
using System.Security.Cryptography;
public partial class Module_Design_Transactions_TPL_Design_Assembly_Edit_Assbly : System.Web.UI.Page
{
    clsFunctions fun = new clsFunctions();
    DataSet DS = new DataSet();
    string wono = "";
    string wonofrm = "";
    int CompId = 0;
    string SessionId = "";
    int FinYearId = 0;

    protected void Page_Load(object sender, EventArgs e)
    {
      try
        {
            CompId = Convert.ToInt32(Session["compid"]);
            SessionId = Session["username"].ToString();
            FinYearId = Convert.ToInt32(Session["finyear"]);
            lblWONoFrm.Text = (Request.QueryString["WONoSrc"].ToString());
            wono = lblWONoFrm.Text;
            lblWONo.Text = (Request.QueryString["WONoDest"].ToString());
            wonofrm = lblWONo.Text;
            lblMsg.Text = "";
            if (Request.QueryString["msg"] != null)
            {
                lblMsg.Text = Request.QueryString["msg"].ToString();
            }

            if (!Page.IsPostBack)
            {

                string odr = " Order by tblDG_BOM_Master.Id Desc";
                fun.BindDataCustIMaster("tblDG_Item_Master,tblDG_BOM_Master,Unit_Master", " tblDG_BOM_Master.CId,tblDG_BOM_Master.Id,tblDG_BOM_Master.ItemId,tblDG_BOM_Master.WONo,tblDG_Item_Master.ItemCode,tblDG_Item_Master.ManfDesc,Unit_Master.Symbol As UOMBasic,tblDG_BOM_Master.Qty", "tblDG_Item_Master.Id=tblDG_BOM_Master.ItemId AND WONo='" + wono + "' AND tblDG_BOM_Master.PId='0' AND tblDG_Item_Master.UOMBasic = Unit_Master.Id  AND tblDG_BOM_Master.CompId='" + CompId + "' AND tblDG_BOM_Master.FinYearId<='" + FinYearId + "'", SearchGridView1, DropDownList1.SelectedValue, txtSearchCustomer.Text, odr);

                //string odr = " Order by tblDG_TPL_Master.Id Desc";
                //fun.BindDataCustIMaster("tblDG_Item_Master,tblDG_TPL_Master,Unit_Master,vw_Unit_Master", " tblDG_TPL_Master.CId,tblDG_TPL_Master.Id,tblDG_TPL_Master.ItemId,tblDG_TPL_Master.WONo,tblDG_Item_Master.ItemCode,tblDG_Item_Master.ManfDesc,tblDG_Item_Master.PurchDesc,Unit_Master.Symbol As UOMBasic,vw_Unit_Master.Symbol As UOMPurchase,tblDG_TPL_Master.Qty,tblDG_TPL_Master.Weldments,tblDG_TPL_Master.LH,tblDG_TPL_Master.RH", "tblDG_Item_Master.Id=tblDG_TPL_Master.ItemId AND WONo='" + wono + "' AND tblDG_TPL_Master.PId='0' AND tblDG_TPL_Master.CompId='" + CompId + "'AND tblDG_TPL_Master.FinYearId<='" + FinYearId + "'AND tblDG_Item_Master.UOMBasic = Unit_Master.Id AND tblDG_Item_Master.UOMPurchase=vw_Unit_Master.Id", SearchGridView1, DropDownList1.SelectedValue, txtSearchCustomer.Text, odr);


            }
        }
       catch (Exception es) { }
    }

    protected void SearchGridView1_PageIndexChanging(object sender, GridViewPageEventArgs e)
    {
        try
        {
            SearchGridView1.PageIndex = e.NewPageIndex;

            string odr = " Order by tblDG_BOM_Master.Id Desc";
            fun.BindDataCustIMaster("tblDG_Item_Master,tblDG_BOM_Master,Unit_Master", " tblDG_BOM_Master.CId,tblDG_BOM_Master.Id,tblDG_BOM_Master.ItemId,tblDG_BOM_Master.WONo,tblDG_Item_Master.ItemCode,tblDG_Item_Master.ManfDesc,Unit_Master.Symbol As UOMBasic,tblDG_BOM_Master.Qty", "tblDG_Item_Master.Id=tblDG_BOM_Master.ItemId AND WONo='" + wono + "' AND tblDG_BOM_Master.PId='0' AND tblDG_Item_Master.UOMBasic = Unit_Master.Id  AND tblDG_BOM_Master.CompId='" + CompId + "' AND tblDG_BOM_Master.FinYearId<='" + FinYearId + "'", SearchGridView1, DropDownList1.SelectedValue, txtSearchCustomer.Text, odr);

            //string odr = " Order by tblDG_TPL_Master.Id Desc";
            //fun.BindDataCustIMaster("tblDG_Item_Master,tblDG_TPL_Master,Unit_Master,vw_Unit_Master", " tblDG_TPL_Master.CId,tblDG_TPL_Master.Id,tblDG_TPL_Master.ItemId,tblDG_TPL_Master.WONo,tblDG_Item_Master.ItemCode,tblDG_Item_Master.ManfDesc,tblDG_Item_Master.PurchDesc,Unit_Master.Symbol As UOMBasic,vw_Unit_Master.Symbol As UOMPurchase,tblDG_TPL_Master.Qty,tblDG_TPL_Master.Weldments,tblDG_TPL_Master.LH,tblDG_TPL_Master.RH", "tblDG_Item_Master.Id=tblDG_TPL_Master.ItemId AND WONo='" + wono + "' AND tblDG_TPL_Master.PId='0'AND tblDG_TPL_Master.CompId='" + CompId + "'AND tblDG_TPL_Master.FinYearId<='" + FinYearId + "' AND tblDG_Item_Master.UOMBasic = Unit_Master.Id AND tblDG_Item_Master.UOMPurchase=vw_Unit_Master.Id", SearchGridView1, DropDownList1.SelectedValue, txtSearchCustomer.Text, odr);
        }
        catch (Exception es)
        {
        }
    }

    protected void btnSearch_Click(object sender, EventArgs e)
    {
       try
        {

            string odr = " Order by tblDG_BOM_Master.Id Desc";
            fun.BindDataCustIMaster("tblDG_Item_Master,tblDG_BOM_Master,Unit_Master", " tblDG_BOM_Master.CId,tblDG_BOM_Master.Id,tblDG_BOM_Master.ItemId,tblDG_BOM_Master.WONo,tblDG_Item_Master.ItemCode,tblDG_Item_Master.ManfDesc,Unit_Master.Symbol As UOMBasic,tblDG_BOM_Master.Qty", "tblDG_Item_Master.Id=tblDG_BOM_Master.ItemId AND WONo='" + wono + "' AND tblDG_BOM_Master.PId='0' AND tblDG_Item_Master.UOMBasic = Unit_Master.Id  AND tblDG_BOM_Master.CompId='" + CompId + "' AND tblDG_BOM_Master.FinYearId<='" + FinYearId + "'", SearchGridView1, DropDownList1.SelectedValue, txtSearchCustomer.Text, odr);
            //fun.BindDataCustIMaster("tblDG_Item_Master,tblDG_TPL_Master,Unit_Master,vw_Unit_Master", " tblDG_TPL_Master.CId,tblDG_TPL_Master.Id,tblDG_TPL_Master.ItemId,tblDG_TPL_Master.WONo,tblDG_Item_Master.ItemCode,tblDG_Item_Master.ManfDesc,tblDG_Item_Master.PurchDesc,Unit_Master.Symbol As UOMBasic,vw_Unit_Master.Symbol As UOMPurchase,tblDG_TPL_Master.Qty,tblDG_TPL_Master.Weldments,tblDG_TPL_Master.LH,tblDG_TPL_Master.RH", "tblDG_Item_Master.Id=tblDG_TPL_Master.ItemId AND WONo='" + wono + "' AND tblDG_TPL_Master.PId='0' AND tblDG_TPL_Master.CompId='" + CompId + "'AND tblDG_TPL_Master.FinYearId<='" + FinYearId + "'AND tblDG_Item_Master.UOMBasic = Unit_Master.Id AND tblDG_Item_Master.UOMPurchase=vw_Unit_Master.Id", SearchGridView1, DropDownList1.SelectedValue, txtSearchCustomer.Text, odr);
        
        }
       catch (Exception es)
        {
        }
    }

    protected void btnCancel_Click(object sender, EventArgs e)
    {
        Response.Redirect("TPL_Design_WO_TreeView.aspx?WONo=" + wonofrm + "&ModId=3&SubModId=23");
    }


    protected void chkSelectAll_CheckedChanged(object sender, EventArgs e)
    {
       try
        {
            CheckBox chkAll = (CheckBox)SearchGridView1.HeaderRow.FindControl("chkSelectAll");

            if (chkAll.Checked == true)
            {
                foreach (GridViewRow gvRow in SearchGridView1.Rows)
                {
                    CheckBox chkSel = (CheckBox)gvRow.FindControl("chkSelect");
                    chkSel.Checked = true;
                }
            }
            else
            {
                foreach (GridViewRow gvRow in SearchGridView1.Rows)
                {
                    CheckBox chkSel = (CheckBox)gvRow.FindControl("chkSelect");
                    chkSel.Checked = false;
                }
            }
        }
        catch (Exception ee)
        {
        }
    }

    protected void SearchGridView1_RowCommand(object sender, GridViewCommandEventArgs e)
    {
        //Copy Root Assly
       try
        {

            if (e.CommandName == "Add")
            {
                int j = 0;
                foreach (GridViewRow gvRow in SearchGridView1.Rows)
                {
                    CheckBox ck = (CheckBox)gvRow.FindControl("chkSelect");

                    if (ck.Checked == true)
                    {
                        int rowIndex = gvRow.RowIndex;
                        int srcCId = Convert.ToInt32(((Label)SearchGridView1.Rows[rowIndex].FindControl("CId")).Text);
                        int srcItemId = Convert.ToInt32(((Label)SearchGridView1.Rows[rowIndex].FindControl("ItemId")).Text);
                        int destCid = fun.getTPLCId(wono,CompId,FinYearId);
                        fun.getRootNode(srcCId, wono, wonofrm, CompId, SessionId, FinYearId, 0, destCid);
                        j++;
                    }
                }
                if(j>0)
                {
                Response.Redirect("TPL_Design_WO_TreeView.aspx?WONo=" + wono + "&ModId=3&SubModId=23&Msg=Copy of root assemblies are done.");
                }
            }
        }
        catch (Exception es)
        {

        }

    }   

}
