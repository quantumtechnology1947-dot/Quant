=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/HR/Transactions/GatePass_Print.aspx.txt ===

﻿<%@ Page Language="C#" MasterPageFile="~/MasterPage.master" AutoEventWireup="true" CodeFile="GatePass_Print.aspx.cs" Inherits="Module_HR_Transactions_GatePass_Print" Title="ERP" Theme="Default" %>


<%@ Register Assembly="CrystalDecisions.Web, Version=10.5.3700.0, Culture=neutral, PublicKeyToken=692fbea5521e1304"
    Namespace="CrystalDecisions.Web" TagPrefix="CR" %>
<%@ Register assembly="AjaxControlToolkit" namespace="AjaxControlToolkit" tagprefix="cc1" %>
<asp:Content ID="Content1" ContentPlaceHolderID="head" Runat="Server">
    <link href="../../../Css/StyleSheet.css" rel="stylesheet" type="text/css" />
<link href="../../../Css/yui-datatable.css" rel="stylesheet" type="text/css" />
<link href="../../../Css/styles.css" rel="stylesheet" type="text/css" />
<script src="../../../Javascript/loadingNotifier.js" type="text/javascript"></script>
<script src="../../../Javascript/PopUpMsg.js" type="text/javascript"></script> 
</asp:Content>
<asp:Content ID="Content2" ContentPlaceHolderID="cp3" Runat="Server">

</asp:Content>
<asp:Content ID="Content3" ContentPlaceHolderID="cp1" Runat="Server">
</asp:Content>
<asp:Content ID="Content4" ContentPlaceHolderID="cp2" Runat="Server">
</asp:Content>
<asp:Content ID="Content5" ContentPlaceHolderID="MainContent" Runat="Server">
</asp:Content>
<asp:Content ID="Content6" ContentPlaceHolderID="ContentPlaceHolder2" Runat="Server">

</asp:Content>
<asp:Content ID="Content7" ContentPlaceHolderID="ContentPlaceHolder3" Runat="Server">
    
    <table width="100%" cellpadding="0" cellspacing="0">
        <tr>
           
            <td align="left"  
                style="background:url(../../../images/hdbg.JPG)" height="21" 
                class="fontcsswhite" width="100%" colspan="7"><b>&nbsp;Gate Pass - Print </b></td>
           
        </tr>
        <tr valign="bottom">           
           
           <td align="left" height="25px" valign="bottom">
                &nbsp;</td>
            <td align="left" valign="bottom">
                &nbsp;</td> 
            <td align="left" valign="bottom">
                From Date: <asp:TextBox ID="txtFromDate" CssClass="box3" runat="server" 
                    Width="80px"></asp:TextBox>
                <cc1:CalendarExtender ID="txtFromDate_CalendarExtender" runat="server" CssClass="cal_Theme2" PopupPosition="BottomLeft"
                            Enabled="True" Format="dd-MM-yyyy" TargetControlID="txtFromDate">
                        </cc1:CalendarExtender>
            </td>
           
            <td align="left" valign="bottom">
                To Date: <asp:TextBox ID="txtToDate" CssClass="box3" runat="server" Width="80px"></asp:TextBox>
                <cc1:CalendarExtender ID="txtToDate_CalendarExtender" runat="server" CssClass="cal_Theme2" PopupPosition="BottomLeft"
                            Enabled="True" Format="dd-MM-yyyy" TargetControlID="txtToDate">
                </cc1:CalendarExtender>
            </td>
           
            <td align="left" valign="bottom">
                Employee&nbsp; Name: <asp:TextBox ID="txtEmpCode" CssClass="box3" 
                    runat="server" Width="250px"></asp:TextBox>
                <cc1:AutoCompleteExtender ID="Txt_AutoCompleteExtender" runat="server" 
                        CompletionInterval="100"
                         CompletionListCssClass="almt2" 
                        CompletionListHighlightedItemCssClass="bgtext"
                         CompletionListItemCssClass="bg" 
                        CompletionSetCount="2"
                         DelimiterCharacters="" Enabled="True" 
                        FirstRowSelected="True" 
                        MinimumPrefixLength="1" ServiceMethod="sql3" 
                        ServicePath=""
                         ShowOnlyCurrentWordInCompletionListItem="True" 
                        TargetControlID="txtEmpCode" UseContextKey="True">
                    </cc1:AutoCompleteExtender> 
                    
                    &nbsp; 
                    
                    <asp:Button ID="BtnSearch" runat="server" Text="Search" CssClass="redbox" 
                    onclick="BtnSearch_Click" />
            </td>
           
            <td align="left" valign="bottom">
                               
                &nbsp;</td>
           
            <td align="left" valign="bottom">
                &nbsp;</td>
            
           
        </tr>       
        
        <tr valign="bottom">  
           <td align="center" colspan="7">
             <iframe id="Iframe1"  runat ="server" width="100%" height="430px" frameborder="0" 
                   scrolling="auto" ></iframe>
           </td> 
        </tr>         
        </table>
        
    
       

</asp:Content>
<asp:Content ID="Content8" ContentPlaceHolderID="ContentPlaceHolder4" Runat="Server">
</asp:Content>



=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/HR/Transactions/GatePass_Print.aspx.cs ===

﻿using System;
using System.Collections;
using System.Configuration;
using System.Data;
using System.Linq;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Xml.Linq;
using System.Data.SqlClient;

public partial class Module_HR_Transactions_GatePass_Print : System.Web.UI.Page
{
    string connStr = "";
    SqlConnection con;
    int CompId = 0;
    int FinYearId = 0;
    clsFunctions fun = new clsFunctions();
    protected void Page_Load(object sender, EventArgs e)
    {
        try
        {
            connStr = fun.Connection();
            con = new SqlConnection(connStr);
            CompId = Convert.ToInt32(Session["compid"]);
            FinYearId = Convert.ToInt32(Session["finyear"]);

            txtFromDate.Attributes.Add("readonly", "readonly");
            txtToDate.Attributes.Add("readonly", "readonly");

        }
        catch (Exception ex)
        {
        }

    }
    protected void BtnSearch_Click(object sender, EventArgs e)
    {

        string z = "";// Onsite Date Wise
        string p = "";//Employee WIse
        string FDate = "";
        string TDate = "";
        string q="";
        string m="";

        if (txtFromDate.Text != string.Empty && txtToDate.Text != string.Empty)
        {
            FDate = (txtFromDate.Text);
            TDate = txtToDate.Text;
            z = " And tblGatePass_Details.FromDate Between '" + fun.FromDate(txtFromDate.Text) + "' And '" + fun.FromDate(txtToDate.Text) + "' ";
        }

        if (txtEmpCode.Text != string.Empty)
        {


            m = " And tblGate_Pass.EmpId='" + fun.getCode(txtEmpCode.Text) + "' ";

            string sqlInv = fun.select("tblGate_Pass.SessionId,tblGate_Pass.CompId,tblGate_Pass.SysDate,tblGate_Pass.Authorize,tblGate_Pass.EmpId As SelfEId,tblGate_Pass.Id,tblGate_Pass.FinYearId,tblGate_Pass.GPNo,tblGate_Pass.Authorize,tblGate_Pass.AuthorizedBy,tblGate_Pass.AuthorizeDate,tblGate_Pass.AuthorizeTime,tblGatePass_Details.FromDate,tblGatePass_Details.FromTime,tblGatePass_Details.ToTime,tblGatePass_Details.Type,tblGatePass_Details.TypeFor,tblGatePass_Details.Reason,tblGatePass_Details.Feedback,tblGatePass_Details.Id As DId,tblGatePass_Details.EmpId As OtherEId,tblGatePass_Details.Place,tblGatePass_Details.ContactPerson,tblGatePass_Details.ContactNo", "tblGate_Pass,tblGatePass_Details", "tblGate_Pass.Id=tblGatePass_Details.MId "+m);

            SqlCommand cmdInv = new SqlCommand(sqlInv, con);
            SqlDataAdapter DAInv = new SqlDataAdapter(cmdInv);
            DataSet DSInv = new DataSet();
            DAInv.Fill(DSInv);
            if (DSInv.Tables[0].Rows.Count > 0)
            {
                p = " And tblGate_Pass.EmpId='" + fun.getCode(txtEmpCode.Text) + "' ";

            }
            else
            {
                q = " And tblGatePass_Details.EmpId='" + fun.getCode(txtEmpCode.Text) + "' ";

           }       
        }
        string getRandomKey = fun.GetRandomAlphaNumeric();
        Iframe1.Attributes.Add("src", "GatePass_Print_Details.aspx?z=" + z + "&p=" + p + "&FDate=" + FDate + "&TDate=" + TDate + "&q=" + q + "&Key=" + getRandomKey + "");

       
    }

    [System.Web.Services.WebMethodAttribute(), System.Web.Script.Services.ScriptMethodAttribute()]
    public static string[] sql3(string prefixText, int count, string contextKey)
    {
        clsFunctions fun = new clsFunctions();
        string connStr = fun.Connection();
        DataSet ds = new DataSet();
        SqlConnection con = new SqlConnection(connStr);
        con.Open();
        int CompId = Convert.ToInt32(HttpContext.Current.Session["compid"]);
        string cmdStr2 = fun.select("EmpId,EmployeeName", "tblHR_OfficeStaff", "CompId='" + CompId + "'");
        SqlDataAdapter da2 = new SqlDataAdapter(cmdStr2, con);
        da2.Fill(ds, "tblMM_Supplier_master");
        con.Close();
        string[] main = new string[0];
        for (int i = 0; i < ds.Tables[0].Rows.Count; i++)
        {

            if (ds.Tables[0].Rows[i].ItemArray[1].ToString().ToLower().StartsWith(prefixText.ToLower()))
            {
                Array.Resize(ref main, main.Length + 1);
                main[main.Length - 1] = ds.Tables[0].Rows[i].ItemArray[1].ToString() + " [" + ds.Tables[0].Rows[i].ItemArray[0].ToString() + "]";
                //if (main.Length == 15)
                //    break;
            }

        }

        Array.Sort(main);
        return main;
    }
}