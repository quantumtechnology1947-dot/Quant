=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/Inventory/Transactions/SupplierChallan_Edit_Details.aspx.txt ===

﻿<%@ Page Language="C#" MasterPageFile="~/MasterPage.master" AutoEventWireup="true" CodeFile="SupplierChallan_Edit_Details.aspx.cs" Inherits="Module_Inventory_Transactions_SupplierChallan_Edit_Details" Title="ERP" Theme="Default" %>

<%@ Register assembly="AjaxControlToolkit" namespace="AjaxControlToolkit" tagprefix="cc1" %>
<asp:Content ID="Content1" ContentPlaceHolderID="head" Runat="Server">
    <link href="../../../Css/yui-datatable.css" rel="stylesheet" type="text/css" />
    <link href="../../../Css/StyleSheet.css" rel="stylesheet" type="text/css" />
    <script src="../../../Javascript/PopUpMsg.js" type="text/javascript"></script>
    <script src="../../../Javascript/loadingNotifier.js" type="text/javascript"></script>
    </asp:Content>
<asp:Content ID="Content2" ContentPlaceHolderID="cp3" Runat="Server">
</asp:Content>
<asp:Content ID="Content3" ContentPlaceHolderID="cp1" Runat="Server">
</asp:Content>
<asp:Content ID="Content4" ContentPlaceHolderID="cp2" Runat="Server">
</asp:Content>
<asp:Content ID="Content5" ContentPlaceHolderID="MainContent" Runat="Server">
</asp:Content>
<asp:Content ID="Content6" ContentPlaceHolderID="ContentPlaceHolder2" Runat="Server">
</asp:Content>
<asp:Content ID="Content7" ContentPlaceHolderID="ContentPlaceHolder3" Runat="Server">

    <script type="text/javascript">
        function OnChanged(sender, args)
        {
            ServerUtilities.SetTabIndex(sender.get_activeTabIndex());
        }
    </script>
    
      <cc1:TabContainer ID="TabContainer1" runat="server" ActiveTabIndex="0" 
                    AutoPostBack="true"
                    Width="100%" 
        onactivetabchanged="TabContainer1_ActiveTabChanged">
                    <cc1:TabPanel runat="server" HeaderText="Supplier Challan" ID="Add">                    
<ContentTemplate>
                        
                    <asp:Panel ID="Panel2" ScrollBars="Auto" runat="server">                    
                        
                         <table align="left" cellpadding="0" cellspacing="0" width="100%">
        <tr>
            <td height="5px" colspan="4" ></td>
        </tr>
                             <tr>
                                 <td colspan="4" height="5px">
                                     <asp:Panel ID="Panel1" runat="server" Height="360px" ScrollBars="Auto">
                                         <asp:GridView ID="GridView2" runat="server" AutoGenerateColumns="False" 
                                             CssClass="yui-datatable-theme" DataKeyNames="Id" 
                                             OnPageIndexChanging="GridView2_PageIndexChanging" 
                                             OnRowCommand="GridView2_RowCommand" style="position:static" Width="100%">
                                             <Columns>
                                                 <asp:TemplateField HeaderText="SN">
                                                     <ItemTemplate>
                                                         <%# Container.DataItemIndex+1 %>
                                                     </ItemTemplate>
                                                     <HeaderStyle Font-Size="10pt" />
                                                     <ItemStyle HorizontalAlign="Right" VerticalAlign="Top" Width="2%" />
                                                 </asp:TemplateField>
                                                 <asp:TemplateField>
                                                     <ItemTemplate>
                                                         <asp:CheckBox ID="CheckBox1" runat="server" AutoPostBack="true" 
                                                             oncheckedchanged="CheckBox1_CheckedChanged" />
                                                     </ItemTemplate>
                                                     <HeaderStyle Font-Size="10pt" />
                                                     <ItemStyle HorizontalAlign="Center" VerticalAlign="Top" Width="2%" />
                                                 </asp:TemplateField>
                                                 <asp:TemplateField HeaderText="Id" Visible="False">
                                                     <ItemTemplate>
                                                         <asp:Label ID="lblId" runat="server" Text='<%# Eval("Id") %>'></asp:Label>
                                                     </ItemTemplate>
                                                     <ItemStyle HorizontalAlign="Center" VerticalAlign="Top" />
                                                 </asp:TemplateField>
                                                 <asp:TemplateField HeaderText="PR NO">
                                                     <ItemTemplate>
                                                         <asp:Label ID="lblprNo" runat="server" Text='<%# Eval("PRNo") %>'></asp:Label>
                                                     </ItemTemplate>
                                                     <ItemStyle HorizontalAlign="Center" VerticalAlign="Top" Width="6%" />
                                                 </asp:TemplateField>
                                                 <asp:TemplateField HeaderText="WONo">
                                                     <ItemTemplate>
                                                         <asp:Label ID="lblWono" runat="server" Text='<%# Eval("WONo") %>'></asp:Label>
                                                     </ItemTemplate>
                                                     <ItemStyle HorizontalAlign="Center" VerticalAlign="Top" Width="6%" />
                                                 </asp:TemplateField>
                                                 <asp:TemplateField HeaderText="SC No">
                                                     <ItemTemplate>
                                                         <asp:Label ID="lblSCno" runat="server" Text='<%# Eval("SCNo") %>'></asp:Label>
                                                     </ItemTemplate>
                                                     <ItemStyle HorizontalAlign="Center" VerticalAlign="Top" Width="5%" />
                                                 </asp:TemplateField>
                                                 <asp:TemplateField HeaderText="Date">
                                                     <ItemTemplate>
                                                         <asp:Label ID="lblprDt" runat="server" Text='<%# Eval("SCDate") %>'></asp:Label>
                                                     </ItemTemplate>
                                                     <ItemStyle HorizontalAlign="Center" VerticalAlign="Top" Width="6%" />
                                                 </asp:TemplateField>
                                                 <asp:TemplateField HeaderText="Item Code">
                                                     <ItemTemplate>
                                                         <asp:Label ID="lblit" runat="server" Text='<%# Eval("ItemCode") %>'> </asp:Label>
                                                     </ItemTemplate>
                                                     <ItemStyle HorizontalAlign="Center" VerticalAlign="Top" Width="8%" />
                                                 </asp:TemplateField>
                                                 <asp:TemplateField HeaderText="Description">
                                                     <ItemTemplate>
                                                         <asp:Label ID="lbldesc" runat="server" Text='<%# Eval("ManfDesc") %>'>
                                                         </asp:Label>
                                                     </ItemTemplate>
                                                     <ItemStyle HorizontalAlign="Left" VerticalAlign="Top" Width="20%" />
                                                 </asp:TemplateField>
                                                 <asp:TemplateField HeaderText="UOM">
                                                     <ItemTemplate>
                                                         <asp:Label ID="lbluom" runat="server" Text='<%# Eval("UOM") %>'> </asp:Label>
                                                     </ItemTemplate>
                                                     <ItemStyle HorizontalAlign="Center" VerticalAlign="Top" Width="5%" />
                                                 </asp:TemplateField>
                                                 <asp:TemplateField HeaderText="PR Qty">
                                                     <ItemTemplate>
                                                         <asp:Label ID="lblprqty" runat="server" Text='<%# Eval("PRQty") %>'></asp:Label>
                                                     </ItemTemplate>
                                                     <ItemStyle HorizontalAlign="Right" VerticalAlign="Top" Width="4%" />
                                                 </asp:TemplateField>
                                                 <asp:TemplateField HeaderText="Remain Qty">
                                                     <ItemTemplate>
                                                         <asp:Label ID="lblrmnqty" runat="server" Text=""> </asp:Label>
                                                     </ItemTemplate>
                                                     <ItemStyle HorizontalAlign="Right" VerticalAlign="Top" Width="6%" />
                                                 </asp:TemplateField>
                                                 <asp:TemplateField HeaderText=" Challan Qty">
                                                     <ItemTemplate>
                                                         <asp:Label ID="LblCHQty" runat="server" Text='<%# Eval("ChallanQty") %>' 
                                                             Visible="false"></asp:Label>
                                                         <asp:TextBox ID="txtqty" runat="server" CssClass="box3" 
                                                             Text='<%# Eval("ChallanQty") %>' Width="80%">
                                                         </asp:TextBox>
                                                         <asp:RequiredFieldValidator ID="ReqChNo" runat="server" 
                                                             ControlToValidate="txtqty" ErrorMessage="*" ValidationGroup="A">
                                                         </asp:RequiredFieldValidator>
                                                         <asp:RegularExpressionValidator ID="RegularExpressionValidator2" runat="server" 
                                                             ControlToValidate="txtqty" ErrorMessage="*" 
                                                             ValidationExpression="^\d{1,15}(\.\d{0,3})?$" ValidationGroup="A">
                                                         </asp:RegularExpressionValidator>
                                                     </ItemTemplate>
                                                     <ItemStyle HorizontalAlign="Left" VerticalAlign="Top" Width="8%" />
                                                 </asp:TemplateField>
                                             </Columns>
                                             <EmptyDataTemplate>
                                                 <table class="fontcss" width="100%">
                                                     <tr>
                                                         <td align="center">
                                                             <asp:Label ID="Label1" runat="server" Font-Size="Larger" ForeColor="maroon" 
                                                                 Text="No data to display !"> </asp:Label>
                                                         </td>
                                                     </tr>
                                                 </table>
                                             </EmptyDataTemplate>
                                             <FooterStyle Font-Bold="False" />
                                             <HeaderStyle Font-Size="9pt" />
                                             <PagerSettings PageButtonCount="40" />
                                         </asp:GridView>
                                     </asp:Panel>
                                 </td>
                             </tr>
                             <tr>
                                 <td colspan="4" height="5px" 
                                     style="border-bottom-style: solid; border-width: thin; border-color: #808080">
                                     &nbsp;</td>
                             </tr>
                             <tr>
                                 <td height="24px" 
                                     style="border-left-style: solid; border-width: medium; border-color: #808080" 
                                     width="1%">
                                     &nbsp;</td>
                                 <td height="5px" valign="middle" width="30%">
                                     Vehicle No. :
                                     <asp:TextBox ID="txtVehicleNo" runat="server" CssClass="box3" Width="200px"></asp:TextBox>
                                 </td>
                                 <td align="right" height="5px" valign="middle" width="10%">
                                     Remarks :</td>
                                 <td height="5px" rowspan="2" 
                                     style="border-width: thin; border-color: #808080; height: 10px; border-right-style: solid;" 
                                     valign="middle" width="56%">
                                     <asp:TextBox ID="txtRemarks" runat="server" Height="38px" TextMode="MultiLine" 
                                         Width="98%"></asp:TextBox>
                                 </td>
                             </tr>
                             <tr>
                                 <td height="24px" 
                                     style="border-left-style: solid; border-width: medium; border-color: #808080" 
                                     width="1%">
                                     &nbsp;</td>
                                 <td height="5px" valign="middle" width="30%">
                                     Transpoter :
                                     <asp:TextBox ID="txtTranspoter" runat="server" CssClass="box3" Width="200px"></asp:TextBox>
                                 </td>
                                 <td height="5px" width="10%">
                                     &nbsp;</td>
                             </tr>
        <tr>
            <td align="left"  valign="top" colspan="4">
               
                            <table align="left" cellpadding="0" cellspacing="0" width="100%" >
                                <tr>
                                    <td valign="middle" align="center" height="24px" 
                                        style="border-top-style: solid; border-width: thin; border-color: #808080"  >
                                        <asp:Button ID="BtnAdd" runat="server" CssClass="redbox" OnClick="BtnAdd_Click" 
                                            OnClientClick=" confirmationUpdate()" Text="Update" ValidationGroup="A" />
                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<asp:Button ID="Btncancel" runat="server" CssClass="redbox" 
                                            OnClick="Btncancel_Click" Text="Cancel" />
                                    </td>
                                </tr>
                                
                            </table>
                      
                   </td>
        </tr>
        
    </table> </asp:Panel></ContentTemplate></cc1:TabPanel>
    
       <cc1:TabPanel ID="View" runat="server" HeaderText="Clear Challan">
                    <ContentTemplate>
                     <asp:Panel ID="Panel3" ScrollBars="Auto" runat="server">                    
                        
                         <table align="left" width="100%" cellpadding="0" cellspacing="0" >
        <tr>
            <td height="5px" ></td>
        </tr>
        <tr>
            <td align="left"  valign="top">
               
                            <table align="left" cellpadding="0" width="100%" cellspacing="0" >
                               
                                <tr>
                                    <td valign="top" align="center"  >
                                        <asp:Panel ID="Panel4" ScrollBars="Auto" Height="395px" runat="server">
                                       
                                      
                                            <asp:GridView ID="GridView1" runat="server"
                                                AutoGenerateColumns="False" CssClass="yui-datatable-theme" DataKeyNames="Id"
                                                 style="position:static" 
                                                Width="100%" >
                                                
                                                <Columns>
                                                    <asp:TemplateField HeaderText="SN">
                                                        <ItemTemplate>
                                                            <%# Container.DataItemIndex+1 %>
                                                        </ItemTemplate>
                                                        <HeaderStyle Font-Size="10pt" />
                                                        <ItemStyle HorizontalAlign="Right" VerticalAlign="Top" Width="2%" />
                                                    </asp:TemplateField>
                                                    <asp:TemplateField>
                                                        <ItemTemplate>
                                                 <asp:CheckBox ID="CheckBox2" runat="server" AutoPostBack="true" oncheckedchanged="CheckBox2_CheckedChanged"
                                                 />
                                                
                                                        </ItemTemplate>                                                         
                                                        <HeaderStyle Font-Size="10pt" />
                                                        <ItemStyle HorizontalAlign="Center" VerticalAlign="Top" Width="2%" />
                                                    </asp:TemplateField>
                                                    
                                                     <asp:TemplateField HeaderText="PR NO">
                                                        <ItemTemplate>
                                                           <asp:Label ID="lblprNo1" runat="server" Text='<%# Eval("PRNo") %>'></asp:Label>
                                                    </ItemTemplate>
                                                        <ItemStyle VerticalAlign="Top" HorizontalAlign="Center" Width="6%" />
                                                    </asp:TemplateField>     
                                                     <asp:TemplateField HeaderText="WONo">
                                                        <ItemTemplate>
                                                           <asp:Label ID="lblWono1" runat="server" Text='<%# Eval("WONo") %>'></asp:Label>
                                                    </ItemTemplate>
                                                        <ItemStyle VerticalAlign="Top" HorizontalAlign="Center" Width="6%" />
                                                    </asp:TemplateField> 
                                                    
                                                    <asp:TemplateField HeaderText="SC No">
                                                        <ItemTemplate>
                                                           <asp:Label ID="lblSCNo1" runat="server" Text='<%# Eval("SCNo") %>'></asp:Label>
                                                    </ItemTemplate>
                                                        <ItemStyle VerticalAlign="Top" HorizontalAlign="Center" Width="6%" />
                                                    </asp:TemplateField> 
                                                     <asp:TemplateField HeaderText="Date">
                                                        <ItemTemplate>
                                                           <asp:Label ID="lblprDt1" runat="server" Text='<%# Eval("PRDate") %>'></asp:Label>
                                                    </ItemTemplate>
                                                        <ItemStyle VerticalAlign="Top" HorizontalAlign="Center" Width="6%" />
                                                    </asp:TemplateField> 
                                                    
                                                    
                                                    <asp:TemplateField  Visible="false" HeaderText="Id">
                                                        <ItemTemplate>
                                                           <asp:Label ID="lblId1" runat="server" Text='<%# Eval("Id") %>'></asp:Label>
                                                    </ItemTemplate>
                                                        <ItemStyle VerticalAlign="Top" HorizontalAlign="Center" Width="6%" />
                                                    </asp:TemplateField> 
                                                    
                                                     <asp:TemplateField  Visible="false">
                                                        <ItemTemplate>
                                                           <asp:Label ID="lblDId1" runat="server" Text='<%# Eval("DId") %>'></asp:Label>
                                                    </ItemTemplate>
                                                        <ItemStyle VerticalAlign="Top" HorizontalAlign="Center" Width="6%" />
                                                    </asp:TemplateField> 
                                                    
                                                                                                  
                                                   
                                                   
                                                  
                                                     <asp:TemplateField HeaderText="Item Code">
                                                        <ItemTemplate>
                                                            <asp:Label ID="lblit" runat="server" Text='<%# Eval("ItemCode") %>'> </asp:Label>
                                                        </ItemTemplate>
                                                        <ItemStyle HorizontalAlign="Center" Width="8%" VerticalAlign="Top" />
                                                    </asp:TemplateField>
                                                    <asp:TemplateField HeaderText="Description">
                                                        <ItemTemplate>
                                                            <asp:Label ID="lbldesc" runat="server" Text='<%# Eval("Descr") %>'> </asp:Label>
                                                        </ItemTemplate>
                                                        <ItemStyle HorizontalAlign="Left" Width="20%" VerticalAlign="Top" />
                                                    </asp:TemplateField>
                                                    <asp:TemplateField HeaderText="UOM">
                                                        <ItemTemplate>
                                                            <asp:Label ID="lbluom" runat="server" Text='<%# Eval("Symbol") %>'> </asp:Label>
                                                        </ItemTemplate>
                                                        <ItemStyle HorizontalAlign="Center" VerticalAlign="Top" Width="5%" />
                                                    </asp:TemplateField>
                                                    
                                                    <asp:TemplateField HeaderText="Challan Qty">
                                                        <ItemTemplate>
                                                           <asp:Label ID="lblprqty" runat="server" Text='<%# Eval("ChallanQty") %>'></asp:Label>
                                                    </ItemTemplate>
                                                        <ItemStyle VerticalAlign="Top" HorizontalAlign="Right" Width="6%" />
                                                    </asp:TemplateField> 
                                                    
                                                    <asp:TemplateField HeaderText="Cleared Qty">
                                                        <ItemTemplate>
                                                           <asp:Label ID="lblqty" runat="server" Text=""></asp:Label>
                                                    </ItemTemplate>
                                                        <ItemStyle VerticalAlign="Top" HorizontalAlign="Right" Width="6%" />
                                                    </asp:TemplateField> 
                                                   
                                                   
                                                     <asp:TemplateField HeaderText=" Clear Qty">
                                                        <ItemTemplate>
                                                            <asp:TextBox ID="txtqty" Width="80%" Text='<%# Eval("ClearedQty") %>'  CssClass="box3" runat="server"></asp:TextBox>
        <asp:RegularExpressionValidator ID="RegularExpressionValidator2" runat="server" ErrorMessage="*" ControlToValidate="txtqty" ValidationExpression="^\d{1,15}(\.\d{0,3})?$" ValidationGroup="B"></asp:RegularExpressionValidator>
                                    <asp:RequiredFieldValidator
                                        ID="ReqChNo" runat="server" ErrorMessage="*"  ValidationGroup="B" ControlToValidate="txtqty"></asp:RequiredFieldValidator>
                                                          
                                                    </ItemTemplate>
                                                    
                                                        <ItemStyle VerticalAlign="Top" HorizontalAlign="Left" Width="10%" />
                                                    </asp:TemplateField> 
                                                
                                                    
                                                </Columns>
                                                <EmptyDataTemplate>
                    <table width="100%" class="fontcss">
                    <tr>
                    <td align="center">
                    <asp:Label ID="Label1" runat="server"  Text="No data to display !" Font-Size="Larger" ForeColor="maroon">
                    </asp:Label>
                    
                   
                    </td>
                    </tr>
                    </table>
                    </EmptyDataTemplate>
                                                <FooterStyle Font-Bold="False" />
                                                <HeaderStyle Font-Size="9pt" />
                                            </asp:GridView>
                                        </asp:Panel>
                                        
                                    </td>
                                </tr>
                                
                                <tr>
                                    <td valign="top" align="center"  >
                                        <asp:Button ID="BtnAdd1" ValidationGroup="B"  runat="server"  CssClass="redbox" 
                                            Text="Update" onclick="BtnAdd1_Click" />                                            
                                        
                                        &nbsp;<asp:Button ID="BtnCancel1"  runat="server"  CssClass="redbox" 
                                            Text="Cancel" onclick="BtnCancel1_Click"  /> 
                                        
                                    </td>
                                </tr>
                                
                            </table>
                      
                   </td>
        </tr>
        
    </table>
                        </asp:Panel>
                    </ContentTemplate>
                    </cc1:TabPanel>
    </cc1:TabContainer>
</asp:Content>
<asp:Content ID="Content8" ContentPlaceHolderID="ContentPlaceHolder4" Runat="Server">
</asp:Content>




=== FILE: /Users/shiv/workspace/syncortext/NewERP/Module/Inventory/Transactions/SupplierChallan_Edit_Details.aspx.cs ===

﻿using System;
using System.Collections;
using System.Configuration;
using System.Data;
using System.Linq;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Xml.Linq;
using System.Data.SqlClient;

public partial class Module_Inventory_Transactions_SupplierChallan_Edit_Details : System.Web.UI.Page
{
    clsFunctions fun = new clsFunctions();  
    string sId = "";
    int CompId = 0;  
    int fyid = 0;

    string supid = "";
    string str = "";
    SqlConnection con;
    string CDate = "";
    string CTime = "";
    int id = 0;
    int popup = 0;
    protected void Page_Load(object sender, EventArgs e)
    {
        try
        {
            CompId = Convert.ToInt32(Session["compid"]);
            fyid = Convert.ToInt32(Session["finyear"]);           
            sId = Session["username"].ToString();
            id = Convert.ToInt32(Request.QueryString["Id"]);
            str = fun.Connection();
            con = new SqlConnection(str);           
            CDate = fun.getCurrDate();
            CTime = fun.getCurrTime();
            if (!IsPostBack)
            {
                this.fillGrid();                
            }
            this.disableCheck();
        }
        catch (Exception es)
        {

        }
    }
    public void disableCheck()
    {
        try
        {
            con.Open();
            foreach (GridViewRow grv in GridView2.Rows)
            {
                double TotDiffQty = 0;
                int Id = Convert.ToInt32(((Label)grv.FindControl("lblId")).Text);
                string PRSQL = fun.select("tblInv_Supplier_Challan_Details.PRDId,tblInv_Supplier_Challan_Master.SupplierId", "  tblInv_Supplier_Challan_Details,tblInv_Supplier_Challan_Master ", " tblInv_Supplier_Challan_Master.Id= tblInv_Supplier_Challan_Details.MId And tblInv_Supplier_Challan_Details.Id=" + Id + "");
                SqlCommand CmdPR = new SqlCommand(PRSQL, con);
                SqlDataAdapter DAPR = new SqlDataAdapter(CmdPR);
                DataSet DSPR = new DataSet();
                DAPR.Fill(DSPR);
                if (DSPR.Tables[0].Rows.Count > 0)
                {
                    SqlCommand sqlCmd;
                    sqlCmd = new SqlCommand("GetSupplier_PR_ChQty", con);
                    sqlCmd.CommandType = CommandType.StoredProcedure;
                    sqlCmd.Parameters.Add(new SqlParameter("@SupId", SqlDbType.VarChar));
                    sqlCmd.Parameters.Add(new SqlParameter("@Id", SqlDbType.VarChar));
                    sqlCmd.Parameters["@SupId"].Value = DSPR.Tables[0].Rows[0]["SupplierId"].ToString();
                    sqlCmd.Parameters["@Id"].Value = DSPR.Tables[0].Rows[0]["PRDId"].ToString();
                    SqlDataReader rdr = sqlCmd.ExecuteReader(CommandBehavior.CloseConnection);
                    rdr.Read();
                    if (rdr.HasRows)
                    {
                        TotDiffQty = Convert.ToDouble(decimal.Parse(rdr[0].ToString()).ToString("N3"));
                    }
                }
                ((Label)grv.FindControl("lblrmnqty")).Text = decimal.Parse((TotDiffQty).ToString()).ToString("N3");

            }
        }
        catch (Exception ex)
        {
        }
        finally
        {
            con.Close();
        }

    }

    public void GetValidate()
    {
        try
        {
            foreach (GridViewRow grv in GridView2.Rows)
            {
                if (((CheckBox)grv.FindControl("CheckBox1")).Checked == true)
                {
                    ((RequiredFieldValidator)grv.FindControl("ReqChNo")).Visible = true;
                    ((TextBox)grv.FindControl("txtqty")).Enabled = true;

                }
                else
                {
                    ((RequiredFieldValidator)grv.FindControl("ReqChNo")).Visible = false;
                    ((TextBox)grv.FindControl("txtqty")).Enabled = false;
                }
            }
        }

       catch (Exception ex) { }

    }
    public void GetValidates()
    {
      try
        {
            foreach (GridViewRow grv in GridView1.Rows)
            {
                int Id = Convert.ToInt32(((Label)grv.FindControl("lblDId1")).Text);
                if (((CheckBox)grv.FindControl("CheckBox2")).Checked == true)
                {
                    ((RequiredFieldValidator)grv.FindControl("ReqChNo")).Visible = true;
                    ((TextBox)grv.FindControl("txtqty")).Enabled = true;

                }
                else
                {
                    ((RequiredFieldValidator)grv.FindControl("ReqChNo")).Visible = false;
                    ((TextBox)grv.FindControl("txtqty")).Enabled = false;
                }

                double TotClearedQty = 0;
                double ChallanQty = 0;
                ChallanQty = Convert.ToDouble(decimal.Parse(((Label)grv.FindControl("lblprqty")).Text).ToString("N3"));
                string StrSql3 = "SELECT  Sum(tblInv_Supplier_Challan_Clear.ClearedQty) As Qty  FROM  tblInv_Supplier_Challan_Clear INNER JOIN tblInv_Supplier_Challan_Details ON tblInv_Supplier_Challan_Clear.DId = tblInv_Supplier_Challan_Details.Id   And tblInv_Supplier_Challan_Clear.DId=" + Id + "";
                SqlCommand cmd3 = new SqlCommand(StrSql3, con);
                SqlDataAdapter da3 = new SqlDataAdapter(cmd3);
                DataSet DS3 = new DataSet();
                da3.Fill(DS3);
                if (DS3.Tables[0].Rows.Count > 0 && DS3.Tables[0].Rows[0][0] != DBNull.Value)
                {
                    TotClearedQty = Convert.ToDouble(decimal.Parse(DS3.Tables[0].Rows[0][0].ToString()).ToString("N3"));
                }
                ((Label)grv.FindControl("lblqty")).Text = decimal.Parse((TotClearedQty).ToString()).ToString("N3");               
            }
        }

        catch (Exception ex) { }

    }
    public void fillGrid()
    {
        try
        {
            con.Open();
            SqlCommand da = new SqlCommand("GetChallan_Details", con);
            da.CommandType = CommandType.StoredProcedure;
            da.Parameters.Add(new SqlParameter("@Id", SqlDbType.VarChar));
            da.Parameters.Add(new SqlParameter("@CompId", SqlDbType.VarChar));
            da.Parameters["@Id"].Value = id;
            da.Parameters["@CompId"].Value = CompId;
            SqlDataReader rdr = da.ExecuteReader(CommandBehavior.CloseConnection);
            DataTable dt = new DataTable();
            dt.Load(rdr);
            GridView2.DataSource = dt;
            GridView2.DataBind();
            this.disableCheck();
            this.GetValidate();

            txtRemarks.Text = dt.Rows[0]["Remarks"].ToString ();
            txtVehicleNo.Text = dt.Rows[0]["VehicleNo"].ToString();
            txtTranspoter.Text = dt.Rows[0]["Transpoter"].ToString();

        }
        catch (Exception ex)
        {
        }
        finally
        {
            con.Close();
        }
    }
    public void LoadGrid()
    {
        con.Open();
        try
        {
            SqlCommand da = new SqlCommand("GetSup_Challan_Clear_Edit", con);
            da.CommandType = CommandType.StoredProcedure;
            da.Parameters.Add(new SqlParameter("@Id", SqlDbType.VarChar));
            da.Parameters.Add(new SqlParameter("@CompId", SqlDbType.VarChar));
            da.Parameters.Add(new SqlParameter("@FinYearId", SqlDbType.VarChar));
            da.Parameters["@Id"].Value = id;
            da.Parameters["@CompId"].Value = CompId;
            da.Parameters["@FinYearId"].Value = fyid;
            SqlDataReader rdr = da.ExecuteReader(CommandBehavior.CloseConnection);
            DataTable dt = new DataTable();
            dt.Load(rdr);
            GridView1.DataSource = dt;

            GridView1.DataBind();
            this.GetValidates();
        }
        catch (Exception ex)
        {
        }
        finally
        {
            con.Close();
        }
    }
    protected void GridView2_PageIndexChanging(object sender, GridViewPageEventArgs e)
    {

    }
    protected void GridView2_RowCommand(object sender, GridViewCommandEventArgs e)
    {

    }
    protected void CheckBox1_CheckedChanged(object sender, EventArgs e)
    {
        this.GetValidate();
    }
    protected void BtnAdd_Click(object sender, EventArgs e)
    {
        try
        {
           
            int y = 0;
            int x = 0;
            int k = 0;
            int s = 0;

            foreach (GridViewRow grv in GridView2.Rows)
            {
                if (((CheckBox)grv.FindControl("CheckBox1")).Checked == true)
                {
                    x++;
                    if (((CheckBox)grv.FindControl("CheckBox1")).Checked == true && ((TextBox)grv.FindControl("txtqty")).Text != "" && fun.NumberValidationQty(((TextBox)grv.FindControl("txtqty")).Text) == true && Convert.ToDouble(((TextBox)grv.FindControl("txtqty")).Text) != 0)
                    {
                        double lblQty = Convert.ToDouble(decimal.Parse(((Label)grv.FindControl("LblCHQty")).Text).ToString("N3"));
                        double rmnQty = Convert.ToDouble(decimal.Parse(((Label)grv.FindControl("lblrmnqty")).Text).ToString("N3"));
                        double Qty = Convert.ToDouble(decimal.Parse(((TextBox)grv.FindControl("txtqty")).Text).ToString("N3"));
                        double PrQty = Convert.ToDouble(decimal.Parse(((Label)grv.FindControl("lblprqty")).Text).ToString("N3"));
                        int Id = Convert.ToInt32(((Label)grv.FindControl("lblId")).Text);
                        double TotChalnQty = 0;                        
                        string StrSql3 = "select ChallanQty From View_Sup_PR_Challan_Calc where SupplierId='" + supid + "' And Id="+Id+"";
                        SqlCommand cmd3 = new SqlCommand(StrSql3, con);
                        SqlDataAdapter da3 = new SqlDataAdapter(cmd3);
                        DataSet DS3 = new DataSet();
                        da3.Fill(DS3);
                        if (DS3.Tables[0].Rows.Count > 0 && DS3.Tables[0].Rows[0][0] != DBNull.Value)
                        {
                            TotChalnQty = Convert.ToDouble(decimal.Parse(DS3.Tables[0].Rows[0][0].ToString()).ToString("N3"));
                        }

                        if (Convert.ToDouble(decimal.Parse((PrQty - (Qty + TotChalnQty)).ToString()).ToString("N3")) >= 0  &&  (rmnQty+lblQty-Qty)>=0 )
                        {
                            y++;
                        }


                    }
                }

            }

            if (x == y && x == 0 && y == 0)
            {
                string StrSCMaster1 = fun.update("tblInv_Supplier_Challan_Master", "SysDate='" + CDate + "',SysTime='" + CTime + "',SessionId='" + sId + "',Remarks='" + txtRemarks.Text + "',VehicleNo='" + txtVehicleNo.Text + "',Transpoter='" + txtTranspoter.Text + "'", "Id='" + id + "'");
                SqlCommand cmd111 = new SqlCommand(StrSCMaster1, con);
                con.Open();
                cmd111.ExecuteNonQuery();
                con.Close();
                s++;
                popup++;
            }

            if (x == y && y > 0)
            {
                DataSet DS = new DataSet();

                {
                    string StrSCMaster = fun.update("tblInv_Supplier_Challan_Master", "SysDate='" + CDate + "',SysTime='" + CTime + "',SessionId='" + sId + "',Remarks='" + txtRemarks.Text + "',VehicleNo='" + txtVehicleNo.Text + "',Transpoter='" + txtTranspoter.Text + "'", "Id='" + id + "'");
                    SqlCommand cmd11 = new SqlCommand(StrSCMaster, con);
                    con.Open();
                    cmd11.ExecuteNonQuery();
                    con.Close();

                    foreach (GridViewRow grv in GridView2.Rows)
                    {
                        int Id = Convert.ToInt32(((Label)grv.FindControl("lblId")).Text);

                        if (((CheckBox)grv.FindControl("CheckBox1")).Checked == true && ((TextBox)grv.FindControl("txtqty")).Text != "" && fun.NumberValidationQty(((TextBox)grv.FindControl("txtqty")).Text) == true && Convert.ToDouble(((TextBox)grv.FindControl("txtqty")).Text) != 0)
                        {

                            double Qty = Convert.ToDouble(decimal.Parse(((TextBox)grv.FindControl("txtqty")).Text).ToString("N3"));


                            SqlCommand exeme2 = new SqlCommand(fun.update("tblInv_Supplier_Challan_Details", "ChallanQty='" + Qty + "'", "Id='" + Id + "'"), con);
                            con.Open();
                            exeme2.ExecuteNonQuery();
                            con.Close();
                            k++;

                        }
                    }
                }
            }
            else
            {
                if (s == 0)
                {
                    string myStringVariable = string.Empty;
                    myStringVariable = "Invalid input data.";
                    ClientScript.RegisterStartupScript(this.GetType(), "myalert", "alert('" + myStringVariable + "');", true);
                }
               
            }

            if (k > 0)
            {
                this.fillGrid();
                popup++;               
            }
            this.PopUp(popup);
         
        }
        catch (Exception ex) { }
    }
    protected void Btncancel_Click(object sender, EventArgs e)
    {
        Response.Redirect("~/Module/Inventory/Transactions/SupplierChallan_Edit.aspx?ModId=9&SubModId=118");
    }
    protected void TabContainer1_ActiveTabChanged(object sender, EventArgs e)
    {
        if (TabContainer1.ActiveTabIndex == 1)
        {
            this.LoadGrid();
        }
    }    
    protected void CheckBox2_CheckedChanged(object sender, EventArgs e)
    {
        this.GetValidates();
    }
    protected void BtnAdd1_Click(object sender, EventArgs e)
   {
       try
       {

           int y = 0;
           int x = 0;
           int k = 0;

           foreach (GridViewRow grv in GridView1.Rows)
           {
               if (((CheckBox)grv.FindControl("CheckBox2")).Checked == true)
               {
                   x++;
                   if (((CheckBox)grv.FindControl("CheckBox2")).Checked == true && ((TextBox)grv.FindControl("txtqty")).Text != "" && fun.NumberValidationQty(((TextBox)grv.FindControl("txtqty")).Text) == true && Convert.ToDouble(((TextBox)grv.FindControl("txtqty")).Text) != 0)
                   {

                       double CleardQty = Convert.ToDouble(decimal.Parse(((TextBox)grv.FindControl("txtqty")).Text).ToString("N3"));
                       double ChallanQty = Convert.ToDouble(decimal.Parse(((Label)grv.FindControl("lblprqty")).Text).ToString("N3"));
                       int Id = Convert.ToInt32(((Label)grv.FindControl("lblDId1")).Text);
                       double TotChalnQty = 0;
                       string StrSql3 = "SELECT  Sum(tblInv_Supplier_Challan_Clear.ClearedQty) As Qty  FROM  tblInv_Supplier_Challan_Clear INNER JOIN tblInv_Supplier_Challan_Details ON tblInv_Supplier_Challan_Clear.DId = tblInv_Supplier_Challan_Details.Id   And tblInv_Supplier_Challan_Clear.DId=" + Id + "";
                       SqlCommand cmd3 = new SqlCommand(StrSql3, con);
                       SqlDataAdapter da3 = new SqlDataAdapter(cmd3);
                       DataSet DS3 = new DataSet();
                       da3.Fill(DS3);
                       if (DS3.Tables[0].Rows.Count > 0 && DS3.Tables[0].Rows[0][0] != DBNull.Value)
                       {
                           TotChalnQty = Convert.ToDouble(decimal.Parse(DS3.Tables[0].Rows[0][0].ToString()).ToString("N3"));
                       }



                       if (ChallanQty - CleardQty >= 0)
                      // if (Convert.ToDouble(decimal.Parse((ChallanQty - (CleardQty + TotChalnQty)).ToString()).ToString("N3")) >= 0)
                       {
                           y++;
                       }


                   }
               }

           }

           if (x == y && y > 0)
           {

               foreach (GridViewRow grv in GridView1.Rows)
               {
                   if (((CheckBox)grv.FindControl("CheckBox2")).Checked == true && ((TextBox)grv.FindControl("txtqty")).Text != "" && fun.NumberValidationQty(((TextBox)grv.FindControl("txtqty")).Text) == true && Convert.ToDouble(((TextBox)grv.FindControl("txtqty")).Text) != 0)
                   {

                       double CleardQty = Convert.ToDouble(decimal.Parse(((TextBox)grv.FindControl("txtqty")).Text).ToString("N3"));
                       int DId = Convert.ToInt32(((Label)grv.FindControl("lblId1")).Text);                      
                       SqlCommand exeme2 = new SqlCommand(fun.update("tblInv_Supplier_Challan_Clear", "SysDate='" + CDate + "',SysTime='" + CTime + "',CompId=" + CompId + ",FinYearId=" + fyid + ",SessionId='" + sId + "',ClearedQty=" + CleardQty + "", "Id="+DId+""), con);

                       con.Open();
                       exeme2.ExecuteNonQuery();
                       con.Close();
                       k++;

                   }
               }

           }

           else
           {
               string myStringVariable = string.Empty;
               myStringVariable = "Invalid input data.";
               ClientScript.RegisterStartupScript(this.GetType(), "myalert", "alert('" + myStringVariable + "');", true);

           }
           if (k > 0)
           {
               this.LoadGrid();
           }

       }
       catch (Exception ex) { }
    }
    protected void BtnCancel1_Click(object sender, EventArgs e)
    {       
        Response.Redirect("~/Module/Inventory/Transactions/SupplierChallan_Edit.aspx?ModId=9&SubModId=118");
    }

    public void PopUp(int popup)
    {
        if(popup>0)
        {

            string myStringVariable = string.Empty;
            myStringVariable = "Data updated successfully.";
            ClientScript.RegisterStartupScript(this.GetType(), "myalert", "alert('" + myStringVariable + "');", true);
            popup = 0;
        }
        else 
        {
            popup = 0;
        }
    }
}
